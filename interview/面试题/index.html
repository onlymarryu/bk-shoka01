<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/atom.xml"><link rel="alternate" type="application/json" title="每天进步一点点，就是成功的开始" href="https://eth168.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="面试"><link rel="canonical" href="https://eth168.top/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/"><title>面试题 - 面试 | 雾都博客 = 每天进步一点点，就是成功的开始</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">面试题</h1><div class="meta"><span class="item" title="创建时间：2023-01-12 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-01-12T00:00:00+08:00">2023-01-12</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>89k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>1:21</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">雾都博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://api.yimian.xyz/img?929155"></li><li class="item" data-background-image="https://api.yimian.xyz/img?733098"></li><li class="item" data-background-image="https://api.yimian.xyz/img?823908"></li><li class="item" data-background-image="https://api.yimian.xyz/img?747248"></li><li class="item" data-background-image="https://api.yimian.xyz/img?155844"></li><li class="item" data-background-image="https://api.yimian.xyz/img?988106"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="item" rel="index" title="分类于 面试"><span itemprop="name">面试</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://eth168.top/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="雾都"><meta itemprop="description" content=", 花非花，雾非雾"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="每天进步一点点，就是成功的开始"></span><div class="body md" itemprop="articleBody"><h1 id="javase基础不含集合之后的内容"><a class="anchor" href="#javase基础不含集合之后的内容">#</a> javaSE 基础 (不含集合之后的内容)</h1><h3 id="创建java对象方式"><a class="anchor" href="#创建java对象方式">#</a> 创建 JAVA 对象方式</h3><p>一共 5 种</p><p>1、new 申请空间，执行构造方法</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>2、通过 Class 类中，newInstance () 方法，默认去找空参（不建议）</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Class</span> cla <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span>cla<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>3、通过 Construction 类中的 newInstance () 找到对应构造方法去创建</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Class</span> cla <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Construction</span> construction <span class="token operator">=</span> cla<span class="token punctuation">.</span><span class="token function">getConstruction</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span>construction<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>4、通过 Object 类中的 Clone ()</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 要实现 Cloneable 重写</span></pre></td></tr></table></figure><p>5、通过对象的反序列化</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Person</span> pp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span>ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="new一个对象的顺序内含代码块"><a class="anchor" href="#new一个对象的顺序内含代码块">#</a> new 一个对象的顺序 (内含代码块)</h3><ul><li>假设一个类他的父类有<strong>静态代码块</strong>、<strong>代码块</strong>、<strong>构造器</strong>，自身也有<strong>静态代码块</strong>、<strong>代码块</strong>、构造器，以及<strong>方法内部的代码块</strong></li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFather</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">private</span>  <span class="token keyword">int</span> age <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"这是父类构造块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"这是父类静态构造块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">TestFather</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">TestFather</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 属性</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">int</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> sa<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 方法</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token comment">// 普通块限制了局部变量的作用范围</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"这是普通块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----000000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">//System.out.println(num);</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment">//if()&#123;&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment">//while()&#123;&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// 构造块</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------这是构造块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// 静态块</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">static</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----这是静态块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">// 构造器</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"这是空构造器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// 这是一个 main 方法，是程序的入口：</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token class-name">Test</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        t<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token class-name">Test</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        t2<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220803104041443.png" title="image-20220803104041443"><p><strong>总结：</strong></p><blockquote><p><em>顺序</em>：</p><ul><li><p>static 变量或者方法</p><p>父类静态构造块 -&gt; 静态构造块 -&gt;</p></li><li><p>Test t = new Test()</p><p>父类构造块 -&gt; 构造块 -&gt; 空参构造 -&gt;</p></li><li><p>t.a();</p><p>方法 A -&gt; 方法中的构造块 -&gt;</p></li><li><p>Test t2 = new Test()</p><p>父类构造块 -&gt; 构造块 -&gt; 空参构造 -&gt;</p></li><li><p>t2.a();</p><p>方法 A -&gt; 方法中的构造块</p></li></ul></blockquote><p>总的来说，</p><ul><li>父类方法在前</li><li>静态在前且<strong>只加载一次</strong></li><li><strong>构造块 》构造器 》 方法</strong></li></ul><p>新的总结：</p><blockquote><p>​	从 JVM 的角度来说，再开始的时候先进性类的加载，(Loading [加载器获取] 》Linking [校验是否符合语法》附默认值》解析 ] 》initialization [初始化] ) ，在加载阶段我们就将我们的方法体放入了方法区中，初始化的时候就已经将我们的静态系列运行了，这也就是为什么 static 系列的东西只在程序过程中产生一次。</p></blockquote><h3 id="java有哪几种关键字作用区间是什么"><a class="anchor" href="#java有哪几种关键字作用区间是什么">#</a> JAVA 有哪几种关键字，作用区间是什么</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps1.jpg" title="img"><p>private：只有类中的子类和方法可以使用</p><p>default：只有和自己同一个包下的子类才能使用</p><p>protected：只有自己和子类可以直接使用</p><p>public：全部范围</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731132616681.png" title="image-20220731132616681"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731132623293.png" title="image-20220731132623293"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731132627634.png" title="image-20220731132627634"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731132632474.png" title="image-20220731132632474"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731132638079.png" title="image-20220731132638079"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731132644922.png" title="image-20220731132644922"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731132649522.png" title="image-20220731132649522"><h3 id="overload-和-override区别"><a class="anchor" href="#overload-和-override区别">#</a> OverLoad 和 Override 区别</h3><p>OverLoad：重载，指同一个类中可以有多个名称相同的方法，但这些方法的参数列表各不相同 (即参数个数或类型不同)</p><p>Override：重写，表示子类中的方法可以与父类中的某个方法的名称和参数完全相同</p><p>注意：</p><p>Override 注意事项:<br>1. 覆盖的方法的标志必须要和被覆盖的方法的标志完全匹配，才能达到覆盖的效果<br>2. 覆盖的方法的返回值必须和被覆盖的方法的返回一致<br>3. 覆盖的方法所抛出的异常必须和被覆盖方法的所<mark>抛出的异常一致，或者是其子类</mark>；<br>4. 被覆盖的<mark>方法不能为 private</mark>，否则在其子类中只是新定义了一个方法，并没有对其进行覆盖。</p><p>Overload 注意事项:<br>1. 在使用重载时只能通过不同的参数样式。例如，不同的参数类型，不同的参数个数，不同的参数顺序（当然，同一方法内的几个参数类型必须不一样，例如可以是 fun (int,float)，但是不能为 fun (int,int)）；<br>2. 不能通过访问权限、返回类型、抛出的异常进行重载；<br>3. 方法的异常类型和数目不会对重载造成影响；<br>4. 对于继承来说 **，如果某一方法在父类中是访问权限是 priavte**，那么就不能在子类对其进行重载，如果定义的话，也只是定义了一个新方法，而不会达到重载的效果</p><p><strong>总结：</strong></p><blockquote><p>重载：名字相同是前提，是否合理看参数，其他都没啥关系，父类一旦私有就玩完</p><p>重写：继承实现是前提，子类起码大于父，犯的错误要更小，返回类型要一致</p></blockquote><h3 id="简述一下java面向对象的基本特征继承-封装与多态以及你自己的应用"><a class="anchor" href="#简述一下java面向对象的基本特征继承-封装与多态以及你自己的应用">#</a> 简述一下 Java 面向对象的基本特征，继承、封装与多态，以及你自己的应用？</h3><p>继承：就好比一个父亲多个孩子，并且孩子还完全继承父类的方法，private 修饰的方法也能继承，只 是因为封装的特性阻碍了直接调用，但是提供了间接调用的方式，可以间接调用。并且后面多态的条件</p><p>封装：把对象的属性和操作（或服务）结合为一个<strong>独立的整体</strong>，并<strong>尽可能隐藏对象的内部实现细节</strong>。</p><p>​ 例如，内部属性只对外提供 get、set 方法，不能直接引用。</p><p>多态：多态，故名思意，事物的多种形态。多态跟属性无关，多态指的是方法的多态。打破单继承。</p><p>前提：</p><ul><li><strong>有继承性关系</strong></li><li><strong>要有方法的重写</strong></li><li><strong>必须是父类引用子类的对象</strong></li></ul><h3 id="this和super"><a class="anchor" href="#this和super">#</a> this 和 super</h3><p><strong>this</strong></p><ol><li>对象内部指代自身的引用</li><li>解决成员变量和局部变量的同名问题</li><li>可以调用成员变量，不能调用局部变量</li><li>可以调用成员方法</li><li>在普通方法中可以省略 this</li><li>静态方法中不允许出现</li></ol><p><strong>super</strong></p><ol><li>代表当前对象的直接父类对象的引用</li><li>可以调用父类中非 private 成员变量和方法</li><li>super () 可以调用父类的构造器，只限于构造方法中使用，且必须是第一条</li></ol><h3 id="怎样声明一个类不会被继承什么场景下会用"><a class="anchor" href="#怎样声明一个类不会被继承什么场景下会用">#</a> 怎样声明一个类不会被继承，什么场景下会用？</h3><p><strong>final 修饰的类</strong>不能有子类 大部分都是出于<strong>安全</strong>考虑</p><p>举例：String、Math</p><h3 id="java是什么类型的语言"><a class="anchor" href="#java是什么类型的语言">#</a> java 是什么类型的语言？</h3><h4 id="面向对象语言"><a class="anchor" href="#面向对象语言">#</a> 面向对象语言：</h4><p>​	解释之前我们得引入一个概念，<strong>面向过程</strong>，举一个例子，要把大象装进冰箱需要几步</p><p>面向过程：</p><ul><li>打开冰箱，把大象放进去，关上冰箱。</li></ul><p>面向对象：</p><ul><li>打开冰箱（负责：人走到冰箱前面，打开了）</li><li>存储（负责：大象先迈左腿，然后右腿，然后躺进去）</li><li>关闭冰箱（然后关上冰箱门。）</li></ul><p>面向过程是：要先把事物分析成<strong>不同的步骤</strong>，然后根据步骤一步步的编程。</p><p>面向对象是：创建负责某个部分的负责人也就是我们所说的 “对象”，在给对象赋值上相应的属性，进行方法形式的编程</p><p><strong>两者相辅相成缺一不可。</strong></p><p>1 解释型</p><p>2 编译型</p><h3 id="final-和-static-在java中的意义"><a class="anchor" href="#final-和-static-在java中的意义">#</a> final 和 static 在 JAVA 中的意义？</h3><p>1、static 特点</p><blockquote><p>（1）在类加载的时候一起加载入方法区中的静态域中<br>（2）先于对象存在<br>（3）访问方式： 对象名。属性名 类名。属性名（推荐）</p></blockquote><p>2、final 特点</p><blockquote><p>修饰一个变量，变量的值不可以改变，这个变量也变成了一个字符常量，约定俗称的规定：名字大写</p><p>final 修饰方法，那么这个方法不可以被该类的子类重写：</p><p>final 修饰类，代表没有子类，该类不可以被继承：</p></blockquote><p>3、项目使用场景</p><p>static 修饰属性的应用场景：</p><p>​	某些特定的数据想要在内存中共享，只有一块 --》这个情况下，就可以用 static 修饰的属性</p><p>final 修饰属性的应用场景：</p><p>​	（1）使用 Math 类的时候无需导包，直接使用即可：</p><p>​	（2）Math 类没有子类，不能被其他类继承了</p><p>​	（3）里面的属性全部被 final 修饰，方法也是被 final 修饰的，只是省略不写了</p><p>​ 原因：子类没有必要进行重写。</p><p>​	（4）外界不可以创建对象：</p><p>​	（5）发现 Math 类中的所有的属性，方法都被 static 修饰</p><p>​ 那么不用创建对象去调用，只能通过类名。属性名 类名。方法名 去调用</p><h3 id="java-中的对象拷贝"><a class="anchor" href="#java-中的对象拷贝">#</a> JAVA 中的对象拷贝？</h3><h3 id="什么是接口"><a class="anchor" href="#什么是接口">#</a> 什么是接口？</h3><p>1、制定标准</p><p>2、提供可扩展性</p><p>3、面向接口编程</p><h3 id="接口和抽象类的区别"><a class="anchor" href="#接口和抽象类的区别">#</a> 接口和抽象类的区别：</h3><p>​ <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220803203534319.png" title="image-20220803203534319"></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220803203540347.png" title="image-20220803203540347"><h3 id="什么是内部类"><a class="anchor" href="#什么是内部类">#</a> 什么是内部类？</h3><p>分类：4 种</p><p>1、成员内部类</p><p>2、静态内部类</p><p>3、局部内部类</p><p>4、匿名内部类</p><h3 id="java中的基本数据类型"><a class="anchor" href="#java中的基本数据类型">#</a> JAVA 中的基本数据类型</h3><p>1、8 种数据类型</p><p>2、所占字节长度，最大最小</p><p>3、BigDecimal 对象</p><h3 id="arraylist是用来干嘛的"><a class="anchor" href="#arraylist是用来干嘛的">#</a> ArrayList 是用来干嘛的？</h3><p>1、原理</p><h3 id="try-catch-finally-return"><a class="anchor" href="#try-catch-finally-return">#</a> Try、catch、finally、return</h3><p>在 <code>try</code> 、 <code>catch</code> 、 <code>finally</code> 只有一个 return 有用，也就是说只有最后一个有用</p><h4 id="一-try中带有return"><a class="anchor" href="#一-try中带有return">#</a> 一、try 中带有 return</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"try:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                    <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"catch:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finally:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="16"></td><td><pre>init:24</pre></td></tr><tr><td data-num="17"></td><td><pre>try:25</pre></td></tr><tr><td data-num="18"></td><td><pre>finally:26</pre></td></tr><tr><td data-num="19"></td><td><pre>最终返回：25</pre></td></tr><tr><td data-num="20"></td><td><pre>由此可见：try -》 finally -》return</pre></td></tr><tr><td data-num="21"></td><td><pre>*/</pre></td></tr></table></figure><p>​	因为当 try 中带有 return 时，会先执行 return 前的代码，然后暂时保存需要 return 的信息，再执行 finally 中的代码，最后再通过 return 返回之前保存的信息。所以，这里方法返回的值是 try 中计算后的 25，而非 finally 中计算后的 26。</p><p>再看一个例子</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">static</span> <span class="token class-name">List</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token keyword">int</span> param<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"init:"</span><span class="token operator">+</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token comment">// 方式一：</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"try:"</span><span class="token operator">+</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                    <span class="token keyword">return</span> list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"catch:"</span><span class="token operator">+</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                    <span class="token keyword">return</span> list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finally:"</span><span class="token operator">+</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                    <span class="token keyword">return</span> list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"try:"</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                    <span class="token keyword">int</span> a <span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                    <span class="token keyword">return</span> list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"catch:"</span><span class="token operator">+</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    <span class="token keyword">return</span> list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finally:"</span><span class="token operator">+</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                    <span class="token keyword">return</span> list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="48"></td><td><pre>init:[]</pre></td></tr><tr><td data-num="49"></td><td><pre>try:1</pre></td></tr><tr><td data-num="50"></td><td><pre>catch:[2]</pre></td></tr><tr><td data-num="51"></td><td><pre>finally:[2, 3]</pre></td></tr><tr><td data-num="52"></td><td><pre>最终返回：[2, 3]</pre></td></tr><tr><td data-num="53"></td><td><pre>*/</pre></td></tr></table></figure><p>看完这个例子，可能会发现问题，刚提到 return 时会临时保存需要返回的信息，不受 finally 中的影响，为什么这里会有变化？其实问题出在参数类型上，上一个例子用的是基本类型，这里用的引用类型。list 里存的不是变量本身，而是变量的地址，所以当 finally 通过地址改变了变量，还是会影响方法返回值的。</p><h4 id="二-catch中带有return"><a class="anchor" href="#二-catch中带有return">#</a> 二、catch 中带有 return</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">// 方式一：</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"try:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"catch:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finally:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="19"></td><td><pre>try:25</pre></td></tr><tr><td data-num="20"></td><td><pre>finally:26</pre></td></tr><tr><td data-num="21"></td><td><pre>最终返回：26</pre></td></tr><tr><td data-num="22"></td><td><pre>由此可见：try -》 finally</pre></td></tr><tr><td data-num="23"></td><td><pre>*/</pre></td></tr></table></figure><h4 id="三-finally中带有return"><a class="anchor" href="#三-finally中带有return">#</a> 三、finally 中带有 return</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"try:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                    <span class="token keyword">int</span> a <span class="token operator">=</span>i<span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                    <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"catch:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                    <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finally:"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                    <span class="token keyword">return</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="16"></td><td><pre>init:24</pre></td></tr><tr><td data-num="17"></td><td><pre>try:25</pre></td></tr><tr><td data-num="18"></td><td><pre>catch:26</pre></td></tr><tr><td data-num="19"></td><td><pre>finally:27</pre></td></tr><tr><td data-num="20"></td><td><pre>最终返回：27</pre></td></tr><tr><td data-num="21"></td><td><pre>由此可见 try ->catch -> finally</pre></td></tr><tr><td data-num="22"></td><td><pre>*/</pre></td></tr></table></figure><p>​	当 finally 中有 return 的时候，try 中的 return 会失效，在执行完 finally 的 return 之后，就不会再执行 try 中的 return。这种写法，编译是可以编译通过的，但是编译器会给予警告，所以不推荐在 finally 中写 return，这会破坏程序的完整性，而且一旦 finally 里出现异常，会导致 catch 中的异常被覆盖。</p><blockquote><p>基本数据只看值，先返回啥就是啥，后期改动不影响</p><p>引用数据返回只返他地址，后期改动有影响</p><p>多个 return 只看近</p></blockquote><h4 id="四-总结"><a class="anchor" href="#四-总结">#</a> 四、总结：</h4><p>1、finally 中的代码总会被执行。</p><p>2、当 try、catch 中有 return 时，也会执行 finally。return 的时候，要注意返回值的类型，是否受到 finally 中代码的影响。</p><p>3、finally 中有 return 时，会直接在 finally 中退出，导致 try、catch 中的 return 失效。</p><h3 id="基本类型的转化"><a class="anchor" href="#基本类型的转化">#</a> 基本类型的转化</h3><p>整型</p><p><code>byte</code> <code>short int long</code> 对应字节 1、2 、4、8</p><p>浮点</p><p><code>float</code> <code>double</code> 对应字节 4、8</p><p>字符型</p><p><code>char</code> 对应字节 1</p><p>布尔</p><p><code>boolean</code> 对应字节 看操作系统</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220628104655888.png" title="image-20220628104655888"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220628110544905.png" title="image-20220628110544905"><h4 id="总结"><a class="anchor" href="#总结">#</a> 总结</h4><p>1、长字节的可以直接接收短字节数，短字节数要接收长字节数要强转，同字节数可相互转化，比如 <code>float</code> 和 <code>int</code> 。</p><p>2、父与子的关系也可这样理解</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220628105340365.png" title="image-20220628105340365"><h3 id="运算符"><a class="anchor" href="#运算符">#</a> 运算符</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220628105535662.png" title="image-20220628105535662"><p><strong>不需要去刻意的记优先级关系</strong><br><strong>赋值 &lt; 三目 &lt; 逻辑 &lt; 关系 &lt; 算术 &lt; 单目</strong></p><h3 id="取余"><a class="anchor" href="#取余">#</a> 取余</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> a1<span class="token operator">=</span> <span class="token number">9</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// 1</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> a2<span class="token operator">=</span> <span class="token number">9</span> <span class="token operator">%</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> a3<span class="token operator">=</span> <span class="token operator">-</span><span class="token number">9</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span>	 <span class="token comment">// -1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> a4<span class="token operator">=</span> <span class="token operator">-</span><span class="token number">9</span> <span class="token operator">%</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// -1</span></pre></td></tr></table></figure><p>技巧：全部都当成正数算，<strong>最后的符号与被除数相同</strong></p><h3 id="string-stringbuffer-stringbuilder区别与联系"><a class="anchor" href="#string-stringbuffer-stringbuilder区别与联系">#</a> String、StringBuffer、StringBuilder 区别与联系</h3><ol><li><p>String 类是不可变类，即一旦一个 String 对象被创建后，包含在这个对象中的字符序列是不可改变的，直至这个对象销毁。</p></li><li><p>StringBuffer 类则代表一个字符序列可变的字符串，可以通过 append、insert、reverse、setChartAt、setLength 等方法改变其内容。一旦生成了最终的字符串，调用 toString 方法将其转变为 String</p></li><li><p>JDK1.5 新增了一个 StringBuilder 类，与 StringBuffer 相似，构造方法和方法基本相同。不同是 StringBuffer 是线程安全的，而 StringBuilder 是线程不安全的，所以性能略高。通常情况下，创建一个内容可变的字符串，应该优先考虑使用 StringBuilder</p><pre><code> StringBuilder:JDK1.5开始  效率高   线程不安全
 
 StringBuffer:JDK1.0开始   效率低    线程安全
</code></pre></li></ol><h3 id="jdk18中的stream有用过吗详述一下stream的并行操作原理stream并行的线程池是从哪里来的"><a class="anchor" href="#jdk18中的stream有用过吗详述一下stream的并行操作原理stream并行的线程池是从哪里来的">#</a> Jdk1.8 中的 stream 有用过吗，详述一下 stream 的并行操作原理？stream 并行的线程池是从哪里来的？</h3><p>​	<strong>Stream</strong> 作为 Java8 的一大亮点，它与 java.io 包里的<strong> InputStream</strong> 和<strong> OutputStream</strong> 是完全不同的概念。它是对容器对象功能的增强，它专注于对容器对象进行各种非常便利、高效的聚合操作或者大批量数据操作。</p><p>​	Stream API 借助于同样新出现的 Lambda 表达式，极大的提高编程效率和程序可读性。同时，它<mark>提供串行和并行两种模式进行汇聚操作</mark>，并发模式能够充分利用多核处理器的优势，使用 fork/join 并行方式来拆分任务和加速处理过程。所以说，Java8 中首次出现的 java.util.stream 是一个函数式语言 + 多核时代综合影响的产物。</p><p>Stream 有如下三个操作步骤：</p><p>一、创建 Stream：从一个数据源，如集合、数组中获取流。</p><p>二、中间操作：一个操作的中间链，对数据源的数据进行操作。</p><p>三、终止操作：一个终止操作，执行中间操作链，并产生结果。</p><p>​	当数据源中的数据上了流水线后，这个过程对数据进行的所有操作都称为 “中间操作”。中间操作仍然会返回一个流对象，因此多个中间操作可以串连起来形成一个流水线。比如 map (mapToInt, flatMap 等)、filter、distinct、sorted、peek、limit、skip、parallel、sequential、unordered。</p><p>​	当所有的中间操作完成后，若要将数据从流水线上拿下来，则需要执行终止操作。终止操作将返回一个执行结果，这就是你想要的数据。比如：forEach、forEachOrdered、toArray、reduce、collect、min、max、count、anyMatch、allMatch、noneMatch、findFirst、findAny、iterator。</p><p>​	多个中间操作可以连接起来形成一个流水线，除非流水线上触发终止操作，否则中间操作不会执行任何处理！而在终止操作时一次性全部处理，称作 “惰性求值”。</p><p>​	stream 并行原理：其实本质上就是在 ForkJoin 上进行了一层封装，将 Stream 不断尝试分解成更小的 split，然后使用 fork/join 框架分而治之，parallize 使用了默认的 ForkJoinPool.common 默认的一个静态线程池.</p><h3 id="java-注解"><a class="anchor" href="#java-注解">#</a> JAVA 注解</h3><p>Annotation（注解）是 Java 提供的一种对元程序中元素关联信息和元数据（metadata）的途径和方法。Annatation (注解) 是一个接口，程序可以通过反射来获取指定程序中元素的 Annotation 对象，然后通过该 Annotation 对象来获取注解中的元数据信息。</p><p>4 种标准元注解</p><p>元注解的作用是负责注解其他注解。 Java5.0 定义了 4 个标准的 meta-annotation 类型，它们被用来提供对其它 annotation 类型作说明。</p><p>@Target 修饰的对象范围</p><p>@Target 说明了 Annotation 所修饰的对象范围： Annotation 可被用于 packages、types（类、接口、枚举、Annotation 类型）、类型成员（方法、构造方法、成员变量、枚举值）、方法参数和本地变量（如循环变量、catch 参数）。在 Annotation 类型的声明中使用了 target 可更加明晰其修饰的目标</p><p>@Retention 定义 被保留的时间长短</p><p>Retention 定义了该 Annotation 被保留的时间长短：表示需要在什么级别保存注解信息，用于描述注解的生命周期（即：被描述的注解在什么范围内有效），取值（RetentionPoicy）由：</p><p>n SOURCE: 在源文件中有效（即源文件保留）</p><p>n CLASS: 在 class 文件中有效（即 class 保留）</p><p>n RUNTIME: 在运行时有效（即运行时保留）</p><p>@Documented 描述 **-javadoc**</p><p>@ Documented 用于描述其它类型的 annotation 应该被作为被标注的程序成员的公共 API，因此可以被例如 javadoc 此类的工具文档化。</p><p>@Inherited 阐述了某个被标注的类型是被继承的</p><p>@Inherited 元注解是一个标记注解，@Inherited 阐述了某个被标注的类型是被继承的。如果一个使用了 @Inherited 修饰的 annotation 类型被用于一个 class，则这个 annotation 将被用于该 class 的子类</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/172227-213126.jpeg" title="JAVA注解"><h3 id="synchronizedmap-和-concurrenthashmap有什么区别"><a class="anchor" href="#synchronizedmap-和-concurrenthashmap有什么区别">#</a> SynchronizedMap 和 ConcurrentHashMap 有什么区别</h3><p>1、SynchronizedMap 对整个 map 同步</p><p>2、ConcurrentHashMap 对 map 的桶加锁</p><h3 id="yield-方法有什么用"><a class="anchor" href="#yield-方法有什么用">#</a> yield 方法有什么用？</h3><p>放弃当前线程资源，和其他线程再次同时竞争资源。</p><h3 id="常用线程池"><a class="anchor" href="#常用线程池">#</a> 常用线程池</h3><p>1、newSingleThreadExceutor 单线程池 ，只有一个线程</p><p>2、newFixedThreadPool 最大线程池，可以指定线程池大小</p><p>3、newcachedThreadPool 缓存线程池，没有线程有任务就创建线程，有空余线程来任务直接用。</p><p>4、newScheduledThreadPool 周期性线程池，定时任务</p><h3 id="简述线程池的理解"><a class="anchor" href="#简述线程池的理解">#</a> 简述线程池的理解</h3><p>1、降低资源消耗</p><p>​	线程的创建和销毁，通过重复利用已创建的线程降低线程创建和销毁造成的消耗。</p><p>2、调高响应速度</p><p>​	任务到了就直接可以上线程了，不用再 new。当任务到达时，任务可以不需要等到线程创建就能立即执行</p><p>3、提高线程的可管理性</p><p>​	线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控</p><h3 id="进程和线程的区别"><a class="anchor" href="#进程和线程的区别">#</a> 进程和线程的区别</h3><p>1、进程是执行的程序，系统资源分配和调度的单位</p><p>2、线程是进程的一个实体，线程之间共享地址空间和其他资源（所以通信，同步等操作线程更加容易）</p><p>3、线程上下文切换快</p><p>进程相当于公司，线程相当于公司员工，两个公司交流慢，内部员工交流快</p><h3 id="死锁的必要条件"><a class="anchor" href="#死锁的必要条件">#</a> 死锁的必要条件</h3><p>1、一个资源每次只能被一个线程使用</p><p>2、线程因请求资源而阻塞时，对获得的资源保持不放</p><p>3、线程已获得的资源，在未使用完之前，不能强行剥夺</p><p>4、若干线程之间形成头尾详解的线程资源需求，A 要 B，B 要 A</p><h3 id="避免死锁"><a class="anchor" href="#避免死锁">#</a> 避免死锁</h3><p>1、线程只有获得到 A 锁和 B 锁才能对某资源进行操作</p><p>2、获取锁的顺序是一定的</p><h3 id="java线程池中队列常用类型有什么"><a class="anchor" href="#java线程池中队列常用类型有什么">#</a> Java 线程池中队列常用类型有什么</h3><p>1、ArrayBlockingQueue 基于数组，有界长度大小的 FIFO 队列</p><p>2、LinkedBlockingQueue 基于链表</p><p>3、SynchronousQueue 不存储元素的阻塞队列</p><p>4、PriorityBlockingQueue 优先级队列，无限阻塞队列，基于最小二叉堆</p><p>5、DelayQueue 只有当前指定的时间到了才可以拿到数据，没有大小限制，只有获取数据的</p><p>​ 才阻塞，放的时候没限制</p><h3 id="线程安全需要保证几个基本特征"><a class="anchor" href="#线程安全需要保证几个基本特征">#</a> 线程安全需要保证几个基本特征</h3><p>1、原子性</p><p>2、可见性</p><p>3、有序性（避免指令重排序）</p><h3 id="cas原理"><a class="anchor" href="#cas原理">#</a> CAS 原理</h3><p>全称：CompareANdSwap，乐观锁，比较并交换，主要是通过处理器的指令来保证操作的原子性 。</p><h3 id="cas的缺点"><a class="anchor" href="#cas的缺点">#</a> CAS 的缺点</h3><p>1、ABA 问题，就是在比较的时候，比较的和原来的内容恰好相同，但是不是同一个对象。 例如，现在有三个线程，2 个是将 10+5，还有 1 个是 15-5，现在其中一个 + 5 拿到资源开始操作，然后 - 5 线程在进行操作，对于原来的值虽然没有变化，但是进行了操作，在另外一个 + 5 进行原值比较的时候，会误认为没有改变，然后写入新值。他是基本数据类型的时候是没有问题的。但是要是对象的时候，这就有大问题了 ，我们这样就会让我们产生并发问题了。解决这类问题，最简单的办法就是加版本，在对比的时候，不仅仅对比值，还要比较版本。</p><p>2、循环时间过长开销大</p><p>3、只能保证一个共享变量的原子操作</p><h3 id="线程池原理和核心参数"><a class="anchor" href="#线程池原理和核心参数">#</a> 线程池原理和核心参数</h3><p>1、核心线程数</p><p>2、最大线程数</p><p>3、活跃时间</p><p>4、阻塞队列</p><p>5、拒绝策略</p><img data-src="../../../../../../面试/面试题/面试题_img/image-20220907155719800.png" alt="image-20220907155719800" style="zoom:150%"><h3 id="线程池的拒绝策略有哪些"><a class="anchor" href="#线程池的拒绝策略有哪些">#</a> 线程池的拒绝策略有哪些</h3><p>1、AbortPolicy：直接丢弃，抛异常</p><p>2、CallerRunsPolicy：调用者所在的线程处理任务</p><p>3、DiscardOldestPolicy：丢弃最久的任务</p><p>4、DiscardPolicy：直接丢弃任务，也不抛出异常</p><h3 id="cyclibarrier和countdownlatch区别"><a class="anchor" href="#cyclibarrier和countdownlatch区别">#</a> CycliBarrier 和 CountDownLatch 区别</h3><p>CyclicBarrier 线程运行到某个点后停止运行，所有线程到达点，才重新运行</p><p>CountDownLatch 线程运行到某个点，给某个数值 - 1，</p><p>线程继续 CyclicBarrier 唤起一个</p><p>CountDownLatch 可以唤起多个任务</p><p>CyclicBarrier 可重用，CountDownLatch 不可重用</p><h3 id="get和post请求区别"><a class="anchor" href="#get和post请求区别">#</a> Get 和 Post 请求区别</h3><p>1、get 用户信息获取，而其应该是安全的和幂等的</p><p>2、POST 表示可能修改服务器上的资源的请求</p><p>3、Get 请求的数据会附在 URL 之后</p><p>4、Get 方式提交的数据取决于 URL 长度限制，理论上 POST 没有限制，可传较大量的数据</p><p>5、POST 的安全性要比 Get 的安全性高</p><h3 id="转发和重定向的区别"><a class="anchor" href="#转发和重定向的区别">#</a> 转发和重定向的区别</h3><p>1、转发是服务器行为，重定向是客户端行为</p><p>2、重定向是两次请求，第一次是原来的 A，然后服务器让他请求 B，最后浏览器再请求 B。</p><h3 id="jdbc"><a class="anchor" href="#jdbc">#</a> JDBC</h3><p>1. 引入 Jar 包，加载驱动。</p><p>2. 建立连接 Connection, 创建执行对象 Statement。</p><p>3. 执行语句。</p><p>4. 处理结果 (查询)。</p><p>5. 释放资源 (关闭连接对象)。</p><h3 id="cookie是什么有什么用"><a class="anchor" href="#cookie是什么有什么用">#</a> Cookie 是什么，有什么用？</h3><p>1、cookie 就是保存在客户端的纯文本文件</p><p>2、访问某些网页，并且对网页的一些设置进行修改，cookie 就能跟踪并记录到这些修改。</p><p>3、网站服务器把少量数据存储到客户端的硬盘或内存</p><h3 id="http请求状态码"><a class="anchor" href="#http请求状态码">#</a> HTTP 请求状态码</h3><p>10X 请求一部分，正在请求另外一部分</p><p>20X 请求成功</p><p>30X 转发</p><p>40X 没有资源</p><p>50X 服务器内部错误</p><h3 id="未完成"><a class="anchor" href="#未完成">#</a> —————————— 未完成</h3><h1 id="集合"><a class="anchor" href="#集合">#</a> 集合</h1><h2 id="基础"><a class="anchor" href="#基础">#</a> 基础</h2><h3 id="arraylist集合的add过程"><a class="anchor" href="#arraylist集合的add过程">#</a> ArrayList 集合的 add 过程</h3><p><font size="5" color="#00000"><strong>1.7 和 1.8 的区别</strong></font></p><p>在 1.7 的时候创建不传参直接初始化为 10,</p><p>在 1.8 的时候，只是空参构造初始化为 {}，元素个数为 0，什么时候为 10 呢？——》在第一次 add 时候</p><p>默认初始化一个数组长度 <strong>1.7：10</strong> ；<strong>1.8：0（在第一次 add 时候变为 10）</strong>，最大长度为 Integer.MAX_VALUE=2147483647=<font color="#FF000">(2^31)-1</font> ;</p><p>当 <code>size</code> &gt;10 时，list 要变，也就是说数组要扩容，扩容为原来的<font color="red">1.5 倍</font></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	* minCapacity =size+1</pre></td></tr><tr><td data-num="3"></td><td><pre>	*/</pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// overflow-conscious code</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 新的数组长度</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// 扩容后还小于 size+1</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// 扩容后大于 Integer.MAX_VALUE - 8</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> <span class="token constant">MAX_ARRAY_SIZE</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            newCapacity <span class="token operator">=</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">// minCapacity is usually close to size, so this is a win:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>当到达极端情况下此时 arr 为最大时 2^31-8</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token comment">//MAX_ARRAY_SIZE(2^31-8)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">int</span> b <span class="token operator">=</span> a <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">// newCapacity</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">int</span> c <span class="token operator">=</span> b <span class="token operator">+</span> b <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">//MAX_ARRAY_SIZE(2^31-8)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MAX_ARRAY_SIZE:"</span><span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// newCapacity</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"newCapacity:"</span><span class="token operator">+</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// newCapacity - minCapacity( size + 1 )</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"newCapacity - minCapacity:"</span><span class="token operator">+</span><span class="token punctuation">(</span>c<span class="token operator">-</span><span class="token punctuation">(</span>b<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">// newCapacity - MAX_ARRAY_SIZE(2^31-8)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"newCapacity - MAX_ARRAY_SIZE:"</span><span class="token operator">+</span><span class="token punctuation">(</span>c <span class="token operator">-</span> <span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>结果：</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">MAX_ARRAY_SIZE</span><span class="token punctuation">:</span> <span class="token number">2147483639</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">newCapacity</span><span class="token punctuation">:</span> <span class="token number">-1073741838</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">ewCapacity - minCapacity</span><span class="token punctuation">:</span> <span class="token number">1073741818</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key atrule">newCapacity - MAX_ARRAY_SIZE</span><span class="token punctuation">:</span> <span class="token number">1073741819</span></pre></td></tr></table></figure><h3 id="18为什么改变成17的头插法成尾插法"><a class="anchor" href="#18为什么改变成17的头插法成尾插法">#</a> 1.8 为什么改变成 1.7 的头插法成尾插法？</h3><p>剖析：</p><p>一个链表想要用<strong>尾插</strong>的形式插入数据，我们首先得知道他的<em> next</em> 是否为<em> null</em>,</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> node<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">T</span> data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    node next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>一个链表想要用<strong>头插</strong>的形式插入数据，我们首先得知道他的<em> pre</em> 是否为<em> null</em>, 其次找到之后还要将新元素的<em> next</em> 指向原来的头结点</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> node<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">T</span> data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    node pre<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    node next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><em><strong>总结：</strong></em></p><p>​	从创建开始他的头插的结构体 &gt; 尾插的结构体，其次最主要的是<strong>头插容易形成环形结构</strong>，造成 CPU 的损耗，尾插法可以避免</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220709101908776.png" title="image-20220709101908776"><h3 id="victor-和-arraylist区别"><a class="anchor" href="#victor-和-arraylist区别">#</a> Victor 和 ArrayList 区别</h3><p>【1】底层 Object 数组，int 类型属性表示数组中有效长度：</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220629231051908.png" title="image-20220629231051908"><p>【2】Vector v=new Vector (); 调用构造器：</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220629231123796.png" title="image-20220629231123796"><p>【3】add 方法：</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220629231602106.png" title="image-20220629231602106"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220629231137216.png" title="image-20220629231137216"><p><strong>总结：</strong></p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">Vector</th><th style="text-align:center">ArrayList</th></tr></thead><tbody><tr><td style="text-align:center">底层</td><td style="text-align:center">数组</td><td style="text-align:center">数组</td></tr><tr><td style="text-align:center">初始化</td><td style="text-align:center">直接为长度为 10 的数组</td><td style="text-align:center">1.7：直接为长度为 10 的数组<br>1.8 只初始化为 {} 元素个数为 0 的数组，在第一次 add 的时候扩大到 10</td></tr><tr><td style="text-align:center">扩容</td><td style="text-align:center">2 倍</td><td style="text-align:center">1.5</td></tr><tr><td style="text-align:center">安全性</td><td style="text-align:center">安全<br>add 方法加了 synchronized</td><td style="text-align:center">不安全<br></td></tr><tr><td style="text-align:center">效率</td><td style="text-align:center">低</td><td style="text-align:center">高</td></tr></tbody></table><h3 id="iteratoriteratoriterable关系"><a class="anchor" href="#iteratoriteratoriterable关系">#</a> iterator (),Iterator,Iterable 关系</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220629233802397.png" title="image-20220629233802397"><p><strong>增强 for 循环 底层也是通过迭代器实现的：</strong></p><p><strong>总结：</strong></p><p><code>iterator()</code> 是 <code>Iterable</code> 接口 中的一个抽象方法， <code>ArrayList</code> 内部类 <code>Itr</code> 实现了 <code>Iterator</code> 接口， <code>iterator()</code> 是 Arraylist 内部的一个方法</p><h3 id="listiterator迭代器"><a class="anchor" href="#listiterator迭代器">#</a> ListIterator 迭代器</h3><p>迭代器不可以和 list 同时操作一个对象，可以用迭代器对象直接操作</p><p>不仅有 <code>正向迭代</code> 还有 <code>逆向迭代</code></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"cc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 在 "cc" 之后添加一个字符串 "kk"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">ListIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> it <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">listIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"cc"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                it<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"kk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="linkedlist底层"><a class="anchor" href="#linkedlist底层">#</a> LinkedList 底层</h3><p>​	<font color="red">链表，双向链表</font></p><p>输入和输出结构顺序一致</p><h3 id="hashset底层是什么"><a class="anchor" href="#hashset底层是什么">#</a> HashSet 底层是什么</h3><p><a href="#hashMap_base_code">HashMap</a>，所有的值都存在了 <strong>key</strong> 中</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220630002635848.png" title="image-20220630002635848"><p><strong>基本原理：</strong></p><p>​	在存放数据时，首先要对数据进行 <code>hash</code> 计算然后根据 hash 值存放到对应的数组地址上，地址重复时，再在该位置上引申上一个链表，在每个值插入之前我们都先要对存储过的值进行比较，用的是 <code>equals</code> , 如果存在就不存了。</p><p><font color="red">引申</font></p><p>1、要放入 HashSet 的元素 要具备 <code>Hash</code> 、 <code>equals</code> 两大方法且适合自己，即在自己的类要重写</p><p>2、哈希表 = 数组 + 链表</p><h3 id="linkedset底层"><a class="anchor" href="#linkedset底层">#</a> LinkedSet 底层</h3><p>​	<font color="red">哈希表 + 链表</font></p><p>唯一，输出顺序和输入顺序一致</p><h3 id="treeset底层"><a class="anchor" href="#treeset底层">#</a> TreeSet 底层</h3><p><font color="red">TreeMap</font> 底层数据结构为 <font color="red">二叉树</font> ,</p><p>他与输入结果 无序，输出结果，有序</p><p>一般情况下，随意输入，但是存储的时候，会经过比较器（内部比较强 / 外部比较器<font color="red">[多用]</font>），经过计算将结果放到合适的位置上，输出的时候，利用中序遍历输出得到一个<font color="red">升序的结果</font>。</p><p><font color="red">引申</font></p><p><strong>1、外部比较器</strong></p><p>要实现 <code>Comparator</code> 接口 ，重写 <code>camparr</code> 方法，自定义比较方式，<strong>多用</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220630115643791.png" title="image-20220630115643791"><p><strong>2、二叉树的遍历方式</strong></p><p>​	3 种：<font color="red">先序遍历、中序遍历、后序遍历</font></p><p><strong>先、中、后说的是根节点</strong>，例如</p><p>先：12 3 7 9</p><p>中：3 7 9 12 16</p><p>后：3 7 9 16 12</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220630115853278.png" title="image-20220630115853278"><div name="hashMap_base_code"><h3 id="hashmap底层"><a class="anchor" href="#hashmap底层">#</a> HashMap 底层</h3><h4 id="17底层遵照-font-colorred-哈希表结构-font头插法"><a class="anchor" href="#17底层遵照-font-colorred-哈希表结构-font头插法">#</a> 1.7 底层遵照 <font color="red">哈希表结构 </font>(头插法)</h4><p>1.7 的源码</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 哈希表默认的数组长度</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token comment">// 最大长度</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// 定义了一个 float 类型的变量，以后作为：默认的装填因子，加载因子是表示 Hsah 表中元素的填满的程度</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 太大容易引起哈西冲突，太小容易浪费  0.75 是经过大量运算后得到的最好值</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 这个值其实可以自己改，但是不建议改，因为这个 0.75 是大量运算得到的</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">transient</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span><span class="token comment">// 主数组，每个元素为 Entry 类型，1.8 改名为 Node 内部一样</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">int</span> threshold<span class="token punctuation">;</span><span class="token comment">// 数组扩容的界限值，门槛值   16*0.75=12 </span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span><span class="token comment">// 用来接收装填因子的变量</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>        </pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment">//【4】查看构造器：内部相当于：this (16,0.75f); 调用了当前类中的带参构造器</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">//【5】本类中带参数构造器：--》作用给一些数值进行初始化的！</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">//【6】给 capacity 赋值，capacity 的值一定是 大于你传进来的 initialCapacity 的 最小的 2 的倍数</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">int</span> capacity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>capacity <span class="token operator">&lt;</span> initialCapacity<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            capacity <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token comment">//【7】给 loadFactor 赋值，将装填因子 0.75 赋值给 loadFactor</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token comment">//【8】数组扩容的界限值，门槛值</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>capacity <span class="token operator">*</span> loadFactor<span class="token punctuation">,</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                </pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token comment">//【9】给 table 数组赋值，初始化数组长度为 16</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>capacity<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                   </pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token comment">//【10】调用 put 方法：</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token comment">//【11】对空值的判断</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token keyword">return</span> <span class="token function">putForNullKey</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                    <span class="token comment">//【12】调用 hash 方法，获取哈希码</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                    <span class="token comment">//【14】得到 key 对应在数组中的位置</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                    <span class="token comment">//【16】如果你放入的元素，在主数组那个位置上没有值，e==null  那么下面这个循环不走</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                    <span class="token comment">// 当在同一个位置上放入元素的时候</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token class-name">Object</span> k<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                            <span class="token comment">// 哈希值一样  并且  equals 相比一样   </span></pre></td></tr><tr><td data-num="49"></td><td><pre>                            <span class="token comment">//(k = e.key) == key  如果是一个对象就不用比较 equals 了</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                    <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                    e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                    e<span class="token punctuation">.</span><span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            modCount<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                    <span class="token comment">//【17】走 addEntry 添加这个节点的方法：</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token function">addEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>  		  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        </pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token comment">//【13】hash 方法返回这个 key 对应的哈希值，内部进行二次散列，为了尽量保证不同的 key 得到不同的哈希码！</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>useAltHashing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                <span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Hashing</span><span class="token punctuation">.</span><span class="token function">stringHash32</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            h <span class="token operator">=</span> hashSeed<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                <span class="token comment">//k.hashCode () 函数调用的是 key 键值类型自带的哈希函数，</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                <span class="token comment">// 由于不同的对象其 hashCode () 有可能相同，所以需对 hashCode () 再次哈希，以降低相同率。</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        h <span class="token operator">^=</span> k<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token comment">// This function ensures that hashCodes that differ only by</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token comment">// constant multiples at each bit position have a bounded</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token comment">// number of collisions (approximately 8 at default load factor).</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                <span class="token comment">/*</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                接下来的一串与运算和异或运算，称之为 “扰动函数”，</pre></td></tr><tr><td data-num="80"></td><td><pre>                扰动的核心思想在于使计算出来的值在保留原有相关特性的基础上，</pre></td></tr><tr><td data-num="81"></td><td><pre>                增加其值的不确定性，从而降低冲突的概率。</pre></td></tr><tr><td data-num="82"></td><td><pre>                不同的版本实现的方式不一样，但其根本思想是一致的。</pre></td></tr><tr><td data-num="83"></td><td><pre>                往右移动的目的，就是为了将 h 的高位利用起来，减少哈西冲突</pre></td></tr><tr><td data-num="84"></td><td><pre>                */</pre></td></tr><tr><td data-num="85"></td><td><pre>        h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        <span class="token comment">//【15】返回 int 类型数组的坐标</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">indexFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                <span class="token comment">// 其实这个算法就是取模运算：h% length，取模效率不如位运算</span></pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token keyword">return</span> h <span class="token operator">&amp;</span> <span class="token punctuation">(</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token comment">//【18】调用 addEntry</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token keyword">void</span> <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> bucketIndex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>                <span class="token comment">//【25】size 的大小  大于 16*0.75=12 的时候，比如你放入的是第 13 个，这第 13 个你打算放在没有元素的位置上的时候</span></pre></td></tr><tr><td data-num="96"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">>=</span> threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>                        <span class="token comment">//【26】主数组扩容为 2 倍</span></pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>                        <span class="token comment">//【30】重新调整当前元素的 hash 码</span></pre></td></tr><tr><td data-num="100"></td><td><pre>            hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> key<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                        <span class="token comment">//【31】重新计算元素位置</span></pre></td></tr><tr><td data-num="102"></td><td><pre>            bucketIndex <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>                <span class="token comment">//【19】将 hash,key,value,bucketIndex 位置  封装为一个 Entry 对象：</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token function">createEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> bucketIndex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token comment">//【20】</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token keyword">void</span> <span class="token function">createEntry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> bucketIndex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>                <span class="token comment">//【21】获取 bucketIndex 位置上的元素给 e</span></pre></td></tr><tr><td data-num="110"></td><td><pre>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>                <span class="token comment">//【22】然后将 hash, key, value 封装为一个对象，然后将下一个元素的指向为 e （链表的头插法）</span></pre></td></tr><tr><td data-num="112"></td><td><pre>                <span class="token comment">//【23】将新的 Entry 放在 table [bucketIndex] 的位置上</span></pre></td></tr><tr><td data-num="113"></td><td><pre>        table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>                <span class="token comment">//【24】集合中加入一个元素 size+1</span></pre></td></tr><tr><td data-num="115"></td><td><pre>        size<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    <span class="token comment">//【27】</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> newCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>        <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTable <span class="token operator">=</span> table<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> oldTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">==</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>            <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>                <span class="token comment">//【28】创建长度为 newCapacity 的数组</span></pre></td></tr><tr><td data-num="126"></td><td><pre>        <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>newCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>        <span class="token keyword">boolean</span> oldAltHashing <span class="token operator">=</span> useAltHashing<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>        useAltHashing <span class="token operator">|=</span> sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span><span class="token constant">VM</span><span class="token punctuation">.</span><span class="token function">isBooted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>                <span class="token punctuation">(</span>newCapacity <span class="token operator">>=</span> <span class="token class-name">Holder</span><span class="token punctuation">.</span><span class="token constant">ALTERNATIVE_HASHING_THRESHOLD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>        <span class="token keyword">boolean</span> rehash <span class="token operator">=</span> oldAltHashing <span class="token operator">^</span> useAltHashing<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>                <span class="token comment">//【28.5】转让方法：将老数组中的东西都重新放入新数组中</span></pre></td></tr><tr><td data-num="132"></td><td><pre>        <span class="token function">transfer</span><span class="token punctuation">(</span>newTable<span class="token punctuation">,</span> rehash<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>                <span class="token comment">//【29】老数组替换为新数组</span></pre></td></tr><tr><td data-num="134"></td><td><pre>        table <span class="token operator">=</span> newTable<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>                <span class="token comment">//【29.5】重新计算</span></pre></td></tr><tr><td data-num="136"></td><td><pre>        threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>newCapacity <span class="token operator">*</span> loadFactor<span class="token punctuation">,</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>        <span class="token comment">//【28.6】</span></pre></td></tr><tr><td data-num="139"></td><td><pre>        <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable<span class="token punctuation">,</span> <span class="token keyword">boolean</span> rehash<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>        <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> newTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">:</span> table<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>                <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>rehash<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>                    e<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token operator">==</span> e<span class="token punctuation">.</span>key <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="147"></td><td><pre>                                <span class="token comment">//【28.7】将哈希值，和新的数组容量传进去，重新计算 key 在新数组中的位置</span></pre></td></tr><tr><td data-num="148"></td><td><pre>                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>                                <span class="token comment">//【28.8】头插法</span></pre></td></tr><tr><td data-num="150"></td><td><pre>                e<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 获取链表上元素给 e.next</span></pre></td></tr><tr><td data-num="151"></td><td><pre>                newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span><span class="token comment">// 然后将 e 放在 i 位置 </span></pre></td></tr><tr><td data-num="152"></td><td><pre>                e <span class="token operator">=</span> next<span class="token punctuation">;</span><span class="token comment">//e 再指向下一个节点继续遍历</span></pre></td></tr><tr><td data-num="153"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="155"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>1.7 的头插可能会产生什么问题，为什么？</p><p>问题： 可能会产生环链</p><p>解析：</p><p>通过他的扩容过程中，正常状态下会，他原位置不会变化，只是因为他的结点插入方式为头插法导致我们在每一次的扩容过程之后都会导致我们的链表顺序要翻转一次，这就有一个问题，在单线程的情况下，这么设计是没有问题的，但是在多线程且没有锁的情况下可能会导致产生环。</p><p><strong>扩容前</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220819102531781.png" title="image-20220819102531781"><p>正常 resize () 后</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220819102607885.png" title="image-20220819102607885"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220819101051964.png" title="image-20220819101051964"><p>简单解释一下：</p><p>假设现在两个线程都已经进入到了 trasfer () 方法并且同时到达 rehash 的地方，线程 Thread 2 落后于 Thread 1</p><p>这时候 Thread 1 已经扩容结束，但是在线程 Thread 2 中的 oldTable 并不是我们修改后的还是原来的，这就有问题了</p><p>Thread1 结果</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220819110029605.png" title="image-20220819110029605"><p>Thread2 结果</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220819113951593.png" title="image-20220819113951593"><table><thead><tr><th style="text-align:center">Thread 1</th><th style="text-align:center">Thread 2</th></tr></thead><tbody><tr><td style="text-align:center">进入 transfer</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">进入 transfer</td></tr><tr><td style="text-align:center">e-&gt;3, next-&gt; 2</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">e-&gt;3, next-&gt; 2</td></tr><tr><td style="text-align:center">开始 rehash ()</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">开始 rehash ()</td></tr><tr><td style="text-align:center">扩容</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">扩容结束 (Thread1 结果)</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">扩容</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">扩容结束 (Thread2 结果)</td></tr></tbody></table><p>总结：因为两个线程同时记录的了原链表最初的 结点 e 地址和 next 地址，在一个线程修改完成后顺序由 321 变成了 123，另一个线程再去修改 ，由于头插的缘故 最开始 3-&gt;2 在修改完成后的 2-&gt;3 之间就回形成环路</p><h4 id="18底层遵照-font-colorred-哈希表结构-红黑树font尾插法"><a class="anchor" href="#18底层遵照-font-colorred-哈希表结构-红黑树font尾插法">#</a> 1.8 底层遵照 <font color="red">哈希表结构 + 红黑树</font>（尾插法）</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// HashMap&lt;String,Integer> map = new HashMap&lt;>(); -->JDK 1.7 开始类型推断，后面用钻石运算符即可。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> 		<span class="token comment">//【1】继承的 AbstractMap 中，已经实现了 Map 接口</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span> <span class="token comment">//【2】又实现了这个接口，多余，但是集合的设计者觉得没有必要删除，就这么地了</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment">//------------------ 属性部分：</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span><span class="token comment">//【3-2】用来接收装填因子的变量</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token comment">/*</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		【3-3】</pre></td></tr><tr><td data-num="9"></td><td><pre>		定义了一个 float 类型的变量，以后作为：默认的装填因子，加载因子是表示 Hsah 表中元素的填满的程度</pre></td></tr><tr><td data-num="10"></td><td><pre>        太大容易引起哈西冲突，太小容易浪费  0.75 是经过大量运算后得到的最好值</pre></td></tr><tr><td data-num="11"></td><td><pre>        这个值其实可以自己改，但是不建议改，因为这个 0.75 是大量运算得到的</pre></td></tr><tr><td data-num="12"></td><td><pre>	*/</pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">int</span> threshold<span class="token punctuation">;</span><span class="token comment">//【6-3】数组扩容的界限值，门槛值</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span><span class="token comment">//【7-5】底层主数组</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token comment">//------------------ 构造器：</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token comment">//【3】调用空构造器</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token comment">//【3-1】给装填因子 loadFactor 赋值</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">;</span> <span class="token comment">// all other fields defaulted</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	</pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token comment">//【4】调用有参构造器：</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token comment">//【5】调用两个参数构造器</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token comment">//【6】</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token comment">//【6-1】健壮性考虑，传入的数据过小不行，过大不行</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                                               initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            initialCapacity <span class="token operator">=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                                               loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>		<span class="token comment">//【6-2】给装填因子 loadFactor 赋值，赋值为 0.75，这个值可以单独传入改变，但是不建议改变，一般都用默认的 0.75</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>		<span class="token comment">//【6-3】给 threshold 赋值 </span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>	<span class="token comment">//【6-4】返回的是大于 initialCapacity 的最接近的 2 的整数倍  ，比如 initialCapacity 传入 10，这个方法返回 16</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//（内部内容讲源码时候不用管，面试题中详讲）</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">int</span> n <span class="token operator">=</span> cap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">:</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>	</pre></td></tr><tr><td data-num="55"></td><td><pre>	<span class="token comment">//------------------ 方法：</span></pre></td></tr><tr><td data-num="56"></td><td><pre>	<span class="token comment">//【7】调用 put 方法</span></pre></td></tr><tr><td data-num="57"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>		<span class="token comment">//【7-1】首先调用 hash 方法计算哈希值：</span></pre></td></tr><tr><td data-num="59"></td><td><pre>		<span class="token comment">//【7-3】调用 putVal 方法传入五个参数：</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>	<span class="token comment">//【7-2】计算 hash 值</span></pre></td></tr><tr><td data-num="63"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token keyword">int</span> h<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>	<span class="token comment">//【7-4】调用</span></pre></td></tr><tr><td data-num="68"></td><td><pre>	<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>                   <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>		<span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="72"></td><td><pre>		<span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>		<span class="token comment">//【7-6】将底层主数组 table 给 tab，判断是否为 null，第一次放数据一定是 null</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="75"></td><td><pre>			<span class="token comment">//【7-7】走入 if 分支：table 是 null，就对 table 进行扩容，走进 resize 方法</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token comment">//【7-21】table 的 length 为 16 ，n 为 16</span></pre></td></tr><tr><td data-num="77"></td><td><pre>		<span class="token comment">/*</span></pre></td></tr><tr><td data-num="78"></td><td><pre>		【7-22】</pre></td></tr><tr><td data-num="79"></td><td><pre>		i = (n - 1) &amp; hash 根据哈希值和 n 计算放入数组的位置</pre></td></tr><tr><td data-num="80"></td><td><pre>		取出这个位置上的元素，看是否为空，如果是第一个元素，一定是 null</pre></td></tr><tr><td data-num="81"></td><td><pre>		*/</pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre>			<span class="token comment">//【7-23】在这个位置上将元素封装为 Node 对象，放入对应位置</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 封装 Node 节点 new Node&lt;>(hash, key, value, null);</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                e <span class="token operator">=</span> p<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>                e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>                        p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="97"></td><td><pre>                            <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>                        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                        <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>                        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>                    p <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="107"></td><td><pre>                <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="109"></td><td><pre>                    e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>                <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>                <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token operator">++</span>modCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>		<span class="token comment">//【7-25】size 指的是放入集合的键值总数，size++ 操作，不大于 threshold，resize 方法不走</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="117"></td><td><pre>            <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>	<span class="token comment">//【7-8】resize 方法：---》假设最开始走的是 HashMap 的空构造器：</span></pre></td></tr><tr><td data-num="122"></td><td><pre>	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span><span class="token comment">//【7-9】table 是 null</span></pre></td></tr><tr><td data-num="124"></td><td><pre>        <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">//【7-10】oldCap:0</span></pre></td></tr><tr><td data-num="125"></td><td><pre>        <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span><span class="token comment">//【7-11】threshold 为 16，oldThr：16</span></pre></td></tr><tr><td data-num="126"></td><td><pre>        <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//【7-12】不走</span></pre></td></tr><tr><td data-num="128"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>                threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>                <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>                     oldCap <span class="token operator">>=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="134"></td><td><pre>                newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//【7-13】走</span></pre></td></tr><tr><td data-num="137"></td><td><pre>            newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span><span class="token comment">//newCap=16</span></pre></td></tr><tr><td data-num="138"></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>               <span class="token comment">//【7-14】不走</span></pre></td></tr><tr><td data-num="139"></td><td><pre>			 </pre></td></tr><tr><td data-num="140"></td><td><pre>            newCap <span class="token operator">=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>			 </pre></td></tr><tr><td data-num="142"></td><td><pre>            newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">*</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//【7-15】走</span></pre></td></tr><tr><td data-num="145"></td><td><pre>            <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span><span class="token comment">//【7-16】ft: 16*0.75=12</span></pre></td></tr><tr><td data-num="146"></td><td><pre>            newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">?</span></pre></td></tr><tr><td data-num="147"></td><td><pre>                      <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//【7-17】newThr = 12</span></pre></td></tr><tr><td data-num="148"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>		<span class="token comment">//【7-18】threshold 赋值为 newThr 为 12， ---》所以走空构造器这里 threshold 赋值为 12，走有参构造器里面 threshold 赋值为 12？？？？</span></pre></td></tr><tr><td data-num="150"></td><td><pre>        threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="152"></td><td><pre>		<span class="token comment">//【7-19】创建 Node 数组，长度为 newCap16</span></pre></td></tr><tr><td data-num="153"></td><td><pre>            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>		<span class="token comment">//【7-20】table 赋值为 newTab</span></pre></td></tr><tr><td data-num="155"></td><td><pre>        table <span class="token operator">=</span> newTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="156"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="158"></td><td><pre>                <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>                    oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="162"></td><td><pre>                        newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="164"></td><td><pre>                        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="165"></td><td><pre>                    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="166"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="167"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>                        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>                            next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="173"></td><td><pre>                                    loHead <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="174"></td><td><pre>                                <span class="token keyword">else</span></pre></td></tr><tr><td data-num="175"></td><td><pre>                                    loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="176"></td><td><pre>                                loTail <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre>                            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="178"></td><td><pre>                            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="179"></td><td><pre>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="180"></td><td><pre>                                    hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="181"></td><td><pre>                                <span class="token keyword">else</span></pre></td></tr><tr><td data-num="182"></td><td><pre>                                    hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="183"></td><td><pre>                                hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>                            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="185"></td><td><pre>                        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="186"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="187"></td><td><pre>                            loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="188"></td><td><pre>                            newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="189"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="190"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="191"></td><td><pre>                            hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="192"></td><td><pre>                            newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="193"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="194"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="195"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="196"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="197"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="198"></td><td><pre>        <span class="token keyword">return</span> newTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="199"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="200"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">int</span> threshold<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                                               initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            initialCapacity <span class="token operator">=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                                               loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">int</span> n <span class="token operator">=</span> cap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">:</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	</pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token comment">//【8-1】put 方法</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		<span class="token comment">// 计算 hash 值</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">int</span> h<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token comment">//【8-2】调用 putVal 方法</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                   <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>		<span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="51"></td><td><pre>		<span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>		</pre></td></tr><tr><td data-num="53"></td><td><pre>		<span class="token comment">//【8-3】table 不空了，不走 if		</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>		<span class="token comment">//【8-4】tab [i] 不 null，不走 if</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>			<span class="token comment">/*</span></pre></td></tr><tr><td data-num="62"></td><td><pre>				【8-5】</pre></td></tr><tr><td data-num="63"></td><td><pre>				判断 p.hash == hash 哈希值是否相等，即使 hash 相等也要做 & amp;&amp; 后续的判断，因为两个对象哈希值相等是有可能的</pre></td></tr><tr><td data-num="64"></td><td><pre>				(k = p.key) == key   == 比较地址值，String 的话一样，不是字符串地址也不一样，</pre></td></tr><tr><td data-num="65"></td><td><pre>				Animal a1 = new Animal (19);		和 	Animal a2 = new Animal (19);	地址一定不同，就需要用后面的 equals 进行比较</pre></td></tr><tr><td data-num="66"></td><td><pre>			*/</pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//----》哈希值相等，出现哈西碰撞</span></pre></td></tr><tr><td data-num="69"></td><td><pre>				<span class="token comment">//【8-6】将该数组位置的数据给 e</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                e <span class="token operator">=</span> p<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                        p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="78"></td><td><pre>                            <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>                        <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>                    p <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="88"></td><td><pre>                <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                    e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">//【8-7】新 value 替换老 value</span></pre></td></tr><tr><td data-num="91"></td><td><pre>                <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>                <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span><span class="token comment">//【8-8】返回老 value</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>        <span class="token operator">++</span>modCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre>	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="106"></td><td><pre>        <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>                threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>                <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>                     oldCap <span class="token operator">>=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="115"></td><td><pre>                newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="118"></td><td><pre>            newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    </pre></td></tr><tr><td data-num="120"></td><td><pre>            newCap <span class="token operator">=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>            newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">*</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>            <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>            newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">?</span></pre></td></tr><tr><td data-num="126"></td><td><pre>                      <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>        threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="130"></td><td><pre>            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>        table <span class="token operator">=</span> newTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>                <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>                    oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="138"></td><td><pre>                        newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="140"></td><td><pre>                        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>                    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="142"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>                        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>                            next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="147"></td><td><pre>                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="149"></td><td><pre>                                    loHead <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>                                <span class="token keyword">else</span></pre></td></tr><tr><td data-num="151"></td><td><pre>                                    loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>                                loTail <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>                            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>                            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="155"></td><td><pre>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="156"></td><td><pre>                                    hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>                                <span class="token keyword">else</span></pre></td></tr><tr><td data-num="158"></td><td><pre>                                    hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>                                hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>                            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>                        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>                            loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="164"></td><td><pre>                            newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="165"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="166"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="167"></td><td><pre>                            hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>                            newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="173"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="174"></td><td><pre>        <span class="token keyword">return</span> newTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="175"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="176"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">int</span> threshold<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                                               initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            initialCapacity <span class="token operator">=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                                               loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">int</span> n <span class="token operator">=</span> cap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">:</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	</pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token comment">//【9-1】put 方法</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		<span class="token comment">// 计算 hash 值</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">int</span> h<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token comment">//【9-2】调用 putVal 方法</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                   <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>		<span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="51"></td><td><pre>		<span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>		</pre></td></tr><tr><td data-num="53"></td><td><pre>		<span class="token comment">//【9-3】table 不空了，不走 if		</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>		<span class="token comment">//【9-4】tab [i] 不 null，不走 if</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>			<span class="token comment">/*</span></pre></td></tr><tr><td data-num="62"></td><td><pre>				【9-5】</pre></td></tr><tr><td data-num="63"></td><td><pre>				判断 p.hash == hash 哈希值是否相等，即使 hash 相等也要做 & amp;&amp; 后续的判断，因为两个对象哈希值相等是有可能的</pre></td></tr><tr><td data-num="64"></td><td><pre>				此时 “通话” 和 “重地” 的哈希值一致，但是 key 不一致，if 不走</pre></td></tr><tr><td data-num="65"></td><td><pre>			*/</pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                e <span class="token operator">=</span> p<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span><span class="token comment">//【9-6】p 也不是红黑树，不走 if</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>				<span class="token comment">//【9-7】走到这里，证明数组的这个位置是个链表了</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//【9-8】无条件的死循环   binCount 链表上节点的个数</span></pre></td></tr><tr><td data-num="74"></td><td><pre>					<span class="token comment">// 随着循环  p.next 就是一路找链上元素</span></pre></td></tr><tr><td data-num="75"></td><td><pre>					<span class="token comment">//p.next 要是没有元素，就要开始追加了呗</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//【9-10】一路 next 比较都没有 key 相同的数据</span></pre></td></tr><tr><td data-num="77"></td><td><pre>					</pre></td></tr><tr><td data-num="78"></td><td><pre>                        p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//【9-11】追加在链表尾部 ---》 前七后八</span></pre></td></tr><tr><td data-num="79"></td><td><pre>						<span class="token comment">//【9-12】如果节点个数大于 8，进行树化：要从链表转为红黑树</span></pre></td></tr><tr><td data-num="80"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="81"></td><td><pre>                            <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//【9-13】这里还涉及 剪枝 问题，树节点在 6 个以下，就又变成链表了</span></pre></td></tr><tr><td data-num="82"></td><td><pre>                        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>					<span class="token comment">//【9-9】比较过程中：如果比较链表某个 key 相同，就 break 结束了，不用继续走了</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>                        <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                    p <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="92"></td><td><pre>                <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="94"></td><td><pre>                    e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">//【8-7】新 value 替换老 value</span></pre></td></tr><tr><td data-num="95"></td><td><pre>                <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>                <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span><span class="token comment">//【8-8】返回老 value</span></pre></td></tr><tr><td data-num="97"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token operator">++</span>modCount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre></pre></td></tr><tr><td data-num="101"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>            <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre>	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>        <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="110"></td><td><pre>        <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>        <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>                threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>                <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>                     oldCap <span class="token operator">>=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="119"></td><td><pre>                newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="122"></td><td><pre>            newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    </pre></td></tr><tr><td data-num="124"></td><td><pre>            newCap <span class="token operator">=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>            newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">*</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>            <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>            newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">?</span></pre></td></tr><tr><td data-num="130"></td><td><pre>                      <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>        threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="134"></td><td><pre>            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>        table <span class="token operator">=</span> newTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>                <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>                    oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="142"></td><td><pre>                        newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="144"></td><td><pre>                        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>                    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="146"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="147"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>                        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>                            next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="153"></td><td><pre>                                    loHead <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>                                <span class="token keyword">else</span></pre></td></tr><tr><td data-num="155"></td><td><pre>                                    loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="156"></td><td><pre>                                loTail <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>                            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="158"></td><td><pre>                            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="160"></td><td><pre>                                    hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>                                <span class="token keyword">else</span></pre></td></tr><tr><td data-num="162"></td><td><pre>                                    hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>                                hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="164"></td><td><pre>                            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="165"></td><td><pre>                        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="166"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="167"></td><td><pre>                            loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>                            newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>                            hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>                            newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="173"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="174"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="175"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="176"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="177"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="178"></td><td><pre>        <span class="token keyword">return</span> newTab<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="179"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="180"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>总结：</strong></p><p>默认（创建时只是初始化负载因子，数组长度是在第一次 put 的时候初始化的）<strong>数组长度为 16</strong>，<strong>最大程度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>30</mn></msup></mrow><annotation encoding="application/x-tex">{2^{30}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></span></span></strong>,<strong> 负载因子为 0.75</strong>，扩容时<strong>扩大 2 倍</strong>，最大不超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>31</mn></msup></mrow><annotation encoding="application/x-tex">{2^{31}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span>(一旦到达最开始的域值<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>30</mn></msup></mrow><annotation encoding="application/x-tex">{2^{30}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></span></span> 就变大)</p><p>1.8 相对于 1.7 只是改变了数据结构</p><h3 id="hashmap为什么要使用红黑树"><a class="anchor" href="#hashmap为什么要使用红黑树">#</a> Hashmap 为什么要使用红黑树？</h3><p>​	在 jdk1.8 版本后，java 对 HashMap 做了改进，在<strong>链表长度大于 8</strong> 的时候，将后面的数据存在红黑树中，以加快检索速度</p><p>​	红黑树虽然本质上是一棵二叉查找树，但它在二叉查找树的基础上增加了着色和相关的性质使得红黑树相对平衡，从而保证了红黑树的查找、插入、删除的时间复杂度最坏为 O (log n)。加快检索速率。</p><p><font color="red">引申</font></p><p>在<strong>链表长度小于 6</strong> 的时候，红黑树又会变回二叉树</p><h3 id="主数组的长度为什么是2n"><a class="anchor" href="#主数组的长度为什么是2n">#</a> 主数组的长度为什么是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.664392em;vertical-align:0"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.664392em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>？</h3><p><strong>原因 1：</strong></p><p>因为这个 length 的长度，会影响 key 的位置：</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220630132734570.png" title="image-20220630132734570"><p>实际上这个算法就是： h% length , 但是取模的话 效率太低，所以用位运算效率会很高。</p><p><strong>原因 2：</strong></p><p>如果不是 2 的整数倍，那么 哈西碰撞 哈西冲突的概率就高了很多</p><h3 id="装填因子075的原因"><a class="anchor" href="#装填因子075的原因">#</a> 装填因子 0.75 的原因</h3><p><strong>如果装填因子是 1， 那么数组满了再扩容，可以做到 最大的空间利用率</strong><br>但是这是一个理想状态，元素不可能完全的均匀分布，很可能就哈西碰撞产生链表了。产生链表的话 查询时间就长了。</p><ul><li><strong>空间好，时间不好</strong></li></ul><p><strong>如果是 0.5 的话，就浪费空间，但是可以做到到 0.5 就扩容 ，然后哈西碰撞就少，不产生链表的话，那么查询效率很高</strong></p><ul><li><strong>时间好，空间不好</strong></li></ul><p><strong>总结：</strong></p><p>1 空间利用率高，但是容易造成<strong> hash 冲突</strong>，产生链表，降低查询效率；</p><p>0.5 不易造成 Hash 冲突，但是空间利用率低；</p><p>综上所述 JDK 官方折中处理取了一个中间值 0.75</p><h3 id="hashmap-的时间复杂度"><a class="anchor" href="#hashmap-的时间复杂度">#</a> HashMap 的时间复杂度</h3><p>在数组中结点没有产生链表的情况下 O (1)</p><p>在产生链表但长度小于 8 的时候 O (n)</p><p>链表长度大于等于 8 的时候 O (logn)</p><h3 id="hashtable底层"><a class="anchor" href="#hashtable底层">#</a> HashTable 底层</h3><p>底层遵照 <font color="red">哈希表结构</font></p><h3 id="linkedmap底层"><a class="anchor" href="#linkedmap底层">#</a> LinkedMap 底层</h3><p>底层遵照 <font color="red">哈希表 + 链表</font></p><h3 id="hashmap和hashtable有什么区别"><a class="anchor" href="#hashmap和hashtable有什么区别">#</a> HashMap 和 Hashtable 有什么区别？</h3><table><thead><tr><th></th><th style="text-align:center">HashMap</th><th style="text-align:center">Hashtable</th></tr></thead><tbody><tr><td>存储</td><td style="text-align:center">允许 <code>Key</code> 为 null</td><td style="text-align:center">不允许 <code>Key</code> 为 null</td></tr><tr><td>线程安全</td><td style="text-align:center">线程不安全</td><td style="text-align:center">线程安全</td></tr></tbody></table><p><strong>推荐使用</strong>：</p><p>​	在<strong> Hashtable</strong> 的类注释可以看到，<strong>Hashtable</strong> 是保留类<strong>不建议使用</strong>，推荐在<strong>单线程环境</strong>下使<strong>用 HashMap 替代</strong>，如果需要<strong>多线程</strong>使用则<strong>用 ConcurrentHashMap 替代</strong>。</p><h3 id="treemap底层"><a class="anchor" href="#treemap底层">#</a> TreeMap 底层</h3><p><font color="red">红黑树</font></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token comment">// 重要属性：</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">// 外部比较器：</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> comparator<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// 树的根节点：</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> root <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 集合中元素的数量：</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// 空构造器:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">TreeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        comparator <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 如果使用空构造器，那么底层就不使用外部比较器</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">// 有参构造器：</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">TreeMap</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> comparator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>comparator <span class="token operator">=</span> comparator<span class="token punctuation">;</span><span class="token comment">// 如果使用有参构造器，那么就相当于指定了外部比较器</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        </pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//k,V 的类型在创建对象的时候确定了</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment">// 如果放入的是第一对元素，那么 t 的值为 null</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> t <span class="token operator">=</span> root<span class="token punctuation">;</span><span class="token comment">// 在放入第二个节点的时候，root 已经是根节点了</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token comment">// 如果放入的是第一个元素的话，走入这个 if 中：</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                        <span class="token comment">// 自己跟自己比</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token function">compare</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type (and possibly null) check</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                        <span class="token comment">// 根节点确定为 root</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                        <span class="token comment">//size 值变为 1</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            size <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            modCount<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                </pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">int</span> cmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> parent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token comment">// split comparator and comparable paths</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token comment">// 将外部比较器赋给 cpr:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> cpr <span class="token operator">=</span> comparator<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token comment">//cpr 不等于 null，意味着你刚才创建对象的时候调用了有参构造器，指定了外部比较器</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cpr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                parent <span class="token operator">=</span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                cmp <span class="token operator">=</span> cpr<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将元素的 key 值做比较</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                                <span class="token comment">//cmp 返回的值就是 int 类型的数据：</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                                <span class="token comment">// 要是这个值《0 =0  》0</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                    t <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                    t <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token keyword">else</span><span class="token comment">//cpm==0</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                                <span class="token comment">// 如果 key 的值一样，那么新的 value 替换老的 value  但是 key 不变 因为 key 是唯一的</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                    <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token comment">//cpr 等于 null，意味着你刚才创建对象的时候调用了空构造器，没有指定外部比较器，使用内部比较器</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> k <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> key<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                parent <span class="token operator">=</span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                cmp <span class="token operator">=</span> k<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将元素的 key 值做比较</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                    t <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                    t <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                <span class="token keyword">else</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                    <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            parent<span class="token punctuation">.</span>left <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            parent<span class="token punctuation">.</span>right <span class="token operator">=</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token function">fixAfterInsertion</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        size<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//size 加 1 操作</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        modCount<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        </pre></td></tr><tr><td data-num="81"></td><td><pre>        </pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="83"></td><td><pre> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token class-name">K</span> key<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token class-name">V</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> left <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> right <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> parent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token keyword">boolean</span> color <span class="token operator">=</span> <span class="token constant">BLACK</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="collection-和-collections-区别"><a class="anchor" href="#collection-和-collections-区别">#</a> Collection 和 Collections 区别</h3><p>Collection，提供了对集合对象进行基本操作的通用<strong>接口方法</strong>，所有集合都是它的子类，比如 List、Set 等。</p><p>Collections，是一个<strong>工具类</strong>，它包含了很多静态方法，不能被实例化，比如排序方法： Collections. sort (list) 等。</p><h3 id="arraysaslist方法之后的集合可以调用什么方法"><a class="anchor" href="#arraysaslist方法之后的集合可以调用什么方法">#</a> Arrays.asList () 方法之后的集合可以调用什么方法</h3><p>​ <code>size()</code> 只有 size 方法可用，通过查看源码我们知道，将传递过去的数组变成了一个 ArrayList 集合，但是不是 java.util.ArrayList 而是 java.util.Arrays.ArrayList , 也就是 Arrays 中的一个内部类，他的方法只定义了 <code>size</code> 、 <code>toArray</code> 、 <code>get</code> 、 <code>set</code> 和 <code>indexOf</code></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220628202337546.png" title="image-20220628202337546"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220628202651719.png" title="image-20220628202651719"><h3 id="map-set-list的区别"><a class="anchor" href="#map-set-list的区别">#</a> Map、Set、List 的区别</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220629181141368.png" title="image-20220629181141368"><p><strong>List</strong></p><blockquote><p>List 中存储的元素有序，指的是读出的顺序与存入的顺序是一致的。</p></blockquote><p>①可以允许重复的对象；<br>②可以插入多个 null 元素；<br>③是一个有序容器，保持了每个元素的插入顺序，输出的顺序就是插入的顺序；<br>④常用的实现类有 ArrayList、LinkedList 和 Vector；ArrayList 最为流行，它提供了使用索引的随意访问，而 LinkedList 则对于经常需要从 List 中添加或删除元素的场合更为合适。</p><p><strong>Set</strong></p><blockquote><p>Set 存储的元素是无序的，这里的无序指的是存入的顺序与输出的顺序可能是不一致的。</p></blockquote><p>①不允许重复对象；<br>②无序容器，你无法保证每个元素的存储顺序，TreeSet 通过 Comparator 或者 Comparable 维护了一个排序顺序；<br>③只允许一个 null 元素；<br>④Set 接口最流行的几个实现类是 HashSet、LinkedHashSet 以及 TreeSet；<br>最流行的是<strong>基于 HashMap</strong> 实现的 HashSet；<br>TreeSet 还实现了 SortedSet 接口，因此 TreeSet 是一个根据其 compare () 和 compareTo () 的定义进行排序的有序容器。</p><p><strong>Map</strong></p><blockquote><p>Map 存储的元素是键值对（key-value），键和值都是无序的，即存入顺序与输出顺序可能都不一样。</p></blockquote><p>①Map 不是 Collection 的子接口或者实现类，Map 是一个接口；<br>②Map 的 每个 Entry 都持有两个对象，也就是一个键一个值，Map 可能会持有相同的值对象但键对象必须是唯一的；<br>③TreeMap 也通过 Comparator 或者 Comparable 维护了一个排序顺序；<br>④Map 里你可以拥有随意个 null 值，但最多只能有一个 null 键；<br>⑤Map 接口最流行的几个实现类是 HashMap、LinkedHashMap、Hashtable 和 TreeMap。（HashMap、TreeMap 最常用）</p><h3 id="hashset与treeset-区别"><a class="anchor" href="#hashset与treeset-区别">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd2lsbGlhbWppZS9wLzkwOTkwMzguaHRtbA==">HashSet 与 TreeSet 区别</span></h3><p><strong>HashSet</strong><br>HashSet 有以下特点</p><ul><li>不能保证元素的排列顺序，顺序有可能发生变化</li><li>不是同步的</li><li>集合元素可以是 null, 但只能放入一个 null</li></ul><p>​ 当向 HashSet 集合中存入一个元素时，HashSet 会调用该对象的 hashCode () 方法来得到该对象的 hashCode 值，然后根据 hashCode 值来决定该对象在 HashSet 中存储位置。<br>简单的说，HashSet 集合判断两个元素相等的标准是两个对象通过 equals 方法比较相等，并且两个对象的 hashCode () 方法返回值相等</p><p>​ 注意，如果要把一个对象放入 HashSet 中，重写该对象对应类的 equals 方法，也应该重写其 hashCode () 方法。其规则是如果两个对 象通过 equals 方法比较返回 true 时，其 hashCode 也应该相同。另外，对象中用作 equals 比较标准的属性，都应该用来计算 hashCode 的值。</p><p><strong>TreeSet 类</strong><br>TreeSet 是 SortedSet 接口的唯一实现类，TreeSet 可以确保集合元素处于排序状态。TreeSet 支持两种排序方式，自然排序 和定制排序，其中自然排序为默认的排序方式。向 TreeSet 中加入的应该是同一个类的对象。<br>TreeSet 判断两个对象不相等的方式是两个对象通过 equals 方法返回 false，或者通过 CompareTo 方法比较没有返回 0<br><strong>自然排序</strong><br>自然排序使用要排序元素的 CompareTo（Object obj）方法来比较元素之间大小关系，然后将元素按照升序排列。<br>Java 提供了一个 Comparable 接口，该接口里定义了一个 compareTo (Object obj) 方法，该方法返回一个整数值，实现了该接口的对象就可以比较大小。<br>obj1.compareTo (obj2) 方法如果返回 0，则说明被比较的两个对象相等，如果返回一个正数，则表明 obj1 大于 obj2，如果是 负数，则表明 obj1 小于 obj2。<br>如果我们将两个对象的 equals 方法总是返回 true，则这两个对象的 compareTo 方法返回应该返回 0<br><strong>定制排序</strong><br>自然排序是根据集合元素的大小，以升序排列，如果要定制排序，应该使用 Comparator 接口，实现 int compare (T o1,T o2) 方法。</p><p><strong>最重要：</strong></p><p>1、TreeSet 是二差树实现的，Treeset 中的数据是自动排好序的，不允许放入 null 值。</p><p>2、HashSet 是哈希表实现的，HashSet 中的数据是无序的，可以放入 null，但只能放入一个 null，两者中的值都不能重复，就如数据库中唯一约束。</p><p>3、HashSet 要求放入的对象必须实现 HashCode () 方法，放入的对象，是以 hashcode 码作为标识的，而具有相同内容的 String 对象，hashcode 是一样，所以放入的内容不能重复。但是同一个类的对象可以放入不同的实例 。</p><p><strong>HashSet 与 TreeSet 的使用场景</strong></p><p>HashSet：哈希表是通过使用称为散列法的机制来存储信息的，元素并没有以某种特定顺序来存放 TreeSet：提供一个使用树结构存储 Set 接口的实现 (红黑树算法)，对象以升序顺序存储，访问和遍历的时间很快。<br>使用场景：HashSet 是基于 Hash 算法实现的，其性能通常都优于 TreeSet。我们通常都应该使用 HashSet，在我们需要排序的功能时，我们才使用 TreeSet。</p><p><strong>HashSet 与 TreeSet 的底层运行方式:</strong><br>TreeSet 集合对象的加入过程：<br>TreeSet 的底层是通过二叉树来完成存储的，无序的集合<br>当我们将一个对象加入 treeset 中，treeset 会将第一个对象作为根对象，然后调用对象的 compareTo 方法拿第二个对象和第一个比较，当返回至 = 0 时，说明 2 个对象内容相等，treeset 就不把第二个对象加入集合。返回 &gt; 1 时，说明第二个对象大于第一个对象，将第二个对象放在右边，返回 - 1 时，则将第二个对象放在左边，依次类推</p><p>HashSet 集合对象的加入过程：<br>hashset 底层是 hash 值的地址，它里面存的对象是无序的。<br>第一个对象进入集合时，hashset 会调用 object 类的 hashcode 根据对象在堆内存里的地址调用对象重写的 hashcode 计算出一个 hash 值，然后第一个对象就进入 hashset 集合中的任意一个位置。<br>第二个对象开始进入集合，hashset 先根据第二个对象在堆内存的地址调用对象的计算出一个 hash 值，如果第二个对象和第一个对象在堆内存里的地址是相同的，那么得到的 hash 值也是相同的，直接返回 true，hash 得到 true 后就不把第二个元素加入集合（这段是 hash 源码程序中的操作）。如果第二个对象和第一个对象在堆内存里地址是不同的，这时 hashset 类会先调用自己的方法遍历集合中的元素，当遍历到某个元素时，调用对象的 equals 方法，如果相等，返回 true，则说明这两个对象的内容是相同的，hashset 得到 true 后不会把第二个对象加入集合。</p><h3 id="hashtabl-hashmap-treemap的区别"><a class="anchor" href="#hashtabl-hashmap-treemap的区别">#</a> hashtabl、hashMap treeMap 的区别</h3><p><strong>实现方面</strong><br>HashMap 是继承自 AbstractMap 类，而 HashTable 是继承自 Dictionary 类。它们都同时实现了 map、Cloneable（可复制）、Serializable（可序列化）这三个接口。存储的内容是基于 key-value 的键值对映射，不能有重复的 key，而且一个 key 只能映射一个 value。HashSet 底层就是基于 HashMap 实现的。</p><p><strong>为空方面</strong><br>Hashtable 的 key、value 都不能为 null；HashMap 的 key、value 可以为 null，不过只能有一个 key 为 null，但可以有多个 null 的 value；TreeMap 键、值都不能为 null。</p><p><strong>排序方面</strong><br>Hashtable、HashMap 具有无序特性。TreeMap 是利用红黑树实现的（树中的每个节点的值都会大于或等于它的左子树中的所有节点的值，并且小于或等于它的右子树中的所有节点的值），实现了 SortMap 接口，能够对保存的记录根据键进行排序。所以一般需求排序的情况下首选 TreeMap，默认按键的升序排序（深度优先搜索），也可以自定义实现 Comparator 接口实现排序方式。</p><p><strong>注：<strong>HashTable 是一个线程安全的类，它使用</strong> synchronized</strong> 来锁住整张<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1IYXNoJmFtcDtzcG09MTAwMS4yMTAxLjMwMDEuNzAyMA=="> Hash</span> 表来实现线程安全，即每次锁住整张表让线程独占，相当于所有线程进行读写时都去竞争一把锁，导致效率非常低下</p><p>Hashtable 现在很少出现了，大家更多的会使用 <code>ConcurrentHashMap</code> ，引导面试官提问<strong> ConcurrentHashMap</strong>。</p><h3 id="concurrenthashmap原理与实现"><a class="anchor" href="#concurrenthashmap原理与实现">#</a> ConcurrentHashMap 原理与实现</h3><p>分析问题：原理与实现主要是锁的原理与实现！我们可以从 JDK1.7 开始聊起:<br>JDK1.7 版本，ConcurrentHashMap 内部使用段 (Segment),ConcurrentLevel 有 16 个分段，这 16 个分段有独立的锁机制，每个独立的机制都是一张表，表的下面是链表，这样就可以支持并发的同时保证每张表的线程安全，大大的题高了效率。</p><p>​	JDK1.8 版本，ConcurrentHashMap 内部使用 sychronized + volatile + CAS 的实现降低锁的粒度，大家可以认为粒度就是 HashEntry (首节点)。</p><p>让我们看看具体是如何实现的:</p><ul><li><p>插入、删除、扩容的时候都对数组中相应位置的元素加锁了，加锁用的是 synchronized.</p></li><li><p>table 数组、Node 中的 val 和 next、以及一些控制字段都加了 volatile</p></li><li><p>在更新一些关键变量的时候用到了 sun.misc.Unsafe 中的一些方法</p></li></ul><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/204fe5e5d4314bf99acbaa07df844ef5tplv-k3u1fbpfcp-watermark.jpg" title="204fe5e5d4314bf99acbaa07df844ef5~tplv-k3u1fbpfcp-watermark"><p><strong>反思 &amp; 扩展</strong><br><strong>ConcurrentHashMap 有什么缺陷吗？</strong><br>ConcurrentHashMap 是设计为非阻塞的。在更新时会局部锁住某部分数据，但不会把整个表都锁住。同步读取操作则是完全非阻塞的。好处是在保证合理的同步前提下，效率很高。坏处是严格来说读取操作不能保证反映最近的更新。例如线程 A 调用 putAll 写入大量数据，期间线程 B 调用 get，则只能 get 到目前为止已经顺利插入的部分数据。</p><p><strong>ConcurrentHashMap 在 JDK7 和 8 之间的区别</strong><br>JDK1.8 的实现降低锁的粒度，JDK1.7 版本锁的粒度是基于 Segment 的，包含多个 HashEntry，而 JDK1.8 锁的粒度就是<br>HashEntry (首节<br>点)<br>JDK1.8 版本的数据结构变得更加简单，使得操作也更加清晰流畅，因为已经使用 synchronized 来进行同步，所以不需要分段锁的概念，也就不需要 Segment 这种数据结构了，由于粒度的降低，实现的复杂度也增加了<br>JDK1.8 使用红黑树来优化链表，基于长度很长的链表的遍历是一个很漫长的过程，而红黑树的遍历效率是很快的，代替一定阈值的链表，这样形成一个最佳拍档</p><h3 id="未完成-2"><a class="anchor" href="#未完成-2">#</a> —————————— 未完成</h3><h1 id="泛型"><a class="anchor" href="#泛型">#</a> 泛型</h1><p>什么是泛型（Generic）：<br>泛型就相当于标签，一般我们在使用的时候基本上往集合中存入的都是相同类型的数据 --》便于管理，所以现在什么引用数据类型都可以存入集合，不方便！</p><h3 id="泛型上-下限"><a class="anchor" href="#泛型上-下限">#</a> 泛型上、下限</h3><p><strong>上限</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//        list = object;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        list <span class="token operator">=</span> person<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        list<span class="token operator">=</span>student<span class="token punctuation">;</span></pre></td></tr></table></figure><p>所有直接承接类必须为 extends 的类的子类 / 同等级类，？是爹</p><p><strong>下限</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        list <span class="token operator">=</span> object<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        list <span class="token operator">=</span> person<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">//list=student;</span></pre></td></tr></table></figure><p>所有直接承接类必须为 super 的类的父类 / 同等级类，？是子</p><p><strong>总结</strong></p><p>看上下限，就看 关键字是否为 super，super 下限（<strong>只有子类才用 super</strong>)，否则为上限</p><h3 id="java中的自增ii是线程安全的吗如何实现线程安全的自增"><a class="anchor" href="#java中的自增ii是线程安全的吗如何实现线程安全的自增">#</a> Java 中的自增（i++/++i）是线程安全的吗，如何实现线程安全的自增？</h3><p><strong>不安全</strong>，<strong>加锁，或者用原子类</strong></p><p>增加 synchronized 进行线程同步</p><p>使用 lock、unlock 处理 Reetrantent 锁进行锁定</p><p><font color="red">引申</font></p><p>++ 操作破坏了原子性，使之线程不安全，JVM 为此类操作特意提供了一些同步类</p><p>原子类例如：<strong>AtomicInteger</strong></p><h1 id="多线程"><a class="anchor" href="#多线程">#</a> 多线程</h1><h3 id="wait-和-sleep-的区别"><a class="anchor" href="#wait-和-sleep-的区别">#</a> wait 和 sleep 的区别</h3><p>wait 进入阻塞状态，但是释放了锁</p><p>sleep 进入阻塞状态，但是没有释放锁</p><h3 id="wait和notify要放在synchronize中"><a class="anchor" href="#wait和notify要放在synchronize中">#</a> wait 和 notify 要放在 synchronize 中</h3><p>其实这样设计的原因<strong>就是为了防止多线程并发运行时，程序的执行混乱问题</strong>。不然在有可能会出现在 wait 没有执行结束的情况下，notify 已经执行完毕，这样会导致我们一直处于休眠状态。</p><h3 id="线程状态"><a class="anchor" href="#线程状态">#</a> 线程状态</h3><p><img data-src="https://cdn.jsdelivr.net/gh/onlymarryu/typora-ims-test@master/2020052615440291.png" alt="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200526103703738.png"></p><p>1、 <code>NEW</code> ：初始状态，线程被构建，但是还没有调用 start 方法；</p><p>2、 <code>RUNNABLED</code> ：运行状态，JAVA 线程把操作系统中的就绪和运行两种状态统一称为 “运行中” ；</p><p>3、 <code>BLOCKED</code> ：阻塞状态，表示线程进入等待状态，也就是线程因为某种原因放弃了 CPU 使用权，阻塞也分为几种情况 ：</p><ul><li><p>等待阻塞：运行的线程执行了 Thread.sleep 、wait ()、 join () 等方法 JVM 会把当前线程设置为等待状态，当 sleep 结束、join 线程终止或者线程被唤醒后，该线程从等待状态进入到阻塞状态，重新抢占锁后进行线程恢复；</p></li><li><p>同步阻塞：运行的线程在获取对象的同步锁时，若该同步锁被其他线程锁占用了，那么 jvm 会把当前的线程放入到锁池中 ；</p></li><li><p>其他阻塞：发出了 I/O 请求时，JVM 会把当前线程设置为阻塞状态，当 I/O 处理完毕则线程恢复；</p></li></ul><p>4、 <code>WAITING</code> ：等待状态，没有超时时间，要被其他线程或者有其它的中断操作；</p><p>执行 wait ()、join ()、LockSupport.park ()；</p><p>5、 <code>TIME_WAITING</code> ：超时等待状态，超时以后自动返回；</p><p>执行 Thread.sleep (long)、wait (long)、join (long)、LockSupport.park (long)、LockSupport.parkNanos (long)、LockSupport.parkUntil (long)</p><p>6、 <code>TERMINATED</code> ：终止状态，表示当前线程执行完毕 。</p><h3 id="线程死亡dead"><a class="anchor" href="#线程死亡dead">#</a> 线程死亡（DEAD）</h3><p>正常结束</p><p>1、run () 或 call () 方法执行完成，线程正常结束。</p><p>异常结束</p><p>2.、线程抛出一个未捕获的 Exception 或 Error。</p><p>调用 stop</p><p>3、 直接调用该线程的 stop () 方法来结束该线程 — 该方法通常容易导致死锁，不推荐使用。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220731131902865.png" title="image-20220731131902865"><h2 id="终止线程-4-种方式"><a class="anchor" href="#终止线程-4-种方式">#</a> 终止线程 4 种方式</h2><h3 id="正常运行结束"><a class="anchor" href="#正常运行结束">#</a> 正常运行结束</h3><p>程序运行结束，线程自动结束。</p><h3 id="使用退出标志退出线程"><a class="anchor" href="#使用退出标志退出线程">#</a> 使用退出标志退出线程</h3><p>一般 run () 方法执行完，线程就会正常结束，然而，常常有些线程是伺服线程。它们需要长时间的</p><p>运行，只有在外部某些条件满足的情况下，才能关闭这些线程。使用一个变量来控制循环，例如：</p><p>最直接的方法就是设一个 boolean 类型的标志，并通过设置这个标志为 true 或 false 来控制 while 循环是否退出，代码示例：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadSafe</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> exit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>exit<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">//do something</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>定义了一个退出标志 exit，当 exit 为 true 时，while 循环退出，exit 的默认值为 false. 在定义 exit 时，使用了一个 Java 关键字 volatile，这个关键字的目的是使 exit 同步，也就是说在同一时刻只能由一个线程来修改 exit 的值。</p><h3 id="interrupt-方法结束线程"><a class="anchor" href="#interrupt-方法结束线程">#</a> Interrupt 方法结束线程</h3><p>使用 interrupt () 方法来中断线程有两种情况：</p><p>1、线程处于阻塞状态：如使用了 sleep, 同步锁的 wait,socket 中的 receive,accept 等方法时，会使线程处于阻塞状态。当调用线程的 interrupt () 方法时，会抛出 InterruptException 异常。阻塞中的那个方法抛出这个异常，通过代码捕获该异常，然后 break 跳出循环状态，从而让我们有机会结束这个线程的执行。通常很多人认为只要调用 interrupt 方法线程就会结束，实际上是错的， 一定要先捕获 InterruptedException 异常之后通过 break 来跳出循环，才能正常结束 run 方法。</p><p>2、线程未处于阻塞状态：使用 isInterrupted () 判断线程的中断标志来退出循环。当使用 interrupt () 方法时，中断标志就会置 true，和使用自定义的标志来控制循环是一样的道理。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadSafe</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// 非阻塞过程中通过判断中断标志来退出</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">51000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 阻塞过程捕获中断异常来退出</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">// 捕获到异常之后，执行 break 跳出循环</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="stop-方法终止线程线程不安全"><a class="anchor" href="#stop-方法终止线程线程不安全">#</a> stop 方法终止线程（线程不安全）</h3><p>程序中可以直接使用 thread.stop () 来强行终止线程，但是 stop 方法是很危险的，就象突然关闭计算机电源，而不是按正常程序关机一样，可能会产生不可预料的结果，不安全主要是：thread.stop () 调用之后，创建子线程的线程就会抛出 ThreadDeatherror 的错误，并且会释放子线程所持有的所有锁。一般任何进行加锁的代码块，都是为了保护数据的一致性，如果在调用 thread.stop () 后导致了该线程所持有的所有锁的突然释放 (不可控制)，那么被保护数据就有可能呈现不一致性，其他线程在使用这些被破坏的数据时，有可能导致一些很奇怪的应用程序错误。因此，并不推荐使用 stop 方法来终止线程。</p><h3 id="未完成-3"><a class="anchor" href="#未完成-3">#</a> —————————— 未完成</h3><h1 id="线程池"><a class="anchor" href="#线程池">#</a> 线程池</h1><h3 id="线程工厂的目的"><a class="anchor" href="#线程工厂的目的">#</a> 线程工厂的目的</h3><p>当我们们构建核心线程和最大线程，可以通过线程工厂指定线程名字和其他信息，方便我们后期查错。</p><h3 id="线程池的核心属性"><a class="anchor" href="#线程池的核心属性">#</a> 线程池的核心属性</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 本质就是一个 int 类型的数值，前三位标识线程池的状态，后二十九位标识线程的数量</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> ctl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token function">ctlOf</span><span class="token punctuation">(</span><span class="token constant">RUNNING</span>，<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 本质就是 29, 为了方便对 ctL 做位运算使用的常量</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">COUNT_BITS</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">SIZE</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 计算出线程池的线程最大容量</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">CAPACITY</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 线程池正常运行！		111 ——> -1</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">RUNNING</span><span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span><span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 线程地被 shutdown, 继续执行完剩下的任务！				000 ——> 0</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">SHUTDOwN</span> <span class="token operator">-</span> <span class="token number">0</span><span class="token operator">&lt;&lt;</span><span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 线程池被 shutdownNow，线程池停止，并且所有任务中断	 001 ——> 1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">STOP</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span><span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//shutdown 或者 shutdownNow 之后，任务都被处理完之后，到这个过渡状态	010 ——> 2</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TIDYING</span><span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span><span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 线程池停止			 011 ——> 3</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TERMINATED</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">&lt;&lt;</span><span class="token constant">COUNT_BITS</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="线程池核心的-execute-流程"><a class="anchor" href="#线程池核心的-execute-流程">#</a> 线程池核心的 execute 流程</h3><p>线程池有两种执行 submit 和 execute ，但是其实都是在源码中 submit 的返回值是 Future 内部都是执行了 execute () 方法，所以我们着重看 execute 就行，submit 相当于他的加强</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> ftask <span class="token operator">=</span> <span class="token function">newTaskFor</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">execute</span><span class="token punctuation">(</span>ftask<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> ftask<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> ftask <span class="token operator">=</span> <span class="token function">newTaskFor</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">execute</span><span class="token punctuation">(</span>ftask<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> ftask<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>execute 源码</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 拿到线程信息，高 3 位线程状态，其余 29 位 线程大小</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 基于 workerCountOf () 获取正在工作的线程数，判断是否小于核心线程数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&lt;</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// 创建核心线程，并执行任务  ，传入 true 表示当前为核心线程</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 如果获取线核心线程失败，重新获取 ctl</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// 获取线程池状态，是否运行；如果线程池正在运行，就将任务追加到阻塞队列</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRunning</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> workQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">int</span> recheck <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isRunning</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">remove</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token function">addWorker</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// 尝试创建最大线程数，如果成功返回 true，失败了就进行拒绝策略</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="线程池增加工作线程的操作"><a class="anchor" href="#线程池增加工作线程的操作">#</a> 线程池增加工作线程的操作</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">addWorker</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> firstTask<span class="token punctuation">,</span> <span class="token keyword">boolean</span> core<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 给 for 循环追加标记</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    retry<span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// 获取线程 ctl</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 获取当前线程状态</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token comment">// 如果 rs >= SHUTDOWN，说明线程池执行了 shutdown 方法或者 shutdownNow</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">>=</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token operator">!</span> <span class="token punctuation">(</span>rs <span class="token operator">==</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// 线程池听了</span></pre></td></tr><tr><td data-num="12"></td><td><pre>               firstTask <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// 任务为 null</span></pre></td></tr><tr><td data-num="13"></td><td><pre>               <span class="token operator">!</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 工作队列为空</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token comment">// 获取当前工作线程个数</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token keyword">int</span> wc <span class="token operator">=</span> <span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token comment">// 如果工作线程大于容量 或者 （ 工作线程 》核心线程 | 工作线程 》最大线程 ）</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>wc <span class="token operator">>=</span> <span class="token constant">CAPACITY</span> <span class="token operator">||</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                wc <span class="token operator">>=</span> <span class="token punctuation">(</span>core <span class="token operator">?</span> corePoolSize <span class="token operator">:</span> maximumPoolSize<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token comment">// 基于 CAS 的方式将工作线程数 + 1</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndIncrementWorkerCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token keyword">break</span> retry<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token comment">// 如果没有成功的 CAS，就要判断是否重新执行外部循环</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token comment">// 如果线程池状态改变，从外侧改变</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token comment">// 如果线程池状态没变，从内侧改变</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">!=</span> rs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token keyword">continue</span> retry<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	</pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">// 声明了两个标识</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">boolean</span> workerStarted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">boolean</span> workerAdded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token comment">// 真正的工作线程就是 Worker</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token class-name">Worker</span> w <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token comment">// 构建 Worker, 并将任务注入</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        w <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>firstTask<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">final</span> <span class="token class-name">Thread</span> t <span class="token operator">=</span> w<span class="token punctuation">.</span>thread<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token comment">// 获取线程池的全局锁</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> mainLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainLock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token comment">// 上锁的为因为，shutdown 或者 shutdownNow 的时候，也需要获取锁资源</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            mainLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                <span class="token comment">// 获取线程池状态</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>			   <span class="token comment">// 判断线程池状态 &lt; SHUTDOWN ，也就是 RUNNING 状态</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&lt;</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">||</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                    <span class="token punctuation">(</span>rs <span class="token operator">==</span> <span class="token constant">SHUTDOWN</span> <span class="token operator">&amp;&amp;</span> firstTask <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 线程池为 SHUTDOWN 同时任务为 null</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                    <span class="token comment">// 如果线程干活了。直接抛出异常</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="57"></td><td><pre>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                    <span class="token comment">// 将工作线程追加到 Workers (一个 HashSet) 存储</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    workers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                    <span class="token comment">// 获取这个 hashSet 长度</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                    <span class="token keyword">int</span> s <span class="token operator">=</span> workers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                    <span class="token comment">// 如果现在的工作线程数 > 历史最大线程数，直接替换掉 largestPoolSize</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">></span> largestPoolSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                        largestPoolSize <span class="token operator">=</span> s<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                    <span class="token comment">// 将工作线程设置为 true，表示添加成功</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                    workerAdded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="67"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>                <span class="token comment">// 最后释放锁</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                mainLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token comment">// 如果工作线程添加成功，启动工作线程</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>workerAdded<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                <span class="token comment">// 设置启动工作线程为 True</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                workerStarted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token comment">// 如果工作线程启动失败</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> workerStarted<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>            <span class="token comment">// 补救操作</span></pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token function">addWorkerFailed</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    <span class="token keyword">return</span> workerStarted<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="线程池的work类"><a class="anchor" href="#线程池的work类">#</a> 线程池的 Work 类</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractExecutorService</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">//***</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token comment">// 属于线程池的一个内部类</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">implements</span> <span class="token class-name">Runnable</span>  <span class="token comment">// 继承了 Runnable 也就是相对于 worker 也是一个任务</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        </pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">6138294804551838833L</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">final</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        </pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">Runnable</span> firstTask<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        </pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">volatile</span> <span class="token keyword">long</span> completedTasks<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> firstTask<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">this</span><span class="token punctuation">.</span>firstTask <span class="token operator">=</span> firstTask<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">this</span><span class="token punctuation">.</span>thread <span class="token operator">=</span> <span class="token function">getThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token comment">// 当调用 worker 内部线程的 start () 方法时，实际是在调用 worker 类中的 run () 方法，实际执行的是 runWorker ()</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="线程池的-runworker-方法"><a class="anchor" href="#线程池的-runworker-方法">#</a> 线程池的 runWorker () 方法</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">Worker</span> w<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 获取当前线程</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Thread</span> wt <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 获取 Worker 中的具体任务</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Runnable</span> task <span class="token operator">=</span> w<span class="token punctuation">.</span>firstTask<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 将 worker 中的 task 置为 null</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    w<span class="token punctuation">.</span>firstTask <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 将有参构造中的标记 (setState (-1)) 撤销，代表当前线程可以被打断</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// allow interrupts</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 标记，</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">boolean</span> completedAbruptly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">// 如果 worker 中的 task 有任务，直接执行当前任务，否则去队列中获取任务</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>task <span class="token operator">=</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token comment">// 当前要执行，添加标记，shutdown 也不能打断</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>           <span class="token comment">// 判断当前线程池装，以及线程状态，判断是否需要被打断</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">STOP</span><span class="token punctuation">)</span> <span class="token operator">||</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                 <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                  <span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">STOP</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token operator">!</span>wt<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                wt<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token comment">// 执行任务的开始</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token comment">// 在执行任务之前做的事，前置增强</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token function">beforeExecute</span><span class="token punctuation">(</span>wt<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token class-name">Throwable</span> thrown <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                    <span class="token comment">// 执行任务</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                    task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                    thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                    thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                     <span class="token comment">// 在执行任务之前做的事，后置增强</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                    <span class="token function">afterExecute</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> thrown<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token comment">// 任务处理结束</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token comment">// 标记当前 worker 处理的任务数 + 1</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                w<span class="token punctuation">.</span>completedTasks<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        completedAbruptly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token function">processWorkerExit</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> completedAbruptly<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="1-单核cpu设定多线程是否有意义"><a class="anchor" href="#1-单核cpu设定多线程是否有意义">#</a> 1、单核 CPU 设定多线程是否有意义？</h3><h3 id="2-线程数是不是越多越好"><a class="anchor" href="#2-线程数是不是越多越好">#</a> 2、线程数是不是越多越好？</h3><p>​	并不是，这牵扯到线程调用问题举个反例，盖一个房子需要 100H，我 100 人工作一小时就可以完成？显然不可以。甚至会降低效率，浪费资源</p><h3 id="3-线程数设置多少最合适"><a class="anchor" href="#3-线程数设置多少最合适">#</a> 3、线程数设置多少最合适？</h3><ul><li><strong>压测</strong>（就是不停尝试，找到最合适的）， 一般情况下，为了安全不可能全部占用，我们留出一部分空间我们一般取 80%，</li></ul><p>1️⃣64 核 CPU 我们全部使用，其他的程序就无法启动，显然不正常</p><ul><li><strong>通过公式计算</strong></li></ul><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220708174914435.png" title="image-20220708174914435"><p>⭕️ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>32</mn><mo>∗</mo><mn>8</mn><mo>∗</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>0.2</mn><mo stretchy="false">)</mo><mo>=</mo><mn>30.72</mn></mrow><annotation encoding="application/x-tex">32*8*(1+0.2)=30.72</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">8</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">3</span><span class="mord">0</span><span class="mord">.</span><span class="mord">7</span><span class="mord">2</span></span></span></span>​</p><h3 id="如何优雅的结束一个线程"><a class="anchor" href="#如何优雅的结束一个线程">#</a> 如何优雅的结束一个线程？</h3><p>1️⃣ stop () 方法，但是不建议，容易产生数据不一致情况 【<strong>已废</strong>】</p><p>2️⃣ suspend ()、resume () 方法，暂停，继续方法，暂停的时候不会释放锁，容易产生死锁【<strong>已废</strong>】</p><p>3️⃣ vlatile ()，时间无法控制</p><ul><li><p>不适合某些场景（比如还没有同步的时候，线程做了阻塞操作，没有办法循环回去）</p></li><li><p>打断时间也不是特别精确，比如一个阻塞容器，容量为 5 的时候结束生产者，<br>但是，由于 volatile 同步线程标志位的时间控制不是很精确，有可能生产者还继续生产一段儿时间</p></li></ul><p>4️⃣ interrupt () and isInterrupted（比较优雅）</p><h3 id="程序真的会一行一行的运行吗"><a class="anchor" href="#程序真的会一行一行的运行吗">#</a> 程序真的会一行一行的运行吗？</h3><p>​	不一定，在没有相互依赖的语句，可能为了效率后面的语句会同时运行，运行完成的时间比前一个跟快。</p><h3 id="this对象溢出问题"><a class="anchor" href="#this对象溢出问题">#</a> this 对象溢出问题？</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> num <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>最终结果可能是什么？</p><p>1️⃣、8</p><p>2️⃣、0</p><p>为什么是 0 呢，因为在我们初始化的时候有可能会导致我们创建的这个线程直接去读取未被初始化的 Num，所以解决方案</p><ul><li>可以在构造器中 new 但是不要启动，启动单另写一个方法启动</li></ul><h3 id="线程池的好处"><a class="anchor" href="#线程池的好处">#</a> 线程池的好处</h3><p>1、降低资源消耗</p><p>​	线程的创建和销毁，通过重复利用已创建的线程降低线程创建和销毁造成的消耗。</p><p>2、调高响应速度</p><p>​	任务到了就直接可以上线程了，不用再 new。当任务到达时，任务可以不需要等到线程创建就能立即执行</p><p>3、提高线程的可管理性</p><p>​	线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控</p><h3 id="未完成-4"><a class="anchor" href="#未完成-4">#</a> ———————— 未完成</h3><h1 id="jvm"><a class="anchor" href="#jvm">#</a> JVM</h1><h3 id="基础内容"><a class="anchor" href="#基础内容">#</a> 基础内容</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220821204809060.png" title="image-20220821204809060"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907231623467.png" title="image-20220907231623467"><p>1、方法区</p><p>线程共享，方法区是逻辑上堆的一部分，虚拟机有一个在所有 Java 虚拟机线程之间共享的方法区。</p><p>运行时常量池、字段和方法数据，以及方法和构造函数的代码，包括类和实例初始化和接口初始化中使用的特殊方法。</p><p>如果方法区域中的内存无法满足分配请求，Java 虚拟机将抛出一个 OutOfMemoryError</p><p>2、堆（虚拟机中最大的一块）</p><p>线程共享</p><p>堆是为所有类实例和数组分配内存的运行时数据区域。</p><p>内存不足 OutOfMemoryError</p><p>3、java 虚拟机栈 执行 java 方法 线程私有 深度不够时，Stack OverflowError</p><p>4、本地方法栈 执行本地方法（C++）</p><p>5、程序计数器 记录程序执行到的位置 线程私有 深度不够时，Stack OverflowError</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907232658406.png" title="image-20220907232658406"><p>栈帧代表一个方法的运行，他的结构如图所示：</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907233019604.png" title="image-20220907233019604"><p><mark>还少一个附加信息</mark></p><p><strong>附加信息：栈帧的高度 + 虚拟机版本信息</strong></p><p><strong>栈帧信息：附加信息 + 动态链接 + 方法的返回地址</strong></p><p><strong>局部变量表：方法中定义的局部变量以及方法的参数都会存放在这张表中，单纯的存储单元</strong></p><p><strong>操作数栈：以压栈以及出栈的方式存储操作数</strong></p><p>int a = 1;</p><p>int b = 1;</p><p>int c = a + b;</p><p>将 a，b 从表中拿出来，然后将 c 返回到表中</p><p><strong>方法的返回地址：当你一个方法执行的时候，只有两种方法可以退出</strong></p><ul><li>遇到方法的返回字节码指令</li><li>出现异常，有异常处理，则交给异常处理器，没有就抛出异常</li></ul><p><strong>动态链接：动态链接将这些符号方法引用转换为具体的方法引用，简单来说，符号引用转变为直接引用</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">void</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 如果调用 a () 最终执行的是 c ()</span></pre></td></tr></table></figure><p><strong>但是这里有个问题，符号引用转变为直接引用，我们在类加载的时候已经做过了，为什么又要来一次？</strong></p><blockquote><p>这是因为我们 java 的多态，我们在刚开始的时候并不知道，具体的实现方法，要在我们运行的过程中，<br>才能知道，我们运用的是哪一个，所以我们这个时候会再来一次 “符号的引用转变为直接引用”</p></blockquote><h3 id="类加载机制"><a class="anchor" href="#类加载机制">#</a> 类加载机制</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907201636552.png" title="image-20220907201636552"><p>类加载机制其实就是虚拟机把 Class 文件加载到内存并对数据进行校验，转换解析和初始化，形成可以虚拟机直接使用的 Java 类型，即 java.lang.Class</p><p>1、装载</p><p>Class 文件 ——&gt; 二进制字节流 ——&gt; 类加载器</p><p>1）通过一个类的全限定名获取这个类的二进制字节流</p><p>2）将这个字节流所代表的静态存储结构转换成为方法区的运行时数据结构</p><p>3）在 Java 堆中生成一个代表这个类的 Java.lang.Class 对象，作为我们方法区得数据访问入口</p><p>2、链接</p><p>1）验证，保证我们类加载的正确性</p><ul><li>文件格式的验证（这一步其实在我们我们装载的时候进行）</li><li>元数据验证</li><li>字节码验证</li><li>符号引用验证</li></ul><p>2）准备</p><p>为<mark>类的静态变量分配内存</mark>，并将其初始化为当前类型的<mark>默认值</mark></p><p>3）解析</p><p>解析是从运行时常量池中的符号引用动态确定具体指的过程。</p><p>把类中的符号引用转换成直接引用</p><p>3、初始化</p><p>执行到 Clinit 方法，为静态变量赋值，初始化静态代码块，初始化当前类的父类。</p><h3 id="类加载器"><a class="anchor" href="#类加载器">#</a> 类加载器</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907203357976.png" title="image-20220907203357976"><p>启动类加载器、扩展类加载器、系统加载器、自定义加载器</p><h3 id="双亲委派机制"><a class="anchor" href="#双亲委派机制">#</a> 双亲委派机制</h3><p>原名叫：父类委托机制</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907182221718.png" title="image-20220907182221718"><h3 id="打破双亲委派机制"><a class="anchor" href="#打破双亲委派机制">#</a> 打破双亲委派机制</h3><p>1. 复写 重写 classloader</p><p>2.SPI Service Provider Interface 服务提供接口</p><p>可插拔设计，可以随时替换实现</p><p>3.OSGI 热部署，热更新</p><h3 id="对象的创建过程"><a class="anchor" href="#对象的创建过程">#</a> 对象的创建过程</h3><p>1、对象类的加载 ——&gt; ClassLoader</p><p>​	load</p><p>​	link (verification [检验是否符合标准],preparation [对对象附默认值],resolution [做解析])</p><p>​	initializing (类的初始化) -&gt; 静态变量附默认值，并执行静态语句块</p><p>2、申请对象内存</p><p>3、成员变量附默认值</p><p>4、调用构造方法</p><p>​	成员变量顺序附初始值</p><p>​	执行构造方法语句</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20210714084921294.png" title="img"><h3 id="为什么要把堆和栈区分出来呢栈中不是也可以存储数据吗"><a class="anchor" href="#为什么要把堆和栈区分出来呢栈中不是也可以存储数据吗">#</a> 为什么要把堆和栈区分出来呢？栈中不是也可以存储数据吗？</h3><p><strong>栈是运行时的单位，而堆是存储的单位。</strong></p><p>栈解决程序的运行问题，即程序如何执行，或者说如何处理数据；堆解决的是数据存储的问题，即数据怎么放、放在哪儿。</p><p>在 Java 中一个线程就会相应有一个线程栈与之对应，这点很容易理解，因为不同的线程执行逻辑有所不同，因此需要一个独立的线程栈。而堆则是所有线程共享的。栈因为是运行单位，因此里面存储的信息都是跟当前线程（或程序）相关信息的。包括局部变量、程序运行状态、方法返回值等等；而堆只负责存储对象信息。</p><p>1、从软件设计的角度看，栈代表了处理逻辑，而堆代表了数据。这样分开，使得处理逻辑更为清晰。分而治之的思想。这种隔离、模块化的思想在软件设计的方方面面都有体现。</p><p>2、 堆与栈的分离，使得堆中的内容可以被多个栈共享（也可以理解为多个线程访问同一个对象）。这种共享的收益是很多的。一方面这种共享提供了一种有效的数据交互方式 (如：共享内存)，另一方面，堆中的共享常量和缓存可以被所有栈访问，节省了空间。</p><p>3、栈因为运行时的需要，比如保存系统运行的上下文，需要进行地址段的划分。由于栈只能向上增长，因此就会限制住栈存储内容的能力。而堆不同，堆中的对象是可以根据需要动态增长的，因此栈和堆的拆分，使得动态增长成为可能，相应栈中只需记录堆中的一个地址即可。</p><p>4、 面向对象就是堆和栈的完美结合。其实，面向对象方式的程序与以前结构化的程序在执行上没有任何区别。但是，面向对象的引入，使得对待问题的思考方式发生了改变，而更接近于自然方式的思考。当我们把对象拆开，你会发现，对象的属性其实就是数据，存放在堆中；而对象的行为（方法），就是运行逻辑，放在栈中。我们在编写对象的时候，其实即编写了数据结构，也编写的处理数据的逻辑。不得不承认，面向对象的设计，确实很美。</p><h3 id="为什么不把基本类型放堆中呢"><a class="anchor" href="#为什么不把基本类型放堆中呢">#</a> 为什么不把基本类型放堆中呢？</h3><p>因为其占用的空间一般是 1~8 个字节 —— 需要空间比较少，而且因为是基本类型，所以不会出现动态增长的情况 —— 长度固定，因此栈中存储就够了，如果把他存在堆中是没有什么意义的。可以这么说，基本类型和对象的引用都是存放在栈中，而且都是几个字节的一个数，因此在程序运行时，他们的处理方式是统一的。但是基本类型、对象引用和对象本身就有所区别了，因为一个是栈中的数据一个是堆中的数据。最常见的一个问题就是，Java 中参数传递时的问题。</p><h3 id="堆中存什么栈中存什么"><a class="anchor" href="#堆中存什么栈中存什么">#</a> 堆中存什么？栈中存什么？</h3><p>堆中存的是对象。栈中存的是基本数据类型和堆中对象的引用。一个对象的大小是不可估计的，或者说是可以动态变化的，但是在栈中，一个对象只对应了一个 4btye 的引用（堆栈分离的好处：）。</p><h3 id="java中的参数传递时传值呢还是传引用"><a class="anchor" href="#java中的参数传递时传值呢还是传引用">#</a> Java 中的参数传递时传值呢？还是传引用？</h3><p>参数是基本数据类型 -》按值传递</p><p>参数是引用类型 —— 》 按引用传递</p><p>注意 String 是个坑 ，他是值传递但是引用数据类型</p><h3 id="为什么需要jvm"><a class="anchor" href="#为什么需要jvm">#</a> 为什么需要 JVM</h3><p>1、JVM 可以帮助我们屏蔽底层的操作系统，一次编译，到处运行。</p><p>2、JVM 可以运行 Class 文件</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907171924496.png" title="image-20220907171924496"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907171933089.png" title="image-20220907171933089"><h3 id="jdkjrejvm的关系"><a class="anchor" href="#jdkjrejvm的关系">#</a> JDK，JRE，JVM 的关系</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907171654044.png" title="image-20220907171654044"><h3 id="我们的编译器到底干了什么"><a class="anchor" href="#我们的编译器到底干了什么">#</a> 我们的编译器到底干了什么</h3><p>仅仅是将我们的 .java 文件转换成了 .class 文件 ，实际上就是文件格式化的转换，对等信息转换</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907175840054.png" title="image-20220907175840054"><h3 id="对象被判定为不可达对象之后就死了吗"><a class="anchor" href="#对象被判定为不可达对象之后就死了吗">#</a> 对象被判定为不可达对象之后就死了吗？</h3><img data-src="../../../../../../面试/面试题/面试题_img/image-20220907183347727.png" alt="image-20220907183347727" style="zoom:150%"><p>finalize () 只能调用一次</p><p>根：GC_Root</p><h3 id="java堆进行分代处理"><a class="anchor" href="#java堆进行分代处理">#</a> Java 堆进行分代处理</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907171502725.png" title="image-20220907171502725"><h3 id="为什么edens0s1是811"><a class="anchor" href="#为什么edens0s1是811">#</a> 为什么 Eden：S0：S1 是 8:1:1</h3><p>98% 的对象都是朝生夕死，在一块业务用一下，就等着死亡，比如我们 new Radom () 用完就结束了。</p><p>eden 区越小越容易发送 young 区 GC，消耗性能</p><h3 id="老年代的担保机制"><a class="anchor" href="#老年代的担保机制">#</a> 老年代的担保机制</h3><p>Eden 区有一个域值，如果对象超过 Eden 区的域值，他就直接进入到了 Old 区，年轻代扛不住。</p><h3 id="如何确定一个对象是垃圾"><a class="anchor" href="#如何确定一个对象是垃圾">#</a> 如何确定一个对象是垃圾</h3><ul><li>引用计数法</li></ul><p>​ <strong>对于某个对象而言，只要应用程序中持有该对象的引用，就说明该对象不是垃圾，如果一个对象没有任何指针对其引用，它就是垃圾。</strong></p><p><mark>弊端：如果 AB 相互持有引用，导致永远不能被回收。</mark> （很少用了）</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907231345316.png" title="image-20220907231345316"><p>循环使用，导致我们永远不能被回收。循环引用，内存泄漏，最终导致内存占用越来越多，导致内存溢出</p><ul><li>可达性分析 / 跟搜索算法</li></ul><p>通过 GC_Root 的对象 (<mark>活跃的引用，不是对象</mark>)，开始向下搜找，看某个对象是否可达</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907200320553.png" title="image-20220907200320553"><p>能够作为 GC_Root：</p><p>​	类加载器、Thread、虚拟机栈的本地变量表、static 成员、常量引用、本地方法栈的变量等。</p><blockquote><p>虚拟机栈（栈帧中的本地变量表) 中引用的对象。方法区中类静态属性引用的对象。<br>方法区中常量引用的对象。<br>本地方法核中 NI（即一般说的 Native 方法）引用的对象</p></blockquote><h3 id="垃圾收集器分类"><a class="anchor" href="#垃圾收集器分类">#</a> 垃圾收集器分类</h3><ul><li>串行收集器 -&gt;Serial 和 Serial Old</li></ul><p><strong>只能有一个垃圾回收线程执行，用户线程暂停。</strong></p><blockquote><p>适用于内存比较小的嵌入式设备。</p></blockquote><ul><li>并行收集器 [吞吐量优先]-&gt;Parallel Scanvenge、Parallel Old</li></ul><p><strong>多条垃圾收集线程并行工作，但此时用户线程仍然处于等待状态。</strong></p><blockquote><p>适用于科学计算、后台处理等若交互场景。</p></blockquote><ul><li>并发收集器 [停顿时间优先]-&gt;CMS、G1</li></ul><p><strong>用户线程和垃圾收集线程同时执行 (但并不一定是并行的，可能是交替执行的)，垃圾收集线程在执行的时候不会停顿用户线程的运行。</strong></p><blockquote><p>适用于相对时间有要求的场景，比知 web。</p></blockquote><h3 id="吞吐量和停顿时间"><a class="anchor" href="#吞吐量和停顿时间">#</a> 吞吐量和停顿时间</h3><ul><li><p>停顿时间 -&gt; 垃圾收集器进行垃圾回收终端应用执行响应的时间</p></li><li><p>吞吐量 -&gt; 运行用户代码时间 /(运行用户代码时间 + 垃圾收集时间)</p></li></ul><blockquote><p>停顿时间越短就越适合需要和用户交互的程序，良好的响应速度能提升用户体验；</p><p>高吞吐量则可以高效地利用 cPu 时间，尽快完成程序的运算任务，主要适洽在后台运算而不需要太多交互的任务。</p></blockquote><p>小结：这两个指标也是评价垃圾回收器好处的标准。</p><h3 id="垃圾收集算法"><a class="anchor" href="#垃圾收集算法">#</a> 垃圾收集算法</h3><blockquote><p>已经能够确定一个对象为垃圾之后，接下来要考虑的就是回收，怎么回收呢？得要有对应的算法，下面介绍常见的垃圾回收算法。</p></blockquote><h3 id="标记-清除mark-sweep"><a class="anchor" href="#标记-清除mark-sweep">#</a> 标记 - 清除 (Mark-Sweep)</h3><ul><li><p>标记<br><strong>找出内存中需要回收的对象，并且把它们标记出来</strong></p><p>此时堆中所有的对象都会被扫描一遍，从而才能确定需要回收的对象，比较耗时</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907180008076.png" title="image-20220907180008076"></li><li><p>清除</p><p>清除掉被标记需要回收的对象，释放出对应的内存空间</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907180045044.png" title="image-20220907180045044"></li></ul><p><strong>缺点：</strong></p><blockquote><p>​	标记清除之后会产生大量不连续的内存碎片，空间碎片太多可能会导致以后在程序运行过程中需要分配较大对象时，无法找到足够的连续内存而不得不提前触发另一次垃圾收集动作。</p><p>(1) 标记和清除两个过程都比较耗时，效率不高</p><p>(2) 会产生大量不连续的内存碎片，空间碎片太多可能会导致以后在程序运行过程中需要分配较大对象时，无法找到足够的连续内存而不得不提前触发另一次垃圾收集动作。</p></blockquote><h3 id="标记-复制算法mark-copying"><a class="anchor" href="#标记-复制算法mark-copying">#</a> 标记 - 复制算法 (Mark-Copying)</h3><p>将内存划分为两块相等的区域，每次只使用其中一块，如下图所示:</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907180404320.png" title="image-20220907180404320"><p>当其中一块内存使用完了，就将还存活的对象复制到另外一块上面，然后把已经使用过的内存空间一次清除掉。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907180425740.png" title="image-20220907180425740"><p><strong>缺点：空间利用率低</strong></p><h3 id="标记-整理mark-compact"><a class="anchor" href="#标记-整理mark-compact">#</a> 标记 - 整理 (Mark-Compact)</h3><blockquote><p>复制收集算法在对象存活率较高时就要进行较多的复制操作，效率将会变低。更关键的是，如果不想浪费 50% 的空间，就需要有额外的空间进行分配担保，以应对被使用的内存中所有对象都有 100% 存活的极端情况，所以老年代一般不能直接选用这种算法。</p></blockquote><p><strong>标记过程仍然与 &quot;标记 - 清除&quot; 算法一样，但是后续步骤不是直接对可回收对象进行清理，而是让所有存活的对象都向一端移动，然后直接清理掉端边界以外的内存。</strong></p><p>其实上述过程相对 &quot;复制算法&quot; 来讲，少了一个 &quot; 保留区</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907180607386.png" title="image-20220907180607386"><p>让所有存活的对象都向一端移动，清除掉边界以外的内存</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907180726882.png" title="image-20220907180726882"><h3 id="分代收集算法"><a class="anchor" href="#分代收集算法">#</a> 分代收集算法</h3><p>既然上面介绍了 3 种垃圾收集算法，那么在堆内存中到底用哪一个呢？</p><p>Young 区：复制算法 (对象在被分配之后，可能生命周期比较短，young 区复制效率比较高)</p><p>Old 区：标记清除或者标记整理 (Old 区对象存活时间比较长，复制来复制去没有必要，不如做个标记然后清除)</p><h3 id="zgc"><a class="anchor" href="#zgc">#</a> ZGC</h3><p>官网: <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vamF2YS9qYXZhc2UvMTEvZ2N0dW5pbmcvei1nYXJiYWdlLWNvbGxlY3RvcjEuaHRtbCNHVUlELUE1QTQyNjkxLTA5NUUtNDdCQS1CNkRDLUZCNEU1RkFBNDNETw==">https://docs.oracle.com/en/java/javase/11/gctuning/z-garbage-collector1.html#GUID-A5A42691-095E-47BA-B6DC-FB4E5FAA43DO</span></p><p>​	JDK11 新引入的 ZGC 收集器，不管是物理上还是逻辑上，ZGC 中已经不存在新老年代的概念了会分为一个个 page，当进行 GC 操作时会对 page 进行压缩，因此没有碎片问题，只能在 64 位的 linux 上使用，目前用得还比较少。</p><p><strong>(1）可以达到 10ms 以内的停顿时间要求</strong><br><strong>(2) 支持 TB 级别的内存</strong><br><strong>(3）堆内存变大后停顿时间还是在 10ms 以内</strong></p><h3 id="垃圾收集器"><a class="anchor" href="#垃圾收集器">#</a> 垃圾收集器</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907200720387.png" title="image-20220907200720387"><h3 id="serial系列"><a class="anchor" href="#serial系列">#</a> Serial 系列</h3><p>​	<strong>Serial 收集器是最基本、发展历史最悠久的收集器，曾经（在 JDK1.3.1 之前) 是虚拟机新生代收集的唯一选择。</strong></p><p>​	<strong>它是一种单线程收集器，不仅仅意味着它只会使用一个 CPU 或者一条收集线程去完成垃圾收集工作，更重要的是其在进行垃圾收集的时候需要暂停其他线程。</strong></p><blockquote><p>优点：简单高效，拥有很高的单线程收集效率缺点：收集过程需要暂停所有线程</p><p><strong>算法：复制算法</strong></p><p>应用：client 模式下的默认新生代收集器</p><p>适用范围：新生代</p></blockquote><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907175127639.png" title="image-20220907175127639"><ul><li><p>serial Old</p><p>Serial Old 收集器是 Serial 收集器的老年代版本，也是一个单线程收集器，不同的是采用 **&quot; 标记 - 整理算法”**，运行过程和 Serial 收集器一样。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907174807758.png" title="image-20220907174807758"></li></ul><h3 id="parallel系列垃圾收集器"><a class="anchor" href="#parallel系列垃圾收集器">#</a> Parallel 系列垃圾收集器</h3><ul><li><p>ParNew<br><strong>可以把这个收集器理解为 Serial 收集器的多线程版本。</strong></p><blockquote><p>重点：关注停顿时间</p><p>优点：在多 CPU 时，比 Serial 效率高。</p><p>缺点：收集过程暂停所有应用程序线程，单 cPU 时比 Serial 效率差。算法：复制算法</p><p>应用：运行在 Server 模式下的虚拟机中首选的新生代收集器</p><p>适用范围：新生代</p></blockquote><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907174604135.png" title="image-20220907174604135"></li><li><p>Parallel Scavenge<br><strong>Parallel Scavenge 收集器是一个新生代收集器，它也是使用复制算法的收集器，又是并行的多线程收集器，看上去和 ParNew 一样，但是 Parallel Scanvenge 更关注系统的吞吐量。</strong></p></li></ul><blockquote><p>吞吐量 = 运行用户代码的时间 /(运行用户代码的时间 + 垃圾收集时间)</p><p>比如虚拟机总共运行了 100 分钟，垃圾收集时间用了 1 分钟，吞吐量 =(100-1)/100=99%。</p><p>若吞吐量越大，意味着垃圾收集的时间越短，则用户代码可以充分利用 CPU 资源，尽快完成程序的运算任务。</p></blockquote><p>-XX:MaxGCPauseMillis 控制最大的垃圾收集停顿时间，<br>-XX:GCRatio 直接设置吞吐量的大小。</p><ul><li><p>Parallel Old</p><p><strong>Parallel Old 收集器是 Parallel Scavenge 收集器的老年代版本，使用多线程和标记 - 整理算法进行垃圾回收，也是更加关注系统的吞吐量</strong></p></li></ul><h3 id="cms垃圾收集器"><a class="anchor" href="#cms垃圾收集器">#</a> CMS 垃圾收集器</h3><p>采取的是 &quot;标记 - 清除算法&quot;，整个过程分为四步：</p><p>(1) 初始标记 CMS initial mark 标记 GC Roots 直接关联对象，不用 Tracing，速度很快</p><p>(2) 并发标记 CMS concurrent mark 进行 GC Roots Tracing</p><p>(3) 重新标记 CMS remark 修改并发标记因用户程序变动的内容</p><p>(4) 并发清除 CMS concurrent sweep 清除不可达对象回收空间，同时有新垃圾产生，留着下次清理称为</p><p>​ 浮动垃圾</p><p>整个过程中，并发标记和并发编程，收集器线程可以与用户线程一起工作，所以总体来说，CMS 收集器的内存回收过程是与用户线程一起并发的执行。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907164245323.png" title="image-20220907164245323"><p>优点：并发收集、低停顿</p><p>缺点：产生大量的空间碎片并发阶段会降低吞吐量</p><h3 id="g1-调优策略"><a class="anchor" href="#g1-调优策略">#</a> G1 调优策略</h3><p><strong>(1）不要手动设置新生代和老年代的大小，只要设置整个堆的大小</strong><br>why: <span class="exturl" data-url="aHR0cHM6Ly9ibG9ncy5vcmFjbGUuY29tL3Bvb25hbS9pbmNyZWFzZWQtaGVhcC11c2FnZS13aXRoLWcxLWdj">https://blogs.oracle.com/poonam/increased-heap-usage-with-g1-gc</span></p><blockquote><p>G1 收集器在运行过程中，会自己调整新生代和老年代的大小<br>其实是通过 adapt 代的大小来调整对象晋升的速度和年龄，从而达到为收集器设置的暂停时间目标如果手动设置了大小就意味着放弃了 G1 的自动调优</p></blockquote><p><strong>(2) 不断调优暂停时间目标</strong></p><blockquote><p>一般情况下这个值设置到 100ms 或者 20oms 都是可以的 (不同情况下会不一样)，但如果设置成 5oms 就不太合理。暂停时间设置的太短，就会导致出现 G1 跟不上垃圾产生的速度。最终退化成 Full GC。所以对这个参数的调优是一个持续的过程，逐步调整到最佳状态。暂停时间只是一个目标，并不能总是得到满足。</p></blockquote><p><strong>(3) 使用 - XX:ConcGCThreads=n 来增加标记线程的数量</strong></p><blockquote><p>IHOP 如果阀值设置过高，可能会遇到转移失败的风险，比如对象进行转移时空间不足。如果阀值设置过低，就会使标记周期运行过于频繁，并且有可能混合收集期回收不到空间。<br>IHOP 值如果设置合理，但是在并发周期时间过长时，可以尝试增加并发线程数，调高 ConcGCThreads。</p></blockquote><p><strong>(4) MixedGC 调优</strong></p><blockquote><p>-XX:InitiatingHeapOccupancyPercent</p><p>-XX:G1MixedGCLiveThresholdPercent</p><p>-XX:G1MixedGcCountTarger</p><p>-XX:G10ldCSetRegionThresholdPercent</p></blockquote><p><strong>(5) 当增加堆内存大小</strong></p><p><strong>(6) 不正常的 Full GC</strong></p><blockquote><p>有时候会发现系统刚刚启动的时候，就会发生一次 Full GC，但是老年代空间比较充足，一般是由 Metaspace 区域引起的。可以通过 MetaspaceSize 适当增加其大家，比如 256M。</p></blockquote><h3 id="g1垃圾收集器"><a class="anchor" href="#g1垃圾收集器">#</a> G1 垃圾收集器</h3><p>官网:<br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzgvZG9jcy90ZWNobm90ZXMvZ3VpZGVzL3ZtL2djdHVuaW5nTGcxX2djLmh0bWwjZ2FyYmFnZV9maXJzdF9nYXJiYWdlX2NvbGxlY3Rpb24=">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuningLg1_gc.html#garbage_first_garbage_collection</span></p><p><strong>使用 G1 收集器时，Java 堆的内存布局与就与其他收集器有很大差别，它将整个 Java 堆划分为多个大小相等的独立区域 (Region)，虽然还保留有新生代和老年代的概念，但新生代和老年代不再是物理隔离的了，它们都是一部分 Region (不需要连续) 的集合。</strong></p><p>每个 Region 大小都是一样的，可以是 1M 到 32M 之间的数值，但是必须保证是 2 的 n 次幂</p><p>如果对象太大，一个 Region 放不下 [超过 Region 大小的 50%]，那么就会直接放到 Humongous 中</p><p>设置 Region 大小: -XX:G1HeapRegionSize=<n>M</n></p><p>所谓 Garbage-Frist，其实就是优先回收垃圾最多的 Region 区域</p><blockquote><p>(1) 分代收集（仍然保留了分代的概念)</p><p>(2）空间整合（整体上属于 “标记 - 整理” 算法，不会导致空间碎片)</p><p>(3）可预测的停顿（比 CNs 更先进的地方在于能让使用者明确指定一个长度为 w 毫秒的时间片段内，消耗在垃圾收集上的时间不得超过 N 毫秒)</p></blockquote><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907165802632.png" title="image-20220907165802632"><p><strong>工作过程可以分为如下几步</strong><br>初始标记 0KIaitial Marking) 标记以下 GC Roots 能够关联的对象，并且修改 TAS 的值，需要</p><p>​ 暂停用户线程</p><p>并发标记（Concurrent Marking) 从 GC Roots 进行可达性分析，找出存活的对象，与用户线程并</p><p>​ 发执行</p><p>最终标记 Final Marking) 修正在并发标记阶段因为用户程序的并发执行导致变动的数</p><p>​ 据，需暂停用户线程</p><p>筛选回收 (Live Data Counting and Evacuation) 对各个 Region 的回收价值和成本进行排序，根据用户所期望</p><p>​ 的 cc 停顿时间制定回收计划</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907170046446.png" title="image-20220907170046446"><h3 id="生产环境中如何选择合适的垃圾收集器"><a class="anchor" href="#生产环境中如何选择合适的垃圾收集器">#</a> 生产环境中，如何选择合适的垃圾收集器</h3><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vbGphdmFzZS84L2RvY3MvdGVjaG5vdGVzL2d1aWRlcy92bS9nY3R1bmluZy9jb2xsZWN0b3JzLmh0bWwjc3RocmVmMjg=">https://docs.oracle.com/ljavase/8/docs/technotes/guides/vm/gctuning/collectors.html#sthref28</span></p><ul><li>优先调整堆的大小让服务器自己来选择</li><li>如果内存小于 100M，使用串行收集器</li><li>如果是单核，并且没有停顿时间要求，使用串行或 JVM 自己选</li><li>如果允许停顿时间超过 1 秒，选择并行或 JVM 自己选</li><li>如果响应时间最重要，并且不能超过 1 秒，使用并发收集器</li></ul><h3 id="如何判断是否使用g1垃圾收集器"><a class="anchor" href="#如何判断是否使用g1垃圾收集器">#</a> 如何判断是否使用 G1 垃圾收集器</h3><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzgvZG9jcy90ZWNobm90ZXMvZ3VpZGVzL3ZtL0cxLmh0bWwjdXNlX2Nhc2Vz">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/G1.html#use_cases</span></p><p><strong>JDK 7 开始使用，JDK 8 非常成熟，JDK9 默认的垃圾收集器，适用于新老生代。</strong></p><p><strong>是否使用 G1 收集器？</strong></p><p>(1) 50% 以上的堆被存活对象占用</p><p>(2) 对象分配和晋升的速度变化非常大</p><p>(3) 垃圾回收时间比较长</p><h3 id="什么时候才会进行垃圾回收"><a class="anchor" href="#什么时候才会进行垃圾回收">#</a> 什么时候才会进行垃圾回收</h3><blockquote><p>GC 是由 JVM 自动完成的，根据 JVM 系统环境而定，所以时机是不确定的。<br>当然，我们可以手动进行垃圾回收，比如调用 System.gc () 方法通知 JVM 进行一次垃圾回收，但是具体什么时刻运行也无法控制。也就是说 System.gc () 只是通知要回收，什么时候回收由 VM 决定。<strong>但是不建议手动调用该方法，因为 GC 消耗的资源比较大。</strong></p></blockquote><p>(1) 当 Eden 区或者 s 区不够用</p><p>(2) 老年代空间不够用</p><p>(3) 方法区空间不够用</p><p>(4) System.gc () // 通知 时机也不确定 执行的 Full GC</p><h3 id="jvm-常用命令"><a class="anchor" href="#jvm-常用命令">#</a> JVM 常用命令</h3><ul><li><p>jps</p><p><strong>查看 java 进程</strong></p><blockquote><p>The jps command lists the instrumented Java HotSpot VWls on the target system. The command is limited toreporting information on JVMs for which it has the access permissions.</p></blockquote></li><li><p>jinfo</p><p><strong>(1) 实时查看和调整 JVM 配置参数</strong></p><blockquote><p>The jinfo command prints Java configuration information for a specified Java process or core file or aremote debug server. The configuration information includes Java system properties and Java VirtualMachine (VM)command-line flags.</p></blockquote><p><strong>(2) 查看用法</strong></p><pre><code>jinfo  -flag  name  PID			查看某个java进程的name属性的值

jinfo  -flag  MaxHeapSize  PID
jinfo  -flag  UseG1GC  PID
</code></pre><p><strong>(3) 修改</strong></p><p>参数只有被标记为 manageable 的 flags 可以被实时修改</p><pre><code>jinfo -flag [+-]PID
jinfo -flag  &lt;name&gt;=&lt;value&gt; PID
</code></pre><p><strong>(4）查看曾经赋过值的一些参数</strong></p><pre><code>jinfo -flags PID
</code></pre></li><li><p>jstat<br><strong>(1）查看虚拟机性能统计信息</strong></p><blockquote><p>The jstat command displays performance statistics for an instrumented Java HotSpot VwW. The target wW isidentified by its virtual machine identifier, or vmid option.</p></blockquote><p><strong>(2) 查看类装载信息</strong></p><p>jstat -class PID 1000 10 查看某个 java 进程的类装载信息，每 1000 毫秒输出一次，共输出 10 次</p><p><strong>(3) 查看垃圾收集信息</strong></p><p>jstat -gc PID 1000 10</p></li><li><p>jstack<br><strong>(1) 查看线程堆栈信息</strong></p><blockquote><p>The jstack command prints Java stack traces of ]ava threads for a specified Java process,core file,orremote debug server.</p></blockquote><p><strong>(2) 用法</strong></p><p>jstack PID</p></li><li><p>jmap</p><p>(1) 生成堆转储快照</p><blockquote><p>The jmap command prints shared object memory maps or heap memory details of a specified process,corefile, or remote debug server.</p></blockquote><p>(2) 打印出堆内存相关信息</p><p>jmap -heap PID</p><p>jinfo -flag UsePSAdaptiveSurvivorSizePolicy 35352</p><p>-XX: SurvivorRatio=8</p></li></ul><h3 id="jvm性能优化指南"><a class="anchor" href="#jvm性能优化指南">#</a> JVM 性能优化指南</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220907173816272.png" title="image-20220907173816272"><h3 id="未完成-5"><a class="anchor" href="#未完成-5">#</a> —————————— 未完成</h3><h1 id="数据库"><a class="anchor" href="#数据库">#</a> 数据库</h1><h3 id="数据库存储引擎有哪些"><a class="anchor" href="#数据库存储引擎有哪些">#</a> 数据库存储引擎有哪些</h3><p>Myisam、Innodb</p><h3 id="myisam和innodb有什么区别"><a class="anchor" href="#myisam和innodb有什么区别">#</a> Myisam 和 Innodb 有什么区别</h3><table><thead><tr><th style="text-align:center">区别</th><th style="text-align:center">MyISAM</th><th style="text-align:center">InnoDB</th></tr></thead><tbody><tr><td style="text-align:center">数据结构</td><td style="text-align:center">.frm 存储表定义<br>.MYD 存储数据文件<br>.MYI 存储索引文件</td><td style="text-align:center">.frm 存储表定义<br>.ibd 存储数据和索引</td></tr><tr><td style="text-align:center">存储空间</td><td style="text-align:center">MyISAM<strong> 可被压缩，存储空间较小</strong><br>支持三种存储：静态表 [默认]、动态表、压缩表</td><td style="text-align:center">InnoDB<em><strong> 需要更多的内存和存储，它会在主内存中建立其专用的缓冲池用于高速缓冲数据和索引</strong></em>。InnoDB 所在的表都保存在同一个数据文件中（也可能是多个文件，或者是独立的表空间）<br>InnoDB 表的大小只受限于操作系统文件的大小，一般为 2GB</td></tr><tr><td style="text-align:center">事务的支持</td><td style="text-align:center">MyISAM 强调的是性能，每次查询具有原子性，其执行速度比 Innodb 类型更快，<br>但是<strong>不提供事务支持</strong>。</td><td style="text-align:center">InnoDB 除了<em><strong>提供事务支持</strong></em>和外部键等高级数据库功能。还具有事务提交（commit）、回滚（rollback）和崩溃修复能力（crach recovery capabilities）等这些事务安全（transaction-safe ACID compliant）型表</td></tr><tr><td style="text-align:center">锁的支持</td><td style="text-align:center">如果只是执行大量的查询，MyISAM 是更好的选择。MyISAM 在<strong>增删</strong>的时候需要<strong>锁定整个表格</strong>，效率会低一些</td><td style="text-align:center">innoDB 支持行级锁，<em><strong>删除插入</strong></em>的时候只需要<em><strong>锁定操作行</strong></em>就行。如果有大量的插入、修改删除操作，使用 InnoDB 性能能会更高</td></tr><tr><td style="text-align:center">查询效率</td><td style="text-align:center"><strong>高</strong><br>支持全文索引</td><td style="text-align:center"><em><strong>低</strong></em><br>不支持全文索引</td></tr><tr><td style="text-align:center">外键的支持</td><td style="text-align:center">MyISAM<strong> 不支持外键</strong></td><td style="text-align:center"><em>支持外键</em></td></tr></tbody></table><h3 id="如何选择数据库引擎"><a class="anchor" href="#如何选择数据库引擎">#</a> 如何选择数据库引擎？</h3><p>1、如果需要支持事务，选择 InnoDB，不需要事务则选择 MyISAM。</p><p>2、如果大部分表操作都是查询，选择 MyISAM，有写又有读选 InnoDB。</p><p>3、如果系统崩溃导致数据难以恢复，且成本高，不要选择 MyISAM。</p><h3 id="三范式是什么"><a class="anchor" href="#三范式是什么">#</a> 三范式是什么</h3><p>第一范式：列不可再分</p><p>第二范式：行可以唯一区分，主键约束</p><p>第三范式：表的非主属性不能依赖与其他表的非主属性 外键约束</p><p>简单来说，第一范式就是让属性原子化，不可再分；第二范式就是让数据具有主属性从而产生唯一标识（特别是为了标识有联合主键的情况）；第三范式就是表的非主属性不能依赖与其他表的非主属性，也可以说是表中的属性不能有依赖关系</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220714214608165.png" title="image-20220714214608165"><h3 id="什么是事务有哪些特点"><a class="anchor" href="#什么是事务有哪些特点">#</a> 什么是事务，有哪些特点</h3><p>事务是用来维护数据库完整性的，具体体现就是多条 sql 语句，要么全部成功，要么全部失败。</p><p>特点：<mark>ACID</mark></p><p>A:（原子性 Atomicity）、C: 一致性（Consistency）、I：隔离性（Isolation）、D：持久性（Durability）</p><p>1) 原子性<br>原子是自然界最小的颗粒，具有不可再分的特性</p><ol start="2"><li><p>一致性<br>一致性是指事务执行的结果必须使数据库从一个一致性状态，变到另一个一致性状态。</p></li><li><p>隔离性<br>隔离性是指各个事务的执行互不干扰</p></li></ol><p>4) 持久性<br>持久性指事务一旦提交，对数据所做的任何改变，都要记录到永久存储器中</p><h3 id="事务的隔离级别有哪些"><a class="anchor" href="#事务的隔离级别有哪些">#</a> 事务的隔离级别有哪些</h3><p>由低到高：</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220714221905692.png" title="image-20220714221905692"><p><strong>READ UNCOMMITTED（读未提交）</strong></p><p>​	在这个隔离级别，所有事务都可以看到未提交事务的执行结果。在这种隔离级别上，可能会产生很多问题。所以这种隔离级别很少用于实际应用，而且它的性能也没有比其他性能好很多，而别的级别还有其他的优点。读取未提交数据，也被称为 “脏读”。</p><p><strong>READ COMMITTED（读已提交）</strong></p><p>​	读已提交这种隔离级别是大多数数据库系统默认的隔离级别（但 mysql 默认的隔离级别却不是这种），满足了隔离的最早简单定义：一个事务开始时，只能看见已经提交事务所做的改变，一个事务从开始到提交前，所做的任何数据改变都是不可见的，除非已经提交。这种隔离级别也支持所谓的不可重复读。这意味着用户运行同一个语句两次，看到的结果是不同的。</p><p><strong>REPEATABLE READ（可重复读）</strong></p><p>​	mysql 数据库默认的隔离级别。该级别解决了 READ UNCOMMITTED 导致的问题。它保证了同一事务的多个实例在并发读取事务时，会看到同样的数据行。不过这会导致另外一个问题 “幻读”。InnoDB 和 Falcon 存储引擎通过多版本并发控制解决了幻读问题。</p><p><strong>SERIALIZABLE（可串行化）</strong></p><p>​	该隔离级别是最高的隔离级别。它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简而言之：SERIALIZABLE 是在每个读的数据行加锁，在这个级别上可能导致大量的超时和锁竞争现象，实际应用中很少使用这个级别，但如果用户的应用为了数据的稳定性，需要强制减少并发，也可以选择这种隔离级别。</p><h3 id="并发事务带来哪些问题"><a class="anchor" href="#并发事务带来哪些问题">#</a> 并发事务带来哪些问题？</h3><p><strong>脏读（Dirty read）</strong></p><p>​	当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是 “脏数据”，依据 “脏数据” 所做的操作可能是不正确的。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220714222508260.png" title="image-20220714222508260"><p><strong>不可重复读（Unrepeatableread）</strong></p><p>​	指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220714222512979.png" title="image-20220714222512979"><p><strong>幻读 （Phantom read）</strong></p><p>幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220714222518876.png" title="image-20220714222518876"><h3 id="不可重复度和幻读区别"><a class="anchor" href="#不可重复度和幻读区别">#</a> 不可重复度和幻读区别？</h3><p>不可重复读的重点是修改，幻读的重点在于新增或者删除。</p><p>解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表</p><h3 id="sql优化手段有哪些"><a class="anchor" href="#sql优化手段有哪些">#</a> SQL 优化手段有哪些？</h3><p>1、查询语句中不要使用 select *</p><p>2、尽量减少子查询，使用关联查询（left join,right join,inner join）替代</p><p>3、减少使用 IN 或者 NOT IN , 使用 exists，not exists 或者关联查询语句替代</p><p>4、or 的查询尽量用 union 或者 union all 代替 (在确认没有重复数据或者不用剔除重复数据时，union all 会更好)</p><p>5、应尽量避免在 where 子句中使用！= 或 &lt;&gt; 操作符，否则将引擎放弃使用索引而进行全表扫描。</p><p>6、应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如： select id from t where num is null 可以在 num 上设置默认值 0，确保表中 num 列没有 null 值，然后这样查询： select id from t where num=0</p><h3 id="mysql常见的日志有哪些分别起到了什么作用"><a class="anchor" href="#mysql常见的日志有哪些分别起到了什么作用">#</a> MySQL 常见的日志有哪些，分别起到了什么作用</h3><ol><li>bin log ：数据恢复、主从复制</li></ol><p>MySQL Server 层也有一个日志文件叫做 Binlog ，它可以被所有的存储引擎使用。</p><p>bin log 以事件的形式记录了所有的 DDL 和 DML 语句（因为他记录的是操作而不是数据值），可以用做主从复制和数据恢复</p><ol start="2"><li><p>relay log ：中介日志</p></li><li><p>redo log</p><p>记录修改后的值，属于物理日志</p><p>redo log 的大小事固定的，前面的内容会被覆盖，所以不能用于数据回滚 / 数据恢复</p><p>redo log 是 InnoDB 存储引擎实现的，并不是所有引擎都有</p></li></ol><h3 id="什么是buffer-pool"><a class="anchor" href="#什么是buffer-pool">#</a> 什么是 Buffer Pool</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220909103813728.png" title="image-20220909103813728"><h3 id="buffer-pool-内存淘汰策略"><a class="anchor" href="#buffer-pool-内存淘汰策略">#</a> Buffer pool 内存淘汰策略</h3><p>冷热分区的 LRU 策略</p><p>冷热分区比：5:3</p><p>数据一进来先进入到冷区的头部，默认在 1000ms 之后如果再次访问，就会将他放入到热区</p><h3 id="什么是hash索引"><a class="anchor" href="#什么是hash索引">#</a> 什么是 hash 索引</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220909104250912.png" title="image-20220909104250912"><p>不适合做范围查找，innodb 不支持 hash 索引</p><h3 id="mysql为什么要用b数做索引"><a class="anchor" href="#mysql为什么要用b数做索引">#</a> MySQL 为什么要用 B + 数做索引</h3><ol><li>B + 树能显著的减少 IO 次数，提高效率</li><li>B + 树的查询效率更加稳定，因为所有的数据都放在了叶子上</li><li>B + 树能提高范围查询的效率，因为叶子结点指向下一个叶子结点</li></ol><h3 id="数据库优化什么是数据库索引有哪些类型"><a class="anchor" href="#数据库优化什么是数据库索引有哪些类型">#</a> 数据库优化，什么是数据库索引，有哪些类型</h3><h3 id="谈一下你对数据库btree的理解"><a class="anchor" href="#谈一下你对数据库btree的理解">#</a> 谈一下你对数据库 b+tree 的理解</h3><h3 id="聚集索引和非聚集索引的区别"><a class="anchor" href="#聚集索引和非聚集索引的区别">#</a> 聚集索引和非聚集索引的区别</h3><h3 id="在日常工作中是如何进行数据库优化的"><a class="anchor" href="#在日常工作中是如何进行数据库优化的">#</a> 在日常工作中是如何进行数据库优化的</h3><h3 id="请列举几个索引失效的场景"><a class="anchor" href="#请列举几个索引失效的场景">#</a> 请列举几个索引失效的场景</h3><h3 id="数据库锁的机制"><a class="anchor" href="#数据库锁的机制">#</a> 数据库锁的机制</h3><h3 id="在遇到死锁情况如何处理"><a class="anchor" href="#在遇到死锁情况如何处理">#</a> 在遇到死锁情况如何处理</h3><h3 id="mysql和oracle的区别"><a class="anchor" href="#mysql和oracle的区别">#</a> mysql 和 oracle 的区别</h3><h3 id="数据库的根本特点"><a class="anchor" href="#数据库的根本特点">#</a> 数据库的根本特点</h3><p>1、数据结构化 数据库系统实现了整体数据的结构化，这是数据库的最主要的特征之一</p><p>2、数据的共享性高，冗余度低，易扩充 因为数据是面向整体的，所以数据可以被多个用户、多个应用程序共享使用</p><p>3、数据独立性高 数据独立性包括数据的物理独立性和逻辑独立性。</p><p>4、数据由 DBMS 统一管理和控制 数据库的共享是并发的 (concurrency) 共享，即多个用户可以同时存取数据库中的数据，甚至可以同时存取数据库中的同一个数据；</p><h3 id="数据库中数据共享是指"><a class="anchor" href="#数据库中数据共享是指">#</a> 数据库中数据共享是指</h3><p>多个应用、多种语言、多个用户共享数据</p><h3 id="数据库中产生数据不一致"><a class="anchor" href="#数据库中产生数据不一致">#</a> 数据库中产生数据不一致</h3><p>1. 并发控制不当</p><p>2. 数据冗余</p><p>3. 各种故障，错误</p><p>第一种往往是由于重复存放的数据未能进行一致性更新造成的</p><p>第二种情况是由于多用户共享数据库，而更新操作未能保持同步进行引起的</p><p>第三种是由于某种原因（硬件故障或软件故障等）而造成数据丢失或数据损坏等</p><h3 id="运算"><a class="anchor" href="#运算">#</a> 运算</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/c484ce59eba713b93d75a1381901dabe.png" title="img"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/9606dddddf13fb7dafa3119aa768e7a4.png" title="数据库之运算符详解_数据库_18"><h4 id="运算优先级"><a class="anchor" href="#运算优先级">#</a> 运算优先级</h4><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/2b23723e1f54716522beeb85047554c2.png" title="数据库之运算符详解_mysql_23"><h3 id="问题"><a class="anchor" href="#问题">#</a> 问题</h3><ol><li>undo 、redo、binlog</li><li>双写一致性</li><li>mysql 的索引</li><li>回表问题和覆盖索引</li><li>MVCC 以及原理</li><li>分库分表</li><li></li></ol><h3 id="未完成-6"><a class="anchor" href="#未完成-6">#</a> —————————— 未完成</h3><h1 id="javaee"><a class="anchor" href="#javaee">#</a> JavaEE</h1><p>Tomcat 有哪几种 connector 运行模式</p><p>Tomcat 有几种部署方式</p><p>简述 Servlet 的生命周期</p><p>JSP 和 Servlet 的区别是什么</p><p>四大作用域有哪些</p><p>9 大内置对象有哪些</p><p>get 请求和 post 请求的区别</p><p>forward 和 redirect 的区别</p><p>tomcat 容器是如何创建 Servlet 类实例，用到了什么原理</p><p>什么是 Cookie，Session</p><p>Cookie 和 Session 的区别是啥</p><p>cookie 禁用了 Session 是否可用</p><p>Servlet 是否线程安全，如何保证线程安全</p><h3 id="未完成-7"><a class="anchor" href="#未完成-7">#</a> —————————— 未完成</h3><h2 id="servlet"><a class="anchor" href="#servlet">#</a> Servlet</h2><h3 id="servlet中-forward-和-redirct-的区别"><a class="anchor" href="#servlet中-forward-和-redirct-的区别">#</a> Servlet 中 forward () 和 redirct () 的区别？</h3><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">forward</th><th style="text-align:center">redirct</th></tr></thead><tbody><tr><td style="text-align:center">浏览器地址栏</td><td style="text-align:center">请求转发是一种服务器的行为，不会变化</td><td style="text-align:center">重定向是一种浏览器行为，会发生变化</td></tr><tr><td style="text-align:center">请求的参数</td><td style="text-align:center">可以从源组件传递到目标组件<br>始终都是一个 request 和 response</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">请求对象和响应对象</td><td style="text-align:center">没有重新创建，而是传递给了目标组件</td><td style="text-align:center">再次产生，请求中的参数是不会携带<br>也可以携带一点简单信息，通过 url 的拼接，如：**?name=zhangsan</td></tr><tr><td style="text-align:center">页面跳转</td><td style="text-align:center">可以<br>能帮助我们访问 WEB-INF 中的资源</td><td style="text-align:center">可以<br>不能帮助我们访问 WEB-INF 中的资源</td></tr><tr><td style="text-align:center">范围</td><td style="text-align:center">只能转发给当前项目的内部资源</td><td style="text-align:center">可以定向到外部资源</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><h3 id="servlet的生命周期"><a class="anchor" href="#servlet的生命周期">#</a> Servlet 的生命周期</h3><p>阶段 次数 时机</p><p>创建 1 次 第一次请求</p><p>初始化 1 次 实例化之后</p><p>执行服务 多次 每次请求</p><p>销毁 1 次 停止服务</p><h3 id="未完成-8"><a class="anchor" href="#未完成-8">#</a> —————————— 未完成</h3><h1 id="mybatis"><a class="anchor" href="#mybatis">#</a> MyBatis</h1><h3 id="什么是mybatis"><a class="anchor" href="#什么是mybatis">#</a> 什么是 Mybatis</h3><p>Mybatis 是一个半 ORM 框架（对象关系映射）——》Hibernate 全 ORM 框架 ——》都是基于 JDBC 封装的框架</p><p>简化持久层开发</p><p>我们只需要专注于 SQL 语句，不用再去理会获取驱动；连接</p><p>为什么说是半自动，因为需要手动编写 sql 来完成</p><p>使用 Hibernate 查询关联对象或者关联集合对象时，可以根据对象关系模型直接获取，所以它是全自动的</p><h3 id="mybatis优点"><a class="anchor" href="#mybatis优点">#</a> Mybatis 优点</h3><ol><li>基于 SQL 语句的编程，相对来说更加灵活</li><li>和 JDBC 相比，减少了 50% 的代码量</li><li>可以很好地和各种数据库兼容</li><li>能够和 Spring 很好地兼容</li><li>提供了非常灵活的标签，动态 SQL 语句</li></ol><h3 id="mybatis的缺点"><a class="anchor" href="#mybatis的缺点">#</a> Mybatis 的缺点</h3><ol><li>SQL 语句的编写工作量大。</li><li>SQL 语句要和具体的数据库依赖很大，导致数据库的移植性很差，不能随意的切换数据库</li></ol><h3 id="和-的区别"><a class="anchor" href="#和-的区别">#</a> $ 和 # 的区别</h3><p>#{} 是预编译处理，在 Mybatis 出阿里的时候，会替换为？，然后调用 PreparedSatement 的 set () 方法对？赋值</p><p>${} Mybatis 处理的时候直接替换，会有 SQL 注入的风险</p><h3 id="属性名和字段名不一致"><a class="anchor" href="#属性名和字段名不一致">#</a> 属性名和字段名不一致</h3><ol><li>查询的 SQL 语句我们可以通过别名处理</li><li>通过 resultMap 来设置字段和属性的映射关系</li></ol><h3 id="如何获取自动生成的主键"><a class="anchor" href="#如何获取自动生成的主键">#</a> 如何获取自动生成的主键</h3><p>在使用 insert 标签时候，设置 2 个属性，</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>        </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h3 id="mybatis使用了那些设计模式"><a class="anchor" href="#mybatis使用了那些设计模式">#</a> Mybatis 使用了那些设计模式</h3><ol><li>缓存模块：装饰器模式</li><li>日志模块：适配器模式，代理模式</li><li>SqlSessionFactory：工厂模式</li><li>Mapper 接口：代理模式</li><li>SQLSessionFactoryBuilder ：建造者模式</li><li>......</li></ol><h3 id="mybatis映射文件中处理curd操作的标签以外还有那些标签"><a class="anchor" href="#mybatis映射文件中处理curd操作的标签以外还有那些标签">#</a> Mybatis 映射文件中处理 CURD 操作的标签以外还有那些标签</h3><p>sql 标签：SQL 代码片段</p><p>cache：缓存</p><p>cache-ref</p><p>resultMap：结果集映射</p><p>全局配置文件中有哪些标签</p><p>peoperties</p><p>settings</p><p>typeHandler</p><p>interceprots</p><p>elements</p><p>mappers</p><p>...</p><h3 id="mybatis的分页"><a class="anchor" href="#mybatis的分页">#</a> Mybatis 的分页</h3><p>分页：逻辑分页；物理分页</p><p>逻辑分页：不是真正的分页，RowBounds 来分页</p><p>物理分页：我们都是通过拦截器来实现的分页</p><h3 id="mybatis都有哪些executor执行器它们之间的区别是什么"><a class="anchor" href="#mybatis都有哪些executor执行器它们之间的区别是什么">#</a> Mybatis 都有哪些 Executor 执行器？它们之间的区别是什么？</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/b9baa56b1d94fa4a9c913430deef968d.png" title="img"><p>Mybatis 有三种基本的 Executor 执行器，<mark>SimpleExecutor</mark>、<mark>ReuseExecutor</mark>、 <mark>BatchExecutor。</mark></p><p>SimpleExecutor:</p><blockquote><p>SQL 的基本处理，当执行增删改查时，该类获取数据库连接，创建 PrepareStatement 或者 Statement 对象，执行<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1TUUwlRTglQUYlQUQlRTUlOEYlQTUmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw"> SQL 语句</span>，最后将数据库返回结果转化为设定的对象</p></blockquote><p>ReuseExecutor：</p><blockquote><p>​	执行 update 或 select，以 sql 作为 key 查找 Statement 对象 (在 statementMap 对象中找)，存在就使 用，不存在就创建，用完后，不关闭 Statement 对象，而是放置于 Map&lt;String, Statement &gt; 内，供下一次使用。简言之，就是重复使用 Statement 对象。</p></blockquote><p>BatchExecutor：</p><blockquote><p>​	执行 update（没有 select，mybatis 认为 delete 和 insert 都是 update，JDBC 批处理不支持 select），将所有 sql 都添 加到批处理中（addBatch ()），等待统一执行（executeBatch ()），它缓存了多个 Statement 对象，每个 Statement 对象都是 addBatch () 完毕后，等待逐一执行 executeBatch () 批处理。与 JDBC 批处理相同。</p></blockquote><p>作用范围：Executor 的这些特点，都严格限制在 SqlSession 生命周期范围内。</p><h3 id="mybatis中mapper接口一致性问题"><a class="anchor" href="#mybatis中mapper接口一致性问题">#</a> Mybatis 中 Mapper 接口一致性问题</h3><ol><li>Mapper 接口名要和 Mapper.xml 的文件名一致</li><li>Mapper 接口的方法名要和 mapper.xml 中存在相同的唯一 id</li><li>Mapper 接口的返回类型要和 mapper.xml 中定义的 sql 标签的返回类型一致</li><li>mapper.xml 的 namespace 要和 Mapper 接口的全路径名一致</li></ol><h3 id="介绍一下mybatis的工作原理"><a class="anchor" href="#介绍一下mybatis的工作原理">#</a> 介绍一下 Mybatis 的工作原理</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/MyBatis%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1661130135150.png" title="MyBatis工作原理"><ol><li>Mybatis 启动加载</li></ol><p>SqlSessionFactory：会完成全局配置文件和映射文件的加载解析操作，然后回把相关的信息保存到 Configuration 对象中，创建的 SqlSessionFactory 对象的实现是 DeafaultSsqlSession 对象。</p><p>SqlSession： 通过 SqlSessionFactory 获取 SqlSeesion 对象，创建的具体的是烈士 DefaultSqlSession</p><ol start="2"><li>Mybatis 如何处理请求</li></ol><p>SqlSession 中给提供了处理请求的方法 select update delete save 方法</p><p>调用对应的 executor 处理，如果有配置缓存处理 -》先走二级缓存，然后再走一级缓存，如果缓存中都没有查询到对应的数据，才会走数据库操作，交给 StatementHandler 来处理，通过 ParamenterHandler 处理 SQL 中的占位符，通过 ResultSetHandler 处理结果集的映射。</p><h3 id="mybatis的缓存设计"><a class="anchor" href="#mybatis的缓存设计">#</a> Mybatis 的缓存设计</h3><ol><li>在 Mybatis 中有一个单独的缓存模块 ——》用到了装饰器模式</li><li>缓存的使用 ，cache 标签 ，<cache></li><li>MyBatis 中支持的缓存分类<ol><li>一级缓存：基于会话</li><li>二级缓存：基于会话</li><li>三级缓存：分布式</li></ol></li></ol><p>在 Mybatis 中的缓存执行顺序：二级缓存 ——》一级缓存 ——》数据库查询</p><h3 id="mybatis三级缓存"><a class="anchor" href="#mybatis三级缓存">#</a> mybatis 三级缓存</h3><p>一级缓存：内存上的缓存，<strong>存储在 SQLSession</strong> 中，在<strong> Commit 和增删改的时候自动清空缓存</strong>。<strong>默认开启</strong>。实体类<strong>不需要</strong>实现<strong>序列化</strong>接口</p><p>二级缓存：以 <strong>namespace 为标记的缓存</strong>，可以是<strong>由一个 SqlSessionFactory 创建的 SqlSession 之间共享缓存数据</strong>。默认并不开启。要求实体类<strong>必须实现序列化</strong>接口</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220715163809809.png" title="image-20220715163809809"><p>三方缓存：我们系统为了提高系统并发和性能，一般对系统进行分布式部署（集群部署方式）不适用分布缓存， 缓存的数据在各个服务单独存储，不方便系统开发。所以要使用分布式缓存对缓存数据进行集中管理</p><h3 id="defaultsqlsession是线程安全的吗"><a class="anchor" href="#defaultsqlsession是线程安全的吗">#</a> DefaultSqlSession 是线程安全的吗</h3><p>他是线程不安全的，我们在工作中都不会单独的使用 DefaultSqlSession，而是整合 Spring 框架来使用。</p><p>那 Spring 是如何解决这个数据安全问题的？</p><p>线程不安全的原因是多个线程操作同一个对象，而这个对象被定义为一个成员变量，解决的方案就是吧这个成员变量作为一个局部变量，让多个线程不能同时操作就可以了</p><p>创建了一个 SqiSessionTemplate 模板对象，定义了数据库操作的相关的方法，本质上是通过代理对象获取了 DefaultSqlSession 对象来执行，而且把 DefaultSqlSession 对象声明在了局部变量中，从而解决了线程不安全的问题。</p><h1 id="spring"><a class="anchor" href="#spring">#</a> Spring</h1><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220822092829878.png" title="image-20220822092829878"><h3 id="什么是spring"><a class="anchor" href="#什么是spring">#</a> 什么是 Spring</h3><p>Spring 是个 java 企业级应用的开源开发框架。Spring 主要用来开发 Java 应用，但是有些<mark>扩展</mark>是针对构建 J2EE 平台的 web 应用。Spring 框架目标是简化 Java 企业级应用开发，并通过 POJO 为基础的编程模型促进良好的编程习惯。</p><p>框架 ——》容器 ——》生态</p><h3 id="项目中为什么使用spring框架"><a class="anchor" href="#项目中为什么使用spring框架">#</a> 项目中为什么使用 Spring 框架？</h3><p>这么问的话，就直接说 Spring 框架的好处就可以了。比如说 Spring 有以下特点:</p><p><strong>轻量</strong>： Spring 是轻量的，基本的版本大约 2MB。</p><p><strong>控制反转</strong>：Spring 通过控制反转实现了松散耦合，对象们给出它们的依赖，而不是创建或查找依赖的对象们。</p><p><strong>面向切面的编程 (AOP)</strong>：Spring 支持面向切面的编程，并且把应用业务逻辑和系统服务分开。</p><p><strong>容器</strong>：Spring 包含并管理应用中对象的生命周期和配置。</p><p><strong>MVC 框架</strong>： Spring 的 WEB 框架是个精心设计的框架，是 Web 框架的一个很好的替代品。</p><p><strong>事务管理</strong>：Spring 提供一个持续的事务管理接口，可以扩展到上至本地事务下至全局事务 (JTA)。</p><p><strong>异常处理</strong>： Spring 提供方便的 API 把具体技术相关的异常 (比如由 JDBC，Hibernate or JDO 抛出的）转化为一致的 unchecked 异常。</p><h3 id="autowired-和resource的区别"><a class="anchor" href="#autowired-和resource的区别">#</a> Autowired 和 Resource 的区别</h3><p>Resource 和 @Autowired 都是做 bean 的注入时使用，其实 @Resource 并不是 Spring 的注解，它的包是 javax.annotation.Resource，需要导入，但是 Spring 支持该注解的注入。</p><p>1、共同点<br>两者都可以写在字段和 setter 方法上。两者如果都写在字段上，那么就不需要再写 setter 方法。</p><p>2、不同点</p><p>(1)@Autowired</p><p>@Autowired 为 Spring 提供的注解，需要导入包 org.springframework.beans.factory.annotation.Autowired; 只按照 byType 注入。</p><p>@Autowired 注解是按照类型 (byType）装配依赖对象，默认情况下它要求依赖对象必须存在，如果允许 null 值，可以设置它的 required 属性为 false。</p><p>如果我们想使用按照名称 (byName) 来装配，可以结合 @Qualifier 注解一起使用。</p><p>(2)@Resource</p><p>@Resource 默认按照 ByName 自动注入，由 J2EE 提供，需要导入包 javax.annotation.Resource。</p><p>@Resource 有两个重要的属性: name 和 type，而 Spring 将 @Resource 注解的 name 属性解析为 bean 的名字，而 type 属性则解析为 bean 的类型。所以，如果使用 name 属性，则使用 byName 的自动注入策略，而使用 type 属性时则使用 byType 自动注入策略。如果既不制定 name 也不制定 type 属性，这时将通过反射机制使用 byName 自动注入策略。</p><p>注：最好是将 @Resource 放在 setter 方法上，因为这样更符合面向对象的思想，通过 set、get 去操作属性，而不是直接去操作属性。<br>@Resource 装配顺序:</p><ol><li>如果同时指定了 name 和 type，则从 Spring 上下文中找到唯一匹配的 bean 进行装配，找不到则抛出异常。</li><li>如果指定了 name，则从上下文中查找名称 (id）匹配的 bean 进行装配，找不到则抛出异常。</li><li>如果指定了 type，则从上下文中找到类似匹配的唯一 bean 进行装配，找不到或是找到多个，都会抛出异常。</li><li>④如果既没有指定 name，又没有指定 type，则自动按照 byName 方式进行装配；如果没有匹配，则回退为一个原始类型进行匹配，如果匹配则自动装配。</li></ol><p>@Resource 的作用相当于 @Autowired，只不过 @Autowired 按照 byType 自动注入。</p><h3 id="依赖注入的方式有哪几种"><a class="anchor" href="#依赖注入的方式有哪几种">#</a> 依赖注入的方式有哪几种</h3><p>一、构造器注入</p><p>将被依赖对象通过构造函数的参数注入给依赖对象，并且在初始化对象的时候注入。</p><p>优点：对象初始化完成后便可获得可使用的对象。<br>缺点：当需要注入的对象很多时，构造器参数列表将会很长；不够灵活。若有多种注入方式，每种方式只需注入指定几个依赖，那么就需要提供多个重载的构造函数，麻烦。</p><p>二、setter 方法注入</p><p>IOC Service Provider 通过调用成员变量提供的 setter 函数将被依赖对象注入给依赖类。</p><p>优点：灵活，可以选择性地注入需要的对象。<br>缺点：依赖对象初始化完成后由于尚未注入被依赖对象，因此还不能使用。</p><p>三、接口注入</p><p>依赖类必须要实现指定的接口，然后实现该接口中的一个函数，该函数就是用于依赖注入。该函数的参数就是要注入的对象。</p><p>优点：接口注入中，接口的名字、函数的名字都不重要，只要保证函数的参数是要注入的对象类型即可。</p><p>缺点：侵入性太强，不建议使用</p><p>PS: 什么是侵入行？如果类 A 要使用别人提供的一个功能，若为了使用这功能，需要在自己的类中增加额外的代码，这就是侵入性。</p><h3 id="说一下你对spring核心模块的理解"><a class="anchor" href="#说一下你对spring核心模块的理解">#</a> 说一下你对 spring 核心模块的理解</h3><p>Spring 是一个轻量级的 loC 和 AOP 容器框架。是为 Java 应用程序提供基础性服务的一套框架，目的是用天简化企业应用程序的开发，它使得开发者只需要关心业务需求。常见的配置方式有三种：基于 XML 的配置、基于注解的配置、基于 Java 的配置。</p><p>主要由以下几个模块组成：入口</p><p>Spring Core: 核心类库，提供 IOC 服务；</p><p>Spring Context: 提供框架式的 Bean 访问方式，以及企业级功能 (JNDI、定时任务等);Spring AOP: AOP 服务；</p><p>Spring DAO: 对 JDBC 的抽象，简化了数据访问异常的处理；Spring ORM: 对现有的 ORM 框架的支持；</p><p>Spring Web: 提供了基本的面向 Web 的综合特性，例如多方文件上传；</p><p>Spring MVC: 提供面向 Web 应用的 Model-View-Controller 实现。</p><h3 id="说说你对spring的ioc是怎么理解的"><a class="anchor" href="#说说你对spring的ioc是怎么理解的">#</a> 说说你对 Spring 的 IOC 是怎么理解的？</h3><p>(1) IOC 就是控制反转，是指创建对象的控制权的转移。以前创建对象的主动权和时机是由自己把控的，而现<br>在这种权力转移到 Spring 容器中，并由容器根据配置文件去创建实例和管理各个实例之间的依赖关系。对象与对象之间松散耦合，也利于功能的复用。DI 依赖注入，和控制反转是同一个概念的不同角度的描述，即应用程序在运行时依赖 loC 容器来动态注入对象需要的外部资源。</p><p>(2) 最直观的表达就是，IOC 让对象的创建不用去 new 了，可以由 spring 自动生产，使用 java 的反射机制，根据配置文件在运行时动态的去创建对象以及管理对象，并调用对象的方法的。</p><p>(3) Spring 的 IOC 有三种注入方式：构造器注入、setter 方法注入、根据注解注入。</p><p><mark>IOC 让相互协作的组件保持松散的耦合，而 AOP 编程允许你把遍布于应用各层的功能分离出来形成可重用的功能组件</mark></p><blockquote></blockquote><h3 id="string的aop实现"><a class="anchor" href="#string的aop实现">#</a> String 的 AOP 实现</h3><p>​	面向切面编程（AOP [Aspect Oriented Programming]）和面向对象编程（OOP）类似，也是一种编程模式。AOP 是通过<strong>预编译</strong>方式和<strong>运行期间动态代理</strong>实现程序功能和统一维护的一种技术。Spring AOP 是基于 AOP 编程模式的一个框架，它的使用有效减少了系统间的重复代码，达到了模块间的松耦合目的。</p><p>​	AOP 切面编程一般 ** 可以帮助我们在不修改现有代码的情况下，对程序的功能进行拓展，** 往往用于实现 <strong>日志处理</strong>，<strong> 权限控制</strong>，<strong>性能检测</strong>，<strong> 事务控制</strong>等，便于减少系统的重复代码，降低模块间的耦合度，有利于未来的可扩展性和可维护性</p><p>​	AOP 实现的原理就是<strong>动态代理</strong>，在<strong>有接口</strong>的情况下，<strong> 使用 JDK 动态代理</strong>，在<strong>没有接口</strong>的情况下<strong>使用 cglib 动态代理</strong>。</p><p><strong>AOP 中的术语辨析</strong></p><p><strong>1 连接点 Joint point:</strong><br>类里面那些<font color="#FF0000"><strong>可以被增强的方法</strong></font>, 这些方法称之为连接点<br>表示在程序中明确定义的点，典型的包括方法调用，对类成员的访问以及异常处理程序块的执行等等，它自身还可以嵌套其它 joint point</p><p><strong>2 切入点 Pointcut:</strong><br><font color="#FF0000"><strong>实际被增强的方法</strong></font>, 称之为切入点<br>表示一组 joint point，这些 joint point 或是通过逻辑关系组合起来，或是通过通配、正则表达式等方式集中起来，它定义了相应的 Advice 将要发生的地方</p><p><strong>3 通知 Advice:</strong><br>实际增强的逻辑部分称为通知 (<font color="#FF0000"><strong>增加的功能</strong></font>)<br>Advice 定义了在 Pointcut 里面定义的程序点具体要做的操作，它通过 before、after 和 around 来区别是在每个 joint point 之前、之后还是代替执行的代码。<br>通知类型: 1 前置通知 2 后置通知 3 环绕通知 4 异常通知 5 最终通知</p><p><strong>4 目标对象 Target：<font color="#FF0000">被增强功能的对象 (被代理的对象</font>)</strong><br>织入 Advice 的目标对象</p><p><strong>5 切面 Aspect： <font color="#FF0000">表现为功能相关的一些 advice 方法放在一起声明成的一个 Java 类</font></strong><br>Aspect 声明类似于 Java 中的类声明，在 Aspect 中会包含着一些 Pointcut 以及相应的 Advice。</p><p><strong>6 织入 Weaving：</strong><br><strong><font color="#FF0000">创建代理对象并实现功能增强的声明并运行过程</font></strong><br>将 Aspect 和其他对象连接起来，并创建 Adviced object 的过程</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220629184111567.png" title="image-20220629184111567"><p>当然也可以使用 AspectJ,SpringAOP 中已经集成了 AspectJ,AspectJ 应该算得上是 Java 生态系统中最完整的 AOP 框架了。使用 AOP 之后我们可以把一些通用功能抽象出来，在需要用到的地方直接使用即可，这样可以大大简化代码量。我们需要增加新功能也方便，提高了系统的扩展性。日志功能、事务管理和权限管理等场景都用到了 AOP。</p><h4 id="如何实现"><a class="anchor" href="#如何实现">#</a> 如何实现？？？</h4><ul><li>静态 AOP 实现， AOP 框架在编译阶段对程序源代码进行修改，生成了静态的 AOP 代理类（生成的 *.class 文件已经被改掉了，需要使用特定的编译器），比如 AspectJ。</li><li>动态 AOP 实现， AOP 框架在运行阶段对动态生成代理对象（在内存中以 JDK 动态代理，或 CGlib 动态地生成 AOP 代理类），如 SpringAOP。</li></ul><p><strong>1）JDK 的实现方式：</strong></p><p>JDK 动态代理是通过 JDK 中的 java.lang.reflect.Proxy 类实现的。<br>proxy 结合 invocationHandler 。前提条件：被代理类需要实现某一个接口<br>原理：<br>前置知识（java 文件在编译器编译为 class 字节码，运行时加载对应类到方法区）<br>（1）运行期，根据被代理类，生成代理类的字节码，将被代理类包装到代理类中<br>（2）被代理类方法执行前后，插入统一处理逻辑<br>（3）使用的时候：使用代理类，不再使用被代理类（代理类中已经包裹了被代理类）</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20210616175256885.png" title="img"><p><strong>2) CGLIB 的实现方式：</strong><br>CGLIB（Code Generation Library）是一个高性能开源的代码生成包，它被许多 AOP 框架所使用，其底层是通过使用一个小而快的字节码处理框架 ASM（Java 字节码操控框架）转换字节码并生成新的类。因此 CGLIB 要依赖于 ASM 的包，解压 Spring 的核心包 spring-core-3.2.2.RELEASE.jar。</p><p>MethodInterceptor 完成方法执行前后的业务逻辑插入，再通过 ASM 字节码技术，生成代理类的字节码。<br>前置条件（被代理类不需要实现接口，但不能为 final 修饰）</p><p><strong>Spring 框架代理时：会根据是否实现接口来决定使用哪一种动态代理。</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20210616180920375.png" title="在这里插入图片描述"><h3 id="spring-aop和aspectj-aop有什么区别"><a class="anchor" href="#spring-aop和aspectj-aop有什么区别">#</a> Spring AOP 和 AspectJ AOP 有什么区别？</h3><p>SpringAOP 是属于运行时增强，而 AspectlJ 是编译时增强。SpringAOP 基于代理 (Proxying)，而 AspectJ 基于字节码操作（BytecodeManipulation) 。</p><p>SpringAOP 已经集成了 AspectJ，AspectJ 应该算得上是 Java 生态系统中最完整的 AOP 框架了。AspectJ 相比于<br>SpringAOP 功能更加强大，但是 SpringAOP 相对来说更简单。</p><p>如果我们的切面比较少，那么两者性能差异不大。但是，当切面太多的话，最好选择 AspectJ，它比 SpringAOP 快很多。</p><p><strong>在 SpringAOP 中，关注点和横切关注的区别是什么？</strong></p><p>关注点是应用中一个模块的行为，一个关注点可能会被定义成一个我们想实现的一个功能。横切关注点是一个关注点，此关注点是整个应用都会使用的功能，并影响整个应用，比如日志，安全和数据传输，几乎应用的每个模块都需要的功能。因此这些都属于横切关注点。</p><p>那什么是连接点呢？连接点代表一个应用程序的某个位置，在这个位置我们可以插入一个 AOP 切面，它实际上是个应用程序执行 SpringAOP 的位置。</p><p>切入点是什么？切入点是一个或一组连接点，通知将在这些位置执行。可以通过表达式或匹配的方式指明切入点。</p><p><strong>什么是通知呢？有哪些类型呢？</strong></p><p>通知是个在方法执行前或执行后要做的动作，实际上是程序执行时要通过 SpringAOP 框架触发的代码段。</p><p>Spring 切面可以应用五种类型的通知:</p><ul><li>before: 前置通知，在一个方法执行前被调用。</li><li>after: 在方法执行之后调用的通知，无论方法执行是否成功。</li><li>after-returning: 仅当方法成功完成后执行的通知。</li><li>after-throwing: 在方法抛出异常退出时执行的通知。</li><li>around: 在方法执行之前和之后调用的通知。</li></ul><h3 id="静态代理和动态代理"><a class="anchor" href="#静态代理和动态代理">#</a> 静态代理和动态代理</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vam95OTkvcC8xMDg2NTM5MS5odG1s">https://www.cnblogs.com/joy99/p/10865391.html</span></p><blockquote><p>a</p><p>a</p><p>a</p><p>a</p></blockquote><h3 id="string和springboot和springmvc的区别"><a class="anchor" href="#string和springboot和springmvc的区别">#</a> String 和 Springboot 和 SpringMVC 的区别</h3><h4 id="一-概念"><a class="anchor" href="#一-概念">#</a> 一、概念</h4><p><strong>1、Spring</strong></p><p>Spring 是一个开源容器框架，可以接管 web 层，业务层，dao 层，<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTYlOEMlODElRTQlQjklODUlRTUlQjElODImYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">持久层</span>的组件，并且可以配置各种 bean, 和维护 bean 与 bean 之间的关系。其核心就是控制反转 (IOC), 和面向切面 (AOP), 简单的说就是一个分层的轻量级开源框架。</p><p><strong>2、SpringMVC</strong></p><p>Spring <span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1NVkMmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">MVC</span> 属于 SpringFrameWork 的后续产品，已经融合在 Spring Web Flow 里面。SpringMVC 是一种 web 层 mvc 框架，用于替代 servlet（处理 | 响应请求，获取表单参数，表单校验等。SpringMVC 是一个 MVC 的开源框架，SpringMVC=struts2+spring，springMVC 就相当于是 Struts2 加上 Spring 的整合。</p><p><strong>3、SpringBoot</strong></p><p>Springboot 是一个微服务框架，延续了 spring 框架的核心思想<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1JT0MmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw"> IOC</span> 和 AOP，简化了应用的开发和部署。Spring Boot 是为了简化 Spring 应用的创建、运行、调试、部署等而出现的，使用它可以做到专注于 Spring 应用的开发，而无需过多关注 XML 的配置。提供了一堆依赖打包，并已经按照使用习惯解决了依赖问题 —&gt; 习惯大于约定。</p><h4 id="二-原理和结构"><a class="anchor" href="#二-原理和结构">#</a> 二、原理和结构</h4><p><strong>1、Spring 的原理和组成</strong></p><p>Spring 为简化我们的开发工作，封装了一系列的开箱即用的组件功能模块，包括：Spring JDBC 、Spring MVC 、Spring Security、 Spring <span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1BT1AmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">AOP</span> 、Spring ORM 、Spring Test 等。<strong>如下图：</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20200920135709418.jpg" title="在这里插入图片描述"><p><strong>简化的理解图：</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20200920135841872.jpg" title="在这里插入图片描述"><p><strong>2、SpringMVC 的原理和组成</strong></p><p>从上图中可以看出：<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1TcHJpbmdNVkMmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">SpringMVC</span> 是属于 SpringWeb 里面的一个功能模块（SpringWebMVC）。专门用来开发 SpringWeb 项目的一种 MVC 模式的技术框架实现。<br><strong>其原理如下：</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220810110921395.png" title="image-20220810110921395"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20200920140021102.jpg" title="在这里插入图片描述"><p>MVC：Model（模型）、VIew（视图）、Controller（控制器）；我们从开始接触并学习 javaWeb 开发就知道 MVC 这一种架构，如早起的 Sturts1、Sturts2 等。</p><p><strong>3、SpringBoot 的原理和特性</strong></p><p>Spring Boot 基本上是 Spring 框架的扩展，它消除了设置 Spring 应用程序所需的 XML 配置，为更快，更高效的开发生态系统铺平了道路。</p><p>Spring Boot 中的一些特点：</p><ol><li>创建独立的 spring 应用。</li><li>嵌入 Tomcat, JettyUndertow 而且不需要部署他们。</li><li>提供的 “starters” poms 来简化 Maven 配置。</li><li>尽可能自动配置 spring 应用。</li><li>提供生产指标，健壮检查和外部化配置。</li><li>绝对没有代码生成和 XML 配置要求。</li></ol><p><strong>组成和结构如下图：</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20200920140139882.jpg" title="在这里插入图片描述"><p>从图中可以看出 SpringBoot 是包含了 Spring 的核心（IOC）和（AOP）；以及封装了一些扩展，如 Stater：</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20200920140302700.jpg" title="在这里插入图片描述"><h4 id="三-区别与总结"><a class="anchor" href="#三-区别与总结">#</a> 三、区别与总结</h4><p><strong>1. 简单理解为：Spring 包含了 SpringMVC，而 SpringBoot 又包含了 Spring 或者说是在 Spring 的基础上做得一个扩展。</strong></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/20200920140600599.jpg" title="在这里插入图片描述"><p><strong>2、关系大概就是这样：</strong></p><p>spring mvc &lt; spring &lt; springboot</p><p><strong>3、Spring Boot 对比 Spring 的一些优点包括：</strong></p><ol><li>提供嵌入式容器支持</li><li>使用命令 java -jar 独立运行 jar</li><li>在外部容器中部署时，可以选择排除依赖关系以避免潜在的 jar 冲突</li><li>部署时灵活指定配置文件的选项</li><li>用于集成测试的随机端口生成</li></ol><p><strong>4、结论</strong></p><p>Spring Boot 只是 Spring 本身的扩展，使开发，测试和部署更加方便。</p><h3 id="spring中事务是如何回滚"><a class="anchor" href="#spring中事务是如何回滚">#</a> Spring 中事务是如何回滚</h3><p>在 Service 层的方法上加上 <code>@Transactional</code> 注解，在发生错误时，方法会抛出运行时异常，随即 Spring 会自动回滚事务。</p><p>Spring 实现事务回滚的流程如下：</p><p>1、通过 cglib，将方法上加了 @Transactional 注解的类创建生成代理对象</p><p>2、Controller 在调用 Service 方法时，由于 Service 是代理对象，便会进入到 DynamicAdvisedInterceptor 类的 intercept 方法中</p><p>源码如下：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="2"></td><td><pre>		<span class="token annotation punctuation">@Nullable</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>			<span class="token class-name">Object</span> oldProxy <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>			<span class="token keyword">boolean</span> setProxyContext <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token class-name">Object</span> target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			<span class="token class-name">TargetSource</span> targetSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getTargetSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>			<span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span>exposeProxy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>					<span class="token comment">// Make invocation available if necessary.</span></pre></td></tr><tr><td data-num="11"></td><td><pre>					oldProxy <span class="token operator">=</span> <span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">setCurrentProxy</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>					setProxyContext <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>				<span class="token comment">// Get as late as possible to minimize the time we "own" the target, in case it comes from a pool...</span></pre></td></tr><tr><td data-num="15"></td><td><pre>				target <span class="token operator">=</span> targetSource<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>				<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetClass <span class="token operator">=</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>				<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> chain <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>				<span class="token class-name">Object</span> retVal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>				<span class="token comment">// Check whether we only have one InvokerInterceptor: that is,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>				<span class="token comment">// no real advice, but just reflective invocation of the target.</span></pre></td></tr><tr><td data-num="21"></td><td><pre>				<span class="token keyword">if</span> <span class="token punctuation">(</span>chain<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">isPublic</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>					<span class="token comment">// We can skip creating a MethodInvocation: just invoke the target directly.</span></pre></td></tr><tr><td data-num="23"></td><td><pre>					<span class="token comment">// Note that the final invoker must be an InvokerInterceptor, so we know</span></pre></td></tr><tr><td data-num="24"></td><td><pre>					<span class="token comment">// it does nothing but a reflective operation on the target, and no hot</span></pre></td></tr><tr><td data-num="25"></td><td><pre>					<span class="token comment">// swapping or fancy proxying.</span></pre></td></tr><tr><td data-num="26"></td><td><pre>					<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argsToUse <span class="token operator">=</span> <span class="token class-name">AopProxyUtils</span><span class="token punctuation">.</span><span class="token function">adaptArgumentsIfNecessary</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>					retVal <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> argsToUse<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>				<span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>					<span class="token comment">// We need to create a method invocation...</span></pre></td></tr><tr><td data-num="31"></td><td><pre>					retVal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibMethodInvocation</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">,</span> targetClass<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> methodProxy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>				retVal <span class="token operator">=</span> <span class="token function">processReturnType</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> retVal<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>				<span class="token keyword">return</span> retVal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>			<span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>				<span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>targetSource<span class="token punctuation">.</span><span class="token function">isStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>					targetSource<span class="token punctuation">.</span><span class="token function">releaseTarget</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>				<span class="token keyword">if</span> <span class="token punctuation">(</span>setProxyContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>					<span class="token comment">// Restore old proxy.</span></pre></td></tr><tr><td data-num="42"></td><td><pre>					<span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">setCurrentProxy</span><span class="token punctuation">(</span>oldProxy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这段代码注意这一行，chain 里只有一个对象，即 TransactionInterceptor，下面会用到这个对象</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> chain <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>advised<span class="token punctuation">.</span><span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>3、继续一层层方法进入，我们就会来到 TransactionInterceptor 的 invoke 方法，先获取被代理的对象类 targetClass，随后进入核心类 TransactionAspectSupport 的 invokeWithinTransaction 方法中</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>		<span class="token comment">// Work out the target class: may be &#123;@code null&#125;.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		<span class="token comment">// The TransactionAttributeSource should be passed the target class</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token comment">// as well as the method, which may be from an interface.</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetClass <span class="token operator">=</span> <span class="token punctuation">(</span>invocation<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">AopUtils</span><span class="token punctuation">.</span><span class="token function">getTargetClass</span><span class="token punctuation">(</span>invocation<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> </pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token comment">// Adapt to TransactionAspectSupport's invokeWithinTransaction...</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token keyword">return</span> <span class="token function">invokeWithinTransaction</span><span class="token punctuation">(</span>invocation<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> targetClass<span class="token punctuation">,</span> invocation<span class="token operator">::</span><span class="token function">proceed</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>4、TransactionAspectSupport 的 invokeWithinTransaction 方法中，实现回滚的就是这几行，try catch 包住要执行的事务方法，如果发生报错，就在 catch 中回滚事务</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Object</span> retVal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>			<span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>				<span class="token comment">// This is an around advice: Invoke the next interceptor in the chain.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>				<span class="token comment">// This will normally result in a target object being invoked.</span></pre></td></tr><tr><td data-num="5"></td><td><pre>				retVal <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">proceedWithInvocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>				<span class="token comment">// target invocation exception</span></pre></td></tr><tr><td data-num="9"></td><td><pre>				<span class="token function">completeTransactionAfterThrowing</span><span class="token punctuation">(</span>txInfo<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>				<span class="token keyword">throw</span> ex<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLjUxY3RvLmNvbS91XzE0MTUwNjE1LzIzNTQwMTM=">https://blog.51cto.com/u_14150615/2354013</span></p><p>1. 代码中事务控制的 3 种方式<br>编程式事务：就是直接在代码里手动开启事务，手动提交，手动回滚。优点就是可以灵活控制，缺点就是太麻烦了，太多重复的代码了。</p><p>声明式事务：就是使用 SpringAop 配置事务，这种方式大大的简化了编码。需要注意的是切入点表达式一定要写正确。</p><p>注解事务：直接在 Service 层的方法上面加上 @Transactional 注解，个人比较喜欢用这种方式。</p><h3 id="spring如何处理多线程的bean"><a class="anchor" href="#spring如何处理多线程的bean">#</a> Spring 如何处理多线程的 Bean</h3><p>在一般情况下，只有无状态的 Bean 才可以在多线程环境下共享，在 Spring 中，绝大部分 Bean 都可以声明为 singleton 作用域，因为 Spring 对一些 Bean 中非线程安全状态采用 ThreadLocal 进行处理，解决线程安全问题。</p><p>ThreadLocal 和线程同步机制都是为了解决多线程中相同变量的访问冲突问题。同步机制采用了 “时间换空间” 的方式，仅提供一份变量，不同的线程在访问前需要获取锁，没获得锁的线程则需要排队。而 ThreadLocal 采用了 “空间换时间” 的方式。</p><p>ThreadLocal 会为每一个线程提供一个独立的变量副本，从而隔离了多个线程对数据的访问冲突。因为每一个线程都拥有自己的变量副本，从而也就没有必要对该变量进行同步了。ThreadLocal 提供了线程安全的共享对象，在编写多线程代码时，可以把不安全的变量封装进 ThreadLocal。</p><h1 id="springboot"><a class="anchor" href="#springboot">#</a> SpringBoot</h1><h3 id="什么是springboot"><a class="anchor" href="#什么是springboot">#</a> 什么是 SpringBoot</h3><p>SpringBoot 是基于 Spring 创建一个上层应用框架，14 年发布 1.0。会比以前的那种 SSM 基于配置的方式效率要高很多。.... 自己在想一些优点</p><h3 id="springboot有哪些优点"><a class="anchor" href="#springboot有哪些优点">#</a> SpringBoot 有哪些优点</h3><ol><li><p>独立运行</p></li><li><p>简化配置，预定由于配置的理念</p></li><li><p>自动配置</p></li><li><p>无代码生和 XML 配置</p></li><li><p>Acuator 应用监控（微服务情况下）</p></li></ol><h3 id="springboot中的核心注解"><a class="anchor" href="#springboot中的核心注解">#</a> SpringBoot 中的核心注解</h3><ol><li>@SpringBootApplication，他是一个组合注解</li></ol><p>@ComponentScan ：默认情况下会扫描当前包及其子包下面所有被 @Component 注解修饰的 Java 类</p><p>@SpringBootConfiguration：组合了 @Configuration 这个注解，也就是说明被 SpringBootApplication 所标识的 Java 类就是一个 Java 配置类</p><p>@EnableAutoConfiguration：打开自动装配的功能 --》META-INF/spring.factories 文件中加载需要自动注入的 Java 类</p><h3 id="介绍一下springboot的自动装配原理"><a class="anchor" href="#介绍一下springboot的自动装配原理">#</a> 介绍一下 SpringBoot 的自动装配原理</h3><p>在启动 SpringBoot 项目的 main 方法的头部有一个 @SpringBootApplication 注解，在这个注解中组合了一个 EnableAutoConfiguration 注解，这个注解的作用就是打开自动装配，而在这个注解中又包含了一个 @lmport 注解，在这个注解中引入了一个实现了 lmportSelector 接口的类型，在对应的 selectImports 方法中会读取<br>META/INF 目录下的 splring.factories 文件中需要被自动装配的所有的配置类，然后通过 META-INF 下面的 spring-autoconfigure-metadata.properties 文件做条件过滤。最后返回的就是需要自动装配的相关的对象。</p><h3 id="谈一下-starter-的理解"><a class="anchor" href="#谈一下-starter-的理解">#</a> 谈一下 Starter 的理解</h3><p>starter 的作用是在 META-INF 目录下提供了一个 spring.factories 文件，在该文件中我们添加了一个需要注入到 Spring 容器中的对应的配置类</p><p>第三方框架要整合到 SpringBoot 项目中，也就是需要吧第三方框架的核心组件注入到 Spring 容器中，提供的方式是 spring.factories 文件</p><p>starter 也可以理解为一个启动器</p><p>starter 命名规范：</p><p>官方：spring-boot-starter-xxx</p><p>非官方：xxx-spring-boot-starter</p><h3 id="springboot需要单独的web容器吗"><a class="anchor" href="#springboot需要单独的web容器吗">#</a> SpringBoot 需要单独的 web 容器吗</h3><p>可以不需要，也可以要</p><h3 id="springboot的启动方式"><a class="anchor" href="#springboot的启动方式">#</a> Springboot 的启动方式</h3><ol><li>直接通过 main 运行</li><li>打成 jar 包，通过 java 命令运行，或者打成 war 包，放到 web 容器中启动</li><li>使用 Maven 插件来运行</li></ol><h3 id="springboot如何解决跨域问题"><a class="anchor" href="#springboot如何解决跨域问题">#</a> SpringBoot 如何解决跨域问题</h3><ol><li>通过 JSONP 类解决跨域问题，但是只支持 Get 方式请求</li><li>通过 WebMVCConfigurer 重写里面的 addCorsMappings 方法添加对应的运行跨域的请求</li><li>注解 @Cors</li></ol><h3 id="springboot项目中如何使用log4j"><a class="anchor" href="#springboot项目中如何使用log4j">#</a> SpringBoot 项目中如何使用 Log4j</h3><p>在 SpringBoot 项目中默认提供了日志框架 Logback，所以我们如果需要引入 log4j 的话，必须先排查 Logback 的依赖，然后再添加 log4j 的依赖，然后在 src/main/resouces 目录下创建 log4j.properties 文件，然后就可以进行日志的相关的配置。|</p><p>注：这也要看版本 ，2.3.7 他就直接内置 log4j</p><h3 id="bootstrapyml文件作用"><a class="anchor" href="#bootstrapyml文件作用">#</a> bootstrap.yml 文件作用</h3><p>SpringBoot 中默认支持的属性文件有卜面 4 种</p><p>application.properties application.xml<br>application.yml aplication.yaml</p><p>那么为什么还有一类 bootstrap.yml bootstrap.properties 文件</p><p>bootstrap.yml 在 SpringBoot 中默认是不支持的，需要在 SpringCloud 环境下才支持，<mark>作用是在 SpringBoot 项目启动之前启动的一个父容器，该父容器可以在 SpringBoot 容器启动之前完成一些加载初始化的操作</mark>。比如加载配置中心中的信息。</p><h3 id="谈谈你的actuator理解"><a class="anchor" href="#谈谈你的actuator理解">#</a> 谈谈你的 Actuator 理解</h3><p>Actuator 是 SpringBoot 中提供的四大神器之一，在单体架构中用到的是非常少的，但是在分布式微服务架构下就给非常有用了</p><ol><li>如果有服务出现了故障，定位服务</li><li>对这个系统的性能作出监控</li><li>统一日志管理</li></ol><h1 id="springcloud"><a class="anchor" href="#springcloud">#</a> SpringCloud</h1><h3 id="1什么是springcloud"><a class="anchor" href="#1什么是springcloud">#</a> 1. 什么是 SpringCloud</h3><p>Spring cloud 流应用程序启动器是基于 Spring Boot 的 Spring 集成应用程序，提供与外部系统的集成。Spring cloud Task，一个生命周期短暂的微服务框架，用于快速构建执行有限数据处理的应用程序。</p><h3 id="2什么是微服务"><a class="anchor" href="#2什么是微服务">#</a> 2. 什么是微服务</h3><p>微服务架构是一种架构模式或者说是一种架构风格，它提倡将单一应用程序划分为一组小的服务，每个服务运行在其独立的自己的进程中，服务之间相互协调、互相配合，为用户提供最终价值。服务之间采用轻量级的通信机制互相沟通（通常是基于 HTTP 的 RESTful API), 每个服务都围绕着具体的业务进行构建，并且能够被独立的构建在生产环境、类生产环境等。另外，应避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建，可以有一个非常轻量级的集中式管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据存储。</p><h3 id="注册中心的核心概念"><a class="anchor" href="#注册中心的核心概念">#</a> 注册中心的核心概念？</h3><p>采用微服务以后，软件微服务组件各自独立，但最终还要组合为一个整体作为一个软件系统服务于最终客户，这时软件组件之间也需要彼此通讯，彼此调用方法。微服务架构内部发起通讯调用方法的一方成为 “<strong>服务消费者</strong>”，<strong>提供远程方法调用的服务器称为 “服务提供者”，往往为了提高系统性能</strong>，<strong>会提供多个服务器作为服务提供</strong>，为了帮助服务消费者快速的发现服务提供者，在微服务框架中都会引入注册中心。</p><p><strong>注册中心实现了服务提供和服务消费的快速撮合功能</strong>。</p><h3 id="为何使用注册中心呢"><a class="anchor" href="#为何使用注册中心呢">#</a> 为何使用注册中心呢？</h3><p>我们以入住酒店的前台为例子，稍微加以解释。先设想一个没有服务前台的酒店，客人入住需要自己寻找合适居住的房间，客人不知道每个房间的情况，无法确定那个房间是打扫干净可以入住，客人只能逐个房间寻找，如果遇到已经居住房客的房间一定很尴尬，显然这是不正常的情况。正常的情况是酒店会安排服务台，酒店打扫干净可以入住的房间会登记注册到服务台，这样客人来住店，只需要在前台就可以查找到可以入住的房间，这样就无需等待快速的入住。显然，服务器提供发注册和发现机制可以让房客快速找到合适的房间，快速解决入住问题。<img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220908174714109.png" title="image-20220908174714109"></p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220908174941263.png" title="image-20220908174941263"><h1 id="分布式事务"><a class="anchor" href="#分布式事务">#</a> 分布式事务</h1><h3 id="常见的负载均衡算法"><a class="anchor" href="#常见的负载均衡算法">#</a> 常见的负载均衡算法</h3><p>轮询，加权轮询，随机，最小链接，原地址散列</p><h3 id="分布式id有哪些生成方案"><a class="anchor" href="#分布式id有哪些生成方案">#</a> 分布式 ID 有哪些生成方案</h3><p>有 2 个问题：什么时候用？解决办法</p><ul><li>什么时候用分布式 ID</li></ul><p>唯一性。通过分布式 ID 确认业务</p><ul><li>解决方案</li></ul><p>UUID：本地生成，调用简单，没有高可用的风险，但是长度有点长，造成存储的冗余</p><p>数据库自增 ID：</p><p>提前批量生产</p><p>雪花算法</p><h3 id="幂等"><a class="anchor" href="#幂等">#</a> 幂等</h3><h1 id="分布式锁"><a class="anchor" href="#分布式锁">#</a> 分布式锁</h1><p><mark>set 命令格式</mark>：SET key value [EX seconds] [PX milliseconds] [NX|XX]</p><ul><li><code>EX seconds</code> − 设置指定的到期时间 (以秒为单位)。</li><li><code>PX milliseconds</code> - 设置指定的到期时间 (以毫秒为单位)。</li><li><code>NX</code> - 仅在键不存在时设置键。</li><li><code>XX</code> - 只有在键已存在时才设置。</li></ul><p>== 使用这个：==SetNX （set if not exits）key value ex 100</p><h3 id="未完成-9"><a class="anchor" href="#未完成-9">#</a> —————————— 未完成</h3><h1 id="redis"><a class="anchor" href="#redis">#</a> Redis</h1><h3 id="数据结构"><a class="anchor" href="#数据结构">#</a> 数据结构</h3><h4 id="1-string-key-value-类型"><a class="anchor" href="#1-string-key-value-类型">#</a> 1、string (key-value 类型)</h4><p>相比于 C 的原生字符串，Redis 的 SDS 不光可以保存文本数据还可以保存二进制数据，并且获取字符串长度复杂度为 O (1)（C 字符串为 O (N)）, 除此之外，Redis 的 SDS API 是安全的，不会造成缓冲区溢出。</p><ol><li><strong>常用命令:</strong> <code>set,get,strlen,exists,dect,incr,setex</code> 等等。</li><li><strong>应用场景</strong> ：一般常用在需要计数的场景，比如用户的访问次数、热点文章的点赞转发数量等等。</li></ol><p><strong>普通字符串的基本操作：</strong></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> key value <span class="token comment">#设置 key-value 类型的值</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key <span class="token comment"># 根据 key 获得对应的 value</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">"value"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> exists key  <span class="token comment"># 判断某个 key 是否存在</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> strlen key <span class="token comment"># 返回 key 所储存的字符串值的长度。</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> del key <span class="token comment"># 删除某个 key 对应的值</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">(</span>nil<span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>批量设置</strong> :</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> mset key1 value1 key2 value2 <span class="token comment"># 批量设置 key-value 类型的值</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> mget key1 key2 <span class="token comment"># 批量获取多个 key 对应的 value</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value1"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr></table></figure><p><strong>计数器（字符串的内容为整数的时候可以使用）：</strong></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> number <span class="token number">1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> incr number <span class="token comment"># 将 key 中储存的数字值增一</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get number</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token string">"2"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> decr number <span class="token comment"># 将 key 中储存的数字值减一</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get number</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token string">"1"</span></pre></td></tr></table></figure><p><strong>过期</strong>：</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> expire key  <span class="token number">60</span> <span class="token comment"># 数据在 60s 后过期</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> setex key <span class="token number">60</span> value <span class="token comment"># 数据在 60s 后过期 (setex:[set] + [ex] pire)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>OK</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl key <span class="token comment"># 查看数据还有多久过期</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">56</span></pre></td></tr></table></figure><h4 id="2-list"><a class="anchor" href="#2-list">#</a> 2、list</h4><p>​	特点是易于数据元素的插入和删除并且且可以灵活调整链表长度，但是链表的随机访问困难。 <strong>双向链表</strong>，即可以支持反向查找和遍历，更方便操作，不过带来了部分额外的内存开销）</p><ol><li><strong>常用命令:</strong> <code>rpush,lpop,lpush,rpop,lrange、llen</code> 等。</li><li><strong>应用场景:</strong> 发布与订阅或者说消息队列、慢查询。</li></ol><p><strong>通过 <code>rpush/lpop</code> 实现队列：</strong></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush myList value1 <span class="token comment"># 向 list 的头部（右边）添加元素</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush myList value2 value3 <span class="token comment"># 向 list 的头部（最右边）添加多个元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpop myList <span class="token comment"># 将 list 的尾部 (最左边) 元素取出</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token string">"value1"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange myList <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># 查看对应下标的 list 列表， 0 为 start,1 为 end</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value3"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange myList <span class="token number">0</span> <span class="token parameter variable">-1</span> <span class="token comment"># 查看列表中的所有元素，-1 表示倒数第一</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value3"</span></pre></td></tr></table></figure><p><strong>通过 <code>rpush/rpop</code> 实现栈：</strong></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush myList2 value1 value2 value3</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpop myList2 <span class="token comment"># 将 list 的头部 (最右边) 元素取出</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">"value3"</span></pre></td></tr></table></figure><p><strong>通过 <code>lrange</code> 查看对应下标范围的列表元素：</strong></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush myList value1 value2 value3</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange myList <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># 查看对应下标的 list 列表， 0 为 start,1 为 end</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value1"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange myList <span class="token number">0</span> <span class="token parameter variable">-1</span> <span class="token comment"># 查看列表中的所有元素，-1 表示倒数第一</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value1"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"value3"</span></pre></td></tr></table></figure><p>通过 <code>lrange</code> 命令，你可以基于 list 实现分页查询，性能非常高！</p><p><strong>通过 <code>llen</code> 查看链表长度：</strong></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> llen myList</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr></table></figure><h4 id="3-hash"><a class="anchor" href="#3-hash">#</a> 3、hash</h4><p>​	hash 类似于 JDK1.8 前的 HashMap，内部实现也差不多 (数组 + 链表)。不过，Redis 的 hash 做了更多优化。另外，hash 是一个 string 类型的 field 和 value 的映射表，<strong>特别适合用于存储对象，后续操作的时候，你可以直接仅仅修改这个对象中的某个字段的值</strong>。 比如我们可以 hash 数据结构来存储用户信息，商品信息等等。</p><ol><li><strong>常用命令：</strong> <code>hset,hmset,hexists,hget,hgetall,hkeys,hvals</code> 等。</li><li><strong>应用场景:</strong> 系统中对象数据的存储。</li></ol><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hset userInfoKey name <span class="token string">"guide"</span> description <span class="token string">"dev"</span> age <span class="token string">"24"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hexists userInfoKey name <span class="token comment"># 查看 key 对应的 value 中指定的字段是否存在。</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hget userInfoKey name <span class="token comment"># 获取存储在哈希表中指定字段的值。</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token string">"guide"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hget userInfoKey age</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token string">"24"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hgetall userInfoKey <span class="token comment"># 获取在哈希表中指定 key 的所有字段和值</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"guide"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"description"</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"dev"</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"age"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"24"</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hkeys userInfoKey <span class="token comment"># 获取 key 列表</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"description"</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age"</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hvals userInfoKey <span class="token comment"># 获取 value 列表</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"guide"</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"dev"</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"24"</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hset userInfoKey name <span class="token string">"GuideGeGe"</span> <span class="token comment"># 修改某个字段对应的值</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hget userInfoKey name</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token string">"GuideGeGe"</span></pre></td></tr></table></figure><h4 id="4-set"><a class="anchor" href="#4-set">#</a> 4、set</h4><pre><code>set 类似于 Java 中的 HashSet 。Redis 中的 set 类型是一种**无序集合**，集合中的元素没有先后顺序。当你需要存储一个列表数据，又**不希望出现重复数据**时，set 是一个很好的选择，并且 **set 提供了判断某个成员是否在一个 set 集合内的重要接口，这个也是 list 所不能提供的**。可以基于 set 轻易实现交集、并集、差集的操作。比如：你可以将一个用户所有的关注人存在一个集合中，将其所有粉丝存在一个集合。Redis 可以非常方便的实现如共同关注、共同粉丝、共同喜好等功能。这个过程也就是求交集的过程。
</code></pre><ol><li><strong>常用命令：</strong> <code>sadd,spop,smembers,sismember,scard,sinterstore,sunion</code> 等。</li><li><strong>应用场景:</strong> 需要存放的数据不能重复以及需要获取多个数据源交集和并集等场景</li></ol><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd mySet value1 value2 <span class="token comment"># 添加元素进去</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd mySet value1 <span class="token comment"># 不允许有重复元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> smembers mySet <span class="token comment"># 查看 set 中所有的元素</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value1"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> scard mySet <span class="token comment"># 查看 set 的长度</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sismember mySet value1 <span class="token comment"># 检查某个元素是否存在 set 中，只能接收单个元素</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd mySet2 value2 value3</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sinterstore mySet3 mySet mySet2 <span class="token comment"># 获取 mySet 和 mySet2 的交集并存放在 mySet3 中</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> smembers mySet3</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr></table></figure><h4 id="5-sorted-set也叫zset"><a class="anchor" href="#5-sorted-set也叫zset">#</a> 5、sorted set (也叫 zset)</h4><p>​	和 set 相比，sorted set 增加了一个权重参数 score，使得集合中的元素能够按 score 进行有序排列，还可以通过 score 的范围来获取元素的列表。有点像是 Java 中 HashMap 和 TreeSet 的结合体。</p><ol><li><strong>常用命令：</strong> <code>zadd,zcard,zscore,zrange,zrevrange,zrem</code> 等。</li><li><strong>应用场景：</strong> 需要对数据根据某个权重进行排序的场景。比如在直播系统中，实时排行信息包含直播间在线用户列表，各种礼物排行榜，弹幕消息（可以理解为按消息维度的消息排行榜）等信息。</li></ol><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NTQ1NzEzL2FydGljbGUvZGV0YWlscy8xMDU0Mzk2ODg=">https://blog.csdn.net/qq_38545713/article/details/105439688</span></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd myZset <span class="token number">3.0</span> value1 <span class="token comment"># 添加元素到 sorted set 中 3.0 为权重</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd myZset <span class="token number">2.0</span> value2 <span class="token number">1.0</span> value3 <span class="token comment"># 一次添加多个元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zcard myZset <span class="token comment"># 查看 sorted set 中的元素数量</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zscore myZset value1 <span class="token comment"># 查看某个 value 的权重</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token string">"3"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrange  myZset <span class="token number">0</span> <span class="token parameter variable">-1</span> <span class="token comment"># 顺序输出某个范围区间的元素，0 -1 表示输出所有元素</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value3"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"value1"</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrange  myZset <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># 顺序输出某个范围区间的元素，0 为 start  1 为 stop</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value3"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrevrange  myZset <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># 逆序输出某个范围区间的元素，0 为 start  1 为 stop</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value1"</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"value2"</span></pre></td></tr></table></figure><h3 id="redis-是多线程还是单线程"><a class="anchor" href="#redis-是多线程还是单线程">#</a> redis 是多线程还是单线程</h3><p>​	通常说的 Redis 是单线程，主要是指 Redis 对外提供键值存储服务的主要流程，即网络 IO 和键值对读写是由⼀个线程来完成的。除此外 Redis 的其他功能，比如持久化、 异步删除、集群数据同步等，是由额外的线程执⾏的。在这一点上 Node 也是一样的，一般提到 Node 也是单线程的，但其实 Node 只有一个主线程是单线程，其他异步任务则由其他线程完成。这样做的原因是防止有同步代码阻塞，导致主线程被占用后影响后续的程序代码执行。</p><p>​	因此，严格地说 Redis 并不是单线程。但是我们⼀般把 Redis 称为单线程高性能，这样显得 Redis 更强一些。</p><p>​	这里需要注意一个问题，我们所说的 Redis 的单线程，不是指 Redis 程序真的只会有一个线程。这里所说的单线程，指的是 Redis 处理客户端发来的数据操作请求（增删改查），只会使用一个线程去执行。但是实际上，Redis 在执行其他操作的时候，可能会开启多个进程或线程，比如说持久化。Redis 执行 BGSAVE 指令，进行快照持久化时，就会 fork 出一个子进程，然后子进程去创建快照，完成持久化操作。</p><h3 id="为什么redis使用单线程"><a class="anchor" href="#为什么redis使用单线程">#</a> <strong>为什么 Redis 使用单线程？</strong></h3><p>​	官方解释如下：因为 Redis 是基于内存的操作，CPU 不是 Redis 的瓶颈，Redis 的瓶颈最有可能是机器内存的大小或者网络带宽。既然单线程容易实现，而且 CPU 不会成为瓶颈，那就顺理成章地采用单线程的方案了。</p><p>​	上面的解释不是很好理解，我就简单说一说我自己的理解吧。我们知道，Redis 将数据存放在内存当中，这也就意味着，Redis 在操作数据时，不需要进行磁盘 I/O。磁盘 I/O 是一个比较耗时的操作，所以对于需要进行磁盘 I/O 的程序，我们可以使用多线程，在某个线程进行 I/O 时，CPU 切换到当前程序的其他线程执行，以此减少 CPU 的等待时间。而 Redis 直接操作内存中的数据，所以使用多线程并不能有效提升效率，相反，使用多线程反倒会因为需要进行线程的切换而降低效率。</p><p>​	除此之外，使用多线程的话，多个线程间进行同步，保证线程的安全，也是需要开销的。尤其是 Redis 的数据结构都是一些实现较为简单的集合结构，若使用多线程，将会频繁地发生线程冲突，线程的竞争频率较高，反倒会拖慢 Redis 的响应速度。</p><p>​	综上所述，Redis 为了保持简单和高效，自然而然地就使用了单线程。</p><h3 id="redis如何提高cpu使用率"><a class="anchor" href="#redis如何提高cpu使用率">#</a> <strong>Redis 如何提高 CPU 使用率</strong></h3><p>​	前面也提过，现在的 CPU 一般都有多个核心，每个核心可以单独执行。Redis 处理客户端请求使用单线程，那么自然而然，无法将 CPU 的所有核心都占用，也就造成了资源的浪费。而解决的方式也比较简单，我们可以在同一个服务器上开启多个 Redis 程序，每个 Redis 程序使用不同的端口，相互独立，以此提高 CPU 的使用率。而这多个 Redis 程序可以配置成主从节点，共同为一个程序服务，也可以相互独立，服务于多个程序。</p><h3 id="未完成-10"><a class="anchor" href="#未完成-10">#</a> 未完成</h3><h1 id="设计模式"><a class="anchor" href="#设计模式">#</a> 设计模式</h1><h3 id="说一说程序的设计原则和设计模式"><a class="anchor" href="#说一说程序的设计原则和设计模式">#</a> 说一说程序的设计原则和设计模式</h3><h4 id="设计原则"><a class="anchor" href="#设计原则">#</a> 设计原则</h4><p>程序设计的要遵循的一些理论，也可以理解为程序设计的一种要求和目标，是面向对象程序设计的基石，也是面向对象程序设计的质量保障和依据</p><h3 id="11单一职责原则"><a class="anchor" href="#11单一职责原则">#</a> 1.1 单一职责原则</h3><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps2.jpg" title="img"><p><strong>解释</strong>:</p><p>单一职责 SRP--Single Responsibility Principle</p><p>应该有且仅有一个原因引起类的变更</p><p>1<mark> 系统中的每个类都应该只有一个职</mark>责，而所有类所关注的就是自身之职责的完成</p><p>2 职责是指为” 变化的原因”</p><p>3 如果能想到多个原因去改变一个类，这个类就是多个职责</p><p>4 并不是单一功能原则，并不是每个类只能有一个方法，而是单一” 变化的愿意” 原则</p><p>5 如果一个类有多个职责，这些职责就耦合在了一起，当一个职责发生变化时，可能会影响其他职责</p><p>6 多个职责耦合在一起，会影响服用性 (可能只需要服用该类的某一个功能，但是该职责和其他职责耦合在一起，很难分离出来)</p><p>其实就是我们常说的高内聚低耦合原则，. 单一职责原则是最简单也非常难实现的原则</p><p><strong>好处</strong></p><p>将功能分类，模块划分明确，修改一个模块不会造成其他模块的修改，降低模块之间的耦合度</p><p><strong>举例</strong>:</p><p>​	MVC 模式下，无论是 Controller 层还是 service 亦或是 DAO 层，针对每个表格都有独立的实现类，不要掺杂在一起，以免因为任何一个操作的变化都引起类的修改</p><p><strong>图解</strong>:</p><p>饭店老板 既当厨师，又当服务员，这不合适</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps3.jpg" title="img"><h3 id="12开闭原则"><a class="anchor" href="#12开闭原则">#</a> 1.2 开闭原则</h3><p><strong>解释</strong></p><p>开闭原则 OCP--- Open Closed Principle</p><p>软件实体应该<mark>对功能的拓展开放，对修改关闭的原则</mark>，因为需求有变化，要求我们设计程序时必须为程序功能的新增留好接口，在新增功能时，不要修改原有代码，而是新增代码。让程序实现对拓展开放，对修改关闭测设计要求</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps4.jpg" title="img"><p>薛定谔的猫理论，用户需求不确定理论</p><p>1 实现开闭原则的关键是抽象</p><p>2 定义一个抽象层，之规定功能而不提供实现，实现通过定义具体的类来完成</p><p>3 当需求变化时，不通过修改抽象层来完成，而是通过定义抽象层的新实现完成</p><p>4 通过抽象类及接口，规定了具体的类的特征作为抽象层，相对稳定，不需要修改，从而满足对修改关闭，从抽象类到处的具体类可以作为改变系统的行为，从而满足对扩展开放</p><p><strong>好处</strong></p><p>1 通过扩展已有软件系统，可以提供新的行为，以满足对软件新的需求，提高了软件系统的适应性和灵活性</p><p>2 已有的软件模块，特别是重要的抽象层模块不能再修改，提高了软件系统的一定的稳定性和延续性</p><p>3 这样的设计同时也满足了可复用性和可维护性</p><p><strong>举例</strong></p><p>​	MVC 模式下，每一层都有接口，是和其他层对接的规范，新增功能时，我们可以选择新增 Controller 层和 service 层和 mapper 层代码 不用去修改原有代码</p><p><strong>图解</strong></p><p>每一个层次的要求都要留好接口，作为规范，增加功能就相当于多了一个实现类去实现接口，而不是在先有代码上修改，工厂方法模式</p><h3 id="13里氏代换原则"><a class="anchor" href="#13里氏代换原则">#</a> 1.3 里氏代换原则</h3><p><strong>解释</strong></p><p>里氏代换原则 LSP------ Liskov Substitution Principle</p><p>所有引用的基类的地方必须能够透明的使用其子类的对象</p><p>凡是父类出现的地方，其子类就可以出现，而且调用子类还不能产生多于父类的错误和异常，调用者根本就不要需要知道是子类还是父类对象。但是反过来就不行，子类出现的地方父类未必就能使用</p><p>1<mark> 子类必须完全实现了父类的方法，具备父类完全的功能</mark></p><p>2 子类可以有自己的特征</p><p>3 覆盖和实现父类方法时，输入的参数可以被放大，但是不能被缩小</p><p>4 覆盖和实现父类方法时，输出的结果可以被缩小，但是不能被放大</p><p>5 覆盖和实现父类方法时，产生的异常可以被缩小，但是不能被放大</p><p><strong>好处</strong>:</p><p>为我们如何实现良好的继承和使用多态提供了依据，也是实现开闭原则的重要保证</p><p><strong>举例</strong>:</p><p>白马 马也</p><p>乘白马 乘马也</p><p>黑马 马也</p><p>乘黑马 乘马也</p><p>乘的是马 什么颜色的马都是马</p><p>马 是父类 各种颜色的马是子类 要求的是父类，所有的子类对象都可以使用</p><p>娣 美人也 爱娣 非爱美人也</p><p>美人 父类 娣 子类 要求是子类的地方，父类不一定能够出现</p><p>父类作为方法参数和返回值，可以让参数更灵活</p><p>张三能开车</p><p>张三就能开奥迪</p><p>张三就能开奔驰</p><p>张三就能开宝马</p><p><strong>图解</strong>:</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps5.jpg" title="img"><h3 id="14依赖倒置原则"><a class="anchor" href="#14依赖倒置原则">#</a> 1.4 依赖倒置原则</h3><p><strong>解释</strong></p><p>依赖倒置 DIP--Dependence Inversion Principle</p><p><mark>高层模块不应该依赖底层模块，两者都应该依赖抽象 (简单来说就是面向接口编程)</mark>, 抽象不应该依赖细节，细节应该依赖抽象</p><p>抽象：即是抽象类或者接口，两者是不能够实例化的</p><p>细节：即是具体的嫌累，实现接口或者继承抽象类的类</p><p>依赖正置就是类之间的依赖是实实在在的实现类之间的依赖，也就是面向实现编程</p><p>依赖倒置就是通过抽象 (抽象类或者接口), 使各个模块之间实现彼此独立，不相互应影响</p><p>依赖倒置有三种方式实现</p><p>1 构造函数传递依赖对象</p><p>2setter 方法实现</p><p>3 接口声明实现依赖对象 () 匿名内部类</p><p>依赖倒置原则要求</p><p>1 每个类尽量都有接口和抽象类，或者抽象类和接口都有</p><p>2 变量的表面类型应是接口和抽象类</p><p>3 任何类都不应该从具体派生 (尽量避免继承，做二次开发时，无法获得高层代码时除外)</p><p>4 尽量不要覆盖基类已经实现好的方法 (尽量不要重写父类方法)</p><p><strong>好处</strong>:</p><p>采用依赖倒置原则可以降低模块之间的耦合性，提高系统的稳定性，减少并行开发的风险，提高代码的可读性和可维护性</p><p><strong>举例</strong>:</p><p>一个类组合另一个类作为属性时，应尽量选择抽象类或者是接口，尽量避免直接组合实现类</p><p>电脑里的零件坏了，如硬盘，内存，CPU 等，那么直接更换对应的配件，只要插槽一样就能互换，维护比较方便。插槽就是接口，具体的硬件就是实现类。留好接口可以随时换零件，如果零件直接焊死在电脑上，坏了就没有办法更换了</p><p><strong>图解</strong>:</p><p>抽象的 Driver 接口和抽象的 Car 接口 实现司机开车功能</p><h3 id="15接口隔离原则"><a class="anchor" href="#15接口隔离原则">#</a> 1.5 接口隔离原则</h3><p><strong>解释</strong></p><p>接口隔离原则 ISP Interface Segregation Principle</p><p>客户端不应该强行依赖他不需要的接口，类之间的依赖关系应该建立在最小的接口上，建立单一接口，不要建立庞大臃肿的接口，应该尽量细化接口，<mark> 接口的方法尽量少</mark>，也就是说要为各个类建立专门的接口，而不要试图去建立一个庞大的接口供所有的依赖它的类去调用</p><p>接口隔离原则使用的一些规范</p><p>1 接口尽量小，尽量细致</p><p>2 接口尽量高内聚，尽量和其他接口撇清关系</p><p>3 定制服务，为调用者提供且之提供他需要的方法</p><p>4 接口设计有限度，根据业务及经验，仔细四高筹划，适度隔离接口</p><p>单一职责和接口隔离辨析</p><p>1 单一职责原则侧重职责，接口隔离侧重对接口的依赖的隔离</p><p>2 单一职责原则侧重约束类，其次是接口，针对程序中实现的细节</p><p>3 接口隔离原则侧重约束接口，主要针对抽象需求，针对程序的整体框架的构建</p><p><strong>好处</strong>:</p><p>防止庞大，臃肿的接口，避免接口污染，提高程序设计要求的细致划分性，降低大面积维护成本。一旦出现接口污染，会造成实现类中存在大量的不相关不需要去重写的方法</p><p><strong>举例</strong>:</p><p>演员和角色以及整部戏的关系</p><p><strong>图解</strong>:</p><p>不满足接口隔离原则的情况</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps6.jpg" title="img"><p>满足接口隔离原则的情况</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps7.jpg" title="img"><h3 id="16迪米特法则"><a class="anchor" href="#16迪米特法则">#</a> 1.6 迪米特法则</h3><p><mark>最小知道原则</mark></p><p><strong>解释</strong></p><p>迪米特法则 LOD--Law of Demeter</p><p>只与你只直接的朋友通信，不要和不相关的人产生大量通信，如果两个类不必彼此通信，那么两个类就不应到发生直接的相互作用，如果其中的一个类需要调用另一个类的方法的话，可以通过第三者转发这个调用</p><p>迪米特法则的初衷是在于降低类之间的耦合。但是迪米特法则有可能造成一个后果就是程序中存在大量的中介类，这些中介类完全就是为了传递类间的相互调用关系，一定程度上增加了系统的复杂度</p><p><strong>好处</strong>:</p><p>降低了类和类之间的耦合</p><p><strong>举例</strong>:</p><p>找中介卖房子，不用我们自己直接接触大量的买房人员</p><p><strong>图解</strong>:</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps8.jpg" title="img"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/wps9.jpg" title="img"><h3 id="具体的设计模式"><a class="anchor" href="#具体的设计模式">#</a> 具体的设计模式</h3><ul><li><p>创建型模式</p></li><li><p>结构性模式</p></li><li><p>行为型模式</p></li></ul><h3 id="谈谈你对单列模式的理解"><a class="anchor" href="#谈谈你对单列模式的理解">#</a> 谈谈你对单列模式的理解</h3><ol><li><p>单例模式的核心：要保证一个了只有一个对象在当前容器中，而且需要保证提供一个实例全局访问方法</p></li><li><p>实现单例的方式：饿汉式，懒汉式，枚举（官方推荐）</p></li></ol><h3 id="谈谈你对简单工厂模式理解"><a class="anchor" href="#谈谈你对简单工厂模式理解">#</a> 谈谈你对简单工厂模式理解</h3><p>简单工厂又称为：静态工厂</p><h3 id="谈谈你对简单工厂模式的理解"><a class="anchor" href="#谈谈你对简单工厂模式的理解">#</a> 谈谈你对简单工厂模式的理解</h3><h3 id="谈谈你对工厂方法模式的理解"><a class="anchor" href="#谈谈你对工厂方法模式的理解">#</a> 谈谈你对工厂方法模式的理解</h3><h3 id="谈谈你对代理模式的理解"><a class="anchor" href="#谈谈你对代理模式的理解">#</a> 谈谈你对代理模式的理解</h3><h3 id="谈谈你对模板模式的理解"><a class="anchor" href="#谈谈你对模板模式的理解">#</a> 谈谈你对模板模式的理解</h3><h3 id="谈谈你对观察者模式的理解"><a class="anchor" href="#谈谈你对观察者模式的理解">#</a> 谈谈你对观察者模式的理解</h3><h3 id="谈谈你对装饰器模式的理解"><a class="anchor" href="#谈谈你对装饰器模式的理解">#</a> 谈谈你对装饰器模式的理解</h3><h3 id="谈谈你对策略模式的理解"><a class="anchor" href="#谈谈你对策略模式的理解">#</a> 谈谈你对策略模式的理解</h3><h3 id="谈谈你对适配器模式的理解"><a class="anchor" href="#谈谈你对适配器模式的理解">#</a> 谈谈你对适配器模式的理解</h3><h3 id="未完成-11"><a class="anchor" href="#未完成-11">#</a> 未完成</h3><h1 id="计算机网络"><a class="anchor" href="#计算机网络">#</a> 计算机网络</h1><h3 id="子网掩码的应用"><a class="anchor" href="#子网掩码的应用">#</a> 子网掩码的应用</h3><p>假如有两台计算机的 IP 地址分别为：192.168.1.100 和 192.168.2.101，假如使用一根网线直接连接这两台计算机。并且希望这两台计算机能够相互进行网络通信，该怎么办？</p><p>答案：将两台计算的的子网掩码设置为：255.255.0.0</p><h3 id="简述-tcp-和udp-的区别"><a class="anchor" href="#简述-tcp-和udp-的区别">#</a> 简述 TCP 和 UDP 的区别</h3><img data-src="../../../../../../面试/面试题/面试题_img/image-20220909160022359.png" alt="image-20220909160022359" style="zoom:150%"> <img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220927153953885.png" title="image-20220927153953885"><p>除了上图所展示的区别外，使用 TCP 传输协议时，一旦建立好 TCP 连接后，系统需要实时的维护该连接，所以 TCP 所消耗的系统资源比 UDP 要多。</p><p>另外因为 TCP 的可靠性传输机制导致 TCP 传输数据时比 UDP 要慢的多。</p><h3 id="三次挥手"><a class="anchor" href="#三次挥手">#</a> 三次挥手</h3><p>由客户端的某个进程主动发起 TCP 连接建立，最初两端的 TCP 进程都处于关闭状态</p><p>TCP 服务器被动等待客户进程的 TCP 请求，所以 TCP 服务器进入监听状态</p><p>TCP 客户进程向 TCP 服务器进程发送 TCP 建接请求报文段，并且进入同步已发送状态</p><p>TCP 连接请求报文段首部中的同步位 SYN 被设置为 1，表明这是一个 TCP 连接请求报文段，32 位序列号字段 seq 被设置了一个初始值 x，作为 TCP 客户进程所选择的初始序号。</p><p>TCP 服务器进程接收到 TCP 连接请求报文段后，如果同意建立连接，则向 TCP 客户进程发送 TCP 连接请求确认报文段，并且进入同步已接收状态，该报文段首部中的同步位 SYN 和确认位 ACK 都设置为 1，表明这是一个</p><p>TCP 连接请求确认报文段。序号字段 seq 被设置了一个初始值 y，作为 TCP 服务器进进程选择的初始序号，确认号字段 ack 的值被设置成 x+1，表明接收到了 TCP 客户进程序号为 x 的报文。</p><p>TCP 客户进程收到 TCP 连接请求确认报文段后，还要向 TCP 服务器进程发送一个普通的 TCP 确认报文段，并且进入连接已建立状态，报文段首部中的<strong>确认位 ACK 设置为 1</strong>，表明这是一个普通的 TCP 确认报文段。序列号字段<strong> seq 设置为 x+1</strong>，确认号字段<strong> ack 的值被设置成 y+1</strong>，表明接收到了 TCP 服务进程序号为 y 的报文，TCP 服务器进程收到该确认报文段后也进入<strong>连接已建立状态</strong>。</p><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220909161710369.png" title="image-20220909161710369"><h3 id="四次挥手"><a class="anchor" href="#四次挥手">#</a> 四次挥手</h3><p>四次挥手过程：TCP 通过四次挥手来释放连接，数据通信结束后，TCP 双方都可以释放连接</p><ul><li>假设由客户进程主动关闭 TCP 连接</li><li><strong>客户进程发送连接释放报文段</strong>，并且进入<strong>终止等待 1 状态</strong>，该报文段中的首部终止位 FIN 设置位 1，ACK 设置为 1，表明这是一个连接释放报文段，同时也对之前接收打报文段进行确认，seq=u 表示 TCP 客户进程之前已发送过的数据的最后一个字节的序号 + 1，ack=v 表示客户进程之前已收到的数据的最后一个字节的序号 + 1</li><li>服务器进程接收到 TCP 连接释放报文段后，会<strong>发送一个普通的 TCP 确认报文段并且进入关闭等待状态</strong>，此时 TCP 客户进程到服务器进程这个方向的连接就释放了，这时的 TCP 连接属于半关闭状态，也就是 TCP 客户进程已经没有数据要发送了，但是 TCP 服务器进程如果还有数据需要发送，客户进程则还需要接收，这个状态可能会持续一段时间，直到 TCP 服务器进程将数据发送完毕。</li><li><strong>TCP 客户</strong>进程收到 TCP 确认报文段后就进入<strong>终止等待 2 状态</strong>，等待 TCP 服务器进程发出的 TCP 连接释放报文段。</li><li>当 TCP 服务器进程的没有数据要发送了后，释放连接（被动关闭)，<strong>TCP 服务器进程发送 TCP 连接释放报文段并进入最后确认状态</strong>。FIN=1，ACK=1 表明这是一个连接释放报文段，seq=w, ack=u+1 同时也对之前收到的报文段进行确认。思考：为什么 seq=w，而不是 seq=v+1 呢？</li><li>TCP 客户进程收到 TCP 连接释放报文段后，必须针对该报文段发送普通的 TCP 确认报文段，之后进入时间等待状态</li><li>TCP 服务器进程收到该报文段后就进入关闭状态</li><li>而 TCP 客户进程还需要经过<strong> 2MSL</strong> 后才能进入关闭状态。MSL (Maximum Segment Lifetime) 意思是最<strong>长报文段寿命，RFC793 建议为 2 分钟。</strong></li></ul><img data-src="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220909162429440.png" title="image-20220909162429440"><h1 id="未完成-12"><a class="anchor" href="#未完成-12">#</a> ———————————— 未完成</h1><p>mavencatch 只有一种数据结构 String</p><p>String 的 AOP 实现</p><p>String 和 Springboot 和 SpringMVC 的区别</p><p>Spring 中事务是如何回滚</p><p>mybatis 三级缓存</p><p>线程的状态</p><p>主键 he 唯一索引的区别</p><p>索引的数据结构</p><p>最左原则，联合索引</p><p>mysql 数据隔离级别</p><p>乐观锁和悲观锁</p><p>redis 实现分布式锁</p><p>分布式锁</p><p>redis 中 key 的删除</p><p>缓存击穿、缓存雪崩、缓存穿透</p><p>ereak 和 zookeeper 的区别</p><p>fix 远程 api 调用</p><p>jvm</p><h1 id="字体配色"><a class="anchor" href="#字体配色">#</a> 字体配色</h1><p><font color="red">红色</font></p><div style="background-color:gold">底色为橙色</div><p>什么是存储过程，他的作用是啥</p><p>载荷因子为什么是 0.75</p><p>什么是缓存击穿、缓存穿透、缓存雪崩？</p><div id="gitalk-container"></div><script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalkConfig={clientID:"6db178ba46c8af8f6a6f",clientSecret:"90f730e5956024596558df00975cd8eae28cae3d",repo:"bk-comment01",owner:"onlymarryu",admin:["onlymarryu"],distractionFreeMode:!1,language:"zh-CN",proxy:"https://gitalk-comments.netlify.app/github_access_token",perPage:15};gitalkConfig.id=md5(location.pathname);var gitalk=new Gitalk(gitalkConfig);gitalk.render("gitalk-container")</script><div class="tags"><a href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag"><i class="ic i-tag"></i> 面试</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-01-16 21:06:21" itemprop="dateModified" datetime="2023-01-16T21:06:21+08:00">2023-01-16</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="雾都 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="雾都 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="雾都 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>雾都 <i class="ic i-at"><em>@</em></i>每天进步一点点，就是成功的开始</li><li class="link"><strong>本文链接：</strong> <a href="https://eth168.top/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="面试题">https://eth168.top/interview/面试题/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></div></article></div><div class="post-nav"><div class="item left"><a href="/interview/JavaSE%E2%80%94%E5%A4%9A%E7%BA%BF%E7%A8%8B/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?667224" title="多线程"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 面试</span><h3>多线程</h3></a></div><div class="item right"><a href="/interview/JavaSE%E2%80%94%E9%9B%86%E5%90%88/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?801459" title="集合"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 面试</span><h3>集合</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#javase%E5%9F%BA%E7%A1%80%E4%B8%8D%E5%90%AB%E9%9B%86%E5%90%88%E4%B9%8B%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">1.</span> <span class="toc-text">javaSE 基础 (不含集合之后的内容)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAjava%E5%AF%B9%E8%B1%A1%E6%96%B9%E5%BC%8F"><span class="toc-number">1.0.1.</span> <span class="toc-text">创建 JAVA 对象方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#new%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%86%85%E5%90%AB%E4%BB%A3%E7%A0%81%E5%9D%97"><span class="toc-number">1.0.2.</span> <span class="toc-text">new 一个对象的顺序 (内含代码块)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E5%85%B3%E9%94%AE%E5%AD%97%E4%BD%9C%E7%94%A8%E5%8C%BA%E9%97%B4%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.0.3.</span> <span class="toc-text">JAVA 有哪几种关键字，作用区间是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#overload-%E5%92%8C-override%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.4.</span> <span class="toc-text">OverLoad 和 Override 区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E8%BF%B0%E4%B8%80%E4%B8%8Bjava%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%89%B9%E5%BE%81%E7%BB%A7%E6%89%BF-%E5%B0%81%E8%A3%85%E4%B8%8E%E5%A4%9A%E6%80%81%E4%BB%A5%E5%8F%8A%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.0.5.</span> <span class="toc-text">简述一下 Java 面向对象的基本特征，继承、封装与多态，以及你自己的应用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#this%E5%92%8Csuper"><span class="toc-number">1.0.6.</span> <span class="toc-text">this 和 super</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E6%A0%B7%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E7%B1%BB%E4%B8%8D%E4%BC%9A%E8%A2%AB%E7%BB%A7%E6%89%BF%E4%BB%80%E4%B9%88%E5%9C%BA%E6%99%AF%E4%B8%8B%E4%BC%9A%E7%94%A8"><span class="toc-number">1.0.7.</span> <span class="toc-text">怎样声明一个类不会被继承，什么场景下会用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E6%98%AF%E4%BB%80%E4%B9%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AF%AD%E8%A8%80"><span class="toc-number">1.0.8.</span> <span class="toc-text">java 是什么类型的语言？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AF%AD%E8%A8%80"><span class="toc-number">1.0.8.1.</span> <span class="toc-text">面向对象语言：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#final-%E5%92%8C-static-%E5%9C%A8java%E4%B8%AD%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">1.0.9.</span> <span class="toc-text">final 和 static 在 JAVA 中的意义？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E6%8B%B7%E8%B4%9D"><span class="toc-number">1.0.10.</span> <span class="toc-text">JAVA 中的对象拷贝？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.0.11.</span> <span class="toc-text">什么是接口？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E7%B1%BB%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.12.</span> <span class="toc-text">接口和抽象类的区别：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">1.0.13.</span> <span class="toc-text">什么是内部类？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.0.14.</span> <span class="toc-text">JAVA 中的基本数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arraylist%E6%98%AF%E7%94%A8%E6%9D%A5%E5%B9%B2%E5%98%9B%E7%9A%84"><span class="toc-number">1.0.15.</span> <span class="toc-text">ArrayList 是用来干嘛的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#try-catch-finally-return"><span class="toc-number">1.0.16.</span> <span class="toc-text">Try、catch、finally、return</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80-try%E4%B8%AD%E5%B8%A6%E6%9C%89return"><span class="toc-number">1.0.16.1.</span> <span class="toc-text">一、try 中带有 return</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C-catch%E4%B8%AD%E5%B8%A6%E6%9C%89return"><span class="toc-number">1.0.16.2.</span> <span class="toc-text">二、catch 中带有 return</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89-finally%E4%B8%AD%E5%B8%A6%E6%9C%89return"><span class="toc-number">1.0.16.3.</span> <span class="toc-text">三、finally 中带有 return</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B-%E6%80%BB%E7%BB%93"><span class="toc-number">1.0.16.4.</span> <span class="toc-text">四、总结：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%BD%AC%E5%8C%96"><span class="toc-number">1.0.17.</span> <span class="toc-text">基本类型的转化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.0.17.1.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.0.18.</span> <span class="toc-text">运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E4%BD%99"><span class="toc-number">1.0.19.</span> <span class="toc-text">取余</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string-stringbuffer-stringbuilder%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB"><span class="toc-number">1.0.20.</span> <span class="toc-text">String、StringBuffer、StringBuilder 区别与联系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdk18%E4%B8%AD%E7%9A%84stream%E6%9C%89%E7%94%A8%E8%BF%87%E5%90%97%E8%AF%A6%E8%BF%B0%E4%B8%80%E4%B8%8Bstream%E7%9A%84%E5%B9%B6%E8%A1%8C%E6%93%8D%E4%BD%9C%E5%8E%9F%E7%90%86stream%E5%B9%B6%E8%A1%8C%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%98%AF%E4%BB%8E%E5%93%AA%E9%87%8C%E6%9D%A5%E7%9A%84"><span class="toc-number">1.0.21.</span> <span class="toc-text">Jdk1.8 中的 stream 有用过吗，详述一下 stream 的并行操作原理？stream 并行的线程池是从哪里来的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.0.22.</span> <span class="toc-text">JAVA 注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#synchronizedmap-%E5%92%8C-concurrenthashmap%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.23.</span> <span class="toc-text">SynchronizedMap 和 ConcurrentHashMap 有什么区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yield-%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-number">1.0.24.</span> <span class="toc-text">yield 方法有什么用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">1.0.25.</span> <span class="toc-text">常用线程池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E8%BF%B0%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.0.26.</span> <span class="toc-text">简述线程池的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.27.</span> <span class="toc-text">进程和线程的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E7%9A%84%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.0.28.</span> <span class="toc-text">死锁的必要条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81"><span class="toc-number">1.0.29.</span> <span class="toc-text">避免死锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%AD%E9%98%9F%E5%88%97%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%9E%8B%E6%9C%89%E4%BB%80%E4%B9%88"><span class="toc-number">1.0.30.</span> <span class="toc-text">Java 线程池中队列常用类型有什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%9C%80%E8%A6%81%E4%BF%9D%E8%AF%81%E5%87%A0%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%89%B9%E5%BE%81"><span class="toc-number">1.0.31.</span> <span class="toc-text">线程安全需要保证几个基本特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cas%E5%8E%9F%E7%90%86"><span class="toc-number">1.0.32.</span> <span class="toc-text">CAS 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cas%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">1.0.33.</span> <span class="toc-text">CAS 的缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86%E5%92%8C%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0"><span class="toc-number">1.0.34.</span> <span class="toc-text">线程池原理和核心参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.0.35.</span> <span class="toc-text">线程池的拒绝策略有哪些</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cyclibarrier%E5%92%8Ccountdownlatch%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.36.</span> <span class="toc-text">CycliBarrier 和 CountDownLatch 区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get%E5%92%8Cpost%E8%AF%B7%E6%B1%82%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.37.</span> <span class="toc-text">Get 和 Post 请求区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.0.38.</span> <span class="toc-text">转发和重定向的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdbc"><span class="toc-number">1.0.39.</span> <span class="toc-text">JDBC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie%E6%98%AF%E4%BB%80%E4%B9%88%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-number">1.0.40.</span> <span class="toc-text">Cookie 是什么，有什么用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E8%AF%B7%E6%B1%82%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.0.41.</span> <span class="toc-text">HTTP 请求状态码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90"><span class="toc-number">1.0.42.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#arraylist%E9%9B%86%E5%90%88%E7%9A%84add%E8%BF%87%E7%A8%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">ArrayList 集合的 add 过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18%E4%B8%BA%E4%BB%80%E4%B9%88%E6%94%B9%E5%8F%98%E6%88%9017%E7%9A%84%E5%A4%B4%E6%8F%92%E6%B3%95%E6%88%90%E5%B0%BE%E6%8F%92%E6%B3%95"><span class="toc-number">2.1.2.</span> <span class="toc-text">1.8 为什么改变成 1.7 的头插法成尾插法？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#victor-%E5%92%8C-arraylist%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.3.</span> <span class="toc-text">Victor 和 ArrayList 区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iteratoriteratoriterable%E5%85%B3%E7%B3%BB"><span class="toc-number">2.1.4.</span> <span class="toc-text">iterator (),Iterator,Iterable 关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#listiterator%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">2.1.5.</span> <span class="toc-text">ListIterator 迭代器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linkedlist%E5%BA%95%E5%B1%82"><span class="toc-number">2.1.6.</span> <span class="toc-text">LinkedList 底层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashset%E5%BA%95%E5%B1%82%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.1.7.</span> <span class="toc-text">HashSet 底层是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linkedset%E5%BA%95%E5%B1%82"><span class="toc-number">2.1.8.</span> <span class="toc-text">LinkedSet 底层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#treeset%E5%BA%95%E5%B1%82"><span class="toc-number">2.1.9.</span> <span class="toc-text">TreeSet 底层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashmap%E5%BA%95%E5%B1%82"><span class="toc-number">2.1.10.</span> <span class="toc-text">HashMap 底层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#17%E5%BA%95%E5%B1%82%E9%81%B5%E7%85%A7-font-colorred-%E5%93%88%E5%B8%8C%E8%A1%A8%E7%BB%93%E6%9E%84-font%E5%A4%B4%E6%8F%92%E6%B3%95"><span class="toc-number">2.1.10.1.</span> <span class="toc-text">1.7 底层遵照 哈希表结构 (头插法)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18%E5%BA%95%E5%B1%82%E9%81%B5%E7%85%A7-font-colorred-%E5%93%88%E5%B8%8C%E8%A1%A8%E7%BB%93%E6%9E%84-%E7%BA%A2%E9%BB%91%E6%A0%91font%E5%B0%BE%E6%8F%92%E6%B3%95"><span class="toc-number">2.1.10.2.</span> <span class="toc-text">1.8 底层遵照 哈希表结构 + 红黑树（尾插法）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashmap%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E7%BA%A2%E9%BB%91%E6%A0%91"><span class="toc-number">2.1.11.</span> <span class="toc-text">Hashmap 为什么要使用红黑树？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%95%B0%E7%BB%84%E7%9A%84%E9%95%BF%E5%BA%A6%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF2n"><span class="toc-number">2.1.12.</span> <span class="toc-text">主数组的长度为什么是2n2^n2n？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E5%A1%AB%E5%9B%A0%E5%AD%90075%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.1.13.</span> <span class="toc-text">装填因子 0.75 的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashmap-%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">2.1.14.</span> <span class="toc-text">HashMap 的时间复杂度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashtable%E5%BA%95%E5%B1%82"><span class="toc-number">2.1.15.</span> <span class="toc-text">HashTable 底层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linkedmap%E5%BA%95%E5%B1%82"><span class="toc-number">2.1.16.</span> <span class="toc-text">LinkedMap 底层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashmap%E5%92%8Chashtable%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.17.</span> <span class="toc-text">HashMap 和 Hashtable 有什么区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#treemap%E5%BA%95%E5%B1%82"><span class="toc-number">2.1.18.</span> <span class="toc-text">TreeMap 底层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#collection-%E5%92%8C-collections-%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.19.</span> <span class="toc-text">Collection 和 Collections 区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arraysaslist%E6%96%B9%E6%B3%95%E4%B9%8B%E5%90%8E%E7%9A%84%E9%9B%86%E5%90%88%E5%8F%AF%E4%BB%A5%E8%B0%83%E7%94%A8%E4%BB%80%E4%B9%88%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.20.</span> <span class="toc-text">Arrays.asList () 方法之后的集合可以调用什么方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map-set-list%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.21.</span> <span class="toc-text">Map、Set、List 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashset%E4%B8%8Etreeset-%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.22.</span> <span class="toc-text">HashSet 与 TreeSet 区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashtabl-hashmap-treemap%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.23.</span> <span class="toc-text">hashtabl、hashMap treeMap 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#concurrenthashmap%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.1.24.</span> <span class="toc-text">ConcurrentHashMap 原理与实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-2"><span class="toc-number">2.1.25.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">泛型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E4%B8%8A-%E4%B8%8B%E9%99%90"><span class="toc-number">3.0.1.</span> <span class="toc-text">泛型上、下限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E4%B8%AD%E7%9A%84%E8%87%AA%E5%A2%9Eii%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%90%97%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E8%87%AA%E5%A2%9E"><span class="toc-number">3.0.2.</span> <span class="toc-text">Java 中的自增（i++&#x2F;++i）是线程安全的吗，如何实现线程安全的自增？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#wait-%E5%92%8C-sleep-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.0.1.</span> <span class="toc-text">wait 和 sleep 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wait%E5%92%8Cnotify%E8%A6%81%E6%94%BE%E5%9C%A8synchronize%E4%B8%AD"><span class="toc-number">4.0.2.</span> <span class="toc-text">wait 和 notify 要放在 synchronize 中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81"><span class="toc-number">4.0.3.</span> <span class="toc-text">线程状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%AD%BB%E4%BA%A1dead"><span class="toc-number">4.0.4.</span> <span class="toc-text">线程死亡（DEAD）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8B-4-%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">终止线程 4 种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9D%9F"><span class="toc-number">4.1.1.</span> <span class="toc-text">正常运行结束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%80%80%E5%87%BA%E6%A0%87%E5%BF%97%E9%80%80%E5%87%BA%E7%BA%BF%E7%A8%8B"><span class="toc-number">4.1.2.</span> <span class="toc-text">使用退出标志退出线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#interrupt-%E6%96%B9%E6%B3%95%E7%BB%93%E6%9D%9F%E7%BA%BF%E7%A8%8B"><span class="toc-number">4.1.3.</span> <span class="toc-text">Interrupt 方法结束线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stop-%E6%96%B9%E6%B3%95%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8B%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8"><span class="toc-number">4.1.4.</span> <span class="toc-text">stop 方法终止线程（线程不安全）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-3"><span class="toc-number">4.1.5.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">5.</span> <span class="toc-text">线程池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%B7%A5%E5%8E%82%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">5.0.1.</span> <span class="toc-text">线程工厂的目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A0%B8%E5%BF%83%E5%B1%9E%E6%80%A7"><span class="toc-number">5.0.2.</span> <span class="toc-text">线程池的核心属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%A0%B8%E5%BF%83%E7%9A%84-execute-%E6%B5%81%E7%A8%8B"><span class="toc-number">5.0.3.</span> <span class="toc-text">线程池核心的 execute 流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%A2%9E%E5%8A%A0%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">5.0.4.</span> <span class="toc-text">线程池增加工作线程的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84work%E7%B1%BB"><span class="toc-number">5.0.5.</span> <span class="toc-text">线程池的 Work 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84-runworker-%E6%96%B9%E6%B3%95"><span class="toc-number">5.0.6.</span> <span class="toc-text">线程池的 runWorker () 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E6%A0%B8cpu%E8%AE%BE%E5%AE%9A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%98%AF%E5%90%A6%E6%9C%89%E6%84%8F%E4%B9%89"><span class="toc-number">5.0.7.</span> <span class="toc-text">1、单核 CPU 设定多线程是否有意义？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%98%AF%E4%B8%8D%E6%98%AF%E8%B6%8A%E5%A4%9A%E8%B6%8A%E5%A5%BD"><span class="toc-number">5.0.8.</span> <span class="toc-text">2、线程数是不是越多越好？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%95%B0%E8%AE%BE%E7%BD%AE%E5%A4%9A%E5%B0%91%E6%9C%80%E5%90%88%E9%80%82"><span class="toc-number">5.0.9.</span> <span class="toc-text">3、线程数设置多少最合适？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%BB%93%E6%9D%9F%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B"><span class="toc-number">5.0.10.</span> <span class="toc-text">如何优雅的结束一个线程？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E7%9C%9F%E7%9A%84%E4%BC%9A%E4%B8%80%E8%A1%8C%E4%B8%80%E8%A1%8C%E7%9A%84%E8%BF%90%E8%A1%8C%E5%90%97"><span class="toc-number">5.0.11.</span> <span class="toc-text">程序真的会一行一行的运行吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#this%E5%AF%B9%E8%B1%A1%E6%BA%A2%E5%87%BA%E9%97%AE%E9%A2%98"><span class="toc-number">5.0.12.</span> <span class="toc-text">this 对象溢出问题？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">5.0.13.</span> <span class="toc-text">线程池的好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-4"><span class="toc-number">5.0.14.</span> <span class="toc-text">———————— 未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jvm"><span class="toc-number">6.</span> <span class="toc-text">JVM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9"><span class="toc-number">6.0.1.</span> <span class="toc-text">基础内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="toc-number">6.0.2.</span> <span class="toc-text">类加载机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">6.0.3.</span> <span class="toc-text">类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6"><span class="toc-number">6.0.4.</span> <span class="toc-text">双亲委派机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E7%A0%B4%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6"><span class="toc-number">6.0.5.</span> <span class="toc-text">打破双亲委派机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">6.0.6.</span> <span class="toc-text">对象的创建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8A%8A%E5%A0%86%E5%92%8C%E6%A0%88%E5%8C%BA%E5%88%86%E5%87%BA%E6%9D%A5%E5%91%A2%E6%A0%88%E4%B8%AD%E4%B8%8D%E6%98%AF%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%90%97"><span class="toc-number">6.0.7.</span> <span class="toc-text">为什么要把堆和栈区分出来呢？栈中不是也可以存储数据吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%8A%8A%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E6%94%BE%E5%A0%86%E4%B8%AD%E5%91%A2"><span class="toc-number">6.0.8.</span> <span class="toc-text">为什么不把基本类型放堆中呢？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E4%B8%AD%E5%AD%98%E4%BB%80%E4%B9%88%E6%A0%88%E4%B8%AD%E5%AD%98%E4%BB%80%E4%B9%88"><span class="toc-number">6.0.9.</span> <span class="toc-text">堆中存什么？栈中存什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E6%97%B6%E4%BC%A0%E5%80%BC%E5%91%A2%E8%BF%98%E6%98%AF%E4%BC%A0%E5%BC%95%E7%94%A8"><span class="toc-number">6.0.10.</span> <span class="toc-text">Java 中的参数传递时传值呢？还是传引用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81jvm"><span class="toc-number">6.0.11.</span> <span class="toc-text">为什么需要 JVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdkjrejvm%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">6.0.12.</span> <span class="toc-text">JDK，JRE，JVM 的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E7%9A%84%E7%BC%96%E8%AF%91%E5%99%A8%E5%88%B0%E5%BA%95%E5%B9%B2%E4%BA%86%E4%BB%80%E4%B9%88"><span class="toc-number">6.0.13.</span> <span class="toc-text">我们的编译器到底干了什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E8%A2%AB%E5%88%A4%E5%AE%9A%E4%B8%BA%E4%B8%8D%E5%8F%AF%E8%BE%BE%E5%AF%B9%E8%B1%A1%E4%B9%8B%E5%90%8E%E5%B0%B1%E6%AD%BB%E4%BA%86%E5%90%97"><span class="toc-number">6.0.14.</span> <span class="toc-text">对象被判定为不可达对象之后就死了吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E5%A0%86%E8%BF%9B%E8%A1%8C%E5%88%86%E4%BB%A3%E5%A4%84%E7%90%86"><span class="toc-number">6.0.15.</span> <span class="toc-text">Java 堆进行分代处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88edens0s1%E6%98%AF811"><span class="toc-number">6.0.16.</span> <span class="toc-text">为什么 Eden：S0：S1 是 8:1:1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%81%E5%B9%B4%E4%BB%A3%E7%9A%84%E6%8B%85%E4%BF%9D%E6%9C%BA%E5%88%B6"><span class="toc-number">6.0.17.</span> <span class="toc-text">老年代的担保机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%9E%83%E5%9C%BE"><span class="toc-number">6.0.18.</span> <span class="toc-text">如何确定一个对象是垃圾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%88%86%E7%B1%BB"><span class="toc-number">6.0.19.</span> <span class="toc-text">垃圾收集器分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%9E%E5%90%90%E9%87%8F%E5%92%8C%E5%81%9C%E9%A1%BF%E6%97%B6%E9%97%B4"><span class="toc-number">6.0.20.</span> <span class="toc-text">吞吐量和停顿时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95"><span class="toc-number">6.0.21.</span> <span class="toc-text">垃圾收集算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4mark-sweep"><span class="toc-number">6.0.22.</span> <span class="toc-text">标记 - 清除 (Mark-Sweep)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0-%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95mark-copying"><span class="toc-number">6.0.23.</span> <span class="toc-text">标记 - 复制算法 (Mark-Copying)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86mark-compact"><span class="toc-number">6.0.24.</span> <span class="toc-text">标记 - 整理 (Mark-Compact)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95"><span class="toc-number">6.0.25.</span> <span class="toc-text">分代收集算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zgc"><span class="toc-number">6.0.26.</span> <span class="toc-text">ZGC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">6.0.27.</span> <span class="toc-text">垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#serial%E7%B3%BB%E5%88%97"><span class="toc-number">6.0.28.</span> <span class="toc-text">Serial 系列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parallel%E7%B3%BB%E5%88%97%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">6.0.29.</span> <span class="toc-text">Parallel 系列垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cms%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">6.0.30.</span> <span class="toc-text">CMS 垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#g1-%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5"><span class="toc-number">6.0.31.</span> <span class="toc-text">G1 调优策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#g1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">6.0.32.</span> <span class="toc-text">G1 垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">6.0.33.</span> <span class="toc-text">生产环境中，如何选择合适的垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8g1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">6.0.34.</span> <span class="toc-text">如何判断是否使用 G1 垃圾收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%89%8D%E4%BC%9A%E8%BF%9B%E8%A1%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">6.0.35.</span> <span class="toc-text">什么时候才会进行垃圾回收</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jvm-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">6.0.36.</span> <span class="toc-text">JVM 常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jvm%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97"><span class="toc-number">6.0.37.</span> <span class="toc-text">JVM 性能优化指南</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-5"><span class="toc-number">6.0.38.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">7.</span> <span class="toc-text">数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">7.0.1.</span> <span class="toc-text">数据库存储引擎有哪些</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#myisam%E5%92%8Cinnodb%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="toc-number">7.0.2.</span> <span class="toc-text">Myisam 和 Innodb 有什么区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E"><span class="toc-number">7.0.3.</span> <span class="toc-text">如何选择数据库引擎？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E8%8C%83%E5%BC%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">7.0.4.</span> <span class="toc-text">三范式是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1%E6%9C%89%E5%93%AA%E4%BA%9B%E7%89%B9%E7%82%B9"><span class="toc-number">7.0.5.</span> <span class="toc-text">什么是事务，有哪些特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">7.0.6.</span> <span class="toc-text">事务的隔离级别有哪些</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E5%B8%A6%E6%9D%A5%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-number">7.0.7.</span> <span class="toc-text">并发事务带来哪些问题？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E5%BA%A6%E5%92%8C%E5%B9%BB%E8%AF%BB%E5%8C%BA%E5%88%AB"><span class="toc-number">7.0.8.</span> <span class="toc-text">不可重复度和幻读区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">7.0.9.</span> <span class="toc-text">SQL 优化手段有哪些？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E5%B8%B8%E8%A7%81%E7%9A%84%E6%97%A5%E5%BF%97%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%88%AB%E8%B5%B7%E5%88%B0%E4%BA%86%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8"><span class="toc-number">7.0.10.</span> <span class="toc-text">MySQL 常见的日志有哪些，分别起到了什么作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFbuffer-pool"><span class="toc-number">7.0.11.</span> <span class="toc-text">什么是 Buffer Pool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buffer-pool-%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="toc-number">7.0.12.</span> <span class="toc-text">Buffer pool 内存淘汰策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFhash%E7%B4%A2%E5%BC%95"><span class="toc-number">7.0.13.</span> <span class="toc-text">什么是 hash 索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8b%E6%95%B0%E5%81%9A%E7%B4%A2%E5%BC%95"><span class="toc-number">7.0.14.</span> <span class="toc-text">MySQL 为什么要用 B + 数做索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E6%9C%89%E5%93%AA%E4%BA%9B%E7%B1%BB%E5%9E%8B"><span class="toc-number">7.0.15.</span> <span class="toc-text">数据库优化，什么是数据库索引，有哪些类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E4%B8%80%E4%B8%8B%E4%BD%A0%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93btree%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">7.0.16.</span> <span class="toc-text">谈一下你对数据库 b+tree 的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">7.0.17.</span> <span class="toc-text">聚集索引和非聚集索引的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%97%A5%E5%B8%B8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96%E7%9A%84"><span class="toc-number">7.0.18.</span> <span class="toc-text">在日常工作中是如何进行数据库优化的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E5%88%97%E4%B8%BE%E5%87%A0%E4%B8%AA%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">7.0.19.</span> <span class="toc-text">请列举几个索引失效的场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81%E7%9A%84%E6%9C%BA%E5%88%B6"><span class="toc-number">7.0.20.</span> <span class="toc-text">数据库锁的机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E9%81%87%E5%88%B0%E6%AD%BB%E9%94%81%E6%83%85%E5%86%B5%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86"><span class="toc-number">7.0.21.</span> <span class="toc-text">在遇到死锁情况如何处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E5%92%8Coracle%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">7.0.22.</span> <span class="toc-text">mysql 和 oracle 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%A0%B9%E6%9C%AC%E7%89%B9%E7%82%B9"><span class="toc-number">7.0.23.</span> <span class="toc-text">数据库的根本特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB%E6%98%AF%E6%8C%87"><span class="toc-number">7.0.24.</span> <span class="toc-text">数据库中数据共享是指</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E4%BA%A7%E7%94%9F%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-number">7.0.25.</span> <span class="toc-text">数据库中产生数据不一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97"><span class="toc-number">7.0.26.</span> <span class="toc-text">运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">7.0.26.1.</span> <span class="toc-text">运算优先级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">7.0.27.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-6"><span class="toc-number">7.0.28.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#javaee"><span class="toc-number">8.</span> <span class="toc-text">JavaEE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-7"><span class="toc-number">8.0.1.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#servlet"><span class="toc-number">8.1.</span> <span class="toc-text">Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#servlet%E4%B8%AD-forward-%E5%92%8C-redirct-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">8.1.1.</span> <span class="toc-text">Servlet 中 forward () 和 redirct () 的区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#servlet%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">8.1.2.</span> <span class="toc-text">Servlet 的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-8"><span class="toc-number">8.1.3.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mybatis"><span class="toc-number">9.</span> <span class="toc-text">MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFmybatis"><span class="toc-number">9.0.1.</span> <span class="toc-text">什么是 Mybatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E4%BC%98%E7%82%B9"><span class="toc-number">9.0.2.</span> <span class="toc-text">Mybatis 优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">9.0.3.</span> <span class="toc-text">Mybatis 的缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">9.0.4.</span> <span class="toc-text">$ 和 # 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%90%8D%E5%92%8C%E5%AD%97%E6%AE%B5%E5%90%8D%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-number">9.0.5.</span> <span class="toc-text">属性名和字段名不一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E4%B8%BB%E9%94%AE"><span class="toc-number">9.0.6.</span> <span class="toc-text">如何获取自动生成的主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E4%BD%BF%E7%94%A8%E4%BA%86%E9%82%A3%E4%BA%9B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.0.7.</span> <span class="toc-text">Mybatis 使用了那些设计模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E4%B8%AD%E5%A4%84%E7%90%86curd%E6%93%8D%E4%BD%9C%E7%9A%84%E6%A0%87%E7%AD%BE%E4%BB%A5%E5%A4%96%E8%BF%98%E6%9C%89%E9%82%A3%E4%BA%9B%E6%A0%87%E7%AD%BE"><span class="toc-number">9.0.8.</span> <span class="toc-text">Mybatis 映射文件中处理 CURD 操作的标签以外还有那些标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E7%9A%84%E5%88%86%E9%A1%B5"><span class="toc-number">9.0.9.</span> <span class="toc-text">Mybatis 的分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9Bexecutor%E6%89%A7%E8%A1%8C%E5%99%A8%E5%AE%83%E4%BB%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">9.0.10.</span> <span class="toc-text">Mybatis 都有哪些 Executor 执行器？它们之间的区别是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E4%B8%ADmapper%E6%8E%A5%E5%8F%A3%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-number">9.0.11.</span> <span class="toc-text">Mybatis 中 Mapper 接口一致性问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bmybatis%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">9.0.12.</span> <span class="toc-text">介绍一下 Mybatis 的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E7%9A%84%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1"><span class="toc-number">9.0.13.</span> <span class="toc-text">Mybatis 的缓存设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">9.0.14.</span> <span class="toc-text">mybatis 三级缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#defaultsqlsession%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%90%97"><span class="toc-number">9.0.15.</span> <span class="toc-text">DefaultSqlSession 是线程安全的吗</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#spring"><span class="toc-number">10.</span> <span class="toc-text">Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFspring"><span class="toc-number">10.0.1.</span> <span class="toc-text">什么是 Spring</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8spring%E6%A1%86%E6%9E%B6"><span class="toc-number">10.0.2.</span> <span class="toc-text">项目中为什么使用 Spring 框架？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#autowired-%E5%92%8Cresource%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">10.0.3.</span> <span class="toc-text">Autowired 和 Resource 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D"><span class="toc-number">10.0.4.</span> <span class="toc-text">依赖注入的方式有哪几种</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%BD%A0%E5%AF%B9spring%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">10.0.5.</span> <span class="toc-text">说一下你对 spring 核心模块的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4%E4%BD%A0%E5%AF%B9spring%E7%9A%84ioc%E6%98%AF%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3%E7%9A%84"><span class="toc-number">10.0.6.</span> <span class="toc-text">说说你对 Spring 的 IOC 是怎么理解的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string%E7%9A%84aop%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.0.7.</span> <span class="toc-text">String 的 AOP 实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.0.7.1.</span> <span class="toc-text">如何实现？？？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-aop%E5%92%8Caspectj-aop%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="toc-number">10.0.8.</span> <span class="toc-text">Spring AOP 和 AspectJ AOP 有什么区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">10.0.9.</span> <span class="toc-text">静态代理和动态代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string%E5%92%8Cspringboot%E5%92%8Cspringmvc%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">10.0.10.</span> <span class="toc-text">String 和 Springboot 和 SpringMVC 的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80-%E6%A6%82%E5%BF%B5"><span class="toc-number">10.0.10.1.</span> <span class="toc-text">一、概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C-%E5%8E%9F%E7%90%86%E5%92%8C%E7%BB%93%E6%9E%84"><span class="toc-number">10.0.10.2.</span> <span class="toc-text">二、原理和结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89-%E5%8C%BA%E5%88%AB%E4%B8%8E%E6%80%BB%E7%BB%93"><span class="toc-number">10.0.10.3.</span> <span class="toc-text">三、区别与总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring%E4%B8%AD%E4%BA%8B%E5%8A%A1%E6%98%AF%E5%A6%82%E4%BD%95%E5%9B%9E%E6%BB%9A"><span class="toc-number">10.0.11.</span> <span class="toc-text">Spring 中事务是如何回滚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84bean"><span class="toc-number">10.0.12.</span> <span class="toc-text">Spring 如何处理多线程的 Bean</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#springboot"><span class="toc-number">11.</span> <span class="toc-text">SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFspringboot"><span class="toc-number">11.0.1.</span> <span class="toc-text">什么是 SpringBoot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BC%98%E7%82%B9"><span class="toc-number">11.0.2.</span> <span class="toc-text">SpringBoot 有哪些优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">11.0.3.</span> <span class="toc-text">SpringBoot 中的核心注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bspringboot%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86"><span class="toc-number">11.0.4.</span> <span class="toc-text">介绍一下 SpringBoot 的自动装配原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E4%B8%80%E4%B8%8B-starter-%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">11.0.5.</span> <span class="toc-text">谈一下 Starter 的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E9%9C%80%E8%A6%81%E5%8D%95%E7%8B%AC%E7%9A%84web%E5%AE%B9%E5%99%A8%E5%90%97"><span class="toc-number">11.0.6.</span> <span class="toc-text">SpringBoot 需要单独的 web 容器吗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E7%9A%84%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">11.0.7.</span> <span class="toc-text">Springboot 的启动方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">11.0.8.</span> <span class="toc-text">SpringBoot 如何解决跨域问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8log4j"><span class="toc-number">11.0.9.</span> <span class="toc-text">SpringBoot 项目中如何使用 Log4j</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bootstrapyml%E6%96%87%E4%BB%B6%E4%BD%9C%E7%94%A8"><span class="toc-number">11.0.10.</span> <span class="toc-text">bootstrap.yml 文件作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E7%9A%84actuator%E7%90%86%E8%A7%A3"><span class="toc-number">11.0.11.</span> <span class="toc-text">谈谈你的 Actuator 理解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#springcloud"><span class="toc-number">12.</span> <span class="toc-text">SpringCloud</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E4%BB%80%E4%B9%88%E6%98%AFspringcloud"><span class="toc-number">12.0.1.</span> <span class="toc-text">1. 什么是 SpringCloud</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">12.0.2.</span> <span class="toc-text">2. 什么是微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">12.0.3.</span> <span class="toc-text">注册中心的核心概念？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%91%A2"><span class="toc-number">12.0.4.</span> <span class="toc-text">为何使用注册中心呢？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-number">13.</span> <span class="toc-text">分布式事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95"><span class="toc-number">13.0.1.</span> <span class="toc-text">常见的负载均衡算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8Fid%E6%9C%89%E5%93%AA%E4%BA%9B%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88"><span class="toc-number">13.0.2.</span> <span class="toc-text">分布式 ID 有哪些生成方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%82%E7%AD%89"><span class="toc-number">13.0.3.</span> <span class="toc-text">幂等</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">14.</span> <span class="toc-text">分布式锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-9"><span class="toc-number">14.0.1.</span> <span class="toc-text">—————————— 未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis"><span class="toc-number">15.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">15.0.1.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-string-key-value-%E7%B1%BB%E5%9E%8B"><span class="toc-number">15.0.1.1.</span> <span class="toc-text">1、string (key-value 类型)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-list"><span class="toc-number">15.0.1.2.</span> <span class="toc-text">2、list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-hash"><span class="toc-number">15.0.1.3.</span> <span class="toc-text">3、hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-set"><span class="toc-number">15.0.1.4.</span> <span class="toc-text">4、set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-sorted-set%E4%B9%9F%E5%8F%ABzset"><span class="toc-number">15.0.1.5.</span> <span class="toc-text">5、sorted set (也叫 zset)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-%E6%98%AF%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%98%E6%98%AF%E5%8D%95%E7%BA%BF%E7%A8%8B"><span class="toc-number">15.0.2.</span> <span class="toc-text">redis 是多线程还是单线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88redis%E4%BD%BF%E7%94%A8%E5%8D%95%E7%BA%BF%E7%A8%8B"><span class="toc-number">15.0.3.</span> <span class="toc-text">为什么 Redis 使用单线程？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98cpu%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-number">15.0.4.</span> <span class="toc-text">Redis 如何提高 CPU 使用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-10"><span class="toc-number">15.0.5.</span> <span class="toc-text">未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">16.</span> <span class="toc-text">设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E4%B8%80%E8%AF%B4%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E5%92%8C%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">16.0.1.</span> <span class="toc-text">说一说程序的设计原则和设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">16.0.1.1.</span> <span class="toc-text">设计原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99"><span class="toc-number">16.0.2.</span> <span class="toc-text">1.1 单一职责原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99"><span class="toc-number">16.0.3.</span> <span class="toc-text">1.2 开闭原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E9%87%8C%E6%B0%8F%E4%BB%A3%E6%8D%A2%E5%8E%9F%E5%88%99"><span class="toc-number">16.0.4.</span> <span class="toc-text">1.3 里氏代换原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="toc-number">16.0.5.</span> <span class="toc-text">1.4 依赖倒置原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99"><span class="toc-number">16.0.6.</span> <span class="toc-text">1.5 接口隔离原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99"><span class="toc-number">16.0.7.</span> <span class="toc-text">1.6 迪米特法则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">16.0.8.</span> <span class="toc-text">具体的设计模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E5%8D%95%E5%88%97%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.9.</span> <span class="toc-text">谈谈你对单列模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.10.</span> <span class="toc-text">谈谈你对简单工厂模式理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.11.</span> <span class="toc-text">谈谈你对简单工厂模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.12.</span> <span class="toc-text">谈谈你对工厂方法模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.13.</span> <span class="toc-text">谈谈你对代理模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.14.</span> <span class="toc-text">谈谈你对模板模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.15.</span> <span class="toc-text">谈谈你对观察者模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.16.</span> <span class="toc-text">谈谈你对装饰器模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.17.</span> <span class="toc-text">谈谈你对策略模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">16.0.18.</span> <span class="toc-text">谈谈你对适配器模式的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-11"><span class="toc-number">16.0.19.</span> <span class="toc-text">未完成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">17.</span> <span class="toc-text">计算机网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">17.0.1.</span> <span class="toc-text">子网掩码的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E8%BF%B0-tcp-%E5%92%8Cudp-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">17.0.2.</span> <span class="toc-text">简述 TCP 和 UDP 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="toc-number">17.0.3.</span> <span class="toc-text">三次挥手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="toc-number">17.0.4.</span> <span class="toc-text">四次挥手</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AA%E5%AE%8C%E6%88%90-12"><span class="toc-number">18.</span> <span class="toc-text">———————————— 未完成</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E4%BD%93%E9%85%8D%E8%89%B2"><span class="toc-number">19.</span> <span class="toc-text">字体配色</span></a></li></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/interview/JVM%E5%A4%8D%E4%B9%A0%E7%89%88/" rel="bookmark" title="JVM复习版">JVM复习版</a></li><li><a href="/interview/JavaSE%E2%80%94%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="bookmark" title="多线程">多线程</a></li><li><a href="/interview/JVM%E5%BF%AB%E9%80%9F%E7%AA%81%E5%87%BB%E7%89%88/" rel="bookmark" title="JVM突击版">JVM突击版</a></li><li><a href="/interview/JavaSE%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" rel="bookmark" title="常见问题">常见问题</a></li><li><a href="/interview/JavaSE%E2%80%94%E9%9B%86%E5%90%88/" rel="bookmark" title="集合">集合</a></li><li class="active"><a href="/interview/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="bookmark" title="面试题">面试题</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="雾都" data-src="/images/avatar.jpg"><p class="name" itemprop="name">雾都</p><div class="description" itemprop="description">花非花，雾非雾</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">70</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">22</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL29ubHltYXJyeXU=" title="https:&#x2F;&#x2F;github.com&#x2F;onlymarryu"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9ydXJpc216aw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;rurismzk"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvbXkvbS9tdXNpYy9wbGF5bGlzdD9pZD0zMTY2MDYwNzkw" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;my&#x2F;m&#x2F;music&#x2F;playlist?id&#x3D;3166060790"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vYW1laGltZQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime"><i class="ic i-weibo"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>时间轴</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/toolPage/" rel="section"><i class="ic i-feather"></i>常用工具设置技巧</a></li><li class="item"><a href="/projectBuild/" rel="section"><i class="ic i-th"></i>SpringBoot常用配置</a></li></ul></li><li class="item"><a href="/mianshi/" rel="section"><i class="ic i-calendar"></i>面试</a></li><li class="item"><a href="/study/" rel="section"><i class="ic i-sakura"></i>小实验</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-calendar"></i>留言</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/interview/JavaSE%E2%80%94%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/interview/JavaSE%E2%80%94%E9%9B%86%E5%90%88/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a></div><span><a href="/Distribution/RPC/" title="RPC">RPC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/" title="分类于 Spring 全家桶">Spring 全家桶</a></div><span><a href="/Spring_Family/Spring/" title="Spring">Spring</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC12%E7%AB%A0IO/" title="第12章IO">第12章IO</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/Erlang-tool/" title="Erlang">Erlang</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B0%8F%E5%AE%9E%E9%AA%8C/" title="分类于 小实验">小实验</a></div><span><a href="/study/Collect/Resource/" title="日常搜集到的资源网站">日常搜集到的资源网站</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/python-tool/" title="python">python</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/MySQL-tool/" title="MySQL">MySQL</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/" title="分类于 小程序开发">小程序开发</a></div><span><a href="/Web-anteriore/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/3.%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E8%A7%86%E5%9B%BE%E4%B8%8E%E9%80%BB%E8%BE%91/" title="3.视图与逻辑">3.视图与逻辑</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/Kafka-tool/" title="Kafka">Kafka</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC2%E7%AB%A0_%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="第2章_数据类型">第2章_数据类型</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">雾都 @ 雾都博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.1m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">16:21</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"interview/面试题/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>