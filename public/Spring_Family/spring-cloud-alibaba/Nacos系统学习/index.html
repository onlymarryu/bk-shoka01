<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/atom.xml"><link rel="alternate" type="application/json" title="每天进步一点点，就是成功的开始" href="https://eth168.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="spring-cloud-alibaba,nacos"><link rel="canonical" href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"><title>Nacos 系统学习 - 微服务 | 雾都博客 = 每天进步一点点，就是成功的开始</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Nacos 系统学习</h1><div class="meta"><span class="item" title="创建时间：2023-07-10 21:43:56"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-07-10T21:43:56+08:00">2023-07-10</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>27k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>24 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">雾都博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://api.yimian.xyz/img?143032"></li><li class="item" data-background-image="https://api.yimian.xyz/img?37137"></li><li class="item" data-background-image="https://api.yimian.xyz/img?952483"></li><li class="item" data-background-image="https://api.yimian.xyz/img?436084"></li><li class="item" data-background-image="https://api.yimian.xyz/img?554042"></li><li class="item" data-background-image="https://api.yimian.xyz/img?652250"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" itemprop="item" rel="index" title="分类于 微服务"><span itemprop="name">微服务</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="雾都"><meta itemprop="description" content=", 花非花，雾非雾"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="每天进步一点点，就是成功的开始"></span><div class="body md" itemprop="articleBody"><h1 id="微服务简介"><a class="anchor" href="#微服务简介">#</a> 微服务简介</h1><h2 id="1-什么是微服务"><a class="anchor" href="#1-什么是微服务">#</a> 1 什么是微服务</h2><p>2014 年，Martin Fowler（<strong>马丁・福勒</strong> ） 提出了微服务的概念，定义了微服务是由以单一应用程序构成的小服务，自己拥有自己的进程与轻量化处理，服务依业务功能设计，以全自动的方式部署，与其他服务使用 HTTP API 通信。同时服务会使用最小的规模的集中管理能力，服务可以用不同的编程语言与数据库等组件实现。</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/a544f9b87c934ffe9fc994129e4bc5e2.png" title="WeChat13cb5e0a22944a3c85e6d91ca10babbc.png"><p>马丁・福勒是敏捷联盟的成员，于 2001 年，同其他 16 名合著者一起协助创作了 “敏捷软件开发宣言”。他负责维护一个 bliki 网站 --- 一种 blog 和 wiki 的混合衍生物，他还使控制反转 (Inversion of Control)“依赖注入模式 (Dependency Injection)” 一词得到普及。</p><h3 id="架构的演变"><a class="anchor" href="#架构的演变">#</a> 架构的演变</h3><p>随着互联网的发展，网站应用的规模也不断的扩大，进而导致系统架构也在不断的进行变化，从互联网早起到现在，系统架构大体经历了下面几个过程：</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/18122ec67e5c4f2ca5579288c42c42cf.png" title="WeChatb55c37f0bb53be8957590c529bb21e83.png"><h4 id="单体应用架构"><a class="anchor" href="#单体应用架构">#</a> 单体应用架构：</h4><p>把所有功能都集中在一个应用中，统一部署，开发成本、部署成本和维护成本低</p><ul><li>优点：项目架构简单，适合用户量少的项目，开发成本低，项目部署在一个节点上，维护方便。</li><li>缺点：功能集中在一个工程中，对于大型项目比一开发和维护，项目模块紧耦合，单点容错率低，无法对不同的模块功能进行针对性的优化和水平拓展</li></ul><h4 id="垂直应用架构"><a class="anchor" href="#垂直应用架构">#</a> 垂直应用架构：</h4><p>所谓垂直应用架构，其实就是把之前的单体应用拆分成多个应用，以提升效率，比如电商系统可以拆分成：电商系统、后台系统、CMS 系统</p><ul><li>优点：项目拆分实现了流量分担，解决了并发问题，而且可以针对不同模块进行优化和水平拓展，同时不同的系统之间不会互相影响，提高容错率</li><li>缺点：系统之间互相存在，无法进行相互调用，系统之间互相独立，会造成一部分功能的冗余</li></ul><h4 id="分布式架构"><a class="anchor" href="#分布式架构">#</a> 分布式架构：</h4><p>随着业务的增加，在垂直应用架构中冗余的业务代码越来越多，就需要将冗余的部分抽取出来，统一做成业务层单独处理，变成一个单独的服务，控制层调用不同的业务层服务就能完成不同的业务功能，具体表现就是一个项目拆分成表现层和服务层两个部分，服务层中包含业务逻辑，表现层只需要处理和页面的交互，业务逻辑都是调用服务层的服务来实现，这就是分布式架构。</p><ul><li>优点：抽取公共的功能作为服务层，提高代码复用行。</li><li>缺点：系统间耦合度变高，调用关系错综复杂，难以维护。</li></ul><h4 id="soa架构"><a class="anchor" href="#soa架构">#</a> SOA 架构：</h4><p>分布式架构中的缺点就是调用复杂，而且当服务越来越多，或者当某一个服务压力过大需要水平拓展和负载均衡，对于资源调度和治理就需要用到治理中心 SOA（Service Oriented Architecture）为核心来解决，同时治理中心还可以帮助我们解决服务之间协议不同的问题。</p><ul><li>优点：使用治理中心（ESB\dubbo）解决了服务见调用关系的自动调节</li><li>缺点：服务间会有依赖关系，一旦某个环节出错会影响较大（服务雪崩），服务关系复杂，运维、测试部署困难。</li></ul><h4 id="微服务架构"><a class="anchor" href="#微服务架构">#</a> 微服务架构：</h4><p>微服务架构在某种程度上面架构 SOA 继续发展的下一步，它更加强调服务的 “彻底拆分”，目的就是提高效率，微服务架构中，每个服务必须独立部署同时互不影响，微服务架构更加轻巧，轻量级。</p><h4 id="微服务架构与soa架构的不同"><a class="anchor" href="#微服务架构与soa架构的不同">#</a> 微服务架构与 SOA 架构的不同</h4><ol><li>微服务架构比 SOA 架构会更加的精细，让专业的人去做专业的。</li><li>目的是提高效率每个服务之间互不影响，微服务架构中，每个服务需要独立部署</li><li>SOA 架构中可能数据库存储会发生共享，微服务强调每个服务都是单独数据库，保证每个服务之间互不影响。</li><li>微服务项目架构比 SOA 架构更加适合与互联网公司迅捷开发、快速迭代版本，因为粒度非常精细。</li></ol><p>为何使用微服务呢？</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/6e5c1179855b42d4ad8f472ea9ed2f1b.png" title="WeChatc690c21a12ed31985403c3be5446e01c.png"><p>微服务就像集群作战，可以提升性能</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/7b30c17619c4446aa1f9cd9c8ac98d35.png" title="WeChate3645eab5fa6b9086451566cb00ebadb.png"><p>微服务架构：</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/cdfcdadc0c2a450e869d841d8522e196.png" title="WeChat16099fb7486aa74bf6f6c13e79467e67.png"><ul><li>优点：服务原子化拆分，独立打包、部署和升级，保证每个微服务清晰的任务划分，利于扩展</li><li>缺点：分布式系统开发的技术成本高（容错、分布式事务等），复杂性更高，每个微服务进行分布式独立部署，当进行模块调用的时候，分布式将会变得更加麻烦。</li></ul><h4 id="spring-cloud-发展历史"><a class="anchor" href="#spring-cloud-发展历史">#</a> Spring Cloud 发展历史</h4><p><strong>Spring Cloud netflix -&gt; Spring Cloud Alibaba</strong></p><ol><li>2020-12-22 日<strong> Spring</strong> 官方博客宣布， <code>Spring Cloud 2020.0.0</code> 正式发布。 <code>2020.0.0</code> 是第一个使用新的版本号命名方案的<strong> Spring Cloud</strong> 发行版本。在此之前<strong> Spring Cloud</strong> 使用英国伦敦地铁站的命名方式来命名一个大版本（ <code>train version</code> ），如果不按照新的版本号命名的话，本次的版本号应该是 Ilford。</li><li>更新版本没有什么大惊小怪的，但是本次更新却正式开启了<strong> Spring Cloud Netflix</strong> 体系的终结进程。<strong>Netflix</strong> 公司是目前微服务落地中最成功的公司。它开源了诸如<strong> Eureka</strong> 、<strong>Hystrix</strong> 、<strong>Zuul</strong> 、<strong>Feign</strong> 、<strong>Ribbon</strong> 等等广大开发者所知微服务套件，统称为<strong> Netflix OSS</strong> 。在当时<strong> Netflix OSS</strong> 成为微服务组件上事实的标准。但是在 2018 年<strong> Netflix</strong> 公司宣布其核心组件<strong> Hystrix</strong> 、<strong>Ribbon</strong> 、<strong>Zuul</strong> 、<strong>Eureka</strong> 等进入<strong>维护状态</strong> ，不再进行新特性开发，只修 BUG。这直接影响了<strong> Spring Cloud</strong> 项目的发展路线，<strong>Spring</strong> 官方不得不采取了应对措施，在 2019 年的在 <strong>SpringOne 2019</strong> 大会中，<strong>Spring Cloud</strong> 宣布 <strong>Spring Cloud Netflix 项目进入维护模式</strong> ，并在 2020 年移除相关的<strong> Netflix OSS</strong> 组件。</li><li>Spring Cloud Aalibaba 成为了主流</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/06e4ffcc7d254c14951de86c71ed0d07.png" title="image.png"> <img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/6462169e77c844ea94afb0ec3ff8e5ff.png" title="image.png"><h2 id="2-spring-cloud-alibaba"><a class="anchor" href="#2-spring-cloud-alibaba">#</a> 2 Spring Cloud Alibaba</h2><h3 id="简介"><a class="anchor" href="#简介">#</a> 简介</h3><p>Spring Cloud Alibaba 致力于提供微服务开发的一站式解决方案。此项目包含开发分布式应用微服务的必需组件，方便开发者通过 Spring Cloud 编程模型轻松使用这些组件来开发分布式应用服务。</p><p>依托 Spring Cloud Alibaba，您只需要添加一些注解和少量配置，就可以将 Spring Cloud 应用接入阿里微服务解决方案，通过阿里中间件来迅速搭建分布式应用系统。</p><h3 id="主要功能"><a class="anchor" href="#主要功能">#</a> 主要功能</h3><ul><li><strong>服务限流降级</strong> ：默认支持 WebServlet、WebFlux, OpenFeign、RestTemplate、Spring Cloud Gateway, Zuul, Dubbo 和 RocketMQ 限流降级功能的接入，可以在运行时通过控制台实时修改限流降级规则，还支持查看限流降级 Metrics 监控。</li><li><strong>服务注册与发现</strong> ：适配 Spring Cloud 服务注册与发现标准，默认集成了 Ribbon 的支持。</li><li><strong>分布式配置管理</strong> ：支持分布式系统中的外部化配置，配置更改时自动刷新。</li><li><strong>消息驱动能力</strong> ：基于 Spring Cloud Stream 为微服务应用构建消息驱动能力。</li><li><strong>分布式事务</strong> ：使用 @GlobalTransactional 注解， 高效并且对业务零侵入地解决分布式事务问题。</li><li><strong>阿里云对象存储</strong> ：阿里云提供的海量、安全、低成本、高可靠的云存储服务。支持在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li><li><strong>分布式任务调度</strong> ：提供秒级、精准、高可靠、高可用的定时（基于 Cron 表达式）任务调度服务。同时提供分布式的任务执行模型，如网格任务。网格任务支持海量子任务均匀分配到所有 Worker（schedulerx-client）上执行。</li><li><strong>阿里云短信服务</strong> ：覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</li></ul><h3 id="组件"><a class="anchor" href="#组件">#</a> 组件</h3><p><strong>[Sentinel]</strong> ：阿里巴巴源产品，把流量作为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</p><p><strong>[Nacos]</strong> ：一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p><p><strong>[RocketMQ]</strong> ：一款开源的分布式消息系统，基于高可用分布式集群技术，提供低延时的、高可靠的消息发布与订阅服务。</p><p><strong>[Dubbo]</strong> ：Apache Dubbo™ 是一款高性能 Java RPC 框架。</p><p><strong>[Seata]</strong> ：阿里巴巴开源产品，一个易于使用的高性能微服务分布式事务解决方案。</p><p><strong>[Alibaba Cloud OSS]</strong> : 阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。您可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。</p><p><strong>[Alibaba Cloud SchedulerX]</strong>: 阿里中间件团队开发的一款分布式任务调度产品，提供秒级、精准、高可靠、高可用的定时（基于 Cron 表达式）任务调度服务。</p><p><strong>[Alibaba Cloud SMS]</strong> : 覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</p><h1 id="spring-cloud-alibaba-nacos下载和安装"><a class="anchor" href="#spring-cloud-alibaba-nacos下载和安装">#</a> Spring Cloud Alibaba Nacos 下载和安装</h1><h2 id="nacos介绍"><a class="anchor" href="#nacos介绍">#</a> Nacos 介绍</h2><p>​	Nacos（Naming Configuration Service） 是一个易于使用的动态服务发现、配置和服务管理平台，用于构建云原生应用程序</p><p>​	<strong>服务发现是微服务架构中的关键组件之一</strong>。Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p><p>​	Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以 “服务” 为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p><h2 id="什么是nacos"><a class="anchor" href="#什么是nacos">#</a> 什么是 Nacos？</h2><ol><li><p>Nacos = <strong>注册中心 + 配置中心组合</strong></p></li><li><p>Nacos 支持几乎所有主流类型的 “服务” 的发现、配置和管理，常见的服务如下：</p><p>Kubernetes Service</p><p>gRPC &amp; Dubbo RPC Service</p><p>Spring Cloud RESTful Service</p></li></ol><h2 id="为何使用nacos"><a class="anchor" href="#为何使用nacos">#</a> 为何使用 Nacos？</h2><p>​	为何使用注册中心呢？我们以入住酒店的前台为例子，稍微加以解释。先设想一个没有服务前台的酒店，客人入住需要自己寻找合适居住的房间，客人不知道每个房间的情况，无法确定那个房间是打扫干净可以入住，客人只能逐个房间寻找，如果遇到已经居住房客的房间一定很尴尬，显然这是不正常的情况。正常的情况是酒店会安排服务台，酒店打扫干净可以入住的房间会登记注册到服务台，这样客人来住店，只需要在前台就可以查找到可以入住的房间，这样就无需等待快速的入住。显然，服务器提供发注册和发现机制可以让房客快速找到合适的房间，快速解决入住问题。</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915144412020.png" title="image-20210915144412020"><p>​	采用微服务以后，软件微服务组件各自独立，但最终还要组合为一个整体作为一个软件系统服务于最终客户，这时软件组件之间也需要彼此通讯，彼此调用方法。微服务架构内部发起通讯调用方法的一方成为 “<strong>服务消费者</strong>”，提供远程方法调用的服务器称为 “<strong>服务提供者</strong>”，往往为了提高系统性能，会提供多个服务器作为<strong>服务提供者</strong>，此时<strong>服务消费者</strong>找到<strong>服务提供者</strong>的过程，就类似于用户在找房间的过程。为了帮助<strong>服务消费者</strong>快速的发现<strong>服务提供者</strong>，在微服务框架中都会引入<strong>注册中心。注册中心</strong>类似于酒店的前台，提供在软件服务的注册和发现功能，<strong>服务提供者</strong>会先在注册中心进行<strong>注册</strong>，声明可以对外提供服务，而<strong>服务消费者</strong>只需要在注册中心就可以快速<strong>发现</strong>找到可以使用的服务，快速使用服务。注册中心实现了服务提供和服务消费的快速撮合功能。</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915151230064.png" title="image-20210915151230064"><h2 id="nacos下载和安装"><a class="anchor" href="#nacos下载和安装">#</a> Nacos 下载和安装</h2><p>官网网址：<span class="exturl" data-url="aHR0cHM6Ly9uYWNvcy5pby96aC1jbi9pbmRleC5odG1s">https://nacos.io/zh-cn/index.html</span></p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915113531807-1688998492428.png" title="image-20210915113531807"><p>官网文档网址：<span class="exturl" data-url="aHR0cHM6Ly9uYWNvcy5pby96aC1jbi9kb2NzL3F1aWNrLXN0YXJ0Lmh0bWw=">https://nacos.io/zh-cn/docs/quick-start.html</span></p><p>注意：使用官网推荐的稳定版本：</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915152238853-1688998494209.png" title="image-20210915152238853"><p>下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3MvcmVsZWFzZXM=">https://github.com/alibaba/nacos/releases</span></p><h4 id="下载之后安装过程"><a class="anchor" href="#下载之后安装过程">#</a> 下载之后安装过程</h4><ol><li>解压以后找到 bin 目录</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915163508347-1688998496663.png" title="image-20210915163508347"><ol start="2"><li><p>执行指令：</p><h3 id="linuxunixmac"><a class="anchor" href="#linuxunixmac">#</a> Linux/Unix/Mac</h3><p>启动命令 (standalone 代表着单机模式运行，非集群模式):</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sh</span> startup.sh <span class="token parameter variable">-m</span> standalone</pre></td></tr></table></figure><h3 id="windows"><a class="anchor" href="#windows">#</a> Windows</h3><p>启动命令 (standalone 代表着单机模式运行，非集群模式):</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>startup.cmd <span class="token parameter variable">-m</span> standalone</pre></td></tr></table></figure></li><li><p>结果：</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915163836699.png" title="image-20210915163836699"></li><li><p>得到结果以后为了验证是否成功开启 Nacos，我们需要访问：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4ODQ4L25hY29z">http://localhost:8848/nacos</span></p></li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915163952277-1688998507793.png" title="image-20210915163952277"><ol start="5"><li>出现此界面表示已经成功启动 Nacos，默认的账号密码是：nacos/nacos</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210915164224183-1688998510021.png" title="image-20210915164224183"><ol start="6"><li>到这里就是成功开启了 Nacos 服务了。</li></ol><h1 id="nacos服务提供者注册"><a class="anchor" href="#nacos服务提供者注册">#</a> Nacos 服务提供者注册</h1><h2 id="nacos代替eureka"><a class="anchor" href="#nacos代替eureka">#</a> Nacos 代替 Eureka</h2><p>​	Nacos 可以直接提供注册中心（Eureka）+ 配置中心（Config），所以它的好处显而易见，我们在上节课成功安装和启动了 Nacos 以后就可以发现 Nacos 本身就是一个小平台，它要比之前的 Eureka 更加方便，不需要我们在自己做配置。</p><h2 id="nacos服务注册中心"><a class="anchor" href="#nacos服务注册中心">#</a> Nacos 服务注册中心</h2><p>​	服务发现是微服务架构中的关键组件之一。在这样的架构中，手动为每个客户端配置服务列表可能是一项艰巨的任务，并且使得动态扩展极其困难。Nacos Discovery 帮助您自动将您的服务注册到 Nacos 服务器，Nacos 服务器会跟踪服务并动态刷新服务列表。此外，Nacos Discovery 将服务实例的一些元数据，如主机、端口、健康检查 URL、主页等注册到 Nacos。</p><p>​	学习任何知识我们都需要从它的官方文档入手，所以我们直接来看官网给我们提供的文档：<span class="exturl" data-url="aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWNsb3VkLWFsaWJhYmEjbGVhcm4=">https://spring.io/projects/spring-cloud-alibaba#learn</span></p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210916145054013.png" title="image-20210916145558297"> <img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210916145054014.png" title="image-20210916145707907"><p>​</p><h2 id="如何引入nacos-discovery进行服务注册发现"><a class="anchor" href="#如何引入nacos-discovery进行服务注册发现">#</a> 如何引入 Nacos Discovery 进行服务注册 / 发现</h2><h3 id="创建新项目"><a class="anchor" href="#创建新项目">#</a> 创建新项目</h3><p>聚合项目：由于聚合带来的诸多好处，在 SpringBoot 项目开发中也广泛采用，开发中将 SpringBoot 项目按照功能分成子模块开发，所以我们在使用 Spring Cloud Alibaba 完成项目的时候，也是采用聚合项目来完成。</p><p>​	父项目</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210916172456588.png" title="image-20210916172456588"><p>​	子项目</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210916175756108.png" title="image-20210916175756108"><h3 id="pom"><a class="anchor" href="#pom">#</a> POM</h3><p>​	父项目 pom 文件</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span> xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">></span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>parent<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>parent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">2.4</span><span class="token number">.10</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token operator">&lt;</span>relativePath<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> lookup parent from repository <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>mashibing<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span><span class="token class-name">SpringCloudAlibabaMSB</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">></span></span><span class="token class-name">SpringCloudAlibabaMSB</span><span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>packaging<span class="token punctuation">></span></span>pom<span class="token operator">&lt;</span><span class="token operator">/</span>packaging<span class="token operator">></span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>description<span class="token punctuation">></span></span><span class="token class-name">SpringCloudAlibabaMSB</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">></span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>properties<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>version<span class="token punctuation">></span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>java<span class="token punctuation">.</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token operator">&lt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>version<span class="token operator">></span><span class="token number">2.2</span><span class="token number">.5</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token operator">&lt;</span><span class="token operator">/</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>tomcat<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">></span></span>provided<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">></span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">></span></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">></span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>dependencyManagement<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>dependencies<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>alibaba<span class="token operator">-</span>version<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token generics"><span class="token punctuation">&lt;</span>type<span class="token punctuation">></span></span>pom<span class="token operator">&lt;</span><span class="token operator">/</span>type<span class="token operator">></span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">></span></span><span class="token keyword">import</span><span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">></span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencyManagement<span class="token operator">></span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>modules<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">module</span><span class="token punctuation">></span></span>cloudAlibaba<span class="token operator">-</span><span class="token class-name">Nacos</span><span class="token operator">-</span><span class="token number">9001</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">></span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>modules<span class="token operator">></span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">></span></pre></td></tr></table></figure><p>​	子项目 pom 文件</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span> xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">></span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>parent<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>mashibing<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span><span class="token class-name">SpringAlibabaMSB</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token operator">&lt;</span>relativePath<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> lookup parent from repository <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>mashibing<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">9001</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">9001</span><span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>description<span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">9001</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">></span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>discovery<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">></span></pre></td></tr></table></figure><h3 id="yml"><a class="anchor" href="#yml">#</a> YML</h3><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210916180029680.png" title="image-20210916180029680"><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>server<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  port<span class="token operator">:</span> <span class="token number">9001</span></pre></td></tr><tr><td data-num="3"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  application<span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name<span class="token operator">:</span> nacos<span class="token operator">-</span>provider</pre></td></tr><tr><td data-num="6"></td><td><pre>  cloud<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    discovery<span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      server<span class="token operator">-</span>addr<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>management<span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  endpoint<span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    web<span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      exposure<span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        include<span class="token operator">:</span> <span class="token char">'*'</span></pre></td></tr></table></figure><h3 id="启动类"><a class="anchor" href="#启动类">#</a> 启动类</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>cloudalibabanacos9001</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token annotation punctuation">@SpringBootApplication</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token comment">// 加此注解</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloudalibabaNacos9001Application</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">CloudalibabaNacos9001Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="业务类"><a class="anchor" href="#业务类">#</a> 业务类</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;server.port&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/mashibing"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"Hello Nacos Discovery"</span><span class="token operator">+</span>serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="测试"><a class="anchor" href="#测试">#</a> 测试</h3><p><strong>注意，在启动项目前一定要启动 Nacos</strong></p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210916180252032.png" title="image-20210916180252032"><h2 id="练习"><a class="anchor" href="#练习">#</a> 练习</h2><p>​	根据上面的练习演示，在创建一个新的 9002 端口作为服务注册到 Nacos 中，为了下节课来做准备</p><h1 id="nacos服务消费者注册和负载均衡"><a class="anchor" href="#nacos服务消费者注册和负载均衡">#</a> Nacos 服务消费者注册和负载均衡</h1><h2 id="服务消费者"><a class="anchor" href="#服务消费者">#</a> 服务消费者</h2><p>​	上节课我们成功配置了 Nacos 服务提供者的注册，那么这节课我们将配置服务消费者，同时来验证 Nacos 自带负载均衡。</p><h2 id="具体配置"><a class="anchor" href="#具体配置">#</a> 具体配置</h2><h3 id="新建module"><a class="anchor" href="#新建module">#</a> 新建 Module</h3><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210917135655649-1688998535785.png" title="image-20210917135655649"><h4 id="pom-2"><a class="anchor" href="#pom-2">#</a> pom</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span> xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">></span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>parent<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>mashibing<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span><span class="token class-name">SpringAlibabaMSB</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token operator">&lt;</span>relativePath<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> lookup parent from repository <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>mashibing<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>consumer<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">8083</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>consumer<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">8083</span><span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>description<span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>consumer<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">8083</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">></span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>properties<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>version<span class="token punctuation">></span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>java<span class="token punctuation">.</span>version<span class="token operator">></span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">></span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>discovery<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">></span></pre></td></tr></table></figure><p>注意父项目要添加<models>标记</models></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token generics"><span class="token punctuation">&lt;</span>modules<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">module</span><span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">9001</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">module</span><span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">9002</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">module</span><span class="token punctuation">></span></span>cloudalibaba<span class="token operator">-</span>consumer<span class="token operator">-</span>nacos<span class="token operator">-</span><span class="token number">8083</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>modules<span class="token operator">></span></pre></td></tr></table></figure><h4 id="yml-2"><a class="anchor" href="#yml-2">#</a> yml</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>server<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  port<span class="token operator">:</span> <span class="token number">8083</span></pre></td></tr><tr><td data-num="3"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  application<span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name<span class="token operator">:</span> nacos<span class="token operator">-</span>consumer</pre></td></tr><tr><td data-num="6"></td><td><pre>  cloud<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    discovery<span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span></pre></td></tr></table></figure><h4 id="主启动"><a class="anchor" href="#主启动">#</a> 主启动</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>cloudalibabaconsumernacos8083</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token annotation punctuation">@SpringBootApplication</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@EnableDiscoveryClient</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloudalibabaConsumerNacos8083Application</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">CloudalibabaConsumerNacos8083Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="测试-2"><a class="anchor" href="#测试-2">#</a> 测试</h4><p>注意：要先启动 Nacos，然后再来启动服务</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210917140345089.png" title="image-20210917140345089"><h2 id="远程调用ribbon"><a class="anchor" href="#远程调用ribbon">#</a> 远程调用 Ribbon</h2><p>​	大家现在肯定很疑惑，这个服务消费者不是要调用具体服务吗？但是现在仅仅是创建出来了，和上节课创建的服务者也没有多大的区别啊？这具体怎么用那？</p><p>是这样的，我们现在想要让这个服务的消费者去调用服务提供者，我们就需要通过 Ribbon 来进行调用，那么首先我们先来了解 Ribbon。</p><h4 id="什么是ribbon"><a class="anchor" href="#什么是ribbon">#</a> 什么是 Ribbon</h4><p>​	它是一个基于 HTTP 和 TCP<strong> 客户端</strong>负载均衡器。它虽然只是一个工具类库，它却是<strong>每一个微服务</strong>的基础设施。因为实际上，对于服务间调用、API 网关请求转发都需要经过 Ribbon 负载均衡来实现。总体来说，Ribbon 的主要作用是：从注册服务器端拿到对应服务列表后以负载均衡的方式访问对应服务。</p><p>​	何时使用 Ribbon 呢？一般情况下当一个模块需要从另外一个模块获取数据时候就需要使用 Ribbon 的远程访问功能了。</p><p>​	要注意的是 Nacos 已经整合了 Ribbon，所以我们想要使用只需要导入 Spring Cloud Alibaba Nacos 的依赖就可以直接使用了。</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210917145544074.png" title="image-20210917145544074"><p>​</p><h4 id="具体使用"><a class="anchor" href="#具体使用">#</a> 具体使用</h4><p>RestTemplate 封装了 Ribbon 调用的过程，其中 getForObject 是最常用方法，同时还要在服务消费者中配置 RestTemplate：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@LoadBalanced</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">,</span>arg3<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>第一个参数 url 表示被调用的目标 Rest 接口位置</strong></p><ol><li>url 的第一部分是在 Nacos 中注册的服务提供者名称，如果多个服务提供者注册相同名称，Ribbon 会自动寻找其中一个服务提供者，并且调用接口方法。这个就是负载均衡功能。</li><li>url 后半部是控制器的请求路径。</li></ol><p><strong>第二个参数是返回值类型</strong></p><ol><li>JavaBean 类型或者 JavaBean 数组类型，如果控制器返回的是 List 集合，需要使用数组类型接收。</li></ol><p><strong>第三个参数是可变参数</strong></p><ol><li>是传递给 url 的动态参数，使用参数时候需要在 url 上需要使用 {1}、{2}、{3} 进行参数占位，这样传递的参数就会自动替换占位符。</li></ol><h2 id="验证nacos自带负载均衡"><a class="anchor" href="#验证nacos自带负载均衡">#</a> 验证 Nacos 自带负载均衡</h2><p>​	我们现在知道了如果我们想要让服务消费者 consumer-nacos-8083 调用服务提供者 nacos-9001 或者 9002，那么必然要使用 Ribbon，所以我们要做的第一件事情就是先让 9001 或者 9002 服务对外提供接口，用于访问，由于 9001 已经有对外提供的接口了，所以我们只需要仿照完成 9002 即可</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>cloudalibabanacos9002<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;server.port&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/mashibing"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"Hello Nacos Discovery"</span><span class="token operator">+</span>serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>​	接下来我们就需要通过服务消费 8083 者来访问 9001 或者 9002，但是在这之前，我们先在 consumer-nacos-8083 模块中的 yml 文件里添加一句话</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>server<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  port<span class="token operator">:</span> <span class="token number">8083</span></pre></td></tr><tr><td data-num="3"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  application<span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name<span class="token operator">:</span> nacos<span class="token operator">-</span>consumer</pre></td></tr><tr><td data-num="6"></td><td><pre>  cloud<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    discovery<span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre># 消费者将要去访问的微服务名称（注册成功的<span class="token class-name">Nacos</span>的微服务提供者）</pre></td></tr><tr><td data-num="11"></td><td><pre>service<span class="token operator">-</span>url<span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  nacos<span class="token operator">-</span>user<span class="token operator">-</span>service<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nacos<span class="token operator">-</span>provider</pre></td></tr></table></figure><p>​	因为我们要是使用 Ribbon，所以我们还需要在启动类上配置 restTemplate</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span><span class="token class-name">LoadBalanced</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@SpringBootApplication</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token annotation punctuation">@EnableDiscoveryClient</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloudalibabaConsumerNacos8083Application</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">CloudalibabaConsumerNacos8083Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token annotation punctuation">@LoadBalanced</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>​	配置好之后，我们就可以在 8083 的消费者上来通过 Ribbon 来自动的负载均衡调用 9001 或者 9002 的服务提供者了</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>cloudalibabaconsumernacos8083<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token annotation punctuation">@Resource</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="18"></td><td><pre>     * 消费者去访问具体服务，这种写法可以实现</pre></td></tr><tr><td data-num="19"></td><td><pre>     * 配置文件和代码的分离</pre></td></tr><tr><td data-num="20"></td><td><pre>     */</pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;service-url.nacos-user-service&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> serverURL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"consumer/nacos"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serverURL<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>serverURL<span class="token operator">+</span><span class="token string">"/mashibing"</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>测试结果：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>访问：http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">8083</span><span class="token operator">/</span>consumer<span class="token operator">/</span>nacos</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>结果：<span class="token class-name">Hello</span> <span class="token class-name">Nacos</span> <span class="token class-name">Discovery9001</span><span class="token operator">/</span><span class="token function">9002</span><span class="token punctuation">(</span>负载均衡切换显示<span class="token punctuation">)</span></pre></td></tr></table></figure><p>总结：因为 Nacos 中本身就集成了 Ribbon 所以它本身就自带负载均衡</p><h1 id="nacos服务注册中心对比提升"><a class="anchor" href="#nacos服务注册中心对比提升">#</a> Nacos 服务注册中心对比提升</h1><h2 id="各种服务注册中心对比"><a class="anchor" href="#各种服务注册中心对比">#</a> 各种服务注册中心对比</h2><table><thead><tr><th>服务注册与发现框架</th><th>CAP 模型</th><th>控制台管理</th><th>社区活跃度</th></tr></thead><tbody><tr><td>Eureka</td><td>AP</td><td>支持</td><td>低 (2.x 版本闭源)</td></tr><tr><td>Zookeeper</td><td>CP</td><td>不支持</td><td>中</td></tr><tr><td>Consul</td><td>CP</td><td>支持</td><td>高</td></tr><tr><td>Nacos</td><td>AP/CP</td><td>支持</td><td>高</td></tr></tbody></table><h3 id="cap模型"><a class="anchor" href="#cap模型">#</a> CAP 模型</h3><p>​	计算机专家 埃里克・布鲁尔（Eric Brewer）于 2000 年在 ACM 分布式计算机原理专题讨论会（简称：PODC）中提出的分布式系统设计要考虑的三个核心要素：</p><p>​ 一致性（Consistency）：同一时刻的同一请求的实例返回的结果相同，所有的数据要求具有强一致性 (Strong Consistency)</p><p>​ 可用性（Availability）：所有实例的读写请求在一定时间内可以得到正确的响应</p><p>​ 分区容错性（Partition tolerance）：在网络异常（光缆断裂、设备故障、宕机）的情况下，系统仍能提供正常的服务</p><p>​	以上三个特点就是 CAP 原则（又称 CAP 定理），但是三个特性不可能同时满足，所以分布式系统设计要考虑的是在满足 P（分区容错性）的前提下选择 C（一致性）还是 A（可用性），即：CP 或 AP</p><h3 id="cp原则一致性-分区容错性原则"><a class="anchor" href="#cp原则一致性-分区容错性原则">#</a> CP 原则：一致性 + 分区容错性原则</h3><p>​	CP 原则属于强一致性原则，要求所有节点可以查询的数据随时都要保持一直（同步中的数据不可查询），即：若干个节点形成一个逻辑的共享区域，某一个节点更新的数据都会立即同步到其他数据节点之中，当数据同步完成后才能返回成功的结果，但是在实际的运行过程中网络故障在所难免，如果此时若干个服务节点之间无法通讯时就会出现错误，从而牺牲了以可用性原则（A），例如关系型数据库中的事务。</p><h3 id="ap原则可用性原则-分区容错性原则"><a class="anchor" href="#ap原则可用性原则-分区容错性原则">#</a> AP 原则：可用性原则 + 分区容错性原则</h3><p>​	AP 原则属于弱一致性原则，在集群中只要有存活的节点那么所发送来的所有请求都可以得到正确的响应，在进行数据同步处理操作中即便某些节点没有成功的实现数据同步也返回成功，这样就牺牲一致性原则（C 原则）。</p><p>​	使用场景：对于数据的同步一定会发出指令，但是最终的节点是否真的实现了同步，并不保证，可是却可以及时的得到数据更新成功的响应，可以应用在网络环境不是很好的场景中。</p><p>​</p><h2 id="nacos支持cp和ap"><a class="anchor" href="#nacos支持cp和ap">#</a> Nacos 支持 CP 和 AP</h2><p>​	Nacos 无缝支持一些主流的开源生态，同时再阿里进行 Nacos 设计的时候重复的考虑到了市场化的运作（市面上大多都是以单一的实现形式为主，例如：Zookeeper 使用的是 CP、而 Eureka 采用的是 AP），在 Nacos 中提供了两种模式的动态切换。</p><p>​	<img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210923165642323.png" title="image-20210923165642323"></p><h2 id="nacos-何时选择切换模式"><a class="anchor" href="#nacos-何时选择切换模式">#</a> Nacos 何时选择切换模式</h2><ol><li><p>一般来说，如果不需要储存服务界别的信息且服务实例通过 nacos-client 注册，并能够保持心跳上报，那么就可以选择 AP 模式。如 Spring Cloud 和 Dubbo，都适用于 AP 模式，AP 模式为了服务的可用性减弱了一致性，因此 AP 模式下只支持注册临时实例。</p></li><li><p>如果需要在服务级别编辑或者储存配置信息，那么 CP 是必须的，K8S 服务和 DNS 服务则是用于 CP 模式。CP 模式下则支持注册持久化实例，此时则是以 Raft 协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不存在，则会返回错误。</p></li><li><p>切换命令（默认是 AP）：</p></li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span><span class="token class-name">X</span> <span class="token constant">PUT</span> '$<span class="token constant">NACOS_SERVER</span><span class="token operator">:</span><span class="token number">8848</span><span class="token operator">/</span>nacos<span class="token operator">/</span>v1<span class="token operator">/</span>ns<span class="token operator">/</span>operator<span class="token operator">/</span>switches<span class="token operator">?</span>entry<span class="token operator">=</span>serverMode<span class="token operator">&amp;</span>value<span class="token operator">=</span><span class="token constant">CP</span>'</pre></td></tr></table></figure><p>注意：临时和持久化的区别主要在健康检查失败后的表现，持久化实例健康检查失败后会被标记成不健康，而临时实例会直接从列表中被删除。</p><h1 id="nacos之服务配置中心"><a class="anchor" href="#nacos之服务配置中心">#</a> Nacos 之服务配置中心</h1><h2 id="基础配置"><a class="anchor" href="#基础配置">#</a> 基础配置</h2><p>Nacos 不仅仅可以作为注册中心来使用，同时它支持作为配置中心</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924140930824.png" title="image-20210924140930824"><p>首先我们还是新建 Model：cloudalibaba-config-3377</p><h3 id="pom文件"><a class="anchor" href="#pom文件">#</a> pom 文件</h3><p>​	这里我们主要要引入的是此依赖，这个依赖依据在官网上可以找到:<span class="exturl" data-url="aHR0cHM6Ly9zcHJpbmctY2xvdWQtYWxpYmFiYS1ncm91cC5naXRodWIuaW8vZ2l0aHViLXBhZ2VzL2dyZWVud2ljaC9zcHJpbmctY2xvdWQtYWxpYmFiYS5odG1sI19hbl9leGFtcGxlX29mX3VzaW5nX25hY29zX2Rpc2NvdmVyeV9mb3Jfc2VydmljZV9yZWdpc3RyYXRpb25kaXNjb3ZlcnlfYW5kX2NhbGw=">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_an_example_of_using_nacos_discovery_for_service_registrationdiscovery_and_call</span></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span> </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud <span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span> </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span> spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>config <span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></pre></td></tr></table></figure><h3 id="yml配置"><a class="anchor" href="#yml配置">#</a> YML 配置</h3><p>​	要注意的是这里我们要配置两个，因为 Nacos 同 SpringCloud-config 一样，<strong>在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置之后，才能保证项目的正常启动</strong>。</p><p>​	<strong>springboot 中配置文件的加载是存在优先级顺序的，bootstrap 优先级高于 application</strong></p><p>​	分别要配置的是，这里 bootstrap.yml 配置好了以后，作用是两个，第一个让 3377 这个服务注册到 Nacos 中，第二个作用就是去 Nacos 中去读取指定后缀为 yaml 的配置文件：</p><p>bootstrap.yml</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre># nacos配置</pre></td></tr><tr><td data-num="2"></td><td><pre>server<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  port<span class="token operator">:</span> <span class="token number">3377</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  application<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    name<span class="token operator">:</span> nacos<span class="token operator">-</span>config<span class="token operator">-</span>client</pre></td></tr><tr><td data-num="8"></td><td><pre>  cloud<span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    nacos<span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      discovery<span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span> #<span class="token class-name">Nacos</span>服务注册中心地址</pre></td></tr><tr><td data-num="12"></td><td><pre>      config<span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span> #<span class="token class-name">Nacos</span>作为配置中心地址</pre></td></tr><tr><td data-num="14"></td><td><pre>        file<span class="token operator">-</span>extension<span class="token operator">:</span> yaml #指定yaml格式的配置</pre></td></tr></table></figure><p>application.yml</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  profiles<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    active<span class="token operator">:</span> dev # 表示开发环境</pre></td></tr></table></figure><h3 id="主启动-2"><a class="anchor" href="#主启动-2">#</a> 主启动</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>cloudalibabaconfig3377</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token annotation punctuation">@SpringBootApplication</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@EnableDiscoveryClient</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloudalibabaConfig3377Application</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">CloudalibabaConfig3377Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="业务类-2"><a class="anchor" href="#业务类-2">#</a> 业务类</h3><p>​	这里的 @RefreshScope 实现配置自动更新，意思为如果想要使配置文件中的配置修改后不用重启项目即生效，可以使用 @RefreshScope 配置来实现</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>context<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RefreshScope</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">// 支持 Nacos 的动态刷新功能</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;config.info&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> configInfo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/config/info"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="nacos配置规则"><a class="anchor" href="#nacos配置规则">#</a> Nacos 配置规则</h3><p>​	在 Nacos Spring Cloud 中， <code>dataId</code> 的完整格式如下（详情可以参考官网 <span class="exturl" data-url="aHR0cHM6Ly9uYWNvcy5pby96aC1jbi9kb2NzL3F1aWNrLXN0YXJ0LXNwcmluZy1jbG91ZC5odG1sJUVGJUJDJTg5JUVGJUJDJTlB">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html）：</span></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>$<span class="token punctuation">&#123;</span>prefix<span class="token punctuation">&#125;</span><span class="token operator">-</span>$<span class="token punctuation">&#123;</span>spring<span class="token punctuation">.</span>profiles<span class="token punctuation">.</span>active<span class="token punctuation">&#125;</span><span class="token punctuation">.</span>$<span class="token punctuation">&#123;</span>file<span class="token operator">-</span>extension<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol><li><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code> 来配置。</li><li><code>spring.profiles.active</code> 即为当前环境对应的 profile，注意：<strong>当 <code>spring.profiles.active</code> 为空时，对应的连接符 <code>-</code> 也将不存在，dataId 的拼接格式变成 <code>$&#123;prefix&#125;.$&#123;file-extension&#125;</code> </strong>（不能删除）</li><li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li><li>通过 Spring Cloud 原生注解 <code>@RefreshScope</code> 实现配置自动更新：</li><li><strong>所以根据官方给出的规则我们最终需要在 Nacos 配置中心添加的配置文件的名字规则和名字为：</strong></li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre># $<span class="token punctuation">&#123;</span>spring<span class="token punctuation">.</span>application<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">-</span>$<span class="token punctuation">&#123;</span>spring<span class="token punctuation">.</span>profiles<span class="token punctuation">.</span>active<span class="token punctuation">&#125;</span><span class="token punctuation">.</span>$<span class="token punctuation">&#123;</span>file<span class="token operator">-</span>extension<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre># nacos<span class="token operator">-</span>config<span class="token operator">-</span>client<span class="token operator">-</span>dev<span class="token punctuation">.</span>yaml</pre></td></tr><tr><td data-num="3"></td><td><pre># 微服务名称<span class="token operator">-</span>当前环境<span class="token operator">-</span>文件格式</pre></td></tr></table></figure><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924154026491.png" title="image-20210924160100192"><h2 id="nacos平台创建配置操作"><a class="anchor" href="#nacos平台创建配置操作">#</a> Nacos 平台创建配置操作</h2><p>增加配置</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924154802374.png" title="image-20210924154802374"> <img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924155218752.png" title="image-20210924160459681"><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>config<span class="token operator">:</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>    info<span class="token operator">:</span> nacos config center<span class="token punctuation">,</span>version <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr></table></figure><p>然后在配置中心就会看到刚刚发布的配置</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924155315617.png" title="image-20210924155315617"><h2 id="自动配置更新"><a class="anchor" href="#自动配置更新">#</a> 自动配置更新</h2><p>修改 Nacos 配置，不需要重启项目即可自动刷新</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924195241683.png" title="image-20210924195241683"><p>修改版本号为 2，点击发布</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924195325905.png" title="image-20210924195325905"><h2 id="测试-3"><a class="anchor" href="#测试-3">#</a> 测试</h2><p>启动服务访问服务来测试（没有修改之前是 1，修改之后不需要重启项目既可以直接获取最新配置）：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDozMzc3L2NvbmZpZy9pbmZv">http://localhost:3377/config/info</span></p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210924182159179.png" title="image-20210924182159179"><h2 id="bootsrap文件不读取问题"><a class="anchor" href="#bootsrap文件不读取问题">#</a> bootsrap.* 文件不读取问题</h2><p><strong>在 spring cloud2.4 之后将<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1ib290c3RyYXAmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw"> bootstrap</span>.enabled 设置为 false。</strong></p><h3 id="解决方式一"><a class="anchor" href="#解决方式一">#</a> 解决方式一：</h3><p>添加 bootstrap 的 POM 依赖：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">&lt;!-- 自行修改相应版本 --></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h3 id="解决方式二"><a class="anchor" href="#解决方式二">#</a> 解决方式二：</h3><p>添加环境变量：</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/e38c1ae0a79547ae9928236355f7cc3a.png" title="img"><p>spring.cloud.bootstrap.enabled=true</p><p>** 特殊说明：** 如果你不是 spring cloud 项目，只是 spring boot 项目，在启动无法加载到 bootstrap 的配置，应该为如下解决方式：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.0.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h1 id="nacos命名空间分组和dataid三者关系"><a class="anchor" href="#nacos命名空间分组和dataid三者关系">#</a> Nacos 命名空间分组和 DataID 三者关系</h1><h2 id="名词解释"><a class="anchor" href="#名词解释">#</a> 名词解释</h2><p><strong>命名空间</strong>（Namespace）</p><p>​	用于进行租户粒度的配置隔离。不同的命名空间下，可以存在相同的 Group 或 Data ID 的配置。Namespace 的常用场景之一是不同环境的配置的区分隔离，例如开发测试环境和生产环境的资源（如配置、服务）隔离等。</p><p><strong>配置分组</strong>（Group）</p><p>​	Nacos 中的一组配置集，是组织配置的维度之一。通过一个有意义的字符串（如 Buy 或 Trade ）对配置集进行分组，从而区分 Data ID 相同的配置集。当您在 Nacos 上创建一个配置时，如果未填写配置分组的名称，则配置分组的名称默认采用 DEFAULT_GROUP 。配置分组的常见场景：不同的应用或组件使用了相同的配置类型，如 database_url 配置和 MQ_topic 配置。</p><p><strong>配置集 ID</strong>（Data ID）</p><p>​	Nacos 中的某个配置集的 ID。配置集 ID 是组织划分配置的维度之一。Data ID 通常用于组织划分系统的配置集。一个系统或者应用可以包含多个配置集，每个配置集都可以被一个有意义的名称标识。Data ID 通常采用类 Java 包（如 com.taobao.tc.refund.log.level）的命名规则保证全局唯一性。此命名规则非强制。</p><p>​	配置集：一组相关或者不相关的配置项的集合称为配置集。在系统中，一个配置文件通常就是一个配置集，包含了系统各个方面的配置。例如，一个配置集可能包含了数据源、线程池、日志级别等配置项。</p><h3 id="三者关系"><a class="anchor" href="#三者关系">#</a> 三者关系</h3><p>​	这三者的关系类似于 Java 里面的 package 名和类名，最外层的 Namespace 是可以用于区分部署环境的，Group 和 DataID 逻辑上区分两个目标对象。</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/sanzheguanxi%20.png" title="sanzheguanxi"><p><strong>默认情况</strong></p><p>Namespace=public，Group=DEFAULT_GROUP，默认 Cluster 是 DEFAULT</p><p><strong>具体情况</strong></p><p>​	Nacos 默认的命名空间是 public，我们就可以利用 Namespace 来实现隔离，比如我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个 Namespace，不同的 N amespace 之间是隔离的。</p><p>​	Group 本身就是分组的意思，它可以把不同的微服务划分到同一个分组里面去。</p><p>​	剩下的就是具体微服务，一个 Service 可以包含多个 Cluster，Nacos 默认 Cluster 是 DEFAULT，Cluster 是对指定微服务的一个虚拟划分。比如说，将一个 Service 部署在北京和和杭州的机房中，北京机房的 Service 就可以起名为（BJ），杭州机房中的 Service 就可以起名为（HZ），这样就可以尽量让同一个机房的微服务互相调用，提升性能。</p><h2 id="切换不同环境"><a class="anchor" href="#切换不同环境">#</a> 切换不同环境</h2><h3 id="dataid方案"><a class="anchor" href="#dataid方案">#</a> DataID 方案</h3><ol><li><p>指定 spring.profile.active 和配置文件的 DataID 来使不同环境下读取不同的配置，配置规则：默认空间 + 新建 dev 和 test 两个 DataId：</p><ol><li>新建 dev 配置 DataID（已经创建完成）</li><li>新建 test 配置 DataID</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926170016223.png" title="image-20210926170016223"></li><li><p>通过 spring.profile.active 属性就能进行多环境下配置文件的读取</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926170339921.png" title="image-20210926170339921"> <img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926170620844.png" title="image-20210926170620844"><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  profiles<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    # active<span class="token operator">:</span> dev #表示开发环境</pre></td></tr><tr><td data-num="4"></td><td><pre>    active<span class="token operator">:</span> test #表示测试环境</pre></td></tr></table></figure></li><li><p>测试</p><p>最后再次访问：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDozMzc3L2xvY2FsaG9zdC9jb25maWcvaW5mbw==">http://localhost:3377/localhost/config/info</span></p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926170942161.png" title="image-20210926170942161"></li></ol><h3 id="group方案"><a class="anchor" href="#group方案">#</a> Group 方案</h3><p>​	根据之前的讲解我们都知道 Group 为分组默认是：DEFAULT_GROUP，所以现在我们就需要分出两组，一组是 “Dev 开发组”，一组是 “test 测试组”</p><ol><li><p>新建 Group</p><p>DEV_GROUP</p></li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926171610558.png" title="image-20210926171610558"><p>​ TEST_GROUP</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926171904382.png" title="image-20210926171904382"><p>配置列表，两个 DataID 一致，但是分组不同的配置文件：</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926171954022.png" title="image-20210926171954022"><ol start="2"><li>完成以上配置以后，接下来就需要通过 bootstrap+application 来配合完成，具体方式：在 config 下增加一条 Group 的配置即可，可以配置为 DEV_GROUP 或 TEST_GROUP</li></ol><p>​	bootstrap:</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre># nacos配置</pre></td></tr><tr><td data-num="2"></td><td><pre>server<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  port<span class="token operator">:</span> <span class="token number">3377</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  application<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    name<span class="token operator">:</span> nacos<span class="token operator">-</span>config<span class="token operator">-</span>client</pre></td></tr><tr><td data-num="8"></td><td><pre>  cloud<span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    nacos<span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      discovery<span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span> #<span class="token class-name">Nacos</span>服务注册中心地址</pre></td></tr><tr><td data-num="12"></td><td><pre>      config<span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span> #<span class="token class-name">Nacos</span>作为配置中心地址</pre></td></tr><tr><td data-num="14"></td><td><pre>        file<span class="token operator">-</span>extension<span class="token operator">:</span> yaml #指定yaml格式的配置</pre></td></tr><tr><td data-num="15"></td><td><pre>        group<span class="token operator">:</span> <span class="token constant">TEST_GROUP</span> #增加分组</pre></td></tr></table></figure><p>​	application:</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  profiles<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    # active<span class="token operator">:</span> dev #表示开发环境</pre></td></tr><tr><td data-num="4"></td><td><pre>    # active<span class="token operator">:</span> test #表示测试环境</pre></td></tr><tr><td data-num="5"></td><td><pre>    active<span class="token operator">:</span> info</pre></td></tr></table></figure><ol start="3"><li><p>测试（可以测试不同分组）：</p><p>最后再次访问：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDozMzc3L2xvY2FsaG9zdC9jb25maWcvaW5mbw==">http://localhost:3377/localhost/config/info</span></p></li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926173730298.png" title="image-20210926173730298"><h3 id="namespace空间方案"><a class="anchor" href="#namespace空间方案">#</a> Namespace 空间方案</h3><p>​	我们已经把 DataID 方案和 Group 方案完成了，然后接下来我们来看一下 Namespace（命名空间）方案，默认此方案为 public，此方案不能删除，我们现在来新建两个命名空间方案</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926174051313.png" title="image-20210926174051313"><ol><li>新建 dev/test 的 Namespace</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926174422526.png" title="image-20210926174422526"> <img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926174807843.png" title="image-20210926174807843"><ol><li><p>服务管理 - 服务列表页面查看</p><p>此时我们就可以切换对应的命名空间，然后再通过 Group 和 DataID 来进行切换，如果想要切换命名空间，我们就需要通过命名空间 ID 来进行切换</p><p><img data-src="Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220721230227374.png" alt="image-20220721230227374"><img data-src="Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220721230244037.png" alt="image-20220721230244037"></p></li><li><p>按照域名配置（Namespace+Group+DataId）编写</p><p>​	先通过 namespace 命名空间 ID 来确认使用的命名空间</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926175605787.png" title="image-20210926175605787"><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre># nacos配置</pre></td></tr><tr><td data-num="2"></td><td><pre>server<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  port<span class="token operator">:</span> <span class="token number">3377</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  application<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    name<span class="token operator">:</span> nacos<span class="token operator">-</span>config<span class="token operator">-</span>client</pre></td></tr><tr><td data-num="8"></td><td><pre>  cloud<span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    nacos<span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      discovery<span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span> #<span class="token class-name">Nacos</span>服务注册中心地址</pre></td></tr><tr><td data-num="12"></td><td><pre>      config<span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span> #<span class="token class-name">Nacos</span>作为配置中心地址</pre></td></tr><tr><td data-num="14"></td><td><pre>        file<span class="token operator">-</span>extension<span class="token operator">:</span> yaml #指定yaml格式的配置</pre></td></tr><tr><td data-num="15"></td><td><pre>        group<span class="token operator">:</span> <span class="token constant">TEST_GROUP</span> # 指定分组</pre></td></tr><tr><td data-num="16"></td><td><pre>        namespace<span class="token operator">:</span> <span class="token number">4</span>ba4bf0e<span class="token operator">-</span><span class="token number">210</span>c<span class="token operator">-</span><span class="token number">41</span>ce<span class="token operator">-</span><span class="token number">954</span>c<span class="token operator">-</span><span class="token number">23538d</span>e1dcbc #指定命名空间</pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  profiles<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    active<span class="token operator">:</span> dev #表示开发环境</pre></td></tr><tr><td data-num="4"></td><td><pre>    # active<span class="token operator">:</span> test #表示测试环境</pre></td></tr><tr><td data-num="5"></td><td><pre>    # active<span class="token operator">:</span> info</pre></td></tr></table></figure><p>​</p><p>然后再回到 Nacos 配置列表，添加 Dev 命名空间下的配置，添加 3 条</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926180321810.png" title="image-20210926180321810"> <img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926180120552.png" title="image-20210926180120552"> <img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210926180520423.png" title="image-20210926180520423"></li><li><p>测试：访问 http://localhost:3377/localhost/config/info 来进行测试</p></li></ol><h1 id="nacos集群架构说明"><a class="anchor" href="#nacos集群架构说明">#</a> Nacos 集群架构说明</h1><p>​	到目前为止，我们已经对 Nacos 的一些基本使用和配置已经掌握，但是这些还不够，我们还需要了解一个非常重要的点，就是 Nacos 的集群相关的操作，那我们就先从 Nacos 集群配置的概念说起</p><h2 id="nacos支持三种部署模式"><a class="anchor" href="#nacos支持三种部署模式">#</a> Nacos 支持三种部署模式</h2><ol><li>单机模式 - 用于测试和单机试用</li><li>集群模式 - 用于生产环境，确保高可用</li><li>多集群模式 - 用于多数据中心场景</li></ol><h2 id="集群部署说明"><a class="anchor" href="#集群部署说明">#</a> 集群部署说明</h2><p>参考网站：<span class="exturl" data-url="aHR0cHM6Ly9uYWNvcy5pby96aC1jbi9kb2NzL2NsdXN0ZXItbW9kZS1xdWljay1zdGFydC5odG1s">https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</span></p><p><strong>架构图</strong>：部署生产使用的集群模式</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210927163629652.png" title="image-20210927163629652"><p><strong>具体拆分</strong></p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210927165142680.png" title="image-20210927165836853"><h2 id="预备环境"><a class="anchor" href="#预备环境">#</a> 预备环境</h2><p>​	默认 Nacos 使用嵌入式数据库实现数据的存储，所以，如果启动多个默认配置下的 Nacos 节点，数据储存存在一致性问题，为了解决这个问题，Nacos 采用了集中存储方式来支持集群化部署，目前仅支持 MySql 的存储。</p><ol><li>推荐使用 Linux</li><li>可以使用内部数据源或者外部数据源（推荐使用外部）MySql</li></ol><h1 id="nacos持久化切换配置"><a class="anchor" href="#nacos持久化切换配置">#</a> Nacos 持久化切换配置</h1><h2 id="nacos持久化配置"><a class="anchor" href="#nacos持久化配置">#</a> Nacos 持久化配置</h2><p>​	Nacos 默认自带嵌入式数据库 derby，所以我们每次创建一个 Nacos 实例就会有一个 derby，当有多个 Nacos 节点的时候，就会出现一致性问题，所以 Nacos 支持了外部数据库统一数据管理 MySql。</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210927174839244.png" title="image-20210927174839244"><h2 id="nacos默认derby切换mysql"><a class="anchor" href="#nacos默认derby切换mysql">#</a> Nacos 默认 derby 切换 MySql</h2><p>具体配置方式可以参考官网：<span class="exturl" data-url="aHR0cHM6Ly9uYWNvcy5pby96aC1jbi9kb2NzL2RlcGxveW1lbnQuaHRtbA==">https://nacos.io/zh-cn/docs/deployment.html</span></p><ol><li><p>我们需要找到 Nacos 安装目录下的 conf 目录中的 Sql 脚本，然后在数据库中进行执行</p><p>注意：需要我们先创建好数据库并且使用：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">CREATE</span> <span class="token class-name">DATABASE</span> nacos_config<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">USE</span> nacos_config<span class="token punctuation">;</span></pre></td></tr></table></figure></li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210927175150183.png" title="image-20210927175150183"><ol start="2"><li>修改<strong> conf/application.properties</strong> 文件，增加支持 mysql 数据源配置（目前只支持 mysql），添加 mysql 数据源的 url、用户名和密码。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>platform<span class="token operator">=</span>mysql</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>db<span class="token punctuation">.</span>num<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>db<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>nacos_config<span class="token operator">?</span>characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span>connectTimeout<span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span>socketTimeout<span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span>autoReconnect<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>serverTimezone<span class="token operator">=</span><span class="token constant">UTC</span></pre></td></tr><tr><td data-num="5"></td><td><pre>db<span class="token punctuation">.</span>user<span class="token operator">=</span>root</pre></td></tr><tr><td data-num="6"></td><td><pre>db<span class="token punctuation">.</span>password<span class="token operator">=</span>root</pre></td></tr></table></figure><p>​	这里表示更改 Nacos 数据库为本机 MySql 数据库</p><p><strong>注意：<strong>这里需要注意几个点，一个是 url 地址需要改，另外数据库的用户和密码也需要更改，同时还有一个是官网上在</strong> db.url.0=jdbc:mysql</strong> 这个属性上少了一个属性为<strong> serverTimezone=UTC</strong> 需要我们手动添加</p><h2 id="测试-4"><a class="anchor" href="#测试-4">#</a> 测试</h2><p>重启 Nacos 服务，此时之前所创建的 Namespace+Group+DataID 将全部消失，因为这些数据是保存在之前 Nacos 内嵌的 derby 数据库中，现在使用的是本地的 MySql 数据库，此时我们可以添加配置测试，在查看数据库 nacos_config 中的 config_info 表，此时就会有新添加的配置内容</p><h1 id="nacos之linux版本安装"><a class="anchor" href="#nacos之linux版本安装">#</a> Nacos 之 Linux 版本安装</h1><h2 id="linux版nacosmysql生产环境配置"><a class="anchor" href="#linux版nacosmysql生产环境配置">#</a> Linux 版 Nacos+MySql 生产环境配置</h2><p>​	在之前的课程中我们已经给大家讲解过了 Nacos 生产环境下需要搭建集群配置，那么这里我们预计需要：1 个 Nginx+3 个 Nacos 注册中心 + 1 个 MySql</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210927165142680-1688910942796.png" title="image-20210927165142680"><h2 id="具体配置-2"><a class="anchor" href="#具体配置-2">#</a> 具体配置：</h2><ol><li>在官网上下载 NacosLinux 版本：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3MvcmVsZWFzZXM=">https://github.com/alibaba/nacos/releases</span></li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210928163131899.png" title="image-20210928163131899"><ol start="2"><li>在 Linux 系统中解压此文件，并且把其中 nacos 目录拷贝到 nacos 目录中</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>tar <span class="token operator">-</span>zxvf nacos<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">2.0</span><span class="token number">.3</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</pre></td></tr></table></figure><ol start="3"><li>打开 nacos 目录下的 bin 目录输入命令即可执行</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210928183219115.png" title="image-20210928183219115"><h1 id="nacos集群配置"><a class="anchor" href="#nacos集群配置">#</a> Nacos 集群配置</h1><h2 id="更改nacos启动命令配置原理"><a class="anchor" href="#更改nacos启动命令配置原理">#</a> 更改 Nacos 启动命令配置原理</h2><p>我们现在知道，想要启动 Naocs 只需要启动 startup.sh 命令即可，但是如果启动 3 个 Nacos 那？所以如果我们需要启动多个 Nacos，其实 Nacos 本身默认启动就是集群模式。</p><p>注意点：如果是 linux 虚拟机，需要分配至少 4g 以上内存</p><h2 id="具体配置-3"><a class="anchor" href="#具体配置-3">#</a> 具体配置</h2><h3 id="linux服务器上mysql数据库配置"><a class="anchor" href="#linux服务器上mysql数据库配置">#</a> Linux 服务器上 MySql 数据库配置</h3><ol><li>在 Linux 系统上执行 SQL 脚本，具体位置在 nacos 目录下的 conf 中，这里的操作和之前是一样的，我们可以直接打开这个文件然后拷贝到数据库中执行，当然也是要创建数据库使用数据库然后在复制脚本内容，执行即可</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>create database nacos_config<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>use nacos_config<span class="token punctuation">;</span></pre></td></tr></table></figure><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210929175710498.png" title="image-20210929175710498"><ol start="2"><li>修改 application.properties 配置文件，但是修改之前我们最好做一个备份。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>cp application<span class="token punctuation">.</span>properties application<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>init</pre></td></tr></table></figure><ol start="3"><li>这里的修改和我们之间的在 win 上的修改是完全一样的，所以我们只要打开这个文件，加上对应的内容即可</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>platform<span class="token operator">=</span>mysql</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>db<span class="token punctuation">.</span>num<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>db<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>nacos_config<span class="token operator">?</span>characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span>connectTimeout<span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span>socketTimeout<span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span>autoReconnect<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>serverTimezone<span class="token operator">=</span><span class="token constant">UTC</span></pre></td></tr><tr><td data-num="5"></td><td><pre>db<span class="token punctuation">.</span>user<span class="token operator">=</span>root</pre></td></tr><tr><td data-num="6"></td><td><pre>db<span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token number">123456</span></pre></td></tr></table></figure><ol start="4"><li>还要注意一点，这个文件中的两个服务的端口号也要对应修改</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>#<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token class-name">Spring</span> <span class="token class-name">Boot</span> <span class="token class-name">Related</span> <span class="token class-name">Configurations</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>#</pre></td></tr><tr><td data-num="2"></td><td><pre>### <span class="token class-name">Default</span> web context path<span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>server<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>contextPath<span class="token operator">=</span><span class="token operator">/</span>nacos</pre></td></tr><tr><td data-num="4"></td><td><pre>### <span class="token class-name">Default</span> web server port<span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>server<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">8888</span><span class="token operator">/</span><span class="token number">8868</span></pre></td></tr></table></figure><h3 id="linux服务器上nacos的集群配置cluterconf"><a class="anchor" href="#linux服务器上nacos的集群配置cluterconf">#</a> Linux 服务器上 Nacos 的集群配置 cluter.conf</h3><ol><li>这里开始正式配置集群，首先我们要更改 cluter.conf 这个配置文件，当然我们也需要备份，但是这里它的原始名称为：cluster.conf.example，我们需要把它保留同时复制出一个 cluster.conf 来进行更改</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>cp cluster<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>example cluster<span class="token punctuation">.</span>conf</pre></td></tr></table></figure><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210929182825202.png" title="image-20210929182825202"><ol start="2"><li>具体配置内容，这里我们在配置集群的时候不能直接写 127.0.0.1 这样，这样分不清楚，所以我们需要知道具体的 IP 地址，我们可以通过：</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>ip a #查看具体ip</pre></td></tr></table></figure><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220321182422028.png" title="image-20220321182422028"><p>具体需修改内容，这里注意，我们在修改端口的时候一定要有一定的偏移量，因为 Nacos2.0 本身新增了占用端口，所以我们在设置端口号的时候注意要避开，不要占用端口，以下是官网截图：</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220321175516671.png" title="image-20220321175516671"><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre># 格式： ip地址<span class="token operator">:</span>端口号</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">192.168</span><span class="token number">.189</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">192.168</span><span class="token number">.189</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">8868</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">192.168</span><span class="token number">.189</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">8888</span></pre></td></tr></table></figure><h3 id="启动三个阶段的nacos测试"><a class="anchor" href="#启动三个阶段的nacos测试">#</a> 启动三个阶段的 Nacos 测试</h3><p>当上方配置完成之后，我们此时就可以启动三个节点的 Nacos 进行测试，启动方式和 Win 上区别不大：</p><ol><li>但是要注意一点，因为我们要开放端口测试，所以我们在启动 nacos 之前，要进行关闭防火墙操作：</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 关闭防火墙服务 - 但是开启还会自动启动</span></pre></td></tr><tr><td data-num="2"></td><td><pre>systemctl stop firewalld</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 彻底关闭 - 开机不会启动防火墙</span></pre></td></tr><tr><td data-num="4"></td><td><pre>systemctl disable firewalld</pre></td></tr></table></figure><ol start="2"><li>启动三个 nacos 节点，分别进入到三个 Nacos 节点的 bin 目录中进行启动：</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220321180934633.png" title="image-20220321180934633"><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>sh startup<span class="token punctuation">.</span>sh <span class="token comment">// 启动命令</span></pre></td></tr></table></figure><ol start="3"><li>启动完成以后，我们可以分别看一下启动日志，防止启动出现问题，启动路径：</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220321181649453.png" title="image-20220321181649453"><ol start="4"><li>这里我们可以通过 cat 命令或者 tail -f 命令</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>cat <span class="token operator">/</span>home<span class="token operator">/</span>msb<span class="token operator">/</span>opt<span class="token operator">/</span>nacos3<span class="token operator">/</span>logs<span class="token operator">/</span>start<span class="token punctuation">.</span>out</pre></td></tr><tr><td data-num="2"></td><td><pre>tail <span class="token operator">-</span>f <span class="token operator">/</span>home<span class="token operator">/</span>msb<span class="token operator">/</span>opt<span class="token operator">/</span>nacos3<span class="token operator">/</span>logs<span class="token operator">/</span>start<span class="token punctuation">.</span>out</pre></td></tr></table></figure><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220321181429986.png" title="image-20220321181429986"><ol start="5"><li>通过浏览器分别访问三个阶段的 Nacos，测试是否成功启动</li></ol><p>在看到所有服务都启动成功之后，我们通过浏览器访问对应地址，就可以进入到对应节点的 Nacos 控制台上，然后我们可以查看集群管理，节点列表</p><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220321182820980.png" title="image-20220321182820980"><p><strong>有可能只能启动一个，这是因为 JVM 设置的参数太大可以修改 start.sh 但是还是建议在开两台机器，将服务部署到其他机器上，还有一种办法就是将这个机器的内存调大大的</strong></p><h3 id="nginx配置"><a class="anchor" href="#nginx配置">#</a> Nginx 配置</h3><ol><li>我们需要找到 Nginx 的配置文件，然后做备份</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx</pre></td></tr><tr><td data-num="2"></td><td><pre>cp nginx<span class="token punctuation">.</span>conf nginx<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>bk</pre></td></tr></table></figure><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210929211042606.png" title="image-20210929211042606"><ol start="2"><li>修改 nginx.conf</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>events <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>stream <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      upstream nacos <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.52</span><span class="token operator">:</span><span class="token number">8848</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.52</span><span class="token operator">:</span><span class="token number">8868</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.52</span><span class="token operator">:</span><span class="token number">8888</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>     server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        listen  <span class="token number">81</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        proxy_pass nacos<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>     <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="测试启动"><a class="anchor" href="#测试启动">#</a> 测试启动</h2><ol><li>首先进入到 Nginx 目录下，启动 Nginx，同时要带着我们设置过得配置文件启动</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>sbin</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>/nginx</pre></td></tr></table></figure><ol start="2"><li>通过访问 Nginx 来测试是否能够访问到 Nacos，在 win 系统浏览器网址上输入：</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.189</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">81</span><span class="token operator">/</span>nacos<span class="token operator">/</span></pre></td></tr></table></figure><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210930150017223.png" title="image-20210930150017223"><ol start="3"><li>使用账号密码 nacos，nacos 成功登录就表示此时已经完成全部配置</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210930153201511.png" title="image-20210930153201511"><h3 id="添加配置"><a class="anchor" href="#添加配置">#</a> 添加配置</h3><ol><li>在 Nacos 平台上添加配置</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210930153148673.png" title="image-20210930153148673"><ol start="2"><li>在数据库中检查是否有这一条配置，如果有表示成功添加</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210930153709605.png" title="image-20210930153709605"><h3 id="配置微服务为linux版nacos集群并注册进nacos"><a class="anchor" href="#配置微服务为linux版nacos集群并注册进nacos">#</a> 配置微服务为 Linux 版 Nacos 集群并注册进 Nacos</h3><ol><li>我们以 9002 为例，此时我们要修改 application.yaml 文件，把之前的 Nacos 端口换成 Nacos 集群</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>server<span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  port<span class="token operator">:</span> <span class="token number">9002</span></pre></td></tr><tr><td data-num="3"></td><td><pre>spring<span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  application<span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name<span class="token operator">:</span> nacos<span class="token operator">-</span>provider</pre></td></tr><tr><td data-num="6"></td><td><pre>  cloud<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    nacos<span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      discovery<span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        # server<span class="token operator">-</span>addr<span class="token operator">:</span> localhost<span class="token operator">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        # 换成nginx的<span class="token number">81</span>端口，做集群</pre></td></tr><tr><td data-num="11"></td><td><pre>        server<span class="token operator">-</span>addr<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.189</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">81</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>management<span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  endpoint<span class="token operator">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    web<span class="token operator">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      exponsure<span class="token operator">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        include<span class="token operator">:</span> <span class="token char">'*'</span></pre></td></tr></table></figure><ol start="2"><li>配置完成启动服务，我们就可以在 Naocs 平台上看见对应的微服务了，此时表示服务注册成功</li></ol><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20210930155527834.png" title="image-20210930155527834"><h3 id="总结"><a class="anchor" href="#总结">#</a> 总结</h3><img data-src="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/image-20220321185952218.png" title="image-20220321185952218"><div id="gitalk-container"></div><script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalkConfig={clientID:"6db178ba46c8af8f6a6f",clientSecret:"90f730e5956024596558df00975cd8eae28cae3d",repo:"bk-comment01",owner:"onlymarryu",admin:["onlymarryu"],distractionFreeMode:!1,language:"zh-CN",proxy:"https://gitalk-comments.netlify.app/github_access_token",perPage:15};gitalkConfig.id=md5(location.pathname);var gitalk=new Gitalk(gitalkConfig);gitalk.render("gitalk-container")</script><div class="tags"><a href="/tags/spring-cloud-alibaba/" rel="tag"><i class="ic i-tag"></i> spring-cloud-alibaba</a> <a href="/tags/nacos/" rel="tag"><i class="ic i-tag"></i> nacos</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-07-10 22:18:34" itemprop="dateModified" datetime="2023-07-10T22:18:34+08:00">2023-07-10</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="雾都 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="雾都 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="雾都 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>雾都 <i class="ic i-at"><em>@</em></i>每天进步一点点，就是成功的开始</li><li class="link"><strong>本文链接：</strong> <a href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" title="Nacos 系统学习">https://eth168.top/Spring_Family/spring-cloud-alibaba/Nacos系统学习/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Distribution/Elasticsearch-8/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?592248" title="Elasticsearch-8"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 分布式</span><h3>Elasticsearch-8</h3></a></div><div class="item right"><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?225627" title="Sentinel系统学习"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 微服务</span><h3>Sentinel系统学习</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">微服务简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.1.</span> <span class="toc-text">1 什么是微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8F%98"><span class="toc-number">1.1.1.</span> <span class="toc-text">架构的演变</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">单体应用架构：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9E%82%E7%9B%B4%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">垂直应用架构：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">分布式架构：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#soa%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">SOA 架构：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">微服务架构：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%8Esoa%E6%9E%B6%E6%9E%84%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">微服务架构与 SOA 架构的不同</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spring-cloud-%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">Spring Cloud 发展历史</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-spring-cloud-alibaba"><span class="toc-number">1.2.</span> <span class="toc-text">2 Spring Cloud Alibaba</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.2.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#spring-cloud-alibaba-nacos%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">Spring Cloud Alibaba Nacos 下载和安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">Nacos 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFnacos"><span class="toc-number">2.2.</span> <span class="toc-text">什么是 Nacos？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8nacos"><span class="toc-number">2.3.</span> <span class="toc-text">为何使用 Nacos？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.</span> <span class="toc-text">Nacos 下载和安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E4%B9%8B%E5%90%8E%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="toc-number">2.4.0.1.</span> <span class="toc-text">下载之后安装过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linuxunixmac"><span class="toc-number">2.4.1.</span> <span class="toc-text">Linux&#x2F;Unix&#x2F;Mac</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#windows"><span class="toc-number">2.4.2.</span> <span class="toc-text">Windows</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%E6%B3%A8%E5%86%8C"><span class="toc-number">3.</span> <span class="toc-text">Nacos 服务提供者注册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E4%BB%A3%E6%9B%BFeureka"><span class="toc-number">3.1.</span> <span class="toc-text">Nacos 代替 Eureka</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-number">3.2.</span> <span class="toc-text">Nacos 服务注册中心</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%BC%95%E5%85%A5nacos-discovery%E8%BF%9B%E8%A1%8C%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%8F%91%E7%8E%B0"><span class="toc-number">3.3.</span> <span class="toc-text">如何引入 Nacos Discovery 进行服务注册 &#x2F; 发现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.3.1.</span> <span class="toc-text">创建新项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pom"><span class="toc-number">3.3.2.</span> <span class="toc-text">POM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yml"><span class="toc-number">3.3.3.</span> <span class="toc-text">YML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-number">3.3.4.</span> <span class="toc-text">启动类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-number">3.3.5.</span> <span class="toc-text">业务类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">3.3.6.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">3.4.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85%E6%B3%A8%E5%86%8C%E5%92%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">4.</span> <span class="toc-text">Nacos 服务消费者注册和负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">4.1.</span> <span class="toc-text">服务消费者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">具体配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BAmodule"><span class="toc-number">4.2.1.</span> <span class="toc-text">新建 Module</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pom-2"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yml-2"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E5%90%AF%E5%8A%A8"><span class="toc-number">4.2.1.3.</span> <span class="toc-text">主启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-2"><span class="toc-number">4.2.1.4.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8ribbon"><span class="toc-number">4.3.</span> <span class="toc-text">远程调用 Ribbon</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFribbon"><span class="toc-number">4.3.0.1.</span> <span class="toc-text">什么是 Ribbon</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E4%BD%BF%E7%94%A8"><span class="toc-number">4.3.0.2.</span> <span class="toc-text">具体使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81nacos%E8%87%AA%E5%B8%A6%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">4.4.</span> <span class="toc-text">验证 Nacos 自带负载均衡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AF%B9%E6%AF%94%E6%8F%90%E5%8D%87"><span class="toc-number">5.</span> <span class="toc-text">Nacos 服务注册中心对比提升</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AF%B9%E6%AF%94"><span class="toc-number">5.1.</span> <span class="toc-text">各种服务注册中心对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cap%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.1.1.</span> <span class="toc-text">CAP 模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cp%E5%8E%9F%E5%88%99%E4%B8%80%E8%87%B4%E6%80%A7-%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7%E5%8E%9F%E5%88%99"><span class="toc-number">5.1.2.</span> <span class="toc-text">CP 原则：一致性 + 分区容错性原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ap%E5%8E%9F%E5%88%99%E5%8F%AF%E7%94%A8%E6%80%A7%E5%8E%9F%E5%88%99-%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7%E5%8E%9F%E5%88%99"><span class="toc-number">5.1.3.</span> <span class="toc-text">AP 原则：可用性原则 + 分区容错性原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E6%94%AF%E6%8C%81cp%E5%92%8Cap"><span class="toc-number">5.2.</span> <span class="toc-text">Nacos 支持 CP 和 AP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos-%E4%BD%95%E6%97%B6%E9%80%89%E6%8B%A9%E5%88%87%E6%8D%A2%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.3.</span> <span class="toc-text">Nacos 何时选择切换模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E4%B9%8B%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">6.</span> <span class="toc-text">Nacos 之服务配置中心</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">6.1.</span> <span class="toc-text">基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pom%E6%96%87%E4%BB%B6"><span class="toc-number">6.1.1.</span> <span class="toc-text">pom 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yml%E9%85%8D%E7%BD%AE"><span class="toc-number">6.1.2.</span> <span class="toc-text">YML 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%90%AF%E5%8A%A8-2"><span class="toc-number">6.1.3.</span> <span class="toc-text">主启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E7%B1%BB-2"><span class="toc-number">6.1.4.</span> <span class="toc-text">业务类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nacos%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99"><span class="toc-number">6.1.5.</span> <span class="toc-text">Nacos 配置规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E5%B9%B3%E5%8F%B0%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">6.2.</span> <span class="toc-text">Nacos 平台创建配置操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%9B%B4%E6%96%B0"><span class="toc-number">6.3.</span> <span class="toc-text">自动配置更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-3"><span class="toc-number">6.4.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bootsrap%E6%96%87%E4%BB%B6%E4%B8%8D%E8%AF%BB%E5%8F%96%E9%97%AE%E9%A2%98"><span class="toc-number">6.5.</span> <span class="toc-text">bootsrap.* 文件不读取问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F%E4%B8%80"><span class="toc-number">6.5.1.</span> <span class="toc-text">解决方式一：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F%E4%BA%8C"><span class="toc-number">6.5.2.</span> <span class="toc-text">解决方式二：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%88%86%E7%BB%84%E5%92%8Cdataid%E4%B8%89%E8%80%85%E5%85%B3%E7%B3%BB"><span class="toc-number">7.</span> <span class="toc-text">Nacos 命名空间分组和 DataID 三者关系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">7.1.</span> <span class="toc-text">名词解释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E8%80%85%E5%85%B3%E7%B3%BB"><span class="toc-number">7.1.1.</span> <span class="toc-text">三者关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">7.2.</span> <span class="toc-text">切换不同环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dataid%E6%96%B9%E6%A1%88"><span class="toc-number">7.2.1.</span> <span class="toc-text">DataID 方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group%E6%96%B9%E6%A1%88"><span class="toc-number">7.2.2.</span> <span class="toc-text">Group 方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#namespace%E7%A9%BA%E9%97%B4%E6%96%B9%E6%A1%88"><span class="toc-number">7.2.3.</span> <span class="toc-text">Namespace 空间方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-number">8.</span> <span class="toc-text">Nacos 集群架构说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E6%94%AF%E6%8C%81%E4%B8%89%E7%A7%8D%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.1.</span> <span class="toc-text">Nacos 支持三种部署模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E8%AF%B4%E6%98%8E"><span class="toc-number">8.2.</span> <span class="toc-text">集群部署说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%8E%AF%E5%A2%83"><span class="toc-number">8.3.</span> <span class="toc-text">预备环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E6%8C%81%E4%B9%85%E5%8C%96%E5%88%87%E6%8D%A2%E9%85%8D%E7%BD%AE"><span class="toc-number">9.</span> <span class="toc-text">Nacos 持久化切换配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">9.1.</span> <span class="toc-text">Nacos 持久化配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos%E9%BB%98%E8%AE%A4derby%E5%88%87%E6%8D%A2mysql"><span class="toc-number">9.2.</span> <span class="toc-text">Nacos 默认 derby 切换 MySql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-4"><span class="toc-number">9.3.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E4%B9%8Blinux%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85"><span class="toc-number">10.</span> <span class="toc-text">Nacos 之 Linux 版本安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E7%89%88nacosmysql%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">10.1.</span> <span class="toc-text">Linux 版 Nacos+MySql 生产环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE-2"><span class="toc-number">10.2.</span> <span class="toc-text">具体配置：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nacos%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">11.</span> <span class="toc-text">Nacos 集群配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9nacos%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">11.1.</span> <span class="toc-text">更改 Nacos 启动命令配置原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE-3"><span class="toc-number">11.2.</span> <span class="toc-text">具体配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8Amysql%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">11.2.1.</span> <span class="toc-text">Linux 服务器上 MySql 数据库配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8Anacos%E7%9A%84%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEcluterconf"><span class="toc-number">11.2.2.</span> <span class="toc-text">Linux 服务器上 Nacos 的集群配置 cluter.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%B8%89%E4%B8%AA%E9%98%B6%E6%AE%B5%E7%9A%84nacos%E6%B5%8B%E8%AF%95"><span class="toc-number">11.2.3.</span> <span class="toc-text">启动三个阶段的 Nacos 测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E9%85%8D%E7%BD%AE"><span class="toc-number">11.2.4.</span> <span class="toc-text">Nginx 配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%90%AF%E5%8A%A8"><span class="toc-number">11.3.</span> <span class="toc-text">测试启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE"><span class="toc-number">11.3.1.</span> <span class="toc-text">添加配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%BAlinux%E7%89%88nacos%E9%9B%86%E7%BE%A4%E5%B9%B6%E6%B3%A8%E5%86%8C%E8%BF%9Bnacos"><span class="toc-number">11.3.2.</span> <span class="toc-text">配置微服务为 Linux 版 Nacos 集群并注册进 Nacos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">11.3.3.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Nacos系统学习">Nacos系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Sentinel系统学习">Sentinel系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E6%BA%90%E7%A0%81%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Sentinel源码系统学习">Sentinel源码系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Gateway系统学习">Gateway系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Seata系统学习">Seata系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%85%B3%E4%BA%8E%E5%85%B3%E4%BA%8ENacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE/" rel="bookmark" title="关于关于Nacos配置中心的配置">关于关于Nacos配置中心的配置</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E9%A1%BA%E5%BA%8F/" rel="bookmark" title="微服务加载配置顺序">微服务加载配置顺序</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="雾都" data-src="/images/avatar.jpg"><p class="name" itemprop="name">雾都</p><div class="description" itemprop="description">花非花，雾非雾</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">85</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">30</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL29ubHltYXJyeXU=" title="https:&#x2F;&#x2F;github.com&#x2F;onlymarryu"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9ydXJpc216aw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;rurismzk"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvbXkvbS9tdXNpYy9wbGF5bGlzdD9pZD0zMTY2MDYwNzkw" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;my&#x2F;m&#x2F;music&#x2F;playlist?id&#x3D;3166060790"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vYW1laGltZQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime"><i class="ic i-weibo"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>时间轴</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/toolPage/" rel="section"><i class="ic i-feather"></i>常用工具设置技巧</a></li><li class="item"><a href="/projectBuild/" rel="section"><i class="ic i-th"></i>SpringBoot常用配置</a></li></ul></li><li class="item"><a href="/mianshi/" rel="section"><i class="ic i-calendar"></i>面试</a></li><li class="item"><a href="/study/" rel="section"><i class="ic i-sakura"></i>小实验</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-calendar"></i>留言</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Distribution/Elasticsearch-8/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a></div><span><a href="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DesignMode/" title="设计模式">设计模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/MyCat-tool/" title="MyCat">MyCat</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/" title="分类于 Spring 全家桶">Spring 全家桶</a></div><span><a href="/Spring_Family/Spring/" title="Spring">Spring</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/docker-tool/" title="docker安装">docker安装</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/OpenSSL-tool/" title="OpenSSL">OpenSSL</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC4%E7%AB%A0_%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" title="第4章_流程控制">第4章_流程控制</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a></div><span><a href="/Distribution/RabbitMQ/" title="RabbitMQ">RabbitMQ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC11%E7%AB%A0%E9%9B%86%E5%90%88/" title="第11章集合">第11章集合</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B0%8F%E5%AE%9E%E9%AA%8C/" title="分类于 小实验">小实验</a></div><span><a href="/study/develop/hexo-shoka/" title="hexo_shoka">hexo_shoka</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/Solr-tool/" title="Solr">Solr</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">雾都 @ 雾都博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.5m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">22:43</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Spring_Family/spring-cloud-alibaba/Nacos系统学习/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(i){return i.includes("#")},function(i){return new RegExp(LOCAL.path+"$").test(i)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>