<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/atom.xml"><link rel="alternate" type="application/json" title="每天进步一点点，就是成功的开始" href="https://eth168.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="spring-cloud-alibaba,Seate,分布式事务"><link rel="canonical" href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"><title>Seata 系统学习 - 微服务 | 雾都博客 = 每天进步一点点，就是成功的开始</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Seata 系统学习</h1><div class="meta"><span class="item" title="创建时间：2023-07-10 21:56:23"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-07-10T21:56:23+08:00">2023-07-10</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>28k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>25 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">雾都博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://api.yimian.xyz/img?557215"></li><li class="item" data-background-image="https://api.yimian.xyz/img?328374"></li><li class="item" data-background-image="https://api.yimian.xyz/img?292560"></li><li class="item" data-background-image="https://api.yimian.xyz/img?456630"></li><li class="item" data-background-image="https://api.yimian.xyz/img?65659"></li><li class="item" data-background-image="https://api.yimian.xyz/img?809906"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" itemprop="item" rel="index" title="分类于 微服务"><span itemprop="name">微服务</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="雾都"><meta itemprop="description" content=", 花非花，雾非雾"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="每天进步一点点，就是成功的开始"></span><div class="body md" itemprop="articleBody"><h1 id="分布式事务简介"><a class="anchor" href="#分布式事务简介">#</a> 分布式事务简介</h1><h2 id="概念"><a class="anchor" href="#概念">#</a> 概念</h2><p>基础概念：事务 ACID</p><ul><li>A（Atomic）：原子性，构成事务的所有操作，要么都执行完成，要么全部不执行，不可能出现部分成功部分失 败的情况。</li><li>C（Consistency）：一致性，在事务执行前后，数据库的一致性约束没有被破坏。比如：张三向李四转 100 元， 转账前和转账后的数据是正确状态这叫一致性，如果出现张三转出 100 元，李四账户没有增加 100 元这就出现了数 据错误，就没有达到一致性。</li><li>I（Isolation）：隔离性，数据库中的事务一般都是并发的，隔离性是指并发的两个事务的执行互不干扰，一个事 务不能看到其他事务运行过程的中间状态。通过配置事务隔离级别可以避脏读、重复读等问题。</li><li>D（Durability）：持久性，事务完成之后，该事务对数据的更改会被持久化到数据库，且不会被回滚。</li></ul><h3 id="事务"><a class="anchor" href="#事务">#</a> 事务</h3><ul><li>本地事务：同一数据库和服务器，称为本地事务<br>在计算机系统中，更多的是通过关系型数据库来控制事务，这是利用数据库本身的事务特性来实现的，因此叫数据库事务，由于应用主要靠关系数据库来控制事务，而数据库通常和应用在同一个服务器，所以基于关系型数据库的事务又被称为本地事务。</li><li>分布式事务：<br>分布式事务指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于<strong>不同的分布式系统</strong>的不同节点之上，且属于不同的应用，分布式事务需要保证这些操作要么全部成功，要么全部失败。本质上来说，分布式事务就是为了保证不同数据库的数据一致性。</li><li>举例：<br>分布式系统会把一个应用系统拆分为可独立部署的多个服务，因此需要服务与服务之间远程协作才能完成事务操 作，这种分布式系统环境下由不同的服务之间通过网络远程协作完成事务称之为分布式事务，例如用户注册送积分事务、创建订单减库存事务，银行转账事务等都是分布式事务。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998761000/4544996c3b5c4c619b58e6a9dba391ab.png" alt="image20220111162727304.png"></p><p>通过以上的图中我们可以看出，其实只要涉及到操作多个数据源，就可能会产生事务问题，当然在实际开发中我们要尽量避免这种问题的出现，当然如果避免不了，我们就需要进行解决，在我们的微服务系统架构中，目前比较好，比较常用的解决方案就是 Seata。</p><h2 id="分布式事务理论"><a class="anchor" href="#分布式事务理论">#</a> 分布式事务理论</h2><p>随着互联化的蔓延，各种项目都逐渐向分布式服务做转换。如今微服务已经普遍存在，本地事务已经无法满足分布式的要求，由此分布式事务问题诞生。 分布式事务被称为世界性的难题，目前分布式事务存在两大理论依据：CAP 定律 BASE 理论。</p><h3 id="cap定律"><a class="anchor" href="#cap定律">#</a> CAP 定律</h3><p>这个定理的内容是指的是在一个分布式系统中、Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），三者不可得兼。</p><ul><li>一致性（C）<br>在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）</li><li>可用性（A）<br>在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（对数据更新具备高可用性）</li><li>分区容错性（P）<br>以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在 C 和 A 之间做出选择</li></ul><p>CAP 是无法同时存在的，一下通过这个例子来说明</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998761000/89536f53b26048e18ac8a9a34ba6894d.png" alt="image20220113155408713.png"></p><ol><li>当库存服务减库存以后，那么需要将数据同步到其他的服务上，这是为了保证数据一致性 C，但是网络是不可靠的，所以我们系统就需要保证分区容错性 P，也就是我们必须容忍网络所带来的的一些问题，此时如果我们想保证 C 那么就需要舍弃 A，也就是说我们在保证 C 的情况下，就必须舍弃 A，也就是 CP 无法保证高可用。</li><li>如果为了保证 A，高可用的情况下，也就是必须在限定时间内给出响应，同样由于网络不可靠 P，订单服务就有可能无法拿到新的数据，但是也要给用户作出响应，那么也就无法保证 C 一致性。所以 AP 是无法保证强一致性的。</li><li>如果我们想保证 CA，也就是高可用和一致性，也就是必须保证网络良好才能实现，那么也就是说我们需要将库存、订单、用户放到一起，但是这种情况也就丧失了 P 这个保证，这个时候系统也就不是分布式系统了。</li><li>总结：在分布式系统中，p 是必然的存在的，所以我们只能在 C 和 A 之间进行取舍，在这种条件下就诞生了 BASE 理论</li></ol><h3 id="base理论"><a class="anchor" href="#base理论">#</a> BASE 理论</h3><p>BASE 是 Basically Available（基本可用）、Soft state（软状态）和 Eventually consistent（最终一致性）三个短语的缩写。BASE 理论是对 CAP 中一致性和可用性权衡的结果，其来源于对大规模互联网系统分布式实践的总结， 是基于 CAP 定理逐步演化而来的。BASE 理论的核心思想是：即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。</p><ul><li>基本可用<br>基本可用是指分布式系统在出现不可预知故障的时候，允许损失部分可用性 —- 注意，这绝不等价于系统不可用。比如：<br>（1）响应时间上的损失。正常情况下，一个在线搜索引擎需要在 0.5 秒之内返回给用户相应的查询结果，但由于出现故障，查询结果的响应时间增加了 1~2 秒<br>（2）系统功能上的损失：正常情况下，在一个电子商务网站上进行购物的时候，消费者几乎能够顺利完成每一笔订单，但是在一些节日大促购物高峰的时候，由于消费者的购物行为激增，为了保护购物系统的稳定性，部分消费者可能会被引导到一个降级页面</li><li>软状态<br>软状态指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在不同节点的数据副本之间进行数据同步的过程存在延时</li><li>最终一致性<br>最终一致性强调的是所有的数据副本，在经过一段时间的同步之后，最终都能够达到一个一致的状态。因此，最终一致性的本质是需要系统保证最终数据能够达到一致，而不需要实时保证系统数据的强一致性。</li></ul><p>那这个位置我们依旧可以用我们刚才的例子来进行说明</p><p>** 基本可用：** 保证核心服务是可以使用的，至于其他的服务可以适当的降低响应时间，甚至是服务降级</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998761000/6e34be5dc9114b5f9a10a5b790446333.png" alt="image20220113162344531.png"></p><p>** 软状态：** 存在中间状态，不影响整体系统使用，数据同步存在延时</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998761000/8477ce5071124a21a3c44b61de31318c.png" alt="image20220113162554630.png"></p><p>** 最终一致性：** 再过了流量高峰期以后，经过一段时间的同步，保持各服务数据的一致</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998761000/e060172f628f4baaad06b8f03cc57dd6.png" alt="image20220113162813542.png"></p><h1 id="seata简介"><a class="anchor" href="#seata简介">#</a> Seata 简介</h1><h2 id="分布式事务解决方案"><a class="anchor" href="#分布式事务解决方案">#</a> 分布式事务解决方案</h2><p>2PC 即两阶段提交协议，是将整个事务流程分为两个阶段，P 是指准备阶段，C 是指提交阶段。</p><ol><li>准备阶段（Prepare phase）</li><li>提交阶段（commit phase）</li></ol><p>举例：比如说相亲对象两个人去吃饭，店老板要求，先付钱在吃饭，这是男女双方提出了 AA，也就是说只有男女双方都付钱，才能落座吃饭，但是只要两个人中有一个不同意付款就不能落座吃饭。</p><ul><li>准备阶段：老板要求男方付款，男方付款。老板要求女方付款，女方付款</li><li>提交阶段：老板出餐，两人纷纷落座</li></ul><p>其实此例子就形成了一个事务，如果男女双方有一个人拒绝付款，那么老板就不会出餐，并且会把已收取的钱原路退回。</p><p>整个事务过程是由事务管理器和参与者组成的，店老板就是事务管管理器，男女双发就是参与者，事务管理器决策整个分布式事务在计算机中关系数据库支持的两阶段提交协议：</p><ul><li>准备阶段（Prepare phase）：事务管理器给每个参与者发送 Prepare 消息，每个数据库参与者在本地执行事务，并写本地的 Undo/Redo 日志，此时事务没有提交。</li><li>（Undo 日志是记录修改前的数据，用于数据库回滚，Redo 日志是记录修改后的数据，用于提交事务后写入数据文件）</li><li>提交阶段（commit phase）：如果事务管理器收到了参与者的执行失败或者超时消息时，直接给每个参与者发送回滚 (Rollback) 消息；否则，发送提交 (Commit) 消息；参与者根据事务管理器的指令执行提交或者回滚操作，并释放事务处理过程中使用的资源。</li></ul><p>具体步骤图例：</p><p>成功：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/9a5b66ef19a4446a8a1f3cce3730de73.png" alt="image20220113180953684.png"></p><p>失败：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/22d602b59e6d420c83b42625d146bf29.png" alt="image20220113181028153.png"></p><h2 id="seata简介-2"><a class="anchor" href="#seata简介-2">#</a> Seata 简介</h2><p>官网：<span class="exturl" data-url="aHR0cHM6Ly9zZWF0YS5pby96aC1jbi9kb2NzL292ZXJ2aWV3L3doYXQtaXMtc2VhdGEuaHRtbA==">https://seata.io/zh-cn/docs/overview/what-is-seata.html</span></p><p>概念：Seata 是一款开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。Seata 将为用户提供了 AT、TCC、SAGA 和 XA 事务模式，为用户打造一站式的分布式解决方案。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/7a247a0424714a2ba4bdc43ef6ae6dd0.png" alt="1459421917a2d469f94c84cd28c7e46ad75683636.png"></p><p>在我们的微服务系统中，对应业务被对应的拆分成独立模块，在官方提供的架构图中，我们可以看出当前是三个服务：</p><ul><li>仓储服务：对给定的商品进行增删操作记录数量</li><li>订单服务：根据采购者的需求创建订单</li><li>账户服务：从用户账户中扣除余额、积分等</li></ul><p>在这套架构中，用户下单购买商品的业务，就需要三个服务来完成，每个服务内部的数据一致性由本地事务来保证，但是全局的数据一致性问题就没办法保证，Seata 就是来进行解决这种问题的解决方案。</p><h2 id="seata术语"><a class="anchor" href="#seata术语">#</a> Seata 术语</h2><p>官网地址：<span class="exturl" data-url="aHR0cHM6Ly9zZWF0YS5pby96aC1jbi9kb2NzL292ZXJ2aWV3L3Rlcm1pbm9sb2d5Lmh0bWw=">https://seata.io/zh-cn/docs/overview/terminology.html</span></p><p>要了解 Seata，首先我们要了解一下 Seata 的几个关键的概念：</p><ul><li>TC (Transaction Coordinator) - 事务协调者<br>维护全局和分支事务的状态，驱动全局事务提交或回滚。</li><li>TM (Transaction Manager) - 事务管理器（发起者，同时也是 RM 的一种）<br>定义全局事务的范围：开始全局事务、提交或回滚全局事务。</li><li>RM (Resource Manager) - 资源管理器（每个参与事务的微服务）<br>管理分支事务处理的资源，与 TC 交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/fab8a67b90834a58b7accbb86726eea2.png" alt="image20220111191919517.png"></p><h2 id="seata-server下载"><a class="anchor" href="#seata-server下载">#</a> Seata-Server 下载</h2><p>官方下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRhL3JlbGVhc2Vz">https://github.com/seata/seata/releases</span></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/b3f0f8ae28e44ad49c7144448f6c625a.png" alt="image20220112191252083.png"></p><p>下载完成之后需要解压</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/6e9471205cd9417c979fec4f79146437.png" alt="image20220112191449051.png"></p><h2 id="seata-server配置"><a class="anchor" href="#seata-server配置">#</a> Seata-Server 配置</h2><ol><li>需要打开 conf 目录</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/d79c502c145f4d9e9bc1b0269d86b00a.png" alt="image20220112192512498.png"></p><ol start="2"><li>先配置 registry.conf 配置文件，修改 Seata 的注册中心和配置中心为 Nacos</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/278d4105c1e8490893fe49b9c3ae5d11.png" alt="image20220112192010321.png"></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/5bfd3ee2a99e496087b69d5d8632607c.png" alt="image20220112192038314.png"></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>registry <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment"># file 、nacos 、eureka、redis、zk、consul、etcd3、sofa</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">"nacos"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  nacos <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    application <span class="token operator">=</span> <span class="token string">"seata-server"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8848"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    group <span class="token operator">=</span> <span class="token string">"SEATA_GROUP"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    namespace <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    username <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    password <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  eureka <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    serviceUrl <span class="token operator">=</span> <span class="token string">"http://localhost:8761/eureka"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    application <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    weight <span class="token operator">=</span> <span class="token string">"1"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  redis <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"localhost:6379"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    db <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    password <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">timeout</span> <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  zk <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:2181"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    sessionTimeout <span class="token operator">=</span> <span class="token number">6000</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    connectTimeout <span class="token operator">=</span> <span class="token number">2000</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    username <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    password <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  consul <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8500"</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    aclToken <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  etcd3 <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"http://localhost:2379"</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  sofa <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:9603"</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    application <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    region <span class="token operator">=</span> <span class="token string">"DEFAULT_ZONE"</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    datacenter <span class="token operator">=</span> <span class="token string">"DefaultDataCenter"</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    group <span class="token operator">=</span> <span class="token string">"SEATA_GROUP"</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    addressWaitTime <span class="token operator">=</span> <span class="token string">"3000"</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token function">file</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    name <span class="token operator">=</span> <span class="token string">"file.conf"</span></pre></td></tr><tr><td data-num="54"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>config <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  <span class="token comment"># file、nacos 、apollo、zk、consul、etcd3</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">"nacos"</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>  nacos <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8848"</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    namespace <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    group <span class="token operator">=</span> <span class="token string">"SEATA_GROUP"</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    username <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    password <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    dataId <span class="token operator">=</span> <span class="token string">"seataServer.properties"</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>  consul <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8500"</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    aclToken <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="72"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  apollo <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    appId <span class="token operator">=</span> <span class="token string">"seata-server"</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token comment">## apolloConfigService will cover apolloMeta</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    apolloMeta <span class="token operator">=</span> <span class="token string">"http://192.168.1.204:8801"</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    apolloConfigService <span class="token operator">=</span> <span class="token string">"http://192.168.1.204:8080"</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    namespace <span class="token operator">=</span> <span class="token string">"application"</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    apolloAccesskeySecret <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"seata"</span></pre></td></tr><tr><td data-num="81"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>  zk <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:2181"</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    sessionTimeout <span class="token operator">=</span> <span class="token number">6000</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    connectTimeout <span class="token operator">=</span> <span class="token number">2000</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    username <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    password <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    nodePath <span class="token operator">=</span> <span class="token string">"/seata/seata.properties"</span></pre></td></tr><tr><td data-num="89"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>  etcd3 <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"http://localhost:2379"</span></pre></td></tr><tr><td data-num="92"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>  <span class="token function">file</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    name <span class="token operator">=</span> <span class="token string">"file.conf"</span></pre></td></tr><tr><td data-num="95"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="3"><li>接着我们需要修改 Seata 的存储模式，修改 file.conf 文件，把 Seata 的默认存储模式修改为数据库 &quot;DB&quot;，同时需要配置 JDBC</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/6b91ce75509148978c15ac2f3118be5d.png" alt="image20220112192451611.png"></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/827ac59ad07a46f790b90a40fdf12e4c.png" alt="image20220112192620774.png"></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/69d55657feeb4093b1b629a3118aec2e.png" alt="image20220112193120164.png"></p><pre><code>## transaction log store, only used in seata-server
store &#123;
  ## store mode: file、db、redis
  mode = &quot;db&quot;
  ## rsa decryption public key
  publicKey = &quot;&quot;
  ## file store property
  file &#123;
    ## store location dir
    dir = &quot;sessionStore&quot;
    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions
    maxBranchSessionSize = 16384
    # globe session size , if exceeded throws exceptions
    maxGlobalSessionSize = 512
    # file buffer size , if exceeded allocate new buffer
    fileWriteBufferCacheSize = 16384
    # when recover batch read size
    sessionReloadReadSize = 100
    # async, sync
    flushDiskMode = async
  &#125;

  ## database store property
  db &#123;
    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.
    datasource = &quot;druid&quot;
    ## mysql/oracle/postgresql/h2/oceanbase etc.
    dbType = &quot;mysql&quot;
    driverClassName = &quot;com.mysql.jdbc.Driver&quot;
    ## if using mysql to store the data, recommend add rewriteBatchedStatements=true in jdbc connection param
    url = &quot;jdbc:mysql://localhost:3306/seata?useUnicode=true&amp;characterEncoding=UTF-8&quot;
    user = &quot;root&quot;
    password = &quot;root&quot;
    minConn = 5
    maxConn = 100
    globalTable = &quot;global_table&quot;
    branchTable = &quot;branch_table&quot;
    lockTable = &quot;lock_table&quot;
    queryLimit = 100
    maxWait = 5000
  &#125;

  ## redis store property
  redis &#123;
    ## redis mode: single、sentinel
    mode = &quot;single&quot;
    ## single mode property
    single &#123;
      host = &quot;127.0.0.1&quot;
      port = &quot;6379&quot;
    &#125;
    ## sentinel mode property
    sentinel &#123;
      masterName = &quot;&quot;
      ## such as &quot;10.28.235.65:26379,10.28.235.65:26380,10.28.235.65:26381&quot;
      sentinelHosts = &quot;&quot;
    &#125;
    password = &quot;&quot;
    database = &quot;0&quot;
    minConn = 1
    maxConn = 10
    maxTotal = 100
    queryLimit = 100
  &#125;
&#125;

</code></pre><h2 id="启动"><a class="anchor" href="#启动">#</a> 启动</h2><p>启动步骤为，先启动 nacos 然后在启动 Seata-Server</p><p>启动 Seata-Server 的方式非常简单，直接双击此文件即可:seata-server-1.4.2\bin\seata-server.bat</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/20f23172834f4a10b2bd93fa5386f0c9.png" alt="image20220112193257424.png"></p><p>启动完成效果</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/d008d69fc45645e788d4aedd879091ce.png" alt="image20220112193410847.png"></p><p>然后在 nacos 控制台上就可以看到 Seata-Server</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641998834000/382313d0fd6f43c19f9d7d4b23d321b5.png" alt="image20220112193500935.png"></p><h2 id="seata-servertc环境搭建详解"><a class="anchor" href="#seata-servertc环境搭建详解">#</a> Seata Server（TC）环境搭建详解</h2><p>Server 端存储模式（store.mode）支持三种：</p><ol><li>file：单机模式，全局事务会话信息内存中读写并持久化本地文件 root.data，性能较高（默认）</li><li>DB：高可用模式，全局事务会话信息通过 DB 共享，相对性能差一些</li><li>redis：Seata-Server1.3 及以上版本支持，性能较高，存在事务信息丢失风险，需要配合实际场景使用。</li></ol><h2 id="具体操作"><a class="anchor" href="#具体操作">#</a> 具体操作</h2><ol><li>修改 Seata-Server 模式为 DB 高可用模式</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642518497000/9dbad8c2dacf488488e655535ccbc0d8.png" alt="image20220118173041657.png"></p><p>找到以下对应的 db 配置，要修改其中的 jdbc 连接，以及要注意其中涉及到了三个表，分别是 global_table，branch_table，lock_table 分别是全局事务会话表，分支事务会话表，锁数据表；</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642518497000/bcbeb0859cbd498c95f516e983292c58.png" alt="image20220118231142489.png"></p><ol start="2"><li>建表语句地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRhL2Jsb2IvZGV2ZWxvcC9zY3JpcHQvc2VydmVyL2RiL215c3FsLnNxbA==">https://github.com/seata/seata/blob/develop/script/server/db/mysql.sql</span></li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- the table to store GlobalSession data</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">-- the table to store BranchSession data</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>        <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>      <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">-- the table to store lock data</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>         <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'0:locked ,1:rollbacking'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="3"><li>重启 Seata 即可生效。</li></ol><h1 id="seata配置nacos注册中心和配置中心"><a class="anchor" href="#seata配置nacos注册中心和配置中心">#</a> Seata 配置 Nacos 注册中心和配置中心</h1><p>Seata 支持注册服务到 Nacos，以及支持 Seata 所有配置放到 Nacos 配置中心，在 Nacos 中统一维护；</p><p>高可用模式下就需要配合 Nacos 来完成</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642524267000/a556e2af96964faea8dc93380cf52c83.png" alt="image20220118234555417.png"></p><h2 id="具体配置如下"><a class="anchor" href="#具体配置如下">#</a> 具体配置如下</h2><h3 id="注册中心"><a class="anchor" href="#注册中心">#</a> 注册中心</h3><p>Seata-server 端配置注册中心，在 registry.conf 中加入配置注册中心 nacos<br><strong>注意：确保 client 与 server 的注册处于同一个 namespace 和 group，不然会找不到服务。</strong></p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>registry <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment"># file 、nacos 、eureka、redis、zk、consul、etcd3、sofa</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">"nacos"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  nacos <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    application <span class="token operator">=</span> <span class="token string">"seata-server"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8848"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    group <span class="token operator">=</span> <span class="token string">"SEATA_GROUP"</span> <span class="token comment"># 这里的配置要和客户端保持一致</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    namespace <span class="token operator">=</span> <span class="token string">""</span> <span class="token comment"># 这里的配置要和客户端保持一致</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    cluster <span class="token operator">=</span> <span class="token string">"default"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    username <span class="token operator">=</span> <span class="token string">"nacos"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    password <span class="token operator">=</span> <span class="token string">"nacos"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr></table></figure><h3 id="配置中心"><a class="anchor" href="#配置中心">#</a> 配置中心</h3><ol><li>Seata-server 端配置配置中心，在 registry.conf 中加入配置使用 nacos 作为配置中心</li></ol><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>config <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment"># file、nacos 、apollo、zk、consul、etcd3</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">"nacos"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  nacos <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8848"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    namespace <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    group <span class="token operator">=</span> <span class="token string">"SEATA_GROUP"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    username <span class="token operator">=</span> <span class="token string">"nacos"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    password <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    dataId <span class="token operator">=</span> <span class="token string">"seataServer.properties"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr></table></figure><ol start="2"><li>我们需要把 Seata 的一些配置上传到 Nacos 中，配置比较多，所以官方给我们提供了一个 config.txt，我们下载并且修改其中参数，上传到 Nacos 中<br>下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRhL3RyZWUvZGV2ZWxvcC9zY3JpcHQvY29uZmlnLWNlbnRlcg==">https://github.com/seata/seata/tree/develop/script/config-center</span></li></ol><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#For details about configuration items, see https://seata.io/zh-cn/docs/user/configurations.html</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#Transport configuration, for client and server</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token assign-left variable">transport.type</span><span class="token operator">=</span>TCP</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">transport.server</span><span class="token operator">=</span>NIO</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">transport.heartbeat</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token assign-left variable">transport.enableTmClientBatchSendRequest</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">transport.enableRmClientBatchSendRequest</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">transport.enableTcServerBatchSendResponse</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token assign-left variable">transport.rpcRmRequestTimeout</span><span class="token operator">=</span><span class="token number">30000</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token assign-left variable">transport.rpcTmRequestTimeout</span><span class="token operator">=</span><span class="token number">30000</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token assign-left variable">transport.rpcTcRequestTimeout</span><span class="token operator">=</span><span class="token number">30000</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token assign-left variable">transport.threadFactory.bossThreadPrefix</span><span class="token operator">=</span>NettyBoss</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token assign-left variable">transport.threadFactory.workerThreadPrefix</span><span class="token operator">=</span>NettyServerNIOWorker</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token assign-left variable">transport.threadFactory.serverExecutorThreadPrefix</span><span class="token operator">=</span>NettyServerBizHandler</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token assign-left variable">transport.threadFactory.shareBossWorker</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token assign-left variable">transport.threadFactory.clientSelectorThreadPrefix</span><span class="token operator">=</span>NettyClientSelector</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token assign-left variable">transport.threadFactory.clientSelectorThreadSize</span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token assign-left variable">transport.threadFactory.clientWorkerThreadPrefix</span><span class="token operator">=</span>NettyClientWorkerThread</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token assign-left variable">transport.threadFactory.bossThreadSize</span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token assign-left variable">transport.threadFactory.workerThreadSize</span><span class="token operator">=</span>default</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token assign-left variable">transport.shutdown.wait</span><span class="token operator">=</span><span class="token number">3</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token assign-left variable">transport.serialization</span><span class="token operator">=</span>seata</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token assign-left variable">transport.compressor</span><span class="token operator">=</span>none</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">#Transaction routing rules configuration, only for the client</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token assign-left variable">service.vgroupMapping.default_tx_group</span><span class="token operator">=</span>default</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">#If you use a registry, you can ignore it</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token assign-left variable">service.default.grouplist</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1:8091</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token assign-left variable">service.enableDegrade</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token assign-left variable">service.disableGlobalTransaction</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">#Transaction rule configuration, only for the client</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token assign-left variable">client.rm.asyncCommitBufferLimit</span><span class="token operator">=</span><span class="token number">10000</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token assign-left variable">client.rm.lock.retryInterval</span><span class="token operator">=</span><span class="token number">10</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token assign-left variable">client.rm.lock.retryTimes</span><span class="token operator">=</span><span class="token number">30</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token assign-left variable">client.rm.lock.retryPolicyBranchRollbackOnConflict</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token assign-left variable">client.rm.reportRetryCount</span><span class="token operator">=</span><span class="token number">5</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token assign-left variable">client.rm.tableMetaCheckEnable</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token assign-left variable">client.rm.tableMetaCheckerInterval</span><span class="token operator">=</span><span class="token number">60000</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token assign-left variable">client.rm.sqlParserType</span><span class="token operator">=</span>druid</pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token assign-left variable">client.rm.reportSuccessEnable</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token assign-left variable">client.rm.sagaBranchRegisterEnable</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token assign-left variable">client.rm.sagaJsonParser</span><span class="token operator">=</span>fastjson</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token assign-left variable">client.rm.tccActionInterceptorOrder</span><span class="token operator">=</span>-2147482648</pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token assign-left variable">client.tm.commitRetryCount</span><span class="token operator">=</span><span class="token number">5</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token assign-left variable">client.tm.rollbackRetryCount</span><span class="token operator">=</span><span class="token number">5</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token assign-left variable">client.tm.defaultGlobalTransactionTimeout</span><span class="token operator">=</span><span class="token number">60000</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token assign-left variable">client.tm.degradeCheck</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token assign-left variable">client.tm.degradeCheckAllowTimes</span><span class="token operator">=</span><span class="token number">10</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token assign-left variable">client.tm.degradeCheckPeriod</span><span class="token operator">=</span><span class="token number">2000</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token assign-left variable">client.tm.interceptorOrder</span><span class="token operator">=</span>-2147482648</pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token assign-left variable">client.undo.dataValidation</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token assign-left variable">client.undo.logSerialization</span><span class="token operator">=</span>jackson</pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token assign-left variable">client.undo.onlyCareUpdateColumns</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token assign-left variable">server.undo.logSaveDays</span><span class="token operator">=</span><span class="token number">7</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token assign-left variable">server.undo.logDeletePeriod</span><span class="token operator">=</span><span class="token number">86400000</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token assign-left variable">client.undo.logTable</span><span class="token operator">=</span>undo_log</pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token assign-left variable">client.undo.compress.enable</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token assign-left variable">client.undo.compress.type</span><span class="token operator">=</span>zip</pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token assign-left variable">client.undo.compress.threshold</span><span class="token operator">=</span>64k</pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment">#For TCC transaction mode</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token assign-left variable">tcc.fence.logTableName</span><span class="token operator">=</span>tcc_fence_log</pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token assign-left variable">tcc.fence.cleanPeriod</span><span class="token operator">=</span>1h</pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">#Log rule configuration, for client and server</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token assign-left variable">log.exceptionRate</span><span class="token operator">=</span><span class="token number">100</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment">#Transaction storage configuration, only for the server. The file, DB, and redis configuration values are optional.</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token assign-left variable">store.mode</span><span class="token operator">=</span>file</pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token assign-left variable">store.lock.mode</span><span class="token operator">=</span>file</pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token assign-left variable">store.session.mode</span><span class="token operator">=</span>file</pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token comment">#Used for password encryption</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token assign-left variable">store.publicKey</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token comment">#If `store.mode,store.lock.mode,store.session.mode` are not equal to `file`, you can remove the configuration block.</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token assign-left variable">store.file.dir</span><span class="token operator">=</span>file_store/data</pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token assign-left variable">store.file.maxBranchSessionSize</span><span class="token operator">=</span><span class="token number">16384</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token assign-left variable">store.file.maxGlobalSessionSize</span><span class="token operator">=</span><span class="token number">512</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token assign-left variable">store.file.fileWriteBufferCacheSize</span><span class="token operator">=</span><span class="token number">16384</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token assign-left variable">store.file.flushDiskMode</span><span class="token operator">=</span>async</pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token assign-left variable">store.file.sessionReloadReadSize</span><span class="token operator">=</span><span class="token number">100</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token comment">#These configurations are required if the `store mode` is `db`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `db`, you can remove the configuration block.</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token assign-left variable">store.db.datasource</span><span class="token operator">=</span>druid</pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token assign-left variable">store.db.dbType</span><span class="token operator">=</span>mysql</pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token assign-left variable">store.db.driverClassName</span><span class="token operator">=</span>com.mysql.jdbc.Driver</pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token assign-left variable">store.db.url</span><span class="token operator">=</span>jdbc:mysql://127.0.0.1:3306/seata?useUnicode<span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">rewriteBatchedStatements</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token assign-left variable">store.db.user</span><span class="token operator">=</span>username</pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token assign-left variable">store.db.password</span><span class="token operator">=</span>password</pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token assign-left variable">store.db.minConn</span><span class="token operator">=</span><span class="token number">5</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token assign-left variable">store.db.maxConn</span><span class="token operator">=</span><span class="token number">30</span></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token assign-left variable">store.db.globalTable</span><span class="token operator">=</span>global_table</pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token assign-left variable">store.db.branchTable</span><span class="token operator">=</span>branch_table</pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token assign-left variable">store.db.distributedLockTable</span><span class="token operator">=</span>distributed_lock</pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token assign-left variable">store.db.queryLimit</span><span class="token operator">=</span><span class="token number">100</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token assign-left variable">store.db.lockTable</span><span class="token operator">=</span>lock_table</pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token assign-left variable">store.db.maxWait</span><span class="token operator">=</span><span class="token number">5000</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token comment">#These configurations are required if the `store mode` is `redis`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `redis`, you can remove the configuration block.</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token assign-left variable">store.redis.mode</span><span class="token operator">=</span>single</pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token assign-left variable">store.redis.single.host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1</pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token assign-left variable">store.redis.single.port</span><span class="token operator">=</span><span class="token number">6379</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token assign-left variable">store.redis.sentinel.masterName</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token assign-left variable">store.redis.sentinel.sentinelHosts</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token assign-left variable">store.redis.maxConn</span><span class="token operator">=</span><span class="token number">10</span></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token assign-left variable">store.redis.minConn</span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token assign-left variable">store.redis.maxTotal</span><span class="token operator">=</span><span class="token number">100</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token assign-left variable">store.redis.database</span><span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token assign-left variable">store.redis.password</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token assign-left variable">store.redis.queryLimit</span><span class="token operator">=</span><span class="token number">100</span></pre></td></tr><tr><td data-num="111"></td><td><pre></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token comment">#Transaction rule configuration, only for the server</span></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token assign-left variable">server.recovery.committingRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token assign-left variable">server.recovery.asynCommittingRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token assign-left variable">server.recovery.rollbackingRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token assign-left variable">server.recovery.timeoutRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span></pre></td></tr><tr><td data-num="117"></td><td><pre><span class="token assign-left variable">server.maxCommitRetryTimeout</span><span class="token operator">=</span>-1</pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token assign-left variable">server.maxRollbackRetryTimeout</span><span class="token operator">=</span>-1</pre></td></tr><tr><td data-num="119"></td><td><pre><span class="token assign-left variable">server.rollbackRetryTimeoutUnlockEnable</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token assign-left variable">server.distributedLockExpireTime</span><span class="token operator">=</span><span class="token number">10000</span></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token assign-left variable">server.xaerNotaRetryTimeout</span><span class="token operator">=</span><span class="token number">60000</span></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token assign-left variable">server.session.branchAsyncQueueSize</span><span class="token operator">=</span><span class="token number">5000</span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token assign-left variable">server.session.enableBranchAsyncRemove</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token assign-left variable">server.enableParallelRequestHandle</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="125"></td><td><pre></pre></td></tr><tr><td data-num="126"></td><td><pre><span class="token comment">#Metrics configuration, only for the server</span></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token assign-left variable">metrics.enabled</span><span class="token operator">=</span>false</pre></td></tr><tr><td data-num="128"></td><td><pre><span class="token assign-left variable">metrics.registryType</span><span class="token operator">=</span>compact</pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token assign-left variable">metrics.exporterList</span><span class="token operator">=</span>prometheus</pre></td></tr><tr><td data-num="130"></td><td><pre><span class="token assign-left variable">metrics.exporterPrometheusPort</span><span class="token operator">=</span><span class="token number">9898</span></pre></td></tr></table></figure><ol start="2"><li>具体修改：</li><li>注意：事务分组：用于防护机房停电，来启用备用机房，或者异地机房，容错机制，当然如果 Seata-Server 配置了对应的事务分组，Client 也需要配置相同的事务分组</li><li>service.vgroupMapping. 可以自定义 = default<br>default 这里必须等于 registry.config 中的 cluster=&quot;default&quot;(当然可以更改)</li></ol><figure class="highlight properties"><figcaption data-lang=".properties"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key attr-name">transport.type</span><span class="token punctuation">=</span><span class="token value attr-value">TCP</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key attr-name">transport.server</span><span class="token punctuation">=</span><span class="token value attr-value">NIO</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key attr-name">transport.heartbeat</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key attr-name">transport.enableTmClientBatchSendRequest</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token key attr-name">transport.enableRmClientBatchSendRequest</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token key attr-name">transport.rpcRmRequestTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">5000</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token key attr-name">transport.rpcTmRequestTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token key attr-name">transport.rpcTcRequestTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token key attr-name">transport.threadFactory.bossThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyBoss</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token key attr-name">transport.threadFactory.workerThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyServerNIOWorker</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token key attr-name">transport.threadFactory.serverExecutorThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyServerBizHandler</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token key attr-name">transport.threadFactory.shareBossWorker</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token key attr-name">transport.threadFactory.clientSelectorThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyClientSelector</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token key attr-name">transport.threadFactory.clientSelectorThreadSize</span><span class="token punctuation">=</span><span class="token value attr-value">1</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token key attr-name">transport.threadFactory.clientWorkerThreadPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">NettyClientWorkerThread</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token key attr-name">transport.threadFactory.bossThreadSize</span><span class="token punctuation">=</span><span class="token value attr-value">1</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token key attr-name">transport.threadFactory.workerThreadSize</span><span class="token punctuation">=</span><span class="token value attr-value">default</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">#------------- 修改这个区域的映射 --------------    </span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token key attr-name">transport.shutdown.wait</span><span class="token punctuation">=</span><span class="token value attr-value">3</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token key attr-name">service.vgroupMapping.mygroup</span><span class="token punctuation">=</span><span class="token value attr-value">default # 事务分组</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token key attr-name">service.default.grouplist</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:8091</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token key attr-name">service.enableDegrade</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token key attr-name">service.disableGlobalTransaction</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">#------------------------------------------    </span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token key attr-name">client.rm.asyncCommitBufferLimit</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token key attr-name">client.rm.lock.retryInterval</span><span class="token punctuation">=</span><span class="token value attr-value">10</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token key attr-name">client.rm.lock.retryTimes</span><span class="token punctuation">=</span><span class="token value attr-value">30</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token key attr-name">client.rm.lock.retryPolicyBranchRollbackOnConflict</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token key attr-name">client.rm.reportRetryCount</span><span class="token punctuation">=</span><span class="token value attr-value">5</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token key attr-name">client.rm.tableMetaCheckEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token key attr-name">client.rm.tableMetaCheckerInterval</span><span class="token punctuation">=</span><span class="token value attr-value">60000</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token key attr-name">client.rm.sqlParserType</span><span class="token punctuation">=</span><span class="token value attr-value">druid</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token key attr-name">client.rm.reportSuccessEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token key attr-name">client.rm.sagaBranchRegisterEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token key attr-name">client.rm.sagaJsonParser</span><span class="token punctuation">=</span><span class="token value attr-value">fastjson</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token key attr-name">client.rm.tccActionInterceptorOrder</span><span class="token punctuation">=</span><span class="token value attr-value">-2147482648</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token key attr-name">client.tm.commitRetryCount</span><span class="token punctuation">=</span><span class="token value attr-value">5</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token key attr-name">client.tm.rollbackRetryCount</span><span class="token punctuation">=</span><span class="token value attr-value">5</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token key attr-name">client.tm.defaultGlobalTransactionTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">60000</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token key attr-name">client.tm.degradeCheck</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token key attr-name">client.tm.degradeCheckAllowTimes</span><span class="token punctuation">=</span><span class="token value attr-value">10</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token key attr-name">client.tm.degradeCheckPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">2000</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token key attr-name">client.tm.interceptorOrder</span><span class="token punctuation">=</span><span class="token value attr-value">-2147482648</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token key attr-name">store.mode</span><span class="token punctuation">=</span><span class="token value attr-value">db # 修改</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token key attr-name">store.lock.mode</span><span class="token punctuation">=</span><span class="token value attr-value">file</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token key attr-name">store.session.mode</span><span class="token punctuation">=</span><span class="token value attr-value">file</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token key attr-name">store.publicKey</span><span class="token punctuation">=</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token key attr-name">store.file.dir</span><span class="token punctuation">=</span><span class="token value attr-value">file_store/data</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token key attr-name">store.file.maxBranchSessionSize</span><span class="token punctuation">=</span><span class="token value attr-value">16384</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token key attr-name">store.file.maxGlobalSessionSize</span><span class="token punctuation">=</span><span class="token value attr-value">512</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token key attr-name">store.file.fileWriteBufferCacheSize</span><span class="token punctuation">=</span><span class="token value attr-value">16384</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token key attr-name">store.file.flushDiskMode</span><span class="token punctuation">=</span><span class="token value attr-value">async</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token key attr-name">store.file.sessionReloadReadSize</span><span class="token punctuation">=</span><span class="token value attr-value">100</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">#----------- 修改这个区域的 JDBC 连接 -----------    </span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token key attr-name">store.db.datasource</span><span class="token punctuation">=</span><span class="token value attr-value">druid</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token key attr-name">store.db.dbType</span><span class="token punctuation">=</span><span class="token value attr-value">mysql</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token key attr-name">store.db.driverClassName</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token key attr-name">store.db.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token key attr-name">store.db.user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token key attr-name">store.db.password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token key attr-name">store.db.minConn</span><span class="token punctuation">=</span><span class="token value attr-value">5</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token key attr-name">store.db.maxConn</span><span class="token punctuation">=</span><span class="token value attr-value">30</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment">#------------------------------------------    </span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token key attr-name">store.db.globalTable</span><span class="token punctuation">=</span><span class="token value attr-value">global_table</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token key attr-name">store.db.branchTable</span><span class="token punctuation">=</span><span class="token value attr-value">branch_table</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token key attr-name">store.db.distributedLockTable</span><span class="token punctuation">=</span><span class="token value attr-value">distributed_lock</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token key attr-name">store.db.queryLimit</span><span class="token punctuation">=</span><span class="token value attr-value">100</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token key attr-name">store.db.lockTable</span><span class="token punctuation">=</span><span class="token value attr-value">lock_table</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token key attr-name">store.db.maxWait</span><span class="token punctuation">=</span><span class="token value attr-value">5000</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token key attr-name">store.redis.mode</span><span class="token punctuation">=</span><span class="token value attr-value">single</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token key attr-name">store.redis.single.host</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token key attr-name">store.redis.single.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token key attr-name">store.redis.sentinel.masterName</span><span class="token punctuation">=</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token key attr-name">store.redis.sentinel.sentinelHosts</span><span class="token punctuation">=</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token key attr-name">store.redis.maxConn</span><span class="token punctuation">=</span><span class="token value attr-value">10</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token key attr-name">store.redis.minConn</span><span class="token punctuation">=</span><span class="token value attr-value">1</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token key attr-name">store.redis.maxTotal</span><span class="token punctuation">=</span><span class="token value attr-value">100</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token key attr-name">store.redis.database</span><span class="token punctuation">=</span><span class="token value attr-value">0</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token key attr-name">store.redis.password</span><span class="token punctuation">=</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token key attr-name">store.redis.queryLimit</span><span class="token punctuation">=</span><span class="token value attr-value">100</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token key attr-name">server.recovery.committingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token key attr-name">server.recovery.asynCommittingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token key attr-name">server.recovery.rollbackingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token key attr-name">server.recovery.timeoutRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token key attr-name">server.maxCommitRetryTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token key attr-name">server.maxRollbackRetryTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token key attr-name">server.rollbackRetryTimeoutUnlockEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token key attr-name">server.distributedLockExpireTime</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token key attr-name">client.undo.dataValidation</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token key attr-name">client.undo.logSerialization</span><span class="token punctuation">=</span><span class="token value attr-value">jackson</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token key attr-name">client.undo.onlyCareUpdateColumns</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token key attr-name">server.undo.logSaveDays</span><span class="token punctuation">=</span><span class="token value attr-value">7</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token key attr-name">server.undo.logDeletePeriod</span><span class="token punctuation">=</span><span class="token value attr-value">86400000</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token key attr-name">client.undo.logTable</span><span class="token punctuation">=</span><span class="token value attr-value">undo_log</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token key attr-name">client.undo.compress.enable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token key attr-name">client.undo.compress.type</span><span class="token punctuation">=</span><span class="token value attr-value">zip</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token key attr-name">client.undo.compress.threshold</span><span class="token punctuation">=</span><span class="token value attr-value">64k</span></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token key attr-name">log.exceptionRate</span><span class="token punctuation">=</span><span class="token value attr-value">100</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token key attr-name">transport.serialization</span><span class="token punctuation">=</span><span class="token value attr-value">seata</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token key attr-name">transport.compressor</span><span class="token punctuation">=</span><span class="token value attr-value">none</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token key attr-name">metrics.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token key attr-name">metrics.registryType</span><span class="token punctuation">=</span><span class="token value attr-value">compact</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token key attr-name">metrics.exporterList</span><span class="token punctuation">=</span><span class="token value attr-value">prometheus</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token key attr-name">metrics.exporterPrometheusPort</span><span class="token punctuation">=</span><span class="token value attr-value">9898</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token key attr-name">tcc.fence.logTableName</span><span class="token punctuation">=</span><span class="token value attr-value">tcc_fence_log</span></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token key attr-name">tcc.fence.cleanPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1h</span></pre></td></tr></table></figure><ol start="4"><li>修改好这个文件以后，我们就需要把这个文件放到 seata 目录下</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642524267000/1fb303b3c9574b1e94cce1b743825e0a.png" alt="image20220118195227875.png"></p><ol start="5"><li><p>此时我们需要把这些配置一个个的加入到 Nacos 配置中，所以我们需要一个脚本来进行执行，官方已经提供好了，地址为：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRhL2Jsb2IvZGV2ZWxvcC9zY3JpcHQvY29uZmlnLWNlbnRlci9uYWNvcy9uYWNvcy1jb25maWcuc2g=">https://github.com/seata/seata/blob/develop/script/config-center/nacos/nacos-config.sh</span></p></li><li><p><span class="exturl" data-url="aHR0cDovL3huLS1zZWF0YS1zZXJ2ZXItMS05Mjl2eDc3Z3QwMmJqbTJrdHUzYi40LnhuLS0ybmFjb3MtY29uZmlnLWIwMHVkdG9ieDV4ZGEzMjAxYzBieWFkcTRhZ2EzNWd4NHhvajNvLnNo">我们需要在 seata-server-1.4.2 文件夹中新建一个脚本文件 nacos-config.sh</span>，然后把脚本内容复制进去</p></li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642524267000/5107e37cec114e27a22b1c8c1f226d85.png" alt="image20220118200307770.png"></p><ol start="7"><li>利用 git 来进行执行命令：</li></ol><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sh</span> nacos-config.sh <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-p</span> <span class="token number">8848</span> <span class="token parameter variable">-g</span> SEATA_GROUP <span class="token parameter variable">-t</span> 命名空间 <span class="token parameter variable">-u</span> nacos <span class="token parameter variable">-w</span> nacos</pre></td></tr></table></figure><p>参数说明：</p><p>-h：host，默认值 localhost</p><p>-p：port，默认值 8848</p><p>-g：配置分组，默认为 SEATA_GROUP</p><p>-t：租户信息，对应 Nacos 的命名空间 ID，默认为空</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642524267000/c08136f3e6184b7b88e83d15f733f3d0.png" alt="image20220118200423603.png"></p><ol start="8"><li>在执行 naocs-config 文件的时候要注意，它默认寻找 config.txt 的路径和我们的路径不同，所以要打开 naocs-config 文件进行修改，否则无法执行。</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642524267000/3f11434b59fb4356bb59f0b3919db51d.png" alt="image20220119002450133.png"></p><h3 id="测试启动"><a class="anchor" href="#测试启动">#</a> 测试启动</h3><p>当以上的这些配置完成以后，我们就可以启动 nacos 和 seata-server 了，此时我们查看 Nacos 的配置中心，就会看到我们传入的所有配置信息</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642524267000/800a9a0540244f079f86be63505f153f.png" alt="image20220119003324612.png"></p><h2 id="附加"><a class="anchor" href="#附加">#</a> 附加</h2><p>各位我们 Seata-Server 默认端口是 8091，那么如果我们是集群部署方式，我们如何修改端口那？</p><p>在 Linux/Mac 下</p><pre><code>  sh ./bin/seata-server.sh
</code></pre><p>在 Windows 下</p><pre><code>bin\seata-server.bat
</code></pre><h3 id="支持的启动参数"><a class="anchor" href="#支持的启动参数">#</a> 支持的启动参数</h3><table><thead><tr><th>参数</th><th>全写</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td>-h</td><td>--host</td><td>指定在注册中心注册的 IP</td><td>不指定时获取当前的 IP，外部访问部署在云环境和容器中的 server 建议指定</td></tr><tr><td>-p</td><td>--port</td><td>指定 server 启动的端口</td><td>默认为 8091</td></tr><tr><td>-m</td><td>--storeMode</td><td>事务日志存储方式</td><td>支持 <code>file</code> , <code>db</code> , <code>redis</code> ，默认为 <code>file</code> 注:redis 需 seata-server 1.3 版本及以上</td></tr><tr><td>-n</td><td>--serverNode</td><td>用于指定 seata-server 节点 ID</td><td>如 <code>1</code> , <code>2</code> , <code>3</code> ..., 默认为 <code>1</code></td></tr><tr><td>-e</td><td>--seataEnv</td><td>指定 seata-server 运行环境</td><td>如 <code>dev</code> , <code>test</code> 等，服务启动时会使用 <code>registry-dev.conf</code> 这样的配置</td></tr></tbody></table><p>如：</p><pre><code> sh ./bin/seata-server.sh -p 8091 -h 127.0.0.1 -m file
</code></pre><h1 id="seata-at模式"><a class="anchor" href="#seata-at模式">#</a> Seata-AT 模式</h1><p>概念：AT 模式是一种无侵入的分布式事务解决方案，在 AT 模式下，用户只需关注自己的 “业务 SQL”，用户的 “业务 SQL” 作为一阶段，Seata 框架会自动生成事务的二阶段提交和回滚操作。</p><h2 id="整体机制"><a class="anchor" href="#整体机制">#</a> 整体机制</h2><p>两阶段提交协议的演变：</p><ul><li>一阶段：业务数据和回滚日志记录在同一个本地事务中提交，释放本地锁和连接资源。</li><li>二阶段：<ul><li>提交异步化，非常快速地完成。</li><li>回滚通过一阶段的回滚日志进行反向补偿。</li></ul></li></ul><h3 id="一阶段"><a class="anchor" href="#一阶段">#</a> 一阶段</h3><p>在一阶段中，Seata 会拦截 “业务 SQL“，首先解析 SQL 语义，找到要更新的业务数据，在数据被更新前，保存下来 &quot;undo&quot;，然后执行” 业务 SQL“更新数据，更新之后再次保存数据”redo“，最后生成行锁，这些操作都在本地数据库事务内完成，这样保证了一阶段的原子性。</p><h3 id="二阶段"><a class="anchor" href="#二阶段">#</a> 二阶段</h3><p>相对一阶段，二阶段比较简单，负责整体的回滚和提交，如果之前的一阶段中有本地事务没有通过，那么就执行全局回滚，否在执行全局提交，回滚用到的就是一阶段记录的 &quot;undo Log&quot;，通过回滚记录生成反向更新 SQL 并执行，以完成分支的回滚。当然事务完成后会释放所有资源和删除所有日志。</p><h3 id="具体图解"><a class="anchor" href="#具体图解">#</a> 具体图解</h3><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/c5cda1c2014d4581a93ed75f26d234ab.png" alt="image20220118161225488.png"></p><h2 id="案例"><a class="anchor" href="#案例">#</a> 案例</h2><ol><li>首先设计两个服务，一个订单 order8801 一个库存 stock8802</li><li>stock 库存表为：<img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/aaa39d7694324cce9deef2c10fdbf132.png" alt="image20220117223403744.png"></li><li>order 订单表为：<img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/915363f21d474f04a63b0451955923ae.png" alt="image20220117223340923.png"></li><li>订单服务通过 OpenFegin 远程调用库存服务，然后库存服务减库存，订单服务生成订单，完成基本的调用以后我们给订单服务添加异常</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Service</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Resource</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token annotation punctuation">@Resource</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">StockClient</span> stockClient<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 减库存</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        stockClient<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// 添加异常</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment">// 创建订单</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        orderMapper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="5"><li>此时我们会发现访问接口出现异常情况，但是库存减少，订单没有增加此时已经出现了分布式事务的问题</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/eecbf65494df46029c548c29159d4318.png" alt="image20220117223455391.png"></p><p>订单表，没有增加数据</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/56d1870baf4e4f7aa4120fad0513adae.png" alt="image20220117223513706.png"></p><h3 id="通过seata的at模式解决分布式事务"><a class="anchor" href="#通过seata的at模式解决分布式事务">#</a> 通过 Seata 的 AT 模式解决分布式事务</h3><ol><li>首先增加对应的 Seata 依赖</li></ol><pre><code>    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre><ol start="2"><li>在对应的微服务数据库上加上 undo_log 表，此表用于数据的回滚</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span>  <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'分支事务ID'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'全局事务ID'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'上下文'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">longblob</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'回滚信息'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'状态，0正常，1全局已完成'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'AT transaction mode undo table'</span> ROW_FORMAT <span class="token operator">=</span> Compact<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/354464b4880e4d9e87fde0c8ab535963.png" alt="image20220117225203163.png"></p><ol start="3"><li>配置 yml（8801 和 8802Seata 的配置保持一致）</li></ol><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8802</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">application</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">name</span><span class="token punctuation">:</span> stock</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost</pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">druid</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver</pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token key atrule">url</span><span class="token punctuation">:</span>  jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test_at<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token key atrule">username</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token key atrule">password</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token key atrule">seata</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> mygroup <span class="token comment"># 事务组名称，要和服务端对应</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token key atrule">service</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">vgroup-mapping</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>       mygroup<span class="token punctuation">:</span> default <span class="token comment"># key 是事务组名称 value 要和服务端的机房名称保持一致</span></pre></td></tr></table></figure><ol start="4"><li>需要在 order8801 (TM) 的 Controller 上添加注解</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/order/create"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token comment">// 开启分布式事务</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        orderService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"生成订单"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="5"><li>把 8801 和 8802 都跑起来，当然 Nacos 和 Seata 都要进行启动，这个时候我们进行访问 Order 的 REST 接口：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4ODAxL29yZGVyL2NyZWF0ZQ==">http://localhost:8801/order/create</span>，我们就会发现此时已经解决了分布式事务问题<br>库存没有减少<br>订单也没有增加</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/b6abca237f9547369db5e84d1e932e17.png" alt="image20220118162757573.png"></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/2f7c4ee907454b448d51cb90d0f1f7ad.png" alt="image20220118162832649.png"></p><ol start="6"><li>那么为了验证 undo_log 表用于存储回滚的数据，我们在 OrderServiceImpl 上异常位置添加断点，同时以 debug 方式来启动 8801 订单服务</li></ol><pre><code>@Service
public class OrderServiceImpl implements OrderService &#123;
    @Resource
    private OrderMapper orderMapper;

    @Resource
    private StockClient stockClient;

    @Override
    public void create() &#123;
        // 减库存
        stockClient.decrement();

        // 添加异常
        int i = 1/0;// 此处添加断点

        // 创建订单
        orderMapper.create();
    &#125;
&#125;
</code></pre><ol start="7"><li>然后访问接口：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4ODAxL29yZGVyL2NyZWF0ZQ==">http://localhost:8801/order/create</span>，程序会卡在断点上，此时我们来查看 undo_log 表和库存表，此时我们会发现，库存确实减少了，但是在 undo_log 表中出现了快照记录了当前修改前的数据，这个数据就是用于回滚的数据<br>库存减少</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/27a1b4bcde974baca7dba1df62f44f37.png" alt="image20220118163714002.png"></p><pre><code>	undo_log表记录快照
</code></pre><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/bcf9f44d96864f58aef8d42726e2a811.png" alt="image20220118163908365.png"></p><pre><code>	放行以后，库存数量回复，回滚生效
</code></pre><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1642764224000/4ef168339c6949b39b5f63bc2042ad81.png" alt="image20220118164019307.png"></p><ol start="8"><li>此时我们就验证了 AT 事务的执行过程。</li></ol><h1 id="seata-xa模式"><a class="anchor" href="#seata-xa模式">#</a> Seata-XA 模式</h1><p>Seata 1.2.0 版本重磅发布新的事务模式：XA 模式，实现对 XA 协议的支持。</p><p>我们从三个方面来深入分析：</p><ol><li>XA 模式是什么？</li><li>为什么支持 XA？</li><li>XA 模式如何实现的，以及如何使用？</li></ol><h2 id="xa模式"><a class="anchor" href="#xa模式">#</a> XA 模式</h2><p>首先我们需要先了解一下什么是 XA？</p><p>XA 规范早在上世纪 90 年代初就被提出，用以解决分布式事务处理这个领域的问题。</p><p>注意：不存在某一种分布式事务机制可以完美适应所有场景，满足所有需求。</p><p>现在，无论 AT 模式、TCC 模式还是 Saga 模式，这些模式的提出，本质上都源自 XA 规范对某些场景需求的无法满足。</p><h3 id="什么是xa协议"><a class="anchor" href="#什么是xa协议">#</a> 什么是 XA 协议</h3><p>XA 规范 是 X/Open 组织定义的分布式事务处理（DTP，Distributed Transaction Processing）标准</p><p>XA 规范 描述了全局的事务管理器与局部的资源管理器之间的接口。 XA 规范 的目的是允许的多个资源（如数据库，应用服务器，消息队列等）在同一事务中访问，这样可以使 ACID 属性跨越应用程序而保持有效。</p><p>XA 规范 使用两阶段提交（2PC，Two-Phase Commit）来保证所有资源同时提交或回滚任何特定的事务。</p><p>XA 规范 在上世纪 90 年代初就被提出。目前，几乎所有主流的数据库都对 XA 规范 提供了支持。</p><p>DTP 模型定义如下角色：</p><ul><li>AP：即应用程序，可以理解为使用 DTP 分布式事务的程序</li><li>RM：资源管理器，可以理解为事务的参与者，一般情况下是指一个数据库的实例（MySql），通过资源管理器对该数据库进行控制，资源管理器控制着分支事务</li><li>TM：事务管理器，负责协调和管理事务，事务管理器控制着全局事务，管理实务生命周期，并协调各个 RM。全局事务是指分布式事务处理环境中，需要操作多个数据库共同完成一个工作，这个工作即是一个全局事务。</li><li>DTP 模式定义 TM 和 RM 之间通讯的接口规范叫 XA，简单理解为数据库提供的 2PC 接口协议，基于数据库的 XA 协议来实现的 2PC 又称为 XA 方案。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/081cd4e8c4584620834469d663701fc2.png" alt="20200722160231749.png"></p><p>案例解释：</p><ol><li>应用程序（AP）持有订单库和商品库两个数据源。</li><li>应用程序（AP）通过 TM 通知订单库（RM）和商品库（RM），来创建订单和减库存，RM 此时未提交事务，此时商品和订单资源锁定。</li><li>TM 收到执行回复，只要有一方失败则分别向其他 RM 发送回滚事务，回滚完毕，资源锁释放。</li><li>TM 收到执行回复，全部成功，此时向所有的 RM 发起提交事务，提交完毕，资源锁释放。</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/04a567aca96a410ea7f1fa0e8eba955b.png" alt="image20220209173222316.png"></p><h4 id="xa协议的痛点"><a class="anchor" href="#xa协议的痛点">#</a> XA 协议的痛点</h4><p>如果一个参与全局事务的资源 “失联” 了（收不到分支事务结束的命令），那么它锁定的数据，将一直被锁定。进而，甚至可能因此产生死锁。</p><p>这是 XA 协议的核心痛点，也是 Seata 引入 XA 模式要重点解决的问题。</p><h3 id="seata的事务模式"><a class="anchor" href="#seata的事务模式">#</a> Seata 的事务模式</h3><p>Seata 定义了全局事务的框架。</p><p>全局事务 定义为若干 分支事务 的整体协调：</p><ol><li>TM 向 TC 请求发起（Begin）、提交（Commit）、回滚（Rollback）全局事务。</li><li>TM 把代表全局事务的 XID 绑定到分支事务上。</li><li>RM 向 TC 注册，把分支事务关联到 XID 代表的全局事务中。</li><li>RM 把分支事务的执行结果上报给 TC。（可选）</li><li>TC 发送分支提交（Branch Commit）或分支回滚（Branch Rollback）命令给 RM。</li></ol><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/7c9541b4dfc4450d84714078137081d3.png" alt="TB19qmhOrY1gK0jSZTEXXXDQVXa1330924.png"></p><p>Seata 的 全局事务 处理过程，分为两个阶段：</p><ul><li>执行阶段 ：执行分支事务，并保证执行结果满足是<em>可回滚的（Rollbackable）</em> 和<em>持久化的（Durable）</em>。</li><li>完成阶段： 根据 执行阶段 结果形成的决议，应用通过 TM 发出的全局提交或回滚的请求给 TC，TC 命令 RM 驱动 分支事务 进行 Commit 或 Rollback。</li></ul><p>Seata 的所谓事务模式是指：运行在 Seata 全局事务框架下的 分支事务 的行为模式。准确地讲，应该叫作 分支事务模式。</p><p>不同的 事务模式 区别在于 分支事务 使用不同的方式达到全局事务两个阶段的目标。即，回答以下两个问题：</p><ul><li>执行阶段 ：如何执行并 保证 执行结果满足是<em>可回滚的（Rollbackable）</em> 和<em>持久化的（Durable）</em>。</li><li>完成阶段： 收到 TC 的命令后，如何做到分支的提交或回滚？</li></ul><p>我们以 AT 模式举例：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/2f29d8621f98463db0101f6f3e1c9a35.png" alt="TB1NTuzOBr0gK0jSZFnXXbRRXXa1330924.png"></p><ul><li>执行阶段：<ul><li>可回滚：根据 SQL 解析结果，记录回滚日志</li><li>持久化：回滚日志和业务 SQL 在同一个本地事务中提交到数据库</li></ul></li><li>完成阶段：<ul><li>分支提交：异步删除回滚日志记录</li><li>分支回滚：依据回滚日志进行反向补偿更新</li></ul></li></ul><h2 id="seata的xa模式"><a class="anchor" href="#seata的xa模式">#</a> Seata 的 XA 模式</h2><p>XA 模式：</p><p>在 Seata 定义的分布式事务框架内，利用事务资源（数据库、消息服务等）对 XA 协议的支持，以 XA 协议的机制来管理分支事务的一种 事务模式。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/a4e733baeb4641efa9f81139d9eb9ef2.png" alt="TB1hSpccIVl614jSZKPXXaGjpXa1330924.png"></p><ul><li>执行阶段：<ul><li>可回滚：业务 SQL 操作放在 XA 分支中进行，由资源对 XA 协议的支持来保证 可回滚</li><li>持久化：XA 分支完成后，执行 XA prepare，同样，由资源对 XA 协议的支持来保证<em>持久化</em>（即，之后任何意外都不会造成无法回滚的情况）</li></ul></li><li>完成阶段：<ul><li>分支提交：执行 XA 分支的 commit</li><li>分支回滚：执行 XA 分支的 rollback</li></ul></li></ul><h3 id="为什么要在seata中支持xa"><a class="anchor" href="#为什么要在seata中支持xa">#</a> 为什么要在 Seata 中支持 XA</h3><p>为什么要在 Seata 中增加 XA 模式呢？支持 XA 的意义在哪里呢？</p><p>本质上，Seata 已经支持的 3 大事务模式：AT、TCC、Saga 都是 补偿型 的。</p><p>补偿型 事务处理机制构建在 事务资源 之上（要么在中间件层面，要么在应用层面），事务资源 本身对分布式事务是无感知的。</p><p>事务资源 对分布式事务的无感知存在一个根本性的问题：无法做到真正的 全局一致性 。</p><p>比如，一条库存记录，处在 补偿型 事务处理过程中，由 100 扣减为 50。此时，仓库管理员连接数据库，查询统计库存，就看到当前的 50。之后，事务因为异外回滚，库存会被补偿回滚为 100。显然，仓库管理员查询统计到的 50 就是 脏 数据。所以补偿型事务是存在中间状态的（中途可能读到脏数据）</p><h3 id="xa的价值"><a class="anchor" href="#xa的价值">#</a> XA 的价值</h3><p>与 补偿型 不同，XA 协议 要求 事务资源 本身提供对规范和协议的支持。</p><p>因为 事务资源 感知并参与分布式事务处理过程，所以 事务资源（如数据库）可以保障从任意视角对数据的访问有效隔离，满足全局数据一致性。</p><p>比如，刚才提到的库存更新场景，XA 事务处理过程中，中间状态数据库存 50 由数据库本身保证，是不会仓库管理员的查询统计看到的。</p><p>除了 全局一致性 这个根本性的价值外，支持 XA 还有如下几个方面的好处：</p><ol><li>业务无侵入：和 AT 一样，XA 模式将是业务无侵入的，不给应用设计和开发带来额外负担。</li><li>数据库的支持广泛：XA 协议被主流关系型数据库广泛支持，不需要额外的适配即可使用。</li><li>多语言支持容易：因为不涉及 SQL 解析，XA 模式对 Seata 的 RM 的要求比较少。</li><li>传统基于 XA 应用的迁移：传统的，基于 XA 协议的应用，迁移到 Seata 平台，使用 XA 模式将更平滑。</li></ol><h2 id="xa模式的使用"><a class="anchor" href="#xa模式的使用">#</a> XA 模式的使用</h2><p>我们从官方案例入手，具体的官方案例下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRhLXNhbXBsZXM=">https://github.com/seata/seata-samples</span></p><p>官方案例演示图：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/7bc365555cce40bab992c3fc20d21d23.png" alt="image20220211150003482.png"></p><p>案例解析：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/f80ebac36f754d3f9602c19ffbb0d707.png" alt="image20220211155757596.png"></p><p>整体运行机制：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/c8387eae75ad4db0b7e4065d924b4c5a.png" alt="TB19qmhOrY1gK0jSZTEXXXDQVXa1330924.png"></p><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2><p>在当前的技术发展阶段，不存一个分布式事务处理机制可以完美满足所有场景的需求。</p><p>一致性、可靠性、易用性、性能等诸多方面的系统设计约束，需要用不同的事务处理机制去满足。</p><p>Seata 项目最核心的价值在于：构建一个全面解决分布式事务问题的 标准化 平台。</p><p>基于 Seata，上层应用架构可以根据实际场景的需求，灵活选择合适的分布式事务解决方案。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422177000/84f6e8e625c64f608ffa72ecf1f28f57.png" alt="TB1lTSoOqL7gK0jSZFBXXXZZpXa1028528.png"></p><p>XA 模式的加入，补齐了 Seata 在 全局一致性 场景下的缺口，形成 AT、TCC、Saga、XA 四大 事务模式 的版图，基本可以满足所有场景的分布式事务处理诉求。</p><h1 id="tcc事务模式"><a class="anchor" href="#tcc事务模式">#</a> TCC 事务模式</h1><p>首先我们先来了解常规的 TCC 模式。</p><h3 id="什么是tcc"><a class="anchor" href="#什么是tcc">#</a> 什么是 TCC</h3><p>TCC 是分布式事务中的二阶段提交协议，它的全称为 Try-Confirm-Cancel，即资源预留（Try）、确认操作（Confirm）、取消操作（Cancel），他们的具体含义如下：</p><ol><li>Try：对业务资源的检查并预留；</li><li>Confirm：对业务处理进行提交，即 commit 操作，只要 Try 成功，那么该步骤一定成功；</li><li>Cancel：对业务处理进行取消，即回滚操作，该步骤回对 Try 预留的资源进行释放。</li></ol><p>TCC 是一种侵入式的分布式事务解决方案，以上三个操作都需要业务系统自行实现，对业务系统有着非常大的入侵性，设计相对复杂，但优点是 TCC 完全不依赖数据库，能够实现跨数据库、跨应用资源管理，对这些不同数据访问通过侵入式的编码方式实现一个原子操作，更好地解决了在各种复杂业务场景下的分布式事务问题。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422117000/85e3fca01b714c99952ca6a06be2dc23.png" alt="image.png"></p><h3 id="seata的tcc模式"><a class="anchor" href="#seata的tcc模式">#</a> Seata 的 TCC 模式</h3><p>Seata TCC 模式跟通用型 TCC 模式原理一致。</p><h3 id="tcc和at区别"><a class="anchor" href="#tcc和at区别">#</a> TCC 和 AT 区别</h3><p>AT 模式基于 <strong>支持本地 ACID 事务</strong> 的 <strong>关系型数据库</strong>：</p><ul><li>一阶段 prepare 行为：在本地事务中，一并提交业务数据更新和相应回滚日志记录。</li><li>二阶段 commit 行为：马上成功结束，<strong>自动</strong> 异步批量清理回滚日志。</li><li>二阶段 rollback 行为：通过回滚日志，<strong>自动</strong> 生成补偿操作，完成数据回滚。</li></ul><p>相应的，TCC 模式，不依赖于底层数据资源的事务支持：</p><ul><li>一阶段 prepare 行为：调用<strong>自定义</strong> 的 prepare 逻辑。</li><li>二阶段 commit 行为：调用<strong>自定义</strong> 的 commit 逻辑。</li><li>二阶段 rollback 行为：调用<strong>自定义</strong> 的 rollback 逻辑。</li></ul><p>所谓 TCC 模式，是指支持把 <strong>自定义</strong> 的分支事务纳入到全局事务的管理中。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422117000/94034492f123410197b33cd2c3573a1d.png" alt="seata_tcc11644422133604.png"></p><h2 id="特点"><a class="anchor" href="#特点">#</a> 特点：</h2><ol><li>侵入性比较强，并且需要自己实现相关事务控制逻辑</li><li>在整个过程基本没有锁，性能较强</li></ol><h2 id="详细讲解"><a class="anchor" href="#详细讲解">#</a> 详细讲解</h2><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644422117000/c01ba87b261645f5ae99b4925e1c6fd3.png" alt="image20220125210417709.png"></p><p>具体使用案例：<span class="exturl" data-url="aHR0cHM6Ly9zZWF0YS5pby96aC1jbi9ibG9nL2ludGVncmF0ZS1zZWF0YS10Y2MtbW9kZS13aXRoLXNwcmluZy1jbG91ZC5odG1s">https://seata.io/zh-cn/blog/integrate-seata-tcc-mode-with-spring-cloud.html</span></p><h1 id="seata中的saga事务模式"><a class="anchor" href="#seata中的saga事务模式">#</a> Seata 中的 Saga 事务模式</h1><h3 id="基本概念"><a class="anchor" href="#基本概念">#</a> 基本概念</h3><p>Saga 模式是 SEATA 提供的长事务解决方案，在 Saga 模式中，业务流程中每个参与者都提交本地事务，当出现某一个参与者失败则补偿前面已经成功的参与者，一阶段正向服务和二阶段补偿服务（执行处理时候出错了，给一个修复的机会）都由业务开发实现。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644919973000/659fd4a073484f5888e3c3d7ee635e48.png" alt="TB1Y2kuw7T2gK0jSZFkXXcIQFXa445444.png"></p><p>Saga 模式下分布式事务通常是由事件驱动的，各个参与者之间是异步执行的，Saga 模式是一种长事务解决方案。</p><h3 id="为什么需要saga"><a class="anchor" href="#为什么需要saga">#</a> 为什么需要 Saga</h3><p>之前我们学习的 Seata 分布式三种操作模型中所使用的的微服务全部可以根据开发者的需求进行修改，但是在一些特殊环境下，比如老系统，封闭的系统（无法修改，同时没有任何分布式事务引入），那么 AT、XA、TCC 模型将全部不能使用，为了解决这样的问题，才引用了 Saga 模型。</p><p>比如：事务参与者可能是其他公司的服务或者是遗留系统，无法改造，可以使用 Saga 模式。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644919973000/05d2c07b91dd46a4baa498f4e3f3d49e.png" alt="image20220215170345079.png"></p><p>Saga 模式是 Seata 提供的长事务解决方案，提供了<strong>异构系统的事务统一处理模型</strong>。在 Saga 模式中，所有的子业务都不在直接参与整体事务的处理（只负责本地事务的处理），而是全部交由了最终调用端来负责实现，而在进行总业务逻辑处理时，在某一个子业务出现问题时，则自动补偿全面已经成功的其他参与者，这样一阶段的正向服务调用和二阶段的服务补偿处理全部由总业务开发实现。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644919973000/cd988d659148427fbb3b5dafa1c12782.png" alt="Saga.png"></p><h3 id="saga状态机"><a class="anchor" href="#saga状态机">#</a> Saga 状态机</h3><p>目前 Seata 提供的 Saga 模式只能通过状态机引擎来实现，需要开发者手工的进行 Saga 业务流程绘制，并且将其转换为 Json 配置文件，而后在程序运行时，将依据子配置文件实现业务处理以及服务补偿处理，而要想进行 Saga 状态图的绘制，一般需要通过 Saga 状态机来实现。</p><p>基本原理：</p><ul><li>通过状态图来定义服务调用的流程并生成 json 定义文件</li><li>状态图中一个节点可以调用一个服务，节点可以配置它的补偿节点</li><li>状态图 json 由状态机引擎驱动执行，当出现异常时状态引擎反向执行已成功节点对应的补偿节点将事务回滚</li><li>可以实现服务编排需求，支持单项选择、并发、子流程、参数转换、参数映射、服务执行状态判断、异常捕获等功能</li></ul><p>![](file://E:/%E9%A9%AC%E5%A3%AB%E5%85%B5/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%93%E9%A2%98/%E8%AF%BE%E4%BB%B6/Seata%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/09/demo_statelang.png?lastModify=1644919976)<img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644919973000/78e31d21cf3c4df6be73532c2b1cc08a.png" alt="demo_statelang.png"></p><h3 id="saga状态机的应用"><a class="anchor" href="#saga状态机的应用">#</a> Saga 状态机的应用</h3><p>官方提供了一个状态机设计器</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1644919973000/e3535b08efed496086d1ed219cf580e2.png" alt="image20220215175333918.png"></p><p>官方文档地址：<span class="exturl" data-url="aHR0cHM6Ly9zZWF0YS5pby96aC1jbi9kb2NzL3VzZXIvc2FnYS5odG1s">https://seata.io/zh-cn/docs/user/saga.html</span></p><p>Seata Safa 状态机可视化图形设计器使用地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRhL2Jsb2IvZGV2ZWxvcC9zYWdhL3NlYXRhLXNhZ2Etc3RhdGVtYWNoaW5lLWRlc2lnbmVyL1JFQURNRS56aC1DTi5tZA==">https://github.com/seata/seata/blob/develop/saga/seata-saga-statemachine-designer/README.zh-CN.md</span></p><div id="gitalk-container"></div><script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalkConfig={clientID:"6db178ba46c8af8f6a6f",clientSecret:"90f730e5956024596558df00975cd8eae28cae3d",repo:"bk-comment01",owner:"onlymarryu",admin:["onlymarryu"],distractionFreeMode:!1,language:"zh-CN",proxy:"https://gitalk-comments.netlify.app/github_access_token",perPage:15};gitalkConfig.id=md5(location.pathname);var gitalk=new Gitalk(gitalkConfig);gitalk.render("gitalk-container")</script><div class="tags"><a href="/tags/spring-cloud-alibaba/" rel="tag"><i class="ic i-tag"></i> spring-cloud-alibaba</a> <a href="/tags/Seate/" rel="tag"><i class="ic i-tag"></i> Seate</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" rel="tag"><i class="ic i-tag"></i> 分布式事务</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-07-10 22:05:14" itemprop="dateModified" datetime="2023-07-10T22:05:14+08:00">2023-07-10</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="雾都 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="雾都 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="雾都 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>雾都 <i class="ic i-at"><em>@</em></i>每天进步一点点，就是成功的开始</li><li class="link"><strong>本文链接：</strong> <a href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" title="Seata 系统学习">https://eth168.top/Spring_Family/spring-cloud-alibaba/Seata系统学习/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?271379" title="Gateway系统学习"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 微服务</span><h3>Gateway系统学习</h3></a></div><div class="item right"><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%85%B3%E4%BA%8E%E5%85%B3%E4%BA%8ENacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?303825" title="关于关于Nacos配置中心的配置"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 微服务</span><h3>关于关于Nacos配置中心的配置</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">分布式事务简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.1.1.</span> <span class="toc-text">事务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%90%86%E8%AE%BA"><span class="toc-number">1.2.</span> <span class="toc-text">分布式事务理论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cap%E5%AE%9A%E5%BE%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">CAP 定律</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base%E7%90%86%E8%AE%BA"><span class="toc-number">1.2.2.</span> <span class="toc-text">BASE 理论</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#seata%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">Seata 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">2.1.</span> <span class="toc-text">分布式事务解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seata%E7%AE%80%E4%BB%8B-2"><span class="toc-number">2.2.</span> <span class="toc-text">Seata 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seata%E6%9C%AF%E8%AF%AD"><span class="toc-number">2.3.</span> <span class="toc-text">Seata 术语</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seata-server%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.4.</span> <span class="toc-text">Seata-Server 下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seata-server%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.</span> <span class="toc-text">Seata-Server 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">2.6.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seata-servertc%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.7.</span> <span class="toc-text">Seata Server（TC）环境搭建详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="toc-number">2.8.</span> <span class="toc-text">具体操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#seata%E9%85%8D%E7%BD%AEnacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">3.</span> <span class="toc-text">Seata 配置 Nacos 注册中心和配置中心</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE%E5%A6%82%E4%B8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">具体配置如下</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-number">3.1.1.</span> <span class="toc-text">注册中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">3.1.2.</span> <span class="toc-text">配置中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%90%AF%E5%8A%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">测试启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%8A%A0"><span class="toc-number">3.2.</span> <span class="toc-text">附加</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.1.</span> <span class="toc-text">支持的启动参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#seata-at%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">Seata-AT 模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9C%BA%E5%88%B6"><span class="toc-number">4.1.</span> <span class="toc-text">整体机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E9%98%B6%E6%AE%B5"><span class="toc-number">4.1.1.</span> <span class="toc-text">一阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E9%98%B6%E6%AE%B5"><span class="toc-number">4.1.2.</span> <span class="toc-text">二阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%9B%BE%E8%A7%A3"><span class="toc-number">4.1.3.</span> <span class="toc-text">具体图解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87seata%E7%9A%84at%E6%A8%A1%E5%BC%8F%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-number">4.2.1.</span> <span class="toc-text">通过 Seata 的 AT 模式解决分布式事务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#seata-xa%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">Seata-XA 模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#xa%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.</span> <span class="toc-text">XA 模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFxa%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.1.1.</span> <span class="toc-text">什么是 XA 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xa%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%97%9B%E7%82%B9"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">XA 协议的痛点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#seata%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.2.</span> <span class="toc-text">Seata 的事务模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seata%E7%9A%84xa%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">Seata 的 XA 模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%9C%A8seata%E4%B8%AD%E6%94%AF%E6%8C%81xa"><span class="toc-number">5.2.1.</span> <span class="toc-text">为什么要在 Seata 中支持 XA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xa%E7%9A%84%E4%BB%B7%E5%80%BC"><span class="toc-number">5.2.2.</span> <span class="toc-text">XA 的价值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xa%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.3.</span> <span class="toc-text">XA 模式的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tcc%E4%BA%8B%E5%8A%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">TCC 事务模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFtcc"><span class="toc-number">6.0.1.</span> <span class="toc-text">什么是 TCC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#seata%E7%9A%84tcc%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.0.2.</span> <span class="toc-text">Seata 的 TCC 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcc%E5%92%8Cat%E5%8C%BA%E5%88%AB"><span class="toc-number">6.0.3.</span> <span class="toc-text">TCC 和 AT 区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">6.1.</span> <span class="toc-text">特点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AE%B2%E8%A7%A3"><span class="toc-number">6.2.</span> <span class="toc-text">详细讲解</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#seata%E4%B8%AD%E7%9A%84saga%E4%BA%8B%E5%8A%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.</span> <span class="toc-text">Seata 中的 Saga 事务模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">7.0.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81saga"><span class="toc-number">7.0.2.</span> <span class="toc-text">为什么需要 Saga</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#saga%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">7.0.3.</span> <span class="toc-text">Saga 状态机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#saga%E7%8A%B6%E6%80%81%E6%9C%BA%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">7.0.4.</span> <span class="toc-text">Saga 状态机的应用</span></a></li></ol></li></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Nacos系统学习">Nacos系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Sentinel系统学习">Sentinel系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E6%BA%90%E7%A0%81%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Sentinel源码系统学习">Sentinel源码系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Gateway系统学习">Gateway系统学习</a></li><li class="active"><a href="/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Seata系统学习">Seata系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%85%B3%E4%BA%8E%E5%85%B3%E4%BA%8ENacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE/" rel="bookmark" title="关于关于Nacos配置中心的配置">关于关于Nacos配置中心的配置</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E9%A1%BA%E5%BA%8F/" rel="bookmark" title="微服务加载配置顺序">微服务加载配置顺序</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="雾都" data-src="/images/avatar.jpg"><p class="name" itemprop="name">雾都</p><div class="description" itemprop="description">花非花，雾非雾</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">85</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">30</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL29ubHltYXJyeXU=" title="https:&#x2F;&#x2F;github.com&#x2F;onlymarryu"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9ydXJpc216aw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;rurismzk"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvbXkvbS9tdXNpYy9wbGF5bGlzdD9pZD0zMTY2MDYwNzkw" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;my&#x2F;m&#x2F;music&#x2F;playlist?id&#x3D;3166060790"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vYW1laGltZQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime"><i class="ic i-weibo"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>时间轴</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/toolPage/" rel="section"><i class="ic i-feather"></i>常用工具设置技巧</a></li><li class="item"><a href="/projectBuild/" rel="section"><i class="ic i-th"></i>SpringBoot常用配置</a></li></ul></li><li class="item"><a href="/mianshi/" rel="section"><i class="ic i-calendar"></i>面试</a></li><li class="item"><a href="/study/" rel="section"><i class="ic i-sakura"></i>小实验</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-calendar"></i>留言</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%85%B3%E4%BA%8E%E5%85%B3%E4%BA%8ENacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC12%E7%AB%A0IO/" title="第12章IO">第12章IO</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC4%E7%AB%A0_%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" title="第4章_流程控制">第4章_流程控制</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B0%8F%E5%AE%9E%E9%AA%8C/" title="分类于 小实验">小实验</a></div><span><a href="/study/develop/domain/" title="domain">domain</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E9%9D%A2%E8%AF%95/" title="分类于 面试">面试</a></div><span><a href="/interview/JVM%E5%A4%8D%E4%B9%A0%E7%89%88/" title="JVM复习版">JVM复习版</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a></div><span><a href="/Distribution/RabbitMQ/" title="RabbitMQ">RabbitMQ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC7%E7%AB%A0_IDEA%E7%9A%84%E4%BD%BF%E7%94%A8/" title="第7章_IDEA的使用">第7章_IDEA的使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B0%8F%E5%AE%9E%E9%AA%8C/" title="分类于 小实验">小实验</a></div><span><a href="/study/develop/httpTohttps/" title="配置https">配置https</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a></div><span><a href="/Distribution/Elasticsearch/" title="Elasticsearch-7">Elasticsearch-7</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/HDFS-tool/" title="HDFS安装">HDFS安装</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a></div><span><a href="/Distribution/Dubbo/" title="Dubbo">Dubbo</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">雾都 @ 雾都博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.5m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">22:43</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Spring_Family/spring-cloud-alibaba/Seata系统学习/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(i){return i.includes("#")},function(i){return new RegExp(LOCAL.path+"$").test(i)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>