<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="每天进步一点点，就是成功的开始" href="https://eth168.top/atom.xml"><link rel="alternate" type="application/json" title="每天进步一点点，就是成功的开始" href="https://eth168.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Gateway,spring-cloud-alibaba"><link rel="canonical" href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"><title>Gateway 系统学习 - 微服务 | 雾都博客 = 每天进步一点点，就是成功的开始</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Gateway 系统学习</h1><div class="meta"><span class="item" title="创建时间：2023-07-10 21:54:50"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-07-10T21:54:50+08:00">2023-07-10</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>16k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>15 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">雾都博客</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://api.yimian.xyz/img?261717"></li><li class="item" data-background-image="https://api.yimian.xyz/img?952444"></li><li class="item" data-background-image="https://api.yimian.xyz/img?274380"></li><li class="item" data-background-image="https://api.yimian.xyz/img?349412"></li><li class="item" data-background-image="https://api.yimian.xyz/img?758746"></li><li class="item" data-background-image="https://api.yimian.xyz/img?346765"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" itemprop="item" rel="index" title="分类于 微服务"><span itemprop="name">微服务</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="雾都"><meta itemprop="description" content=", 花非花，雾非雾"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="每天进步一点点，就是成功的开始"></span><div class="body md" itemprop="articleBody"><h1 id="网关介绍"><a class="anchor" href="#网关介绍">#</a> 网关介绍</h1><p>在微服务架构中，一个系统会被拆分为很多个微服务。那么作为客户端要如何去调用这么多的微服务呢？如果没有网关的存在，我们只能在客户端记录每个微服务的地址，然后分别去调用。这样的话会产生很多问题，例如：</p><ul><li>客户端多次请求不同的微服务，增加客户端代码或配置编写的复杂性</li><li>认证复杂，每个微服务都有独立认证</li><li>存在跨域请求，在一定场景下处理相对复杂</li></ul><p>为解决上面的问题所以引入了网关的概念：所谓的 API 网关，就是指系统的统一入口，提供内部服务的路由中转，为客户端提供统一服务，一些与业务本身功能无关的公共逻辑可以在这里实现，诸如认证、鉴权、监控、路由转发等。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1640685138000/13912782ae2c4387a81b42b1ea1b32db.png" alt=".png"></p><h2 id="网关对比"><a class="anchor" href="#网关对比">#</a> 网关对比</h2><ul><li>Zuul 1.x<br>Netflix 开源的网关，基于 Servlet 框架构建，功能丰富，使用 JAVA 开发，易于二次开发 问题：即一个线程处理一次连接请求，这种方式在内部延迟严重、设备故障较多情况下会引起存活的连接增多和线程增加的情况发生。</li><li>Zuul 2.x<br>Zuul2 采用了 Netty 实现异步非阻塞编程模型，每个 CPU 核一个线程，处理所有的请求和响应，请求和响应的生命周期是通过事件和回调来处理的，这种方式减少了线程数量，因此开销较小。</li><li>GateWay<br>Spring 公司为了替换 Zuul 而开发的网关服务，底层为 Netty，将在下面具体介绍。</li><li>Nginx+lua<br>使用 nginx 的反向代理和负载均衡可实现对 api 服务器的负载均衡及高可用，lua 是一种脚本语言，可以来编写一些简单的逻辑，nginx 支持 lua 脚本，问题在于：无法融入到微服务架构中</li><li>Kong<br>基于 Nginx+Lua 开发，性能高，稳定，有多个可用的插件 (限流、鉴权等等) 可以开箱即用。 问题：只支持 Http 协议；二次开发，自由扩展困难；提供管理 API，缺乏更易用的管控、配置方式。</li></ul><h2 id="gateway"><a class="anchor" href="#gateway">#</a> GateWay</h2><p>Spring Cloud Gateway 基于 Spring Boot 2.x、Spring WebFlux 和 Project Reactor，它旨在为微服务架构提供一种简单有效的统一的 API 路由管理方式。它的目标是替代 Netflix Zuul，其不仅提供统一的路由方式，并且基于 Filter 链的方式提供了网关基本的功能，例如：安全，监控和限流。</p><p>特点：</p><ol><li>性能强劲：是 Zuul 的 1.6 倍</li><li>功能强大：内置了很多实用的功能，例如转发、监控、限流等</li><li>设计优雅，容易扩展</li></ol><h3 id="基本概念"><a class="anchor" href="#基本概念">#</a> 基本概念：</h3><p>路由 (Route) 是 gateway 中最基本的组件之一，表示一个具体的路由信息载体。主要定义了下面的几个信息:</p><ul><li>id：路由标识、区别于其他 route</li><li>uri：路由指向的目的地 uri，即客户端请求最终被转发到的微服务</li><li>order：用于多个 route 之间的排序，数值越小排序越靠前，匹配优先级越高</li><li>predicate：断言的作用是进行条件判断，只有断言都返回真，才会真正的执行路由</li><li>filter：过滤器用于修改请求和响应信息</li></ul><h3 id="执行流程"><a class="anchor" href="#执行流程">#</a> 执行流程：</h3><ol><li>Gateway Client 向 Gateway Server 发送请求</li><li>请求首先会被 HttpWebHandlerAdapter 进行提取组装成网关上下文</li><li>然后网关的上下文会传递到 DispatcherHandler，它负责将请求分发给 RoutePredicateHandlerMapping</li><li>RoutePredicateHandlerMapping 负责路由查找，并根据路由断言判断路由是否可用</li><li>如果过断言成功，由 FilteringWebHandler 创建过滤器链并调用</li><li>请求会一次经过 PreFilter-- 微服务 --PostFilter 的方法，最终返回响应</li></ol><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结：</h2><p>SpringCloud GateWay 使用的是 Webflux 中的 reactor-netty 响应式编程组件，底层使用了 Netty 通讯框架。</p><h1 id="gateway工作流程gateway基础搭建"><a class="anchor" href="#gateway工作流程gateway基础搭建">#</a> GateWay 工作流程 + GateWay 基础搭建</h1><p>核心流程图如下：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1640707752000/5f398d8602654c4cb855428f0ac62442.png" alt="spring_cloud_gateway_diagram.png"></p><p><strong>核心概念：</strong></p><p>客户端向 Spring Cloud Gateway 发出请求。如果 Gateway Handler Mapping 确定请求与路由匹配，则将其发送到 Gateway Web Handler 处理程序。此处理程序通过特定于请求的 Fliter 链运行请求。Fliter 被虚线分隔的原因是 Fliter 可以在发送代理请求之前（pre）和之后（post）运行逻辑。执行所有 pre 过滤器逻辑。然后进行代理请求。发出代理请求后，将运行 “post” 过滤器逻辑。</p><p><strong>过滤器作用：</strong></p><ul><li>Filter 在 pre 类型的过滤器可以做参数效验、权限效验、流量监控、日志输出、协议转换等。</li><li>Filter 在 post 类型的过滤器可以做响应内容、响应头的修改、日志输出、流量监控等</li><li>这两种类型的过滤器有着非常重要的作用</li></ul><p>在 GateWay 的内部有三个核心点，我们先来看一下：</p><h2 id="核心点"><a class="anchor" href="#核心点">#</a> 核心点</h2><ul><li>Route（路由）<br>路由是构建网关的基础模块，它由 ID，目标 URI，包括一些列的断言和过滤器组成，如果断言为 true 则匹配该路由</li><li>Predicate（断言）<br>参考的是 Java8 的 java.util.function.Predicate，开发人员可以匹配 HTTP 请求中的所有内容（例如请求头或请求参数），请求与断言匹配则进行路由</li><li>Filter（过滤）<br>指的是 Spring 框架中 GateWayFilter 的实例，使用过滤器，可以在请求被路由前或者之后对请求进行修改。</li><li>三个核心点连起来：<br>当用户发出请求到达 GateWay，GateWay 会通过一些匹配条件，定位到真正的服务节点，并在这个转发过程前后，进行一些及细化控制。其中 Predicate 就是我们匹配的条件，而 Filter 可以理解为一个过滤器，有了这两个点，再加上目标 URI，就可以实现一个具体的路由了。</li></ul><h2 id="总结-2"><a class="anchor" href="#总结-2">#</a> 总结</h2><p>GateWay 核心的流程就是：路由转发 + 执行过滤器链</p><h2 id="gateway搭建"><a class="anchor" href="#gateway搭建">#</a> GateWay 搭建</h2><p>那么我们现在已经了解了整体的基础概念以后，我们现在来搭建一个 GateWay 项目：cloudalibaba-gateway-9999</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1640707752000/365e2d4cfb1e41d68600e6283141c9ec.png" alt="image20211228224951746.png"></p><p>因为 GateWay 属于 SpringCloud 的，所以我们要导入对应依赖，一定要注意版本关系：</p><p>版本对应地址：<span class="exturl" data-url="aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWNsb3Vk">https://spring.io/projects/spring-cloud</span></p><p>老师这里使用的是<mark> SpringBoot2.2.6 的版本所以配合的是 SpringCloud 的 Hoxton.SR5 版本</mark></p><p><strong>注意：引入 GateWay 一定要删除 spring-boot-starter-web 依赖，否则会有冲突无法启动</strong></p><p>父级项目引入</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- parent 中 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud-gateway-version</span><span class="token punctuation">></span></span>Hoxton.SR5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud-gateway-version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token comment">&lt;!-- dependencyManagement 中写 --></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;spring-cloud-gateway-version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>子级项目，因为 GateWay 也需要注册进 Nacos，所以也需要 Nacos 的依赖</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- 子项目中 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>接着配置 YML 文件</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">application</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>getway<span class="token punctuation">-</span>service</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token key atrule">locator</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#开启注册中心路由功能</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment">#路由</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>provider  <span class="token comment">#路由 ID，没有固定要求，但是要保证唯一，建议配合服</span></pre></td></tr><tr><td data-num="16"></td><td><pre>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9001/nacos<span class="token punctuation">-</span>provider <span class="token comment"># 匹配提供服务的路由地址</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>  <span class="token comment"># 断言</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">-</span> Path=/msb/<span class="token important">**</span>  <span class="token comment"># 断言，路径相匹配进行路由</span></pre></td></tr></table></figure><p>更改 9001 的 DemoController，加上一个入口</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/msb"</span><span class="token punctuation">)</span><span class="token comment">// 路由路径</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController2</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;server.port&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/get"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"库存-1："</span><span class="token operator">+</span>serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>最后测试，启动 Nacos、9001 和 9999 网关，通过网关访问 9001 的 /msb/get 接口同时查看 Nacos 控制台</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1640707752000/a8cd2294313a430ea6da143b509a58c9.png" alt="image20211229000611111.png"></p><p>Nacos 控制台成功注册 GateWay 网关</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1640707752000/1c2350c5bb094391a656d9819ba1eb37.png" alt="image20211229000705630.png"></p><h1 id="gateway配置路由的两种方式"><a class="anchor" href="#gateway配置路由的两种方式">#</a> GateWay 配置路由的两种方式</h1><p>经过上节课的讲解，我们现在知道了 GateWay 的基本配置路由的方式，通过 YML 来完成，但是实际上 GateWay 还提供了另外一种配置方式</p><h2 id="gatewayconfig"><a class="anchor" href="#gatewayconfig">#</a> GatewayConfig</h2><p>其实这种配置方式就是通过代码的方式进行配置，也就是通过 @Bean 注入一个 RouteLocator</p><p>那我们直接来操作一下</p><h3 id="具体操作"><a class="anchor" href="#具体操作">#</a> 具体操作</h3><p>首先我们在新建一个 GateWayConfig，其实这里的配置对应的就是我们之前在 YML 中配置的对应内容</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cloudalibabagateway9999<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RouteLocator</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>route<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">RouteLocatorBuilder</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GateWayConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">/*</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    配置了一个 id 为 path_msb1 的路由规则</pre></td></tr><tr><td data-num="12"></td><td><pre>    当访问地址 http://localhost:9999/msb/**</pre></td></tr><tr><td data-num="13"></td><td><pre>    就会转发到 http://localhost:9001/nacos-provider/msb/ 任何地址</pre></td></tr><tr><td data-num="14"></td><td><pre>     */</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">customRouteLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> routeLocatorBuilder<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">// 构建多个路由 routes</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token class-name">RouteLocatorBuilder<span class="token punctuation">.</span>Builder</span> routes <span class="token operator">=</span> routeLocatorBuilder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">// 具体路由地址</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        routes<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"path_msb"</span><span class="token punctuation">,</span>r <span class="token operator">-></span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/msb/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9001/nacos-provider"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">// 返回所有路由规则</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>我们在 9001 的 DemoController 中添加一个控制器</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/custom"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">customTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">"网关配置测试~~costom"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这个时候我们就可以测试了，启动 9999 网关服务和 9001 微服务，然后访问地址：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5OTk5L21zYi9jdXN0b20=">http://localhost:9999/msb/custom</span> 就可以转发到 9001 中具体的接口中了</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1640864431000/ec294ed9249740c4a2a2ea694248cfa0.png" alt="image20211230193640615.png"></p><h1 id="gateway实现负载均衡"><a class="anchor" href="#gateway实现负载均衡">#</a> GateWay 实现负载均衡</h1><p>在之前的学习中，我们已经掌握了 GateWay 的一些基本配置，包括两种配置方法，但是其中有很多的配置细节，我们没有细讲，包括我们现在的配置是写死的具体端口号，那么这节课，我们要实现通过 GateWay 实现负载均衡的两种方式</p><h2 id="自动负载均衡"><a class="anchor" href="#自动负载均衡">#</a> 自动负载均衡</h2><p>首先我们看一下我们之前的网关服务 9999 的 yml 配置，这里的配置信息，其实有一些，咱们目前是不清楚的，比如：</p><ol><li>gateway.discovery.locator.enabled: true #开启自动路由功能</li><li>routes 中的 uri 其实最后是不需要服务名称的，这个位置其实只需要指定的 localhost:9001 即可</li></ol><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      discovery:
        locator:
          enabled: true #开启自动路由功能，根据服务名称自动创建routes
      routes:  # 路由
        - id: nacos-provider #路由ID，没有固定要求，但是要保证唯一，建议配合服务名
          uri: http://localhost:9001/nacos-provider # 匹配提供服务的路由地址
          predicates: # 断言
            - Path=/msb/** # 断言，路径相匹配进行路由
</code></pre><p>所以这个位置我们可以把当前的配置优化为以下情况，它是一样可以启动的，我们可以进行测试启动 9001 和网关 9999，通过网关来访问 &quot;localhost:9999/msb/**&quot;</p><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      routes:  # 路由
        - id: nacos-provider #路由ID，没有固定要求，但是要保证唯一，建议配合服务名
          uri: http://localhost:9001 # 匹配提供服务的路由地址
          predicates: # 断言
            - Path=/msb/** # 断言，路径相匹配进行路由
</code></pre><p>GateWay 还提供了和 Zuul 类似的自动路由规则，具体配置如下：</p><ol><li>discovery.locator.enabled: true #这个配置默认为 false，但是如果为 true，就是开启了通过 serviceId 转发到具体的服务实例。“localhost:9999/ServiceID/msb/**”</li><li>在配置好这些以后，我们可以直接通过服务名称来进行访问 Nacos 中注册的服务和对应的接口</li><li>这个位置我们为了测试可以启动 2 个微服务 9001、9002</li><li>GateWay 在开启了自动路由以后，还自带负载均衡</li></ol><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  port<span class="token punctuation">:</span> <span class="token number">9999</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  application<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name<span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>service</pre></td></tr><tr><td data-num="6"></td><td><pre>  cloud<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    nacos<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      discovery<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        server<span class="token punctuation">-</span><span class="token key atrule">addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    gateway<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      discovery<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        locator<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          enabled<span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#是否与服务发现组件进行结合，通过 serviceId 转发到具体的服务实例。默认为 false，设为 true 便开启通过服务中心的自动根据 serviceId 创建路由的功能。</span></pre></td></tr></table></figure><p>9002 和 9001 保持一致，Controller 保持一致，负载均衡测试</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>cloudalibabanacos9002<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/msb"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;server.port&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/get"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"库存-1："</span><span class="token operator">+</span>serverPort<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"custom"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">customTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"测试网关配置类~~custom"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>测试结果：</p><ul><li>访问地址：<ul><li><span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5OTk5L25hY29zLXByb3ZpZGVyL21zYi9nZXQ=">http://localhost:9999/nacos-provider/msb/get</span></li></ul></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641386784000/143b314052704e94b2011aa7effada65.png" alt="image20220105195136602.png"></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641386784000/818d5667a8a24cd5b17b7b7023cc02c0.png" alt="image20220105195151755.png"></p><h2 id="手动负载均衡"><a class="anchor" href="#手动负载均衡">#</a> 手动负载均衡</h2><p>在以上的配置中，其实是有问题的，问题在于当前的服务名称暴露，并且太过于灵活，那么如果想解决的话，其实我们可以进行手动配置。</p><p>具体配置如下：</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">application</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>getway<span class="token punctuation">-</span>service</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token key atrule">locator</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#开启注册中心路由功能</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment">#路由</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>provider  <span class="token comment">#路由 ID，没有固定要求，但是要保证唯一，建议配合服</span></pre></td></tr><tr><td data-num="16"></td><td><pre>          <span class="token comment"># lb 原则</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>provider <span class="token comment"># 匹配提供服务的路由地址</span></pre></td></tr><tr><td data-num="18"></td><td><pre>          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>  <span class="token comment"># 断言</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">-</span> Path=/msb/<span class="token important">**</span>  <span class="token comment"># 断言，路径相匹配进行路由</span></pre></td></tr></table></figure><h2 id="测试"><a class="anchor" href="#测试">#</a> 测试</h2><p>我们现在开启 9001/9002 两个服务和 9999 网关服务，然后此时我们可以通过网关去访问：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5OTk5L21zYi9nZXQ=">http://localhost:9999/msb/get</span></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641386784000/98b06ceeb9254c21a61ec8700808f6e9.png" alt="image20220105195839464.png"><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641386784000/09ebf499f4ab40a8b6d454eee1106b9d.png" alt="image20220105195849056.png"></p><h1 id="gateway断言predicate"><a class="anchor" href="#gateway断言predicate">#</a> GateWay 断言 Predicate</h1><p>这节课我们来研究一下 GateWay 的 Predicate（断言）</p><p>每一个 Predicate 的使用，可以理解为：当满足条件后才会进行转发，如果是多个，那就是满足所有条件才会转发</p><h2 id="断言种类"><a class="anchor" href="#断言种类">#</a> 断言种类</h2><ol><li>After：匹配在指定日期时间之后发生的请求。</li><li>Before：匹配在指定日期之前发生的请求。</li><li>Between：需要指定两个日期参数，设定一个时间区间，匹配此时间区间内的请求。</li><li>Cookie：需要指定两个参数，分别为 name 和 regexp（正则表达式），也可以理解 Key 和 Value，匹配具有给定名称且其值与正则表达式匹配的 Cookie。</li><li>Header：需要两个参数 header 和 regexp（正则表达式），也可以理解为 Key 和 Value，匹配请求携带信息。</li><li>Host：匹配当前请求是否来自于设置的主机。</li><li>Method：可以设置一个或多个参数，匹配 HTTP 请求，比如 GET、POST</li><li>Path：匹配指定路径下的请求，可以是多个用逗号分隔</li><li>Query：需要指定一个或者多个参数，一个必须参数和一个可选的正则表达式，匹配请求中是否包含第一个参数，如果有两个参数，则匹配请求中第一个参数的值是否符合正则表达式。</li><li>RemoteAddr：匹配指定 IP 或 IP 段，符合条件转发。</li><li>Weight：需要两个参数 group 和 weight（int），实现了路由权重功能，按照路由权重选择同一个分组中的路由</li></ol><h2 id="常用断言演示"><a class="anchor" href="#常用断言演示">#</a> 常用断言演示</h2><p>以上这么多的断言，我们不可能一一的去演示，我们挑出一些比较常用的来给大家做演示，这些具体的演示在官网上都有提供，具体地址为：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmctY2xvdWQtZ2F0ZXdheS9kb2NzL2N1cnJlbnQvcmVmZXJlbmNlL2h0bWwvI2dhdGV3YXktcmVxdWVzdC1wcmVkaWNhdGVzLWZhY3Rvcmllcw==">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories</span></p><h3 id="after"><a class="anchor" href="#after">#</a> After</h3><p>匹配在指定时间之后发生的请求，可以对应提前上线业务</p><p>yml 配置</p><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      discovery:
        locator:
          enabled: false # 是否与服务发现进行组合，通过ServiceID转发到具体的服务实例，默认为false，
                        # 设置为true便开启通过服务注册中心来自动根据SeviceID创建路由功能。
      routes:
        - id: nacos-provider # 路由ID，唯一不可重复，最好配合服务名
          uri: lb://nacos-provider # 匹配提供服务的路由地址 lb://代表开启负载均衡
          predicates: # 断言
            - Path=/msb/** # 匹配对应地址
            - After=2022-01-07T14:39:10.529+08:00[Asia/Shanghai] # 在这个时间之后的请求都能通过，当前没有为题以后，故意改为1个小时以后
</code></pre><p>写一个测试类，来获取当前时间</p><pre><code>public class TestDateTime &#123;
    public static void main(String[] args) &#123;
        ZonedDateTime zbj = ZonedDateTime.now();//默认时区
        System.out.println(zbj);
    &#125;
&#125;
</code></pre><p>测试：</p><p>当前时间之后请求没有问题</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/e10d464666ed4515a70aabd835daaee4.png" alt="image20220107151419442.png"></p><p>设置为 1 个小时会后访问 404</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/ce7286c95b3140abaa49eb0f8538d1f0.png" alt="image20220107151358287.png"></p><p>当这个 After 理解了以后，剩下的关于日期时间的设置 Before、Between 道理都是一样的，只不过是限定不同的日期时间区间</p><h3 id="cookie"><a class="anchor" href="#cookie">#</a> Cookie</h3><p>需要指定两个参数，分别为 name 和 regexp（正则表达式），也可以理解 Key 和 Value，匹配具有给定名称且其值与正则表达式匹配的 Cookie。</p><p>简单理解就是路由规则会通过获取 Cookie name 值和正则表达式去匹配，如果匹配上就会执行路由，如果匹配不上则不执行。</p><p>我们可以分为两种情况演示，Cookie 匹配，Cookie 不匹配</p><p>yml</p><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      discovery:
        locator:
          enabled: false # 是否与服务发现进行组合，通过ServiceID转发到具体的服务实例，默认为false，
                        # 设置为true便开启通过服务注册中心来自动根据SeviceID创建路由功能。
      routes:
        - id: nacos-provider # 路由ID，唯一不可重复，最好配合服务名
          uri: lb://nacos-provider # 匹配提供服务的路由地址 lb://代表开启负载均衡
          predicates: # 断言
            - Path=/msb/** # 匹配对应地址
            # - After=2022-01-07T14:39:10.529+08:00[Asia/Shanghai] # 在这个时间之后的请求都能通过
            - Cookie=username,[a-z]+ # 匹配Cookie的key和value（正则表达式）
</code></pre><p>那么我们通过 postman 来进行测试</p><p>当 Cookie 匹配时：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/9d55f65a1c7a4957b14bb5f9ffe1a0b3.png" alt="image20220107162754644.png"></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/44149a75b4bb4cada71862616de82422.png" alt="image20220107162819910.png"></p><p>当 Cookie 不匹配时：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/b4fd75971a834f33a3c2547a2e5c50a6.png" alt="image20220107162907000.png"></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/7f3eb02776804426875c429a6c48d47a.png" alt="image20220107162922622.png"></p><h3 id="header"><a class="anchor" href="#header">#</a> Header</h3><p>需要两个参数 header 和 regexp（正则表达式），也可以理解为 Key 和 Value，匹配请求携带信息。</p><p>实际上就是请求头携带的信息，官网给出的案例是 X-Request-Id，那我们就用这个做实验</p><p>yml</p><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      discovery:
        locator:
          enabled: false # 是否与服务发现进行组合，通过ServiceID转发到具体的服务实例，默认为false，
                        # 设置为true便开启通过服务注册中心来自动根据SeviceID创建路由功能。
      routes:
        - id: nacos-provider # 路由ID，唯一不可重复，最好配合服务名
          uri: lb://nacos-provider # 匹配提供服务的路由地址 lb://代表开启负载均衡
          predicates: # 断言
            - Path=/msb/** # 匹配对应地址
            #- After=2022-01-07T14:39:10.529+08:00[Asia/Shanghai] # 在这个时间之后的请求都能通过
            #- Cookie=username,[a-z]+
            - Header=X-Request-Id,\d+ #表示数字
</code></pre><p>测试</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/3188d44ced0446b09592794cc874caf5.png" alt="image20220107165412353.png"></p><h3 id="host"><a class="anchor" href="#host">#</a> Host</h3><p>匹配当前请求是否来自于设置的主机。</p><p>这个比较比较简单，我们直接来试验</p><p>yml</p><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      discovery:
        locator:
          enabled: false # 是否与服务发现进行组合，通过ServiceID转发到具体的服务实例，默认为false，
                        # 设置为true便开启通过服务注册中心来自动根据SeviceID创建路由功能。
      routes:
        - id: nacos-provider # 路由ID，唯一不可重复，最好配合服务名
          uri: lb://nacos-provider # 匹配提供服务的路由地址 lb://代表开启负载均衡
          predicates: # 断言
            - Path=/msb/** # 匹配对应地址
            #- After=2022-01-07T14:39:10.529+08:00[Asia/Shanghai] # 在这个时间之后的请求都能通过
            #- Cookie=username,[a-z]+
            #- Header=X-Request-Id,\d+ #表示数字
            - Host=**.mashibing.com #匹配当前的主机地址发出的请求
</code></pre><p>postman</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/229f6b3bddc744cdb2c34f6070700fd3.png" alt="image20220107165950636.png"></p><h3 id="method"><a class="anchor" href="#method">#</a> Method</h3><p>可以设置一个或多个参数，匹配 HTTP 请求，比如 GET、POST</p><p>yml</p><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      discovery:
        locator:
          enabled: false # 是否与服务发现进行组合，通过ServiceID转发到具体的服务实例，默认为false，
                        # 设置为true便开启通过服务注册中心来自动根据SeviceID创建路由功能。
      routes:
        - id: nacos-provider # 路由ID，唯一不可重复，最好配合服务名
          uri: lb://nacos-provider # 匹配提供服务的路由地址 lb://代表开启负载均衡
          predicates: # 断言
            - Path=/msb/** # 匹配对应地址
            #- After=2022-01-07T14:39:10.529+08:00[Asia/Shanghai] # 在这个时间之后的请求都能通过
            #- Cookie=username,[a-z]+
            #- Header=X-Request-Id,\d+ #表示数字
            #- Host=**.mashibing.com #匹配当前的主机地址发出的请求
            - Method=GET,POST # 匹配GET请求或者POST请求
</code></pre><h3 id="query"><a class="anchor" href="#query">#</a> Query</h3><p>需要指定一个或者多个参数，一个必须参数和一个可选的正则表达式，匹配请求中是否包含第一个参数，如果有两个参数，则匹配请求中第一个参数的值是否符合正则表达式。</p><p>yml</p><pre><code>server:
  port: 9999
spring:
  application:
    name: cloud-gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    gateway:
      discovery:
        locator:
          enabled: false # 是否与服务发现进行组合，通过ServiceID转发到具体的服务实例，默认为false，
                        # 设置为true便开启通过服务注册中心来自动根据SeviceID创建路由功能。
      routes:
        - id: nacos-provider # 路由ID，唯一不可重复，最好配合服务名
          uri: lb://nacos-provider # 匹配提供服务的路由地址 lb://代表开启负载均衡
          predicates: # 断言
            - Path=/msb/** # 匹配对应地址
            #- After=2022-01-07T14:39:10.529+08:00[Asia/Shanghai] # 在这个时间之后的请求都能通过
            #- Cookie=username,[a-z]+
            #- Header=X-Request-Id,\d+ #表示数字
            #- Host=**.mashibing.com #匹配当前的主机地址发出的请求
            #- Method=GET,POST
            - Query=id,.+ # 匹配请求参数，这里如果需要匹配多个参数，可以写多个Query
</code></pre><p>测试：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641548103000/000f9c26d9ab4e8ca3775883a77cfbeb.png" alt="image20220107172856256.png"></p><h3 id="weight"><a class="anchor" href="#weight">#</a> Weight</h3><p>需要两个参数 group 和 weight（int），实现了路由权重功能，按照路由权重选择同一个分组中的路由</p><p>官网提供的演示 yml</p><pre><code>spring:
  cloud:
    gateway:
      routes:
      - id: weight_high
        uri: https://weighthigh.org
        predicates:
        - Weight=group1, 8
      - id: weight_low
        uri: https://weightlow.org
        predicates:
        - Weight=group1, 2
</code></pre><p>该路由会将约 80% 的流量转发到<span class="exturl" data-url="aHR0cHM6Ly93ZWlnaHRoaWdoLm9yZy8="> weighthigh.org</span>，将约 20% 的流量<span class="exturl" data-url="aHR0cHM6Ly93ZWlnaGxvdy5vcmcv">转发</span>到<span class="exturl" data-url="aHR0cHM6Ly93ZWlnaGxvdy5vcmcv"> weightlow.org</span></p><h2 id="总结-3"><a class="anchor" href="#总结-3">#</a> 总结：</h2><p>Predicate 就是为了实现一组匹配规则，让请求过来找到对应的 Route 进行处理。</p><h1 id="gateway的filter"><a class="anchor" href="#gateway的filter">#</a> GateWay 的 Filter</h1><p>路由过滤器允许以某种方式修改传入的 HTTP 请求或传出的 HTTP 响应。路由过滤器的范围是特定的路由。Spring Cloud Gateway 包含许多内置的 GatewayFilter 工厂。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641558027000/20dc92cddbf14336afa83e9af1756e9c.png" alt="image20220107175844624.png"></p><h2 id="内置filter"><a class="anchor" href="#内置filter">#</a> 内置 Filter</h2><ol><li>GateWay 内置的 Filter 生命周期为两种：pre（业务逻辑之前）、post（业务逻辑之后）</li><li>GateWay 本身自带的 Filter 分为两种： GateWayFilter（单一）、GlobalFilter（全局）</li><li>单一的有 32 种，全局的有 9 种</li><li>官方网址：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmctY2xvdWQtZ2F0ZXdheS9kb2NzL2N1cnJlbnQvcmVmZXJlbmNlL2h0bWwvI2dsb2JhbC1maWx0ZXJz">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#global-filters</span></li></ol><p>这个数量实在是太惊人了，而且用法都比较简单，所以这里大家可以自行根据官网给出的演示进行练习，在这里给大家举一个例子</p><h3 id="stripprefix"><a class="anchor" href="#stripprefix">#</a> StripPrefix</h3><p>该 StripPrefix 有一个参数，parts。该 parts 参数指示在将请求发送到下游之前要从请求中剥离的路径中的部分数。</p><p>案例：比如我们现在在 9001 微服务上加一个 context-path 配置</p><pre><code>server:
  port: 9001
  servlet:
    context-path: /nacos-provider
.....
</code></pre><p>现在 9001 的访问路径变为<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MDAxL25hY29zLXByb3ZpZGVyL21zYi9nZXQ="> http://localhost:9001/nacos-provider/msb/get</span></p><p>目前的网关 9999 配置信息为</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  port<span class="token punctuation">:</span> <span class="token number">9999</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  application<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name<span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>service</pre></td></tr><tr><td data-num="6"></td><td><pre>  cloud<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    nacos<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      discovery<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        server<span class="token punctuation">-</span><span class="token key atrule">addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    gateway<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      discovery<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        locator<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          enabled<span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否与服务发现进行组合，通过 ServiceID 转发到具体的服务实例，默认为 false，</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                        <span class="token comment"># 设置为 true 便开启通过服务注册中心来自动根据 SeviceID 创建路由功能。</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      routes<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>provider <span class="token comment"># 路由 ID，唯一不可重复，最好配合服务名</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          uri<span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>provider <span class="token comment"># 匹配提供服务的路由地址 lb:// 代表开启负载均衡</span></pre></td></tr><tr><td data-num="18"></td><td><pre>          predicates<span class="token punctuation">:</span> <span class="token comment"># 断言</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">-</span> Path=/msb/<span class="token important">**</span> <span class="token comment"># 匹配对应地址</span></pre></td></tr></table></figure><p>为了保证断言能够匹配，此时通过网关的访问地址应该改为：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5OTk5L21zYi9uYWNvcy1wcm92aWRlci9tc2IvZ2V0">http://localhost:9999/msb/nacos-provider/msb/get</span>，但是出现了 404，因为多了一层路径<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MDAxL21zYi9uYWNvcy1wcm92aWRlci9tc2IvZ2V0"> http://localhost:9001/msb/nacos-provider/msb/get</span></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641558027000/eb87d2b41baf4409a8ff689b03de1b3f.png" alt="image20220107192432401.png"></p><p>那么如果想要解决，我们应该在转发的时候去地址中最前面的 /msb，所以我们就需要使用 FIlter：StripPrefix</p><p>yml</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  port<span class="token punctuation">:</span> <span class="token number">9999</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  application<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name<span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>service</pre></td></tr><tr><td data-num="6"></td><td><pre>  cloud<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    nacos<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      discovery<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        server<span class="token punctuation">-</span><span class="token key atrule">addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    gateway<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      discovery<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        locator<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          enabled<span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否与服务发现进行组合，通过 ServiceID 转发到具体的服务实例，默认为 false，</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                        <span class="token comment"># 设置为 true 便开启通过服务注册中心来自动根据 SeviceID 创建路由功能。</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      routes<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>provider <span class="token comment"># 路由 ID，唯一不可重复，最好配合服务名</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          uri<span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>provider <span class="token comment"># 匹配提供服务的路由地址 lb:// 代表开启负载均衡</span></pre></td></tr><tr><td data-num="18"></td><td><pre>          predicates<span class="token punctuation">:</span> <span class="token comment"># 断言</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">-</span> Path=/msb/<span class="token important">**</span> <span class="token comment"># 匹配对应地址</span></pre></td></tr><tr><td data-num="20"></td><td><pre>          filters<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token punctuation">-</span> StripPrefix=1 <span class="token comment"># 去掉地址中的第一部分</span></pre></td></tr><tr><td data-num="22"></td><td><pre>          <span class="token comment"># http://localhost:9999/msb/nacos-provider/msb/get</span></pre></td></tr><tr><td data-num="23"></td><td><pre>          <span class="token comment"># http://localhost:9999/nacos-provider/msb/get</span></pre></td></tr></table></figure><p>最后我们来看效果，成功转发</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641558027000/386221c4ba7a4b1ba809ff3a4df07a17.png" alt="image20220107193321333.png"></p><h2 id="自定义filter"><a class="anchor" href="#自定义filter">#</a> 自定义 Filter</h2><p>要实现 GateWay 自定义过滤器，那么我们需要实现两个接口</p><ul><li>GlobalFilter</li><li>Ordered</li></ul><h3 id="演示"><a class="anchor" href="#演示">#</a> 演示</h3><p>首先我们新建一个类 MyFilter</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Ordered</span><span class="token punctuation">,</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="5"></td><td><pre>     * @param exchange 可以拿到对应的 request 和 response</pre></td></tr><tr><td data-num="6"></td><td><pre>     * @param chain 过滤器链</pre></td></tr><tr><td data-num="7"></td><td><pre>     * @return 是否放行</pre></td></tr><tr><td data-num="8"></td><td><pre>     */</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">String</span> username <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"*************MyFilter:"</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"**********用户名为null，非法用户，请求被拒绝！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token comment">// 如果 username 为空，返回状态码为 406，不可接受的请求</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">NOT_ACCEPTABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="23"></td><td><pre>     * 加载过滤器的顺序</pre></td></tr><tr><td data-num="24"></td><td><pre>     * @return 整数数字越小优先级越高</pre></td></tr><tr><td data-num="25"></td><td><pre>     */</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>测试，此时我们的逻辑是在访问同时要传入 username 参数同时不能为空，否则不会放行本次请求。</p><p>传入正确参数：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641558027000/77ae413012cd46cbb75379f86cdb4d01.png" alt="image20220107201951485.png"></p><p>未传入正确参数：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1396/1641558027000/670b520f4edc4c57937334a6a7be2155.png" alt="image20220107202003694.png"></p><h1 id="gateway的跨域"><a class="anchor" href="#gateway的跨域">#</a> Gateway 的跨域</h1><p>一旦我们用了 Gateway 服务做了我们的网关服务，那么首先我们就要先解决我们<strong>网关服务的跨域</strong>问题。</p><p>在我们的网关服务中添加对于跨域的配置</p><ol><li><p>建立一个网关服务的配置类 ，exmaple: <code>GatewayConfig</code></p></li><li><p>添加跨域的配置</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span></span><span class="token class-name">CorsConfiguration</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">CorsWebFilter</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">UrlBasedCorsConfigurationSource</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>util<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span></span><span class="token class-name">PathPatternParser</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayConfiguration</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">CorsWebFilter</span> <span class="token function">corsWebFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">CorsConfiguration</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        config<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        config<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        config<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token class-name">UrlBasedCorsConfigurationSource</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathPatternParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        source<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CorsWebFilter</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>重启服务</p></li></ol><div id="gitalk-container"></div><script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalkConfig={clientID:"6db178ba46c8af8f6a6f",clientSecret:"90f730e5956024596558df00975cd8eae28cae3d",repo:"bk-comment01",owner:"onlymarryu",admin:["onlymarryu"],distractionFreeMode:!1,language:"zh-CN",proxy:"https://gitalk-comments.netlify.app/github_access_token",perPage:15};gitalkConfig.id=md5(location.pathname);var gitalk=new Gitalk(gitalkConfig);gitalk.render("gitalk-container")</script><div class="tags"><a href="/tags/Gateway/" rel="tag"><i class="ic i-tag"></i> Gateway</a> <a href="/tags/spring-cloud-alibaba/" rel="tag"><i class="ic i-tag"></i> spring-cloud-alibaba</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-07-10 22:05:15" itemprop="dateModified" datetime="2023-07-10T22:05:15+08:00">2023-07-10</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="雾都 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="雾都 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="雾都 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>雾都 <i class="ic i-at"><em>@</em></i>每天进步一点点，就是成功的开始</li><li class="link"><strong>本文链接：</strong> <a href="https://eth168.top/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" title="Gateway 系统学习">https://eth168.top/Spring_Family/spring-cloud-alibaba/Gateway系统学习/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E6%BA%90%E7%A0%81%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?982680" title="Sentinel源码系统学习"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 微服务</span><h3>Sentinel源码系统学习</h3></a></div><div class="item right"><a href="/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?498835" title="Seata系统学习"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 微服务</span><h3>Seata系统学习</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E5%85%B3%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">网关介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E5%85%B3%E5%AF%B9%E6%AF%94"><span class="toc-number">1.1.</span> <span class="toc-text">网关对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gateway"><span class="toc-number">1.2.</span> <span class="toc-text">GateWay</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">基本概念：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">执行流程：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.</span> <span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gateway%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8Bgateway%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">GateWay 工作流程 + GateWay 基础搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">核心点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">2.2.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gateway%E6%90%AD%E5%BB%BA"><span class="toc-number">2.3.</span> <span class="toc-text">GateWay 搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gateway%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">GateWay 配置路由的两种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gatewayconfig"><span class="toc-number">3.1.</span> <span class="toc-text">GatewayConfig</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="toc-number">3.1.1.</span> <span class="toc-text">具体操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gateway%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">4.</span> <span class="toc-text">GateWay 实现负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">4.1.</span> <span class="toc-text">自动负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">4.2.</span> <span class="toc-text">手动负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gateway%E6%96%AD%E8%A8%80predicate"><span class="toc-number">5.</span> <span class="toc-text">GateWay 断言 Predicate</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E7%A7%8D%E7%B1%BB"><span class="toc-number">5.1.</span> <span class="toc-text">断言种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%AD%E8%A8%80%E6%BC%94%E7%A4%BA"><span class="toc-number">5.2.</span> <span class="toc-text">常用断言演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#after"><span class="toc-number">5.2.1.</span> <span class="toc-text">After</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie"><span class="toc-number">5.2.2.</span> <span class="toc-text">Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#header"><span class="toc-number">5.2.3.</span> <span class="toc-text">Header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#host"><span class="toc-number">5.2.4.</span> <span class="toc-text">Host</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#method"><span class="toc-number">5.2.5.</span> <span class="toc-text">Method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#query"><span class="toc-number">5.2.6.</span> <span class="toc-text">Query</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#weight"><span class="toc-number">5.2.7.</span> <span class="toc-text">Weight</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">5.3.</span> <span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gateway%E7%9A%84filter"><span class="toc-number">6.</span> <span class="toc-text">GateWay 的 Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AEfilter"><span class="toc-number">6.1.</span> <span class="toc-text">内置 Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stripprefix"><span class="toc-number">6.1.1.</span> <span class="toc-text">StripPrefix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89filter"><span class="toc-number">6.2.</span> <span class="toc-text">自定义 Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA"><span class="toc-number">6.2.1.</span> <span class="toc-text">演示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gateway%E7%9A%84%E8%B7%A8%E5%9F%9F"><span class="toc-number">7.</span> <span class="toc-text">Gateway 的跨域</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Spring_Family/spring-cloud-alibaba/Nacos%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Nacos系统学习">Nacos系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Sentinel系统学习">Sentinel系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E6%BA%90%E7%A0%81%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Sentinel源码系统学习">Sentinel源码系统学习</a></li><li class="active"><a href="/Spring_Family/spring-cloud-alibaba/Gateway%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Gateway系统学习">Gateway系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="Seata系统学习">Seata系统学习</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%85%B3%E4%BA%8E%E5%85%B3%E4%BA%8ENacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE/" rel="bookmark" title="关于关于Nacos配置中心的配置">关于关于Nacos配置中心的配置</a></li><li><a href="/Spring_Family/spring-cloud-alibaba/Problem/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E9%A1%BA%E5%BA%8F/" rel="bookmark" title="微服务加载配置顺序">微服务加载配置顺序</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="雾都" data-src="/images/avatar.jpg"><p class="name" itemprop="name">雾都</p><div class="description" itemprop="description">花非花，雾非雾</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">85</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">30</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL29ubHltYXJyeXU=" title="https:&#x2F;&#x2F;github.com&#x2F;onlymarryu"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9ydXJpc216aw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;rurismzk"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvbXkvbS9tdXNpYy9wbGF5bGlzdD9pZD0zMTY2MDYwNzkw" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;my&#x2F;m&#x2F;music&#x2F;playlist?id&#x3D;3166060790"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vYW1laGltZQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime"><i class="ic i-weibo"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>时间轴</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/toolPage/" rel="section"><i class="ic i-feather"></i>常用工具设置技巧</a></li><li class="item"><a href="/projectBuild/" rel="section"><i class="ic i-th"></i>SpringBoot常用配置</a></li></ul></li><li class="item"><a href="/mianshi/" rel="section"><i class="ic i-calendar"></i>面试</a></li><li class="item"><a href="/study/" rel="section"><i class="ic i-sakura"></i>小实验</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-calendar"></i>留言</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Spring_Family/spring-cloud-alibaba/Sentinel%E6%BA%90%E7%A0%81%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Spring_Family/spring-cloud-alibaba/Seata%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/" title="分类于 Spring 全家桶">Spring 全家桶</a></div><span><a href="/Spring_Family/SpringBoot/" title="SpringBoot">SpringBoot</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/toolsPage/%E5%B8%B8%E7%94%A8Typeroa%E6%A0%BC%E5%BC%8F/" title="常用Typeroa格式">常用Typeroa格式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/Nacos-tool/" title="Nacos">Nacos</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B0%8F%E5%AE%9E%E9%AA%8C/" title="分类于 小实验">小实验</a></div><span><a href="/study/develop/eu.org/" title="获取免费域名">获取免费域名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JavaSE/" title="分类于 JavaSE">JavaSE</a></div><span><a href="/Java/%E7%AC%AC15%E7%AB%A0Junit%E6%B3%A8%E8%A7%A3_%E6%9E%9A%E4%B8%BE/" title="第15章Junit注解_枚举">第15章Junit注解_枚举</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="分类于 数据库">数据库</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" title="分类于 MySQL">MySQL</a></div><span><a href="/DataBase/MySQL/MySQL_Basic/" title="MySQL基础">MySQL基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a></div><span><a href="/Distribution/FastDFS/" title="FastDFS">FastDFS</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%89%8D%E7%AB%AF/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/" title="分类于 框架">框架</a></div><span><a href="/Web-anteriore/Vue2-3/vue3%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" title="Vue3">Vue3</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" title="分类于 工具软件安装">工具软件安装</a></div><span><a href="/tools/RabbitMQ-tool/" title="RabbitMQ">RabbitMQ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a></div><span><a href="/Distribution/RPC/" title="RPC">RPC</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">雾都 @ 雾都博客</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.5m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">22:43</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Spring_Family/spring-cloud-alibaba/Gateway系统学习/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(i){return i.includes("#")},function(i){return new RegExp(LOCAL.path+"$").test(i)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>